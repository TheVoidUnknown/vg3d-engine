import{a as K,f as se,d as Gi,c as Wa}from"../chunks/BWELI9yk.js";import{o as Xa,a as qa}from"../chunks/DY35G3v2.js";import{e as Bn,n as Ya,aT as Er,h as fe,x as Hn,Y as Za,o as Ga,D as w,t as Ka,v as Ja,w as _s,y as Wn,i as Ht,ai as Qa,aL as eo,au as Ms,c as at,aU as we,f as Ii,aV as to,s as no,T as io,aW as so,aJ as Ki,aX as ro,aY as ao,aP as oo,ag as ws,aZ as ho,r as Rr,p as Ir,a_ as Xn,q as lo,a$ as co,b0 as uo,aI as fo,d as mo,aF as po,b1 as Fr,k as Ji,A as Or,aQ as go,b2 as xo,z as bo,a8 as dt,aa as le,ab as mt,ac as O,ae as j,ad as F,av as vo,G as X,aS as At,aR as oe,a9 as Fi,b3 as Oi,F as Ts}from"../chunks/CPb4-PPZ.js";import{s as $e,d as Nt,a as qe,e as hn}from"../chunks/Cq5ivxsv.js";import{p as Z,b as Qi,i as Ve}from"../chunks/5MCOkXQm.js";import{s as q,r as Pr}from"../chunks/BFnA5Vmi.js";import{b as yo}from"../chunks/Dy5m1toL.js";function Dr(t,e){return e}function _o(t,e,n){for(var i=[],s=e.length,r,a=e.length,o=0;o<s;o++){let u=e[o];Ir(u,()=>{if(r){if(r.pending.delete(u),r.done.add(u),r.pending.size===0){var f=t.outrogroups;Pi(Ki(r.done)),f.delete(r),f.size===0&&(t.outrogroups=null)}}else a-=1},!1)}if(a===0){var h=i.length===0&&n!==null;if(h){var l=n,c=l.parentNode;fo(c),c.append(l),t.items.clear()}Pi(e,!h)}else r={pending:new Set(e),done:new Set},(t.outrogroups??=new Set).add(r)}function Pi(t,e=!0){for(var n=0;n<t.length;n++)mo(t[n],e)}var ks;function ln(t,e,n,i,s,r=null){var a=t,o=new Map,h=(e&Er)!==0;if(h){var l=t;a=fe?Hn(Za(l)):l.appendChild(Bn())}fe&&Ga();var c=null,u=io(()=>{var p=n();return so(p)?p:p==null?[]:Ki(p)}),f,d=!0;function m(){x.fallback=c,Mo(x,f,a,e,i),c!==null&&(f.length===0?(c.f&we)===0?Rr(c):(c.f^=we,zt(c,null,a)):Ir(c,()=>{c=null}))}var g=Ya(()=>{f=w(u);var p=f.length;let v=!1;if(fe){var b=Ka(a)===Ja;b!==(p===0)&&(a=_s(),Hn(a),Wn(!1),v=!0)}for(var y=new Set,z=at,C=no(),k=0;k<p;k+=1){fe&&Ht.nodeType===Qa&&Ht.data===eo&&(a=Ht,v=!0,Wn(!1));var A=f[k],R=i(A,k),S=d?null:o.get(R);S?(S.v&&Ms(S.v,A),S.i&&Ms(S.i,k),C&&z.unskip_effect(S.e)):(S=wo(o,d?a:ks??=Bn(),A,R,k,s,e,n),d||(S.e.f|=we),o.set(R,S)),y.add(R)}if(p===0&&r&&!c&&(d?c=Ii(()=>r(a)):(c=Ii(()=>r(ks??=Bn())),c.f|=we)),p>y.size&&to(),fe&&p>0&&Hn(_s()),!d)if(C){for(const[I,L]of o)y.has(I)||z.skip_effect(L.e);z.oncommit(m),z.ondiscard(()=>{})}else m();v&&Wn(!0),w(u)}),x={effect:g,items:o,outrogroups:null,fallback:c};d=!1,fe&&(a=Ht)}function yt(t){for(;t!==null&&(t.f&co)===0;)t=t.next;return t}function Mo(t,e,n,i,s){var r=(i&uo)!==0,a=e.length,o=t.items,h=yt(t.effect.first),l,c=null,u,f=[],d=[],m,g,x,p;if(r)for(p=0;p<a;p+=1)m=e[p],g=s(m,p),x=o.get(g).e,(x.f&we)===0&&(x.nodes?.a?.measure(),(u??=new Set).add(x));for(p=0;p<a;p+=1){if(m=e[p],g=s(m,p),x=o.get(g).e,t.outrogroups!==null)for(const S of t.outrogroups)S.pending.delete(x),S.done.delete(x);if((x.f&we)!==0)if(x.f^=we,x===h)zt(x,null,n);else{var v=c?c.next:h;x===t.effect.last&&(t.effect.last=x.prev),x.prev&&(x.prev.next=x.next),x.next&&(x.next.prev=x.prev),Ce(t,c,x),Ce(t,x,v),zt(x,v,n),c=x,f=[],d=[],h=yt(c.next);continue}if((x.f&Xn)!==0&&(Rr(x),r&&(x.nodes?.a?.unfix(),(u??=new Set).delete(x))),x!==h){if(l!==void 0&&l.has(x)){if(f.length<d.length){var b=d[0],y;c=b.prev;var z=f[0],C=f[f.length-1];for(y=0;y<f.length;y+=1)zt(f[y],b,n);for(y=0;y<d.length;y+=1)l.delete(d[y]);Ce(t,z.prev,C.next),Ce(t,c,z),Ce(t,C,b),h=b,c=C,p-=1,f=[],d=[]}else l.delete(x),zt(x,h,n),Ce(t,x.prev,x.next),Ce(t,x,c===null?t.effect.first:c.next),Ce(t,c,x),c=x;continue}for(f=[],d=[];h!==null&&h!==x;)(l??=new Set).add(h),d.push(h),h=yt(h.next);if(h===null)continue}(x.f&we)===0&&f.push(x),c=x,h=yt(x.next)}if(t.outrogroups!==null){for(const S of t.outrogroups)S.pending.size===0&&(Pi(Ki(S.done)),t.outrogroups?.delete(S));t.outrogroups.size===0&&(t.outrogroups=null)}if(h!==null||l!==void 0){var k=[];if(l!==void 0)for(x of l)(x.f&Xn)===0&&k.push(x);for(;h!==null;)(h.f&Xn)===0&&h!==t.fallback&&k.push(h),h=yt(h.next);var A=k.length;if(A>0){var R=(i&Er)!==0&&a===0?n:null;if(r){for(p=0;p<A;p+=1)k[p].nodes?.a?.measure();for(p=0;p<A;p+=1)k[p].nodes?.a?.fix()}_o(t,k,R)}}r&&lo(()=>{if(u!==void 0)for(x of u)x.nodes?.a?.apply()})}function wo(t,e,n,i,s,r,a,o){var h=(a&ro)!==0?(a&ao)===0?oo(n,!1,!1):ws(n):null,l=(a&ho)!==0?ws(s):null;return{v:h,i:l,e:Ii(()=>(r(e,h??n,l??s,o),()=>{t.delete(i)}))}}function zt(t,e,n){if(t.nodes)for(var i=t.nodes.start,s=t.nodes.end,r=e&&(e.f&we)===0?e.nodes.start:n;i!==null;){var a=po(i);if(r.before(i),i===s)return;i=a}}function Ce(t,e,n){e===null?t.effect.first=n:e.next=n,n===null?t.effect.last=e:n.prev=e}function To(t,e,n){var i=t==null?"":""+t;return i===""?null:i}function ko(t,e){return t==null?null:String(t)}function Et(t,e,n,i,s,r){var a=t.__className;if(fe||a!==n||a===void 0){var o=To(n);(!fe||o!==t.getAttribute("class"))&&(o==null?t.removeAttribute("class"):t.className=o),t.__className=n}return r}function Di(t,e,n,i){var s=t.__style;if(fe||s!==e){var r=ko(e);(!fe||r!==t.getAttribute("style"))&&(r==null?t.removeAttribute("style"):t.style.cssText=r),t.__style=e}return i}function zo(t,e,n=e){var i=new WeakSet;Fr(t,"input",async s=>{var r=s?t.defaultValue:t.value;if(r=qn(t)?Yn(r):r,n(r),at!==null&&i.add(at),await go(),r!==(r=e())){var a=t.selectionStart,o=t.selectionEnd,h=t.value.length;if(t.value=r??"",o!==null){var l=t.value.length;a===o&&o===h&&l>h?(t.selectionStart=l,t.selectionEnd=l):(t.selectionStart=a,t.selectionEnd=Math.min(o,l))}}}),(fe&&t.defaultValue!==t.value||Ji(e)==null&&t.value)&&(n(qn(t)?Yn(t.value):t.value),at!==null&&i.add(at)),Or(()=>{var s=e();if(t===document.activeElement){var r=xo??at;if(i.has(r))return}qn(t)&&s===Yn(t.value)||t.type==="date"&&!s&&!t.value||s!==t.value&&(t.value=s??"")})}function Co(t,e,n=e){Fr(t,"change",i=>{var s=i?t.defaultChecked:t.checked;n(s)}),(fe&&t.defaultChecked!==t.checked||Ji(e)==null)&&n(t.checked),Or(()=>{var i=e();t.checked=!!i})}function qn(t){var e=t.type;return e==="number"||e==="range"}function Yn(t){return t===""?null:+t}class es{#e=new WeakMap;#t;#n;static entries=new WeakMap;constructor(e){this.#n=e}observe(e,n){var i=this.#e.get(e)||new Set;return i.add(n),this.#e.set(e,i),this.#i().observe(e,this.#n),()=>{var s=this.#e.get(e);s.delete(n),s.size===0&&(this.#e.delete(e),this.#t.unobserve(e))}}#i(){return this.#t??(this.#t=new ResizeObserver(e=>{for(var n of e){es.entries.set(n.target,n);for(var i of this.#e.get(n.target)||[])i(n)}}))}}var So=new es({box:"border-box"});function zs(t,e,n){var i=So.observe(t,()=>n(t[e]));bo(()=>(Ji(()=>n(t[e])),i))}var Ao=se('<div class="flex items-center gap-2 text-xs"><div class="w-2.5 h-2.5 rounded-full shadow-[0_0_8px]"></div> <div class="flex flex-col leading-none"><span class="text-zinc-400 font-medium uppercase tracking-wider text-[10px]"> </span> <span class="text-zinc-100 font-mono font-bold mt-0.5"> <span class="text-zinc-500 text-[10px] lowercase"> </span></span></div></div>'),Eo=se('<div class="text-zinc-500 text-xs italic">Waiting for data...</div>'),Ro=Gi('<line x1="0" x2="100%" stroke="white" stroke-dasharray="2 4" stroke-width="1"></line>'),Io=Gi('<path fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" vector-effect="non-scaling-stroke" class="opacity-90 drop-shadow-md transition-all duration-300 ease-linear"></path>'),Fo=se('<div class="flex flex-col h-full w-full gap-3 p-4 bg-zinc-900/80  font-mono"><div class="flex flex-wrap gap-x-5 gap-y-2 shrink-0"></div> <div class="relative grow w-full min-h-12 max-h-12 bg-zinc-950/50 rounded border border-zinc-800/50 overflow-hidden"><svg class="absolute inset-0 pointer-events-none w-full h-full opacity-20"><!><line x1="0" y1="99%" x2="100%" y2="99%" stroke="white" stroke-width="1"></line></svg> <svg class="absolute inset-0 overflow-visible opacity-75" preserveAspectRatio="none"></svg></div></div>');function Oo(t,e){dt(e,!0);let n=Z(e,"smooth",3,!0),i=Z(e,"snapshots",19,()=>[]),s=oe(0),r=oe(0);const a=[{key:"ups",label:"UPS",color:"#3b82f6",getValue:p=>Number(p.ups)},{key:"fps",label:"FPS",color:"#22c55e",getValue:p=>Number(p.fps)},{key:"cpuMs",label:"CPU",color:"#ef4444",unit:"ms",getValue:p=>Number(p.cpuMs)},{key:"renderMs",label:"Render",color:"#eab308",unit:"ms",getValue:p=>Number(p.renderMs)},{key:"activeObjs",label:"Objs",color:"#a855f7",getValue:p=>p.activeObjs.opaque+p.activeObjs.transparent}];function o(p){let v=0;for(let b=0;b<p.length;b++)p[b]>v&&(v=p[b]);return v||1}function h(p){if(p.length===0)return"";if(p.length===1)return`M ${p[0].x} ${p[0].y}`;let v=`M ${p[0].x} ${p[0].y}`;for(let b=0;b<p.length-1;b++){const y=p[b===0?0:b-1],z=p[b],C=p[b+1],k=p[b+2]||C,A=z.x+(C.x-y.x)/6,R=z.y+(C.y-y.y)/6,S=C.x-(k.x-z.x)/6,I=C.y-(k.y-z.y)/6;v+=` C ${A} ${R}, ${S} ${I}, ${C.x} ${C.y}`}return v}const l=At(()=>{if(!i().length)return[];const p=Math.ceil(e.duration*1e3/e.interval);return i().length>p?i().slice(-p):i()}),c=At(()=>w(l).length<2||w(s)===0||w(r)===0?[]:a.map(p=>{const v=w(l).map(p.getValue),b=v[v.length-1]??0,y=o(v),z=v.map((k,A)=>({x:A/(v.length-1)*w(s),y:w(r)-k/y*w(r)})),C=n()?h(z):`M ${z.map(k=>`${k.x},${k.y}`).join(" L ")}`;return{...p,d:C,current:b,max:y}}));var u=Fo(),f=O(u);ln(f,21,()=>a,p=>p.key,(p,v)=>{const b=At(()=>e.currentSnapshot?w(v).getValue(e.currentSnapshot):0);var y=Ao(),z=O(y),C=j(z,2),k=O(C),A=O(k,!0);F(k);var R=j(k,2),S=O(R),I=j(S),L=O(I,!0);F(I),F(R),F(C),F(y),le(B=>{Di(z,`background-color: ${w(v).color??""}; box-shadow: 0 0 8px ${w(v).color??""}44`),$e(A,w(v).label),$e(S,`${B??""} `),$e(L,w(v).unit??"")},[()=>w(b).toFixed(1)]),K(p,y)},p=>{var v=Eo();K(p,v)}),F(f);var d=j(f,2),m=O(d),g=O(m);ln(g,16,()=>[.25,.5,.75],Dr,(p,v)=>{var b=Ro();le(()=>{q(b,"y1",`${v*100}%`),q(b,"y2",`${v*100}%`)}),K(p,b)}),vo(),F(m);var x=j(m,2);ln(x,21,()=>w(c),p=>p.key,(p,v)=>{var b=Io();le(()=>{q(b,"d",w(v).d),q(b,"stroke",w(v).color)}),K(p,b)}),F(x),F(d),F(u),le(()=>{q(x,"width",w(s)),q(x,"height",w(r)),q(x,"viewBox",`0 0 ${w(s)??""} ${w(r)??""}`)}),zs(d,"clientWidth",p=>X(s,p)),zs(d,"clientHeight",p=>X(r,p)),K(t,u),mt()}var Po=se(`<button class="
    flex grow justify-center p-1 px-2
    bg-zinc-700 rounded-md font-bold
    hover:bg-amber-700 active:bg-amber-600
    active:scale-95
    transition-all duration-150
  "> </button> <input type="file" accept=".vgd" style="display: none;"/>`,1);function Do(t,e){dt(e,!0);let n=Z(e,"label",3,"Upload VGD"),i;async function s(l){const c=l.target,u=c.files?.[0];if(u)try{const f=await u.text();e.onUpload(f),c.value=""}catch(f){throw new Error(`Error reading .vgd file: ${f}`)}}var r=Po(),a=Fi(r),o=O(a,!0);F(a);var h=j(a,2);Qi(h,l=>i=l,()=>i),le(()=>$e(o,n())),qe("click",a,()=>i.click()),qe("change",h,s),K(t,r),mt()}Nt(["click","change"]);var No=se('<label class="block text-zinc-200 mb-1"> </label>'),jo=se('<span class="flex justify-between items-center"><!></span>'),Lo=se('<div><!> <input type="number"/></div>');function Ue(t,e){dt(e,!0);let n=Z(e,"value",15),i=Z(e,"scrollable",3,!0),s=Z(e,"label",3,void 0),r=Z(e,"disabled",3,!1),a=Z(e,"min",19,()=>-2e16),o=Z(e,"max",3,2e16),h=Z(e,"step",3,1),l=Z(e,"shiftStep",3,.1),c=Z(e,"ctrlStep",3,.01),u=Z(e,"placeholder",3,"0.00"),f=Z(e,"mini",3,!1);const d=`number-input-${Math.random().toString(36).substring(2,9)}`,m=[h(),l(),c()].sort((R,S)=>R-S)[0];let g=oe(!1);function x(R){if(!i()||r())return;R.preventDefault();const S=Number(n())||0;let I;R.deltaY<0?I=S+(R.ctrlKey?c():w(g)?l():h()):I=S-(R.ctrlKey?c():w(g)?l():h());const L=Math.max(a(),Math.min(o(),I));n(v(L,m)),e.onChange&&e.onChange(n()??0)}function p(){n(n()===0?0:v(n(),m)),e.onChange&&e.onChange(n()??0)}function v(R,S){if(R)return Math.round(R/S)*S}function b(R){R.key==="Shift"&&X(g,!0)}function y(R){R.key==="Shift"&&X(g,!1)}var z=Lo();hn("keydown",Oi,b),hn("keyup",Oi,y);var C=O(z);{var k=R=>{var S=jo(),I=O(S);{var L=B=>{var H=No(),re=O(H,!0);F(H),le(()=>{q(H,"for",d),$e(re,s())}),K(B,H)};Ve(I,B=>{s()&&B(L)})}F(S),K(R,S)};Ve(C,R=>{(s()||e.tooltip)&&R(k)})}var A=j(C,2);Pr(A),F(z),le(()=>{Et(z,1,`flex flex-col gap-1 text-left ${f()?"w-full":"min-w-8"}`),q(A,"id",d),A.disabled=r(),q(A,"placeholder",u()),q(A,"min",a()),q(A,"max",o()),q(A,"step",h()),Et(A,1,`w-full rounded-lg bg-zinc-700 px-2 py-1 text-zinc-100 
           focus:outline-none focus:ring-2 focus:ring-amber-600 
           disabled:cursor-not-allowed disabled:opacity-50
           [appearance:textfield] [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none
           ${f()?"text-center":""}
    `)}),hn("wheel",A,x),qe("change",A,p),zo(A,n),K(t,z),mt()}Nt(["change"]);var Uo=Gi('<g data-draggable="true" data-disable-drag="true"><rect height="100%" width="100%" fill="transparent" role="button" tabindex="-7" style="cursor:ew-resize;clip-path: polygon(100% 0, 100% 100%, 0% 100%, 0% 0%, 0 0);"></rect><rect y="0" height="100%" fill="oklch(66.6% 0.179 58.318)" role="button" tabindex="-7" style="cursor:ew-resize;clip-path: polygon(100% 0, 100% 100%, 0% 100%, 0% 0%, 0 0);"></rect></g>');function $o(t,e){dt(e,!0);let n=Z(e,"timestamp",15,0),i=Z(e,"duration",3,1/0),s=Z(e,"width",3,10),r,a=!1;function o(d){a=!0,window.addEventListener("mousemove",h),window.addEventListener("mouseup",l)}function h(d){if(a&&r){const m=r.getClientRects().item(0);if(!m?.width)return;n(d.offsetX/m.width*i())}}function l(){a=!1,window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",l)}var c=Uo(),u=O(c);q(u,"y",0);var f=j(u);F(c),Qi(c,d=>r=d,()=>r),le(()=>{q(f,"x",`${n()/i()*100}%`),q(f,"width",s())}),qe("mousedown",u,o),qe("mousedown",f,o),K(t,c),mt()}Nt(["mousedown"]);var Vo=se("<label> </label>"),Bo=se('<span class="flex justify-between items-center select-none gap-2"><!></span>'),Ho=se('<div class="flex gap-4 text-left w-full items-center"><input type="checkbox" class="hidden"/> <button><span></span></button> <!></div>');function Zn(t,e){dt(e,!0);let n=Z(e,"isChecked",15);const i=`number-input-${Math.random().toString(36).substring(2,9)}`;function s(){e.disabled||(n(!n()),e.onClick&&e.onClick())}var r=Ho(),a=O(r);Pr(a);var o=j(a,2),h=O(o);F(o);var l=j(o,2);{var c=u=>{var f=Bo(),d=O(f);{var m=g=>{var x=Vo(),p=O(x,!0);F(x),le(()=>{q(x,"for",i),Et(x,1,`
            block text-zinc-200
            ${e.disabled?"cursor-not-allowed opacity-50":"cursor-pointer"}
          `),$e(p,e.label)}),K(g,x)};Ve(d,g=>{e.label&&g(m)})}F(f),K(u,f)};Ve(l,u=>{(e.label||e.tooltip)&&u(c)})}F(r),le(()=>{q(a,"id",i),a.disabled=e.disabled,q(o,"aria-label",i),Et(o,1,`
      relative border-2 w-6 h-6 rounded-md transition-colors duration-150 
      ${e.disabled?"cursor-not-allowed":"cursor-pointer"}
      ${n()?"border-amber-600":"border-zinc-700"}
    `),Et(h,1,`absolute transition-all duration-50 bg-amber-600 rounded-sm top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 ${n()?"w-4 h-4":"w-0 h-0"}`)}),Co(a,n),qe("click",o,s),K(t,r),mt()}Nt(["click"]);const Nr=(t,e)=>{if(typeof t=="number"){if(e===3)return{mode:"rgb",r:(t>>8&15|t>>4&240)/255,g:(t>>4&15|t&240)/255,b:(t&15|t<<4&240)/255};if(e===4)return{mode:"rgb",r:(t>>12&15|t>>8&240)/255,g:(t>>8&15|t>>4&240)/255,b:(t>>4&15|t&240)/255,alpha:(t&15|t<<4&240)/255};if(e===6)return{mode:"rgb",r:(t>>16&255)/255,g:(t>>8&255)/255,b:(t&255)/255};if(e===8)return{mode:"rgb",r:(t>>24&255)/255,g:(t>>16&255)/255,b:(t>>8&255)/255,alpha:(t&255)/255}}},Wo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Xo=t=>Nr(Wo[t.toLowerCase()],6),qo=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,Yo=t=>{let e;return(e=t.match(qo))?Nr(parseInt(e[1],16),e[1].length):void 0},Fe="([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)",Rt=`${Fe}%`,ts=`(?:${Fe}%|${Fe})`,Zo=`(?:${Fe}(deg|grad|rad|turn)|${Fe})`,ft="\\s*,\\s*",Go=new RegExp(`^rgba?\\(\\s*${Fe}${ft}${Fe}${ft}${Fe}\\s*(?:,\\s*${ts}\\s*)?\\)$`),Ko=new RegExp(`^rgba?\\(\\s*${Rt}${ft}${Rt}${ft}${Rt}\\s*(?:,\\s*${ts}\\s*)?\\)$`),Jo=t=>{let e={mode:"rgb"},n;if(n=t.match(Go))n[1]!==void 0&&(e.r=n[1]/255),n[2]!==void 0&&(e.g=n[2]/255),n[3]!==void 0&&(e.b=n[3]/255);else if(n=t.match(Ko))n[1]!==void 0&&(e.r=n[1]/100),n[2]!==void 0&&(e.g=n[2]/100),n[3]!==void 0&&(e.b=n[3]/100);else return;return n[4]!==void 0?e.alpha=Math.max(0,Math.min(1,n[4]/100)):n[5]!==void 0&&(e.alpha=Math.max(0,Math.min(1,+n[5]))),e},Qo=(t,e)=>t===void 0?void 0:typeof t!="object"?Vr(t):t.mode!==void 0?t:e?{...t,mode:e}:void 0,xe=(t="rgb")=>e=>(e=Qo(e,t))!==void 0?e.mode===t?e:ve[e.mode][t]?ve[e.mode][t](e):t==="rgb"?ve[e.mode].rgb(e):ve.rgb[t](ve[e.mode].rgb(e)):void 0,ve={},jr={},dn=[],Lr={},e0=t=>t,D=t=>(ve[t.mode]={...ve[t.mode],...t.toMode},Object.keys(t.fromMode||{}).forEach(e=>{ve[e]||(ve[e]={}),ve[e][t.mode]=t.fromMode[e]}),t.ranges||(t.ranges={}),t.difference||(t.difference={}),t.channels.forEach(e=>{if(t.ranges[e]===void 0&&(t.ranges[e]=[0,1]),!t.interpolate[e])throw new Error(`Missing interpolator for: ${e}`);typeof t.interpolate[e]=="function"&&(t.interpolate[e]={use:t.interpolate[e]}),t.interpolate[e].fixup||(t.interpolate[e].fixup=e0)}),jr[t.mode]=t,(t.parse||[]).forEach(e=>{t0(e,t.mode)}),xe(t.mode)),Ur=t=>jr[t],t0=(t,e)=>{if(typeof t=="string"){if(!e)throw new Error("'mode' required when 'parser' is a string");Lr[t]=e}else typeof t=="function"&&dn.indexOf(t)<0&&dn.push(t)},Ni=/[^\x00-\x7F]|[a-zA-Z_]/,n0=/[^\x00-\x7F]|[-\w]/,_={Function:"function",Ident:"ident",Number:"number",Percentage:"percentage",ParenClose:")",None:"none",Hue:"hue",Alpha:"alpha"};let E=0;function Wt(t){let e=t[E],n=t[E+1];return e==="-"||e==="+"?/\d/.test(n)||n==="."&&/\d/.test(t[E+2]):e==="."?/\d/.test(n):/\d/.test(e)}function ji(t){if(E>=t.length)return!1;let e=t[E];if(Ni.test(e))return!0;if(e==="-"){if(t.length-E<2)return!1;let n=t[E+1];return!!(n==="-"||Ni.test(n))}return!1}const i0={deg:1,rad:180/Math.PI,grad:9/10,turn:360};function _t(t){let e="";if((t[E]==="-"||t[E]==="+")&&(e+=t[E++]),e+=Xt(t),t[E]==="."&&/\d/.test(t[E+1])&&(e+=t[E++]+Xt(t)),(t[E]==="e"||t[E]==="E")&&((t[E+1]==="-"||t[E+1]==="+")&&/\d/.test(t[E+2])?e+=t[E++]+t[E++]+Xt(t):/\d/.test(t[E+1])&&(e+=t[E++]+Xt(t))),ji(t)){let n=mn(t);return n==="deg"||n==="rad"||n==="turn"||n==="grad"?{type:_.Hue,value:e*i0[n]}:void 0}return t[E]==="%"?(E++,{type:_.Percentage,value:+e}):{type:_.Number,value:+e}}function Xt(t){let e="";for(;/\d/.test(t[E]);)e+=t[E++];return e}function mn(t){let e="";for(;E<t.length&&n0.test(t[E]);)e+=t[E++];return e}function s0(t){let e=mn(t);return t[E]==="("?(E++,{type:_.Function,value:e}):e==="none"?{type:_.None,value:void 0}:{type:_.Ident,value:e}}function r0(t=""){let e=t.trim(),n=[],i;for(E=0;E<e.length;){if(i=e[E++],i===`
`||i==="	"||i===" "){for(;E<e.length&&(e[E]===`
`||e[E]==="	"||e[E]===" ");)E++;continue}if(i===",")return;if(i===")"){n.push({type:_.ParenClose});continue}if(i==="+"){if(E--,Wt(e)){n.push(_t(e));continue}return}if(i==="-"){if(E--,Wt(e)){n.push(_t(e));continue}if(ji(e)){n.push({type:_.Ident,value:mn(e)});continue}return}if(i==="."){if(E--,Wt(e)){n.push(_t(e));continue}return}if(i==="/"){for(;E<e.length&&(e[E]===`
`||e[E]==="	"||e[E]===" ");)E++;let s;if(Wt(e)&&(s=_t(e),s.type!==_.Hue)){n.push({type:_.Alpha,value:s});continue}if(ji(e)&&mn(e)==="none"){n.push({type:_.Alpha,value:{type:_.None,value:void 0}});continue}return}if(/\d/.test(i)){E--,n.push(_t(e));continue}if(Ni.test(i)){E--,n.push(s0(e));continue}return}return n}function a0(t){t._i=0;let e=t[t._i++];if(!e||e.type!==_.Function||e.value!=="color"||(e=t[t._i++],e.type!==_.Ident))return;const n=Lr[e.value];if(!n)return;const i={mode:n},s=$r(t,!1);if(!s)return;const r=Ur(n).channels;for(let a=0,o,h;a<r.length;a++)o=s[a],h=r[a],o.type!==_.None&&(i[h]=o.type===_.Number?o.value:o.value/100,h==="alpha"&&(i[h]=Math.max(0,Math.min(1,i[h]))));return i}function $r(t,e){const n=[];let i;for(;t._i<t.length;){if(i=t[t._i++],i.type===_.None||i.type===_.Number||i.type===_.Alpha||i.type===_.Percentage||e&&i.type===_.Hue){n.push(i);continue}if(i.type===_.ParenClose){if(t._i<t.length)return;continue}return}if(!(n.length<3||n.length>4)){if(n.length===4){if(n[3].type!==_.Alpha)return;n[3]=n[3].value}return n.length===3&&n.push({type:_.None,value:void 0}),n.every(s=>s.type!==_.Alpha)?n:void 0}}function o0(t,e){t._i=0;let n=t[t._i++];if(!n||n.type!==_.Function)return;let i=$r(t,e);if(i)return i.unshift(n.value),i}const Vr=t=>{if(typeof t!="string")return;const e=r0(t),n=e?o0(e,!0):void 0;let i,s=0,r=dn.length;for(;s<r;)if((i=dn[s++](t,n))!==void 0)return i;return e?a0(e):void 0};function h0(t,e){if(!e||e[0]!=="rgb"&&e[0]!=="rgba")return;const n={mode:"rgb"},[,i,s,r,a]=e;if(!(i.type===_.Hue||s.type===_.Hue||r.type===_.Hue))return i.type!==_.None&&(n.r=i.type===_.Number?i.value/255:i.value/100),s.type!==_.None&&(n.g=s.type===_.Number?s.value/255:s.value/100),r.type!==_.None&&(n.b=r.type===_.Number?r.value/255:r.value/100),a.type!==_.None&&(n.alpha=Math.min(1,Math.max(0,a.type===_.Number?a.value:a.value/100))),n}const l0=t=>t==="transparent"?{mode:"rgb",r:0,g:0,b:0,alpha:0}:void 0,c0=(t,e,n)=>t+n*(e-t),u0=t=>{let e=[];for(let n=0;n<t.length-1;n++){let i=t[n],s=t[n+1];i===void 0&&s===void 0?e.push(void 0):i!==void 0&&s!==void 0?e.push([i,s]):e.push(i!==void 0?[i,i]:[s,s])}return e},f0=t=>e=>{let n=u0(e);return i=>{let s=i*n.length,r=i>=1?n.length-1:Math.max(Math.floor(s),0),a=n[r];return a===void 0?void 0:t(a[0],a[1],s-r)}},T=f0(c0),Y=t=>{let e=!1,n=t.map(i=>i!==void 0?(e=!0,i):1);return e?n:t},pt={mode:"rgb",channels:["r","g","b","alpha"],parse:[h0,Yo,Jo,Xo,l0,"srgb"],serialize:"srgb",interpolate:{r:T,g:T,b:T,alpha:{use:T,fixup:Y}},gamut:!0,white:{r:1,g:1,b:1},black:{r:0,g:0,b:0}},Gn=(t=0)=>Math.pow(Math.abs(t),563/256)*Math.sign(t),Cs=t=>{let e=Gn(t.r),n=Gn(t.g),i=Gn(t.b),s={mode:"xyz65",x:.5766690429101305*e+.1855582379065463*n+.1882286462349947*i,y:.297344975250536*e+.6273635662554661*n+.0752914584939979*i,z:.0270313613864123*e+.0706888525358272*n+.9913375368376386*i};return t.alpha!==void 0&&(s.alpha=t.alpha),s},Kn=t=>Math.pow(Math.abs(t),256/563)*Math.sign(t),Ss=({x:t,y:e,z:n,alpha:i})=>{t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);let s={mode:"a98",r:Kn(t*2.0415879038107465-e*.5650069742788597-.3447313507783297*n),g:Kn(t*-.9692436362808798+e*1.8759675015077206+.0415550574071756*n),b:Kn(t*.0134442806320312-e*.1183623922310184+1.0151749943912058*n)};return i!==void 0&&(s.alpha=i),s},Jn=(t=0)=>{const e=Math.abs(t);return e<=.04045?t/12.92:(Math.sign(t)||1)*Math.pow((e+.055)/1.055,2.4)},gt=({r:t,g:e,b:n,alpha:i})=>{let s={mode:"lrgb",r:Jn(t),g:Jn(e),b:Jn(n)};return i!==void 0&&(s.alpha=i),s},Ye=t=>{let{r:e,g:n,b:i,alpha:s}=gt(t),r={mode:"xyz65",x:.4123907992659593*e+.357584339383878*n+.1804807884018343*i,y:.2126390058715102*e+.715168678767756*n+.0721923153607337*i,z:.0193308187155918*e+.119194779794626*n+.9505321522496607*i};return s!==void 0&&(r.alpha=s),r},Qn=(t=0)=>{const e=Math.abs(t);return e>.0031308?(Math.sign(t)||1)*(1.055*Math.pow(e,1/2.4)-.055):t*12.92},xt=({r:t,g:e,b:n,alpha:i},s="rgb")=>{let r={mode:s,r:Qn(t),g:Qn(e),b:Qn(n)};return i!==void 0&&(r.alpha=i),r},Ze=({x:t,y:e,z:n,alpha:i})=>{t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);let s=xt({r:t*3.2409699419045226-e*1.537383177570094-.4986107602930034*n,g:t*-.9692436362808796+e*1.8759675015077204+.0415550574071756*n,b:t*.0556300796969936-e*.2039769588889765+1.0569715142428784*n});return i!==void 0&&(s.alpha=i),s},d0={...pt,mode:"a98",parse:["a98-rgb"],serialize:"a98-rgb",fromMode:{rgb:t=>Ss(Ye(t)),xyz65:Ss},toMode:{rgb:t=>Ze(Cs(t)),xyz65:Cs}},Q=t=>(t=t%360)<0?t+360:t,m0=(t,e)=>t.map((n,i,s)=>{if(n===void 0)return n;let r=Q(n);return i===0||t[i-1]===void 0?r:e(r-Q(s[i-1]))}).reduce((n,i)=>!n.length||i===void 0||n[n.length-1]===void 0?(n.push(i),n):(n.push(i+n[n.length-1]),n),[]),ke=t=>m0(t,e=>Math.abs(e)<=180?e:e-360*Math.sign(e)),G=[-.14861,1.78277,-.29227,-.90649,1.97294,0],p0=Math.PI/180,g0=180/Math.PI;let As=G[3]*G[4],Es=G[1]*G[4],Rs=G[1]*G[2]-G[0]*G[3];const x0=({r:t,g:e,b:n,alpha:i})=>{t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);let s=(Rs*n+t*As-e*Es)/(Rs+As-Es),r=n-s,a=(G[4]*(e-s)-G[2]*r)/G[3],o={mode:"cubehelix",l:s,s:s===0||s===1?void 0:Math.sqrt(r*r+a*a)/(G[4]*s*(1-s))};return o.s&&(o.h=Math.atan2(a,r)*g0-120),i!==void 0&&(o.alpha=i),o},b0=({h:t,s:e,l:n,alpha:i})=>{let s={mode:"rgb"};t=(t===void 0?0:t+120)*p0,n===void 0&&(n=0);let r=e===void 0?0:e*n*(1-n),a=Math.cos(t),o=Math.sin(t);return s.r=n+r*(G[0]*a+G[1]*o),s.g=n+r*(G[2]*a+G[3]*o),s.b=n+r*(G[4]*a+G[5]*o),i!==void 0&&(s.alpha=i),s},Tn=(t,e)=>{if(t.h===void 0||e.h===void 0||!t.s||!e.s)return 0;let n=Q(t.h),i=Q(e.h),s=Math.sin((i-n+360)/2*Math.PI/180);return 2*Math.sqrt(t.s*e.s)*s},v0=(t,e)=>{if(t.h===void 0||e.h===void 0)return 0;let n=Q(t.h),i=Q(e.h);return Math.abs(i-n)>180?n-(i-360*Math.sign(i-n)):i-n},kn=(t,e)=>{if(t.h===void 0||e.h===void 0||!t.c||!e.c)return 0;let n=Q(t.h),i=Q(e.h),s=Math.sin((i-n+360)/2*Math.PI/180);return 2*Math.sqrt(t.c*e.c)*s},ze=t=>{let e=t.reduce((i,s)=>{if(s!==void 0){let r=s*Math.PI/180;i.sin+=Math.sin(r),i.cos+=Math.cos(r)}return i},{sin:0,cos:0}),n=Math.atan2(e.sin,e.cos)*180/Math.PI;return n<0?360+n:n},y0={mode:"cubehelix",channels:["h","s","l","alpha"],parse:["--cubehelix"],serialize:"--cubehelix",ranges:{h:[0,360],s:[0,4.614],l:[0,1]},fromMode:{rgb:x0},toMode:{rgb:b0},interpolate:{h:{use:T,fixup:ke},s:T,l:T,alpha:{use:T,fixup:Y}},difference:{h:Tn},average:{h:ze}},De=({l:t,a:e,b:n,alpha:i},s="lch")=>{e===void 0&&(e=0),n===void 0&&(n=0);let r=Math.sqrt(e*e+n*n),a={mode:s,l:t,c:r};return r&&(a.h=Q(Math.atan2(n,e)*180/Math.PI)),i!==void 0&&(a.alpha=i),a},Ne=({l:t,c:e,h:n,alpha:i},s="lab")=>{n===void 0&&(n=0);let r={mode:s,l:t,a:e?e*Math.cos(n/180*Math.PI):0,b:e?e*Math.sin(n/180*Math.PI):0};return i!==void 0&&(r.alpha=i),r},Br=Math.pow(29,3)/Math.pow(3,3),Hr=Math.pow(6,3)/Math.pow(29,3),W={X:.3457/.3585,Y:1,Z:(1-.3457-.3585)/.3585},lt={X:.3127/.329,Y:1,Z:(1-.3127-.329)/.329};let ei=t=>Math.pow(t,3)>Hr?Math.pow(t,3):(116*t-16)/Br;const Wr=({l:t,a:e,b:n,alpha:i})=>{t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);let s=(t+16)/116,r=e/500+s,a=s-n/200,o={mode:"xyz65",x:ei(r)*lt.X,y:ei(s)*lt.Y,z:ei(a)*lt.Z};return i!==void 0&&(o.alpha=i),o},zn=t=>Ze(Wr(t)),ti=t=>t>Hr?Math.cbrt(t):(Br*t+16)/116,Xr=({x:t,y:e,z:n,alpha:i})=>{t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);let s=ti(t/lt.X),r=ti(e/lt.Y),a=ti(n/lt.Z),o={mode:"lab65",l:116*r-16,a:500*(s-r),b:200*(r-a)};return i!==void 0&&(o.alpha=i),o},Cn=t=>{let e=Xr(Ye(t));return t.r===t.b&&t.b===t.g&&(e.a=e.b=0),e},pn=1,qr=1,Ft=26/180*Math.PI,gn=Math.cos(Ft),xn=Math.sin(Ft),Yr=100/Math.log(139/100),Li=({l:t,c:e,h:n,alpha:i})=>{t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);let s={mode:"lab65",l:(Math.exp(t*pn/Yr)-1)/.0039},r=(Math.exp(.0435*e*qr*pn)-1)/.075,a=r*Math.cos(n/180*Math.PI-Ft),o=r*Math.sin(n/180*Math.PI-Ft);return s.a=a*gn-o/.83*xn,s.b=a*xn+o/.83*gn,i!==void 0&&(s.alpha=i),s},Ui=({l:t,a:e,b:n,alpha:i})=>{t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);let s=e*gn+n*xn,r=.83*(n*gn-e*xn),a=Math.sqrt(s*s+r*r),o={mode:"dlch",l:Yr/pn*Math.log(1+.0039*t),c:Math.log(1+.075*a)/(.0435*qr*pn)};return o.c&&(o.h=Q((Math.atan2(r,s)+Ft)/Math.PI*180)),i!==void 0&&(o.alpha=i),o},Is=t=>Li(De(t,"dlch")),Fs=t=>Ne(Ui(t),"dlab"),_0={mode:"dlab",parse:["--din99o-lab"],serialize:"--din99o-lab",toMode:{lab65:Is,rgb:t=>zn(Is(t))},fromMode:{lab65:Fs,rgb:t=>Fs(Cn(t))},channels:["l","a","b","alpha"],ranges:{l:[0,100],a:[-40.09,45.501],b:[-40.469,44.344]},interpolate:{l:T,a:T,b:T,alpha:{use:T,fixup:Y}}},M0={mode:"dlch",parse:["--din99o-lch"],serialize:"--din99o-lch",toMode:{lab65:Li,dlab:t=>Ne(t,"dlab"),rgb:t=>zn(Li(t))},fromMode:{lab65:Ui,dlab:t=>De(t,"dlch"),rgb:t=>Ui(Cn(t))},channels:["l","c","h","alpha"],ranges:{l:[0,100],c:[0,51.484],h:[0,360]},interpolate:{l:T,c:T,h:{use:T,fixup:ke},alpha:{use:T,fixup:Y}},difference:{h:kn},average:{h:ze}};function w0({h:t,s:e,i:n,alpha:i}){t=Q(t!==void 0?t:0),e===void 0&&(e=0),n===void 0&&(n=0);let s=Math.abs(t/60%2-1),r;switch(Math.floor(t/60)){case 0:r={r:n*(1+e*(3/(2-s)-1)),g:n*(1+e*(3*(1-s)/(2-s)-1)),b:n*(1-e)};break;case 1:r={r:n*(1+e*(3*(1-s)/(2-s)-1)),g:n*(1+e*(3/(2-s)-1)),b:n*(1-e)};break;case 2:r={r:n*(1-e),g:n*(1+e*(3/(2-s)-1)),b:n*(1+e*(3*(1-s)/(2-s)-1))};break;case 3:r={r:n*(1-e),g:n*(1+e*(3*(1-s)/(2-s)-1)),b:n*(1+e*(3/(2-s)-1))};break;case 4:r={r:n*(1+e*(3*(1-s)/(2-s)-1)),g:n*(1-e),b:n*(1+e*(3/(2-s)-1))};break;case 5:r={r:n*(1+e*(3/(2-s)-1)),g:n*(1-e),b:n*(1+e*(3*(1-s)/(2-s)-1))};break;default:r={r:n*(1-e),g:n*(1-e),b:n*(1-e)}}return r.mode="rgb",i!==void 0&&(r.alpha=i),r}function T0({r:t,g:e,b:n,alpha:i}){t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);let s=Math.max(t,e,n),r=Math.min(t,e,n),a={mode:"hsi",s:t+e+n===0?0:1-3*r/(t+e+n),i:(t+e+n)/3};return s-r!==0&&(a.h=(s===t?(e-n)/(s-r)+(e<n)*6:s===e?(n-t)/(s-r)+2:(t-e)/(s-r)+4)*60),i!==void 0&&(a.alpha=i),a}const k0={mode:"hsi",toMode:{rgb:w0},parse:["--hsi"],serialize:"--hsi",fromMode:{rgb:T0},channels:["h","s","i","alpha"],ranges:{h:[0,360]},gamut:"rgb",interpolate:{h:{use:T,fixup:ke},s:T,i:T,alpha:{use:T,fixup:Y}},difference:{h:Tn},average:{h:ze}};function z0({h:t,s:e,l:n,alpha:i}){t=Q(t!==void 0?t:0),e===void 0&&(e=0),n===void 0&&(n=0);let s=n+e*(n<.5?n:1-n),r=s-(s-n)*2*Math.abs(t/60%2-1),a;switch(Math.floor(t/60)){case 0:a={r:s,g:r,b:2*n-s};break;case 1:a={r,g:s,b:2*n-s};break;case 2:a={r:2*n-s,g:s,b:r};break;case 3:a={r:2*n-s,g:r,b:s};break;case 4:a={r,g:2*n-s,b:s};break;case 5:a={r:s,g:2*n-s,b:r};break;default:a={r:2*n-s,g:2*n-s,b:2*n-s}}return a.mode="rgb",i!==void 0&&(a.alpha=i),a}function C0({r:t,g:e,b:n,alpha:i}){t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);let s=Math.max(t,e,n),r=Math.min(t,e,n),a={mode:"hsl",s:s===r?0:(s-r)/(1-Math.abs(s+r-1)),l:.5*(s+r)};return s-r!==0&&(a.h=(s===t?(e-n)/(s-r)+(e<n)*6:s===e?(n-t)/(s-r)+2:(t-e)/(s-r)+4)*60),i!==void 0&&(a.alpha=i),a}const S0=(t,e)=>{switch(e){case"deg":return+t;case"rad":return t/Math.PI*180;case"grad":return t/10*9;case"turn":return t*360}},A0=new RegExp(`^hsla?\\(\\s*${Zo}${ft}${Rt}${ft}${Rt}\\s*(?:,\\s*${ts}\\s*)?\\)$`),E0=t=>{let e=t.match(A0);if(!e)return;let n={mode:"hsl"};return e[3]!==void 0?n.h=+e[3]:e[1]!==void 0&&e[2]!==void 0&&(n.h=S0(e[1],e[2])),e[4]!==void 0&&(n.s=Math.min(Math.max(0,e[4]/100),1)),e[5]!==void 0&&(n.l=Math.min(Math.max(0,e[5]/100),1)),e[6]!==void 0?n.alpha=Math.max(0,Math.min(1,e[6]/100)):e[7]!==void 0&&(n.alpha=Math.max(0,Math.min(1,+e[7]))),n};function R0(t,e){if(!e||e[0]!=="hsl"&&e[0]!=="hsla")return;const n={mode:"hsl"},[,i,s,r,a]=e;if(i.type!==_.None){if(i.type===_.Percentage)return;n.h=i.value}if(s.type!==_.None){if(s.type===_.Hue)return;n.s=s.value/100}if(r.type!==_.None){if(r.type===_.Hue)return;n.l=r.value/100}return a.type!==_.None&&(n.alpha=Math.min(1,Math.max(0,a.type===_.Number?a.value:a.value/100))),n}const Zr={mode:"hsl",toMode:{rgb:z0},fromMode:{rgb:C0},channels:["h","s","l","alpha"],ranges:{h:[0,360]},gamut:"rgb",parse:[R0,E0],serialize:t=>`hsl(${t.h!==void 0?t.h:"none"} ${t.s!==void 0?t.s*100+"%":"none"} ${t.l!==void 0?t.l*100+"%":"none"}${t.alpha<1?` / ${t.alpha}`:""})`,interpolate:{h:{use:T,fixup:ke},s:T,l:T,alpha:{use:T,fixup:Y}},difference:{h:Tn},average:{h:ze}};function Gr({h:t,s:e,v:n,alpha:i}){t=Q(t!==void 0?t:0),e===void 0&&(e=0),n===void 0&&(n=0);let s=Math.abs(t/60%2-1),r;switch(Math.floor(t/60)){case 0:r={r:n,g:n*(1-e*s),b:n*(1-e)};break;case 1:r={r:n*(1-e*s),g:n,b:n*(1-e)};break;case 2:r={r:n*(1-e),g:n,b:n*(1-e*s)};break;case 3:r={r:n*(1-e),g:n*(1-e*s),b:n};break;case 4:r={r:n*(1-e*s),g:n*(1-e),b:n};break;case 5:r={r:n,g:n*(1-e),b:n*(1-e*s)};break;default:r={r:n*(1-e),g:n*(1-e),b:n*(1-e)}}return r.mode="rgb",i!==void 0&&(r.alpha=i),r}function Kr({r:t,g:e,b:n,alpha:i}){t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);let s=Math.max(t,e,n),r=Math.min(t,e,n),a={mode:"hsv",s:s===0?0:1-r/s,v:s};return s-r!==0&&(a.h=(s===t?(e-n)/(s-r)+(e<n)*6:s===e?(n-t)/(s-r)+2:(t-e)/(s-r)+4)*60),i!==void 0&&(a.alpha=i),a}const Jr={mode:"hsv",toMode:{rgb:Gr},parse:["--hsv"],serialize:"--hsv",fromMode:{rgb:Kr},channels:["h","s","v","alpha"],ranges:{h:[0,360]},gamut:"rgb",interpolate:{h:{use:T,fixup:ke},s:T,v:T,alpha:{use:T,fixup:Y}},difference:{h:Tn},average:{h:ze}};function I0({h:t,w:e,b:n,alpha:i}){if(e===void 0&&(e=0),n===void 0&&(n=0),e+n>1){let s=e+n;e/=s,n/=s}return Gr({h:t,s:n===1?1:1-e/(1-n),v:1-n,alpha:i})}function F0(t){let e=Kr(t);if(e===void 0)return;let n=e.s!==void 0?e.s:0,i=e.v!==void 0?e.v:0,s={mode:"hwb",w:(1-n)*i,b:1-i};return e.h!==void 0&&(s.h=e.h),e.alpha!==void 0&&(s.alpha=e.alpha),s}function O0(t,e){if(!e||e[0]!=="hwb")return;const n={mode:"hwb"},[,i,s,r,a]=e;if(i.type!==_.None){if(i.type===_.Percentage)return;n.h=i.value}if(s.type!==_.None){if(s.type===_.Hue)return;n.w=s.value/100}if(r.type!==_.None){if(r.type===_.Hue)return;n.b=r.value/100}return a.type!==_.None&&(n.alpha=Math.min(1,Math.max(0,a.type===_.Number?a.value:a.value/100))),n}const P0={mode:"hwb",toMode:{rgb:I0},fromMode:{rgb:F0},channels:["h","w","b","alpha"],ranges:{h:[0,360]},gamut:"rgb",parse:[O0],serialize:t=>`hwb(${t.h!==void 0?t.h:"none"} ${t.w!==void 0?t.w*100+"%":"none"} ${t.b!==void 0?t.b*100+"%":"none"}${t.alpha<1?` / ${t.alpha}`:""})`,interpolate:{h:{use:T,fixup:ke},w:T,b:T,alpha:{use:T,fixup:Y}},difference:{h:v0},average:{h:ze}},Qr=203,Sn=.1593017578125,ea=78.84375,An=.8359375,En=18.8515625,Rn=18.6875;function ni(t){if(t<0)return 0;const e=Math.pow(t,1/ea);return 1e4*Math.pow(Math.max(0,e-An)/(En-Rn*e),1/Sn)}function ii(t){if(t<0)return 0;const e=Math.pow(t/1e4,Sn);return Math.pow((An+En*e)/(1+Rn*e),ea)}const si=t=>Math.max(t/Qr,0),Os=({i:t,t:e,p:n,alpha:i})=>{t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);const s=ni(t+.008609037037932761*e+.11102962500302593*n),r=ni(t-.00860903703793275*e-.11102962500302599*n),a=ni(t+.5600313357106791*e-.32062717498731885*n),o={mode:"xyz65",x:si(2.070152218389422*s-1.3263473389671556*r+.2066510476294051*a),y:si(.3647385209748074*s+.680566024947227*r-.0453045459220346*a),z:si(-.049747207535812*s-.0492609666966138*r+1.1880659249923042*a)};return i!==void 0&&(o.alpha=i),o},ri=(t=0)=>Math.max(t*Qr,0),Ps=({x:t,y:e,z:n,alpha:i})=>{const s=ri(t),r=ri(e),a=ri(n),o=ii(.3592832590121217*s+.6976051147779502*r-.0358915932320289*a),h=ii(-.1920808463704995*s+1.1004767970374323*r+.0753748658519118*a),l=ii(.0070797844607477*s+.0748396662186366*r+.8433265453898765*a),c=.5*o+.5*h,u=1.61376953125*o-3.323486328125*h+1.709716796875*l,f=4.378173828125*o-4.24560546875*h-.132568359375*l,d={mode:"itp",i:c,t:u,p:f};return i!==void 0&&(d.alpha=i),d},D0={mode:"itp",channels:["i","t","p","alpha"],parse:["--ictcp"],serialize:"--ictcp",toMode:{xyz65:Os,rgb:t=>Ze(Os(t))},fromMode:{xyz65:Ps,rgb:t=>Ps(Ye(t))},ranges:{i:[0,.581],t:[-.369,.272],p:[-.164,.331]},interpolate:{i:T,t:T,p:T,alpha:{use:T,fixup:Y}}},N0=134.03437499999998,j0=16295499532821565e-27,ai=t=>{if(t<0)return 0;let e=Math.pow(t/1e4,Sn);return Math.pow((An+En*e)/(1+Rn*e),N0)},oi=(t=0)=>Math.max(t*203,0),ta=({x:t,y:e,z:n,alpha:i})=>{t=oi(t),e=oi(e),n=oi(n);let s=1.15*t-.15*n,r=.66*e+.34*t,a=ai(.41478972*s+.579999*r+.014648*n),o=ai(-.20151*s+1.120649*r+.0531008*n),h=ai(-.0166008*s+.2648*r+.6684799*n),l=(a+o)/2,c={mode:"jab",j:.44*l/(1-.56*l)-j0,a:3.524*a-4.066708*o+.542708*h,b:.199076*a+1.096799*o-1.295875*h};return i!==void 0&&(c.alpha=i),c},L0=134.03437499999998,Ds=16295499532821565e-27,hi=t=>{if(t<0)return 0;let e=Math.pow(t,1/L0);return 1e4*Math.pow((An-e)/(Rn*e-En),1/Sn)},li=t=>t/203,na=({j:t,a:e,b:n,alpha:i})=>{t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);let s=(t+Ds)/(.44+.56*(t+Ds)),r=hi(s+.13860504*e+.058047316*n),a=hi(s-.13860504*e-.058047316*n),o=hi(s-.096019242*e-.8118919*n),h={mode:"xyz65",x:li(1.661373024652174*r-.914523081304348*a+.23136208173913045*o),y:li(-.3250758611844533*r+1.571847026732543*a-.21825383453227928*o),z:li(-.090982811*r-.31272829*a+1.5227666*o)};return i!==void 0&&(h.alpha=i),h},ia=t=>{let e=ta(Ye(t));return t.r===t.b&&t.b===t.g&&(e.a=e.b=0),e},sa=t=>Ze(na(t)),U0={mode:"jab",channels:["j","a","b","alpha"],parse:["--jzazbz"],serialize:"--jzazbz",fromMode:{rgb:ia,xyz65:ta},toMode:{rgb:sa,xyz65:na},ranges:{j:[0,.222],a:[-.109,.129],b:[-.185,.134]},interpolate:{j:T,a:T,b:T,alpha:{use:T,fixup:Y}}},Ns=({j:t,a:e,b:n,alpha:i})=>{e===void 0&&(e=0),n===void 0&&(n=0);let s=Math.sqrt(e*e+n*n),r={mode:"jch",j:t,c:s};return s&&(r.h=Q(Math.atan2(n,e)*180/Math.PI)),i!==void 0&&(r.alpha=i),r},js=({j:t,c:e,h:n,alpha:i})=>{n===void 0&&(n=0);let s={mode:"jab",j:t,a:e?e*Math.cos(n/180*Math.PI):0,b:e?e*Math.sin(n/180*Math.PI):0};return i!==void 0&&(s.alpha=i),s},$0={mode:"jch",parse:["--jzczhz"],serialize:"--jzczhz",toMode:{jab:js,rgb:t=>sa(js(t))},fromMode:{rgb:t=>Ns(ia(t)),jab:Ns},channels:["j","c","h","alpha"],ranges:{j:[0,.221],c:[0,.19],h:[0,360]},interpolate:{h:{use:T,fixup:ke},c:T,j:T,alpha:{use:T,fixup:Y}},difference:{h:kn},average:{h:ze}},In=Math.pow(29,3)/Math.pow(3,3),ns=Math.pow(6,3)/Math.pow(29,3);let ci=t=>Math.pow(t,3)>ns?Math.pow(t,3):(116*t-16)/In;const is=({l:t,a:e,b:n,alpha:i})=>{t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);let s=(t+16)/116,r=e/500+s,a=s-n/200,o={mode:"xyz50",x:ci(r)*W.X,y:ci(s)*W.Y,z:ci(a)*W.Z};return i!==void 0&&(o.alpha=i),o},jt=({x:t,y:e,z:n,alpha:i})=>{t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);let s=xt({r:t*3.1341359569958707-e*1.6173863321612538-.4906619460083532*n,g:t*-.978795502912089+e*1.916254567259524+.03344273116131949*n,b:t*.07195537988411677-e*.2289768264158322+1.405386058324125*n});return i!==void 0&&(s.alpha=i),s},ra=t=>jt(is(t)),Lt=t=>{let{r:e,g:n,b:i,alpha:s}=gt(t),r={mode:"xyz50",x:.436065742824811*e+.3851514688337912*n+.14307845442264197*i,y:.22249319175623702*e+.7168870538238823*n+.06061979053616537*i,z:.013923904500943465*e+.09708128566574634*n+.7140993584005155*i};return s!==void 0&&(r.alpha=s),r},ui=t=>t>ns?Math.cbrt(t):(In*t+16)/116,ss=({x:t,y:e,z:n,alpha:i})=>{t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);let s=ui(t/W.X),r=ui(e/W.Y),a=ui(n/W.Z),o={mode:"lab",l:116*r-16,a:500*(s-r),b:200*(r-a)};return i!==void 0&&(o.alpha=i),o},aa=t=>{let e=ss(Lt(t));return t.r===t.b&&t.b===t.g&&(e.a=e.b=0),e};function V0(t,e){if(!e||e[0]!=="lab")return;const n={mode:"lab"},[,i,s,r,a]=e;if(!(i.type===_.Hue||s.type===_.Hue||r.type===_.Hue))return i.type!==_.None&&(n.l=Math.min(Math.max(0,i.value),100)),s.type!==_.None&&(n.a=s.type===_.Number?s.value:s.value*125/100),r.type!==_.None&&(n.b=r.type===_.Number?r.value:r.value*125/100),a.type!==_.None&&(n.alpha=Math.min(1,Math.max(0,a.type===_.Number?a.value:a.value/100))),n}const rs={mode:"lab",toMode:{xyz50:is,rgb:ra},fromMode:{xyz50:ss,rgb:aa},channels:["l","a","b","alpha"],ranges:{l:[0,100],a:[-125,125],b:[-125,125]},parse:[V0],serialize:t=>`lab(${t.l!==void 0?t.l:"none"} ${t.a!==void 0?t.a:"none"} ${t.b!==void 0?t.b:"none"}${t.alpha<1?` / ${t.alpha}`:""})`,interpolate:{l:T,a:T,b:T,alpha:{use:T,fixup:Y}}},B0={...rs,mode:"lab65",parse:["--lab-d65"],serialize:"--lab-d65",toMode:{xyz65:Wr,rgb:zn},fromMode:{xyz65:Xr,rgb:Cn},ranges:{l:[0,100],a:[-125,125],b:[-125,125]}};function H0(t,e){if(!e||e[0]!=="lch")return;const n={mode:"lch"},[,i,s,r,a]=e;if(i.type!==_.None){if(i.type===_.Hue)return;n.l=Math.min(Math.max(0,i.value),100)}if(s.type!==_.None&&(n.c=Math.max(0,s.type===_.Number?s.value:s.value*150/100)),r.type!==_.None){if(r.type===_.Percentage)return;n.h=r.value}return a.type!==_.None&&(n.alpha=Math.min(1,Math.max(0,a.type===_.Number?a.value:a.value/100))),n}const as={mode:"lch",toMode:{lab:Ne,rgb:t=>ra(Ne(t))},fromMode:{rgb:t=>De(aa(t)),lab:De},channels:["l","c","h","alpha"],ranges:{l:[0,100],c:[0,150],h:[0,360]},parse:[H0],serialize:t=>`lch(${t.l!==void 0?t.l:"none"} ${t.c!==void 0?t.c:"none"} ${t.h!==void 0?t.h:"none"}${t.alpha<1?` / ${t.alpha}`:""})`,interpolate:{h:{use:T,fixup:ke},c:T,l:T,alpha:{use:T,fixup:Y}},difference:{h:kn},average:{h:ze}},W0={...as,mode:"lch65",parse:["--lch-d65"],serialize:"--lch-d65",toMode:{lab65:t=>Ne(t,"lab65"),rgb:t=>zn(Ne(t,"lab65"))},fromMode:{rgb:t=>De(Cn(t),"lch65"),lab65:t=>De(t,"lch65")},ranges:{l:[0,100],c:[0,150],h:[0,360]}},oa=({l:t,u:e,v:n,alpha:i})=>{e===void 0&&(e=0),n===void 0&&(n=0);let s=Math.sqrt(e*e+n*n),r={mode:"lchuv",l:t,c:s};return s&&(r.h=Q(Math.atan2(n,e)*180/Math.PI)),i!==void 0&&(r.alpha=i),r},ha=({l:t,c:e,h:n,alpha:i})=>{n===void 0&&(n=0);let s={mode:"luv",l:t,u:e?e*Math.cos(n/180*Math.PI):0,v:e?e*Math.sin(n/180*Math.PI):0};return i!==void 0&&(s.alpha=i),s},la=(t,e,n)=>4*t/(t+15*e+3*n),ca=(t,e,n)=>9*e/(t+15*e+3*n),X0=la(W.X,W.Y,W.Z),q0=ca(W.X,W.Y,W.Z),Y0=t=>t<=ns?In*t:116*Math.cbrt(t)-16,$i=({x:t,y:e,z:n,alpha:i})=>{t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);let s=Y0(e/W.Y),r=la(t,e,n),a=ca(t,e,n);!isFinite(r)||!isFinite(a)?s=r=a=0:(r=13*s*(r-X0),a=13*s*(a-q0));let o={mode:"luv",l:s,u:r,v:a};return i!==void 0&&(o.alpha=i),o},Z0=(t,e,n)=>4*t/(t+15*e+3*n),G0=(t,e,n)=>9*e/(t+15*e+3*n),K0=Z0(W.X,W.Y,W.Z),J0=G0(W.X,W.Y,W.Z),Vi=({l:t,u:e,v:n,alpha:i})=>{if(t===void 0&&(t=0),t===0)return{mode:"xyz50",x:0,y:0,z:0};e===void 0&&(e=0),n===void 0&&(n=0);let s=e/(13*t)+K0,r=n/(13*t)+J0,a=W.Y*(t<=8?t/In:Math.pow((t+16)/116,3)),o=a*(9*s)/(4*r),h=a*(12-3*s-20*r)/(4*r),l={mode:"xyz50",x:o,y:a,z:h};return i!==void 0&&(l.alpha=i),l},Q0=t=>oa($i(Lt(t))),eh=t=>jt(Vi(ha(t))),th={mode:"lchuv",toMode:{luv:ha,rgb:eh},fromMode:{rgb:Q0,luv:oa},channels:["l","c","h","alpha"],parse:["--lchuv"],serialize:"--lchuv",ranges:{l:[0,100],c:[0,176.956],h:[0,360]},interpolate:{h:{use:T,fixup:ke},c:T,l:T,alpha:{use:T,fixup:Y}},difference:{h:kn},average:{h:ze}},nh={...pt,mode:"lrgb",toMode:{rgb:xt},fromMode:{rgb:gt},parse:["srgb-linear"],serialize:"srgb-linear"},ih={mode:"luv",toMode:{xyz50:Vi,rgb:t=>jt(Vi(t))},fromMode:{xyz50:$i,rgb:t=>$i(Lt(t))},channels:["l","u","v","alpha"],parse:["--luv"],serialize:"--luv",ranges:{l:[0,100],u:[-84.936,175.042],v:[-125.882,87.243]},interpolate:{l:T,u:T,v:T,alpha:{use:T,fixup:Y}}},ua=({r:t,g:e,b:n,alpha:i})=>{t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);let s=Math.cbrt(.412221469470763*t+.5363325372617348*e+.0514459932675022*n),r=Math.cbrt(.2119034958178252*t+.6806995506452344*e+.1073969535369406*n),a=Math.cbrt(.0883024591900564*t+.2817188391361215*e+.6299787016738222*n),o={mode:"oklab",l:.210454268309314*s+.7936177747023054*r-.0040720430116193*a,a:1.9779985324311684*s-2.42859224204858*r+.450593709617411*a,b:.0259040424655478*s+.7827717124575296*r-.8086757549230774*a};return i!==void 0&&(o.alpha=i),o},Fn=t=>{let e=ua(gt(t));return t.r===t.b&&t.b===t.g&&(e.a=e.b=0),e},Ut=({l:t,a:e,b:n,alpha:i})=>{t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);let s=Math.pow(t+.3963377773761749*e+.2158037573099136*n,3),r=Math.pow(t-.1055613458156586*e-.0638541728258133*n,3),a=Math.pow(t-.0894841775298119*e-1.2914855480194092*n,3),o={mode:"lrgb",r:4.076741636075957*s-3.3077115392580616*r+.2309699031821044*a,g:-1.2684379732850317*s+2.6097573492876887*r-.3413193760026573*a,b:-.0041960761386756*s-.7034186179359362*r+1.7076146940746117*a};return i!==void 0&&(o.alpha=i),o},On=t=>xt(Ut(t));function Bi(t){const i=1.170873786407767;return .5*(i*t-.206+Math.sqrt((i*t-.206)*(i*t-.206)+4*.03*i*t))}function bn(t){return(t*t+.206*t)/(1.170873786407767*(t+.03))}function sh(t,e){let n,i,s,r,a,o,h,l;-1.88170328*t-.80936493*e>1?(n=1.19086277,i=1.76576728,s=.59662641,r=.75515197,a=.56771245,o=4.0767416621,h=-3.3077115913,l=.2309699292):1.81444104*t-1.19445276*e>1?(n=.73956515,i=-.45954404,s=.08285427,r=.1254107,a=.14503204,o=-1.2684380046,h=2.6097574011,l=-.3413193965):(n=1.35733652,i=-.00915799,s=-1.1513021,r=-.50559606,a=.00692167,o=-.0041960863,h=-.7034186147,l=1.707614701);let c=n+i*t+s*e+r*t*t+a*t*e,u=.3963377774*t+.2158037573*e,f=-.1055613458*t-.0638541728*e,d=-.0894841775*t-1.291485548*e;{let m=1+c*u,g=1+c*f,x=1+c*d,p=m*m*m,v=g*g*g,b=x*x*x,y=3*u*m*m,z=3*f*g*g,C=3*d*x*x,k=6*u*u*m,A=6*f*f*g,R=6*d*d*x,S=o*p+h*v+l*b,I=o*y+h*z+l*C,L=o*k+h*A+l*R;c=c-S*I/(I*I-.5*S*L)}return c}function os(t,e){let n=sh(t,e),i=Ut({l:1,a:n*t,b:n*e}),s=Math.cbrt(1/Math.max(i.r,i.g,i.b)),r=s*n;return[s,r]}function rh(t,e,n,i,s,r=null){r||(r=os(t,e));let a;if((n-s)*r[1]-(r[0]-s)*i<=0)a=r[1]*s/(i*r[0]+r[1]*(s-n));else{a=r[1]*(s-1)/(i*(r[0]-1)+r[1]*(s-n));{let o=n-s,h=i,l=.3963377774*t+.2158037573*e,c=-.1055613458*t-.0638541728*e,u=-.0894841775*t-1.291485548*e,f=o+h*l,d=o+h*c,m=o+h*u;{let g=s*(1-a)+a*n,x=a*i,p=g+x*l,v=g+x*c,b=g+x*u,y=p*p*p,z=v*v*v,C=b*b*b,k=3*f*p*p,A=3*d*v*v,R=3*m*b*b,S=6*f*f*p,I=6*d*d*v,L=6*m*m*b,B=4.0767416621*y-3.3077115913*z+.2309699292*C-1,H=4.0767416621*k-3.3077115913*A+.2309699292*R,re=4.0767416621*S-3.3077115913*I+.2309699292*L,de=H/(H*H-.5*B*re),ne=-B*de,ce=-1.2684380046*y+2.6097574011*z-.3413193965*C-1,be=-1.2684380046*k+2.6097574011*A-.3413193965*R,ye=-1.2684380046*S+2.6097574011*I-.3413193965*L,me=be/(be*be-.5*ce*ye),Ke=-ce*me,Vt=-.0041960863*y-.7034186147*z+1.707614701*C-1,N=-.0041960863*k-.7034186147*A+1.707614701*R,ie=-.0041960863*S-.7034186147*I+1.707614701*L,pe=N/(N*N-.5*Vt*ie),_e=-Vt*pe;ne=de>=0?ne:1e6,Ke=me>=0?Ke:1e6,_e=pe>=0?_e:1e6,a+=Math.min(ne,Math.min(Ke,_e))}}}return a}function hs(t,e,n=null){n||(n=os(t,e));let i=n[0],s=n[1];return[s/i,s/(1-i)]}function fa(t,e,n){let i=os(e,n),s=rh(e,n,t,1,t,i),r=hs(e,n,i),a=.11516993+1/(7.4477897+4.1590124*n+e*(-2.19557347+1.75198401*n+e*(-2.13704948-10.02301043*n+e*(-4.24894561+5.38770819*n+4.69891013*e)))),o=.11239642+1/(1.6132032-.68124379*n+e*(.40370612+.90148123*n+e*(-.27087943+.6122399*n+e*(.00299215-.45399568*n-.14661872*e)))),h=s/Math.min(t*r[0],(1-t)*r[1]),l=t*a,c=(1-t)*o,u=.9*h*Math.sqrt(Math.sqrt(1/(1/(l*l*l*l)+1/(c*c*c*c))));return l=t*.4,c=(1-t)*.8,[Math.sqrt(1/(1/(l*l)+1/(c*c))),u,s]}function Ls(t){const e=t.l!==void 0?t.l:0,n=t.a!==void 0?t.a:0,i=t.b!==void 0?t.b:0,s={mode:"okhsl",l:Bi(e)};t.alpha!==void 0&&(s.alpha=t.alpha);let r=Math.sqrt(n*n+i*i);if(!r)return s.s=0,s;let[a,o,h]=fa(e,n/r,i/r),l;if(r<o){let c=0,u=.8*a,f=1-u/o;l=(r-c)/(u+f*(r-c))*.8}else{let c=o,u=.2*o*o*1.25*1.25/a,f=1-u/(h-o);l=.8+.2*((r-c)/(u+f*(r-c)))}return l&&(s.s=l,s.h=Q(Math.atan2(i,n)*180/Math.PI)),s}function Us(t){let e=t.h!==void 0?t.h:0,n=t.s!==void 0?t.s:0,i=t.l!==void 0?t.l:0;const s={mode:"oklab",l:bn(i)};if(t.alpha!==void 0&&(s.alpha=t.alpha),!n||i===1)return s.a=s.b=0,s;let r=Math.cos(e/180*Math.PI),a=Math.sin(e/180*Math.PI),[o,h,l]=fa(s.l,r,a),c,u,f,d;n<.8?(c=1.25*n,u=0,f=.8*o,d=1-f/h):(c=5*(n-.8),u=h,f=.2*h*h*1.25*1.25/o,d=1-f/(l-h));let m=u+c*f/(1-d*c);return s.a=m*r,s.b=m*a,s}const ah={...Zr,mode:"okhsl",channels:["h","s","l","alpha"],parse:["--okhsl"],serialize:"--okhsl",fromMode:{oklab:Ls,rgb:t=>Ls(Fn(t))},toMode:{oklab:Us,rgb:t=>On(Us(t))}};function $s(t){let e=t.l!==void 0?t.l:0,n=t.a!==void 0?t.a:0,i=t.b!==void 0?t.b:0,s=Math.sqrt(n*n+i*i),r=s?n/s:1,a=s?i/s:1,[o,h]=hs(r,a),l=.5,c=1-l/o,u=h/(s+e*h),f=u*e,d=u*s,m=bn(f),g=d*m/f,x=Ut({l:m,a:r*g,b:a*g}),p=Math.cbrt(1/Math.max(x.r,x.g,x.b,0));e=e/p,s=s/p*Bi(e)/e,e=Bi(e);const v={mode:"okhsv",s:s?(l+h)*d/(h*l+h*c*d):0,v:e?e/f:0};return v.s&&(v.h=Q(Math.atan2(i,n)*180/Math.PI)),t.alpha!==void 0&&(v.alpha=t.alpha),v}function Vs(t){const e={mode:"oklab"};t.alpha!==void 0&&(e.alpha=t.alpha);const n=t.h!==void 0?t.h:0,i=t.s!==void 0?t.s:0,s=t.v!==void 0?t.v:0,r=Math.cos(n/180*Math.PI),a=Math.sin(n/180*Math.PI),[o,h]=hs(r,a),l=.5,c=1-l/o,u=1-i*l/(l+h-h*c*i),f=i*h*l/(l+h-h*c*i),d=bn(u),m=f*d/u,g=Ut({l:d,a:r*m,b:a*m}),x=Math.cbrt(1/Math.max(g.r,g.g,g.b,0)),p=bn(s*u),v=f*p/u;return e.l=p*x,e.a=v*r*x,e.b=v*a*x,e}const oh={...Jr,mode:"okhsv",channels:["h","s","v","alpha"],parse:["--okhsv"],serialize:"--okhsv",fromMode:{oklab:$s,rgb:t=>$s(Fn(t))},toMode:{oklab:Vs,rgb:t=>On(Vs(t))}};function hh(t,e){if(!e||e[0]!=="oklab")return;const n={mode:"oklab"},[,i,s,r,a]=e;if(!(i.type===_.Hue||s.type===_.Hue||r.type===_.Hue))return i.type!==_.None&&(n.l=Math.min(Math.max(0,i.type===_.Number?i.value:i.value/100),1)),s.type!==_.None&&(n.a=s.type===_.Number?s.value:s.value*.4/100),r.type!==_.None&&(n.b=r.type===_.Number?r.value:r.value*.4/100),a.type!==_.None&&(n.alpha=Math.min(1,Math.max(0,a.type===_.Number?a.value:a.value/100))),n}const lh={...rs,mode:"oklab",toMode:{lrgb:Ut,rgb:On},fromMode:{lrgb:ua,rgb:Fn},ranges:{l:[0,1],a:[-.4,.4],b:[-.4,.4]},parse:[hh],serialize:t=>`oklab(${t.l!==void 0?t.l:"none"} ${t.a!==void 0?t.a:"none"} ${t.b!==void 0?t.b:"none"}${t.alpha<1?` / ${t.alpha}`:""})`};function ch(t,e){if(!e||e[0]!=="oklch")return;const n={mode:"oklch"},[,i,s,r,a]=e;if(i.type!==_.None){if(i.type===_.Hue)return;n.l=Math.min(Math.max(0,i.type===_.Number?i.value:i.value/100),1)}if(s.type!==_.None&&(n.c=Math.max(0,s.type===_.Number?s.value:s.value*.4/100)),r.type!==_.None){if(r.type===_.Percentage)return;n.h=r.value}return a.type!==_.None&&(n.alpha=Math.min(1,Math.max(0,a.type===_.Number?a.value:a.value/100))),n}const uh={...as,mode:"oklch",toMode:{oklab:t=>Ne(t,"oklab"),rgb:t=>On(Ne(t,"oklab"))},fromMode:{rgb:t=>De(Fn(t),"oklch"),oklab:t=>De(t,"oklch")},parse:[ch],serialize:t=>`oklch(${t.l!==void 0?t.l:"none"} ${t.c!==void 0?t.c:"none"} ${t.h!==void 0?t.h:"none"}${t.alpha<1?` / ${t.alpha}`:""})`,ranges:{l:[0,1],c:[0,.4],h:[0,360]}},Bs=t=>{let{r:e,g:n,b:i,alpha:s}=gt(t),r={mode:"xyz65",x:.486570948648216*e+.265667693169093*n+.1982172852343625*i,y:.2289745640697487*e+.6917385218365062*n+.079286914093745*i,z:0*e+.0451133818589026*n+1.043944368900976*i};return s!==void 0&&(r.alpha=s),r},Hs=({x:t,y:e,z:n,alpha:i})=>{t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);let s=xt({r:t*2.4934969119414263-e*.9313836179191242-.402710784450717*n,g:t*-.8294889695615749+e*1.7626640603183465+.0236246858419436*n,b:t*.0358458302437845-e*.0761723892680418+.9568845240076871*n},"p3");return i!==void 0&&(s.alpha=i),s},fh={...pt,mode:"p3",parse:["display-p3"],serialize:"display-p3",fromMode:{rgb:t=>Hs(Ye(t)),xyz65:Hs},toMode:{rgb:t=>Ze(Bs(t)),xyz65:Bs}},fi=t=>{let e=Math.abs(t);return e>=1/512?Math.sign(t)*Math.pow(e,1/1.8):16*t},Ws=({x:t,y:e,z:n,alpha:i})=>{t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);let s={mode:"prophoto",r:fi(t*1.3457868816471585-e*.2555720873797946-.0511018649755453*n),g:fi(t*-.5446307051249019+e*1.5082477428451466+.0205274474364214*n),b:fi(t*0+e*0+1.2119675456389452*n)};return i!==void 0&&(s.alpha=i),s},di=(t=0)=>{let e=Math.abs(t);return e>=16/512?Math.sign(t)*Math.pow(e,1.8):t/16},Xs=t=>{let e=di(t.r),n=di(t.g),i=di(t.b),s={mode:"xyz50",x:.7977666449006423*e+.1351812974005331*n+.0313477341283922*i,y:.2880748288194013*e+.7118352342418731*n+899369387256e-16*i,z:0*e+0*n+.8251046025104602*i};return t.alpha!==void 0&&(s.alpha=t.alpha),s},dh={...pt,mode:"prophoto",parse:["prophoto-rgb"],serialize:"prophoto-rgb",fromMode:{xyz50:Ws,rgb:t=>Ws(Lt(t))},toMode:{xyz50:Xs,rgb:t=>jt(Xs(t))}},qs=1.09929682680944,mh=.018053968510807,mi=t=>{const e=Math.abs(t);return e>mh?(Math.sign(t)||1)*(qs*Math.pow(e,.45)-(qs-1)):4.5*t},Ys=({x:t,y:e,z:n,alpha:i})=>{t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);let s={mode:"rec2020",r:mi(t*1.7166511879712683-e*.3556707837763925-.2533662813736599*n),g:mi(t*-.6666843518324893+e*1.6164812366349395+.0157685458139111*n),b:mi(t*.0176398574453108-e*.0427706132578085+.9421031212354739*n)};return i!==void 0&&(s.alpha=i),s},Zs=1.09929682680944,ph=.018053968510807,pi=(t=0)=>{let e=Math.abs(t);return e<ph*4.5?t/4.5:(Math.sign(t)||1)*Math.pow((e+Zs-1)/Zs,1/.45)},Gs=t=>{let e=pi(t.r),n=pi(t.g),i=pi(t.b),s={mode:"xyz65",x:.6369580483012911*e+.1446169035862083*n+.1688809751641721*i,y:.262700212011267*e+.6779980715188708*n+.059301716469862*i,z:0*e+.0280726930490874*n+1.0609850577107909*i};return t.alpha!==void 0&&(s.alpha=t.alpha),s},gh={...pt,mode:"rec2020",fromMode:{xyz65:Ys,rgb:t=>Ys(Ye(t))},toMode:{xyz65:Gs,rgb:t=>Ze(Gs(t))},parse:["rec2020"],serialize:"rec2020"},Be=.0037930732552754493,da=Math.cbrt(Be),gi=t=>Math.cbrt(t)-da,xh=t=>{const{r:e,g:n,b:i,alpha:s}=gt(t),r=gi(.3*e+.622*n+.078*i+Be),a=gi(.23*e+.692*n+.078*i+Be),o=gi(.2434226892454782*e+.2047674442449682*n+.5518098665095535*i+Be),h={mode:"xyb",x:(r-a)/2,y:(r+a)/2,b:o-(r+a)/2};return s!==void 0&&(h.alpha=s),h},xi=t=>Math.pow(t+da,3),bh=({x:t,y:e,b:n,alpha:i})=>{t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);const s=xi(t+e)-Be,r=xi(e-t)-Be,a=xi(n+e)-Be,o=xt({r:11.031566904639861*s-9.866943908131562*r-.16462299650829934*a,g:-3.2541473810744237*s+4.418770377582723*r-.16462299650829934*a,b:-3.6588512867136815*s+2.7129230459360922*r+1.9459282407775895*a});return i!==void 0&&(o.alpha=i),o},vh={mode:"xyb",channels:["x","y","b","alpha"],parse:["--xyb"],serialize:"--xyb",toMode:{rgb:bh},fromMode:{rgb:xh},ranges:{x:[-.0154,.0281],y:[0,.8453],b:[-.2778,.388]},interpolate:{x:T,y:T,b:T,alpha:{use:T,fixup:Y}}},yh={mode:"xyz50",parse:["xyz-d50"],serialize:"xyz-d50",toMode:{rgb:jt,lab:ss},fromMode:{rgb:Lt,lab:is},channels:["x","y","z","alpha"],ranges:{x:[0,.964],y:[0,.999],z:[0,.825]},interpolate:{x:T,y:T,z:T,alpha:{use:T,fixup:Y}}},_h=t=>{let{x:e,y:n,z:i,alpha:s}=t;e===void 0&&(e=0),n===void 0&&(n=0),i===void 0&&(i=0);let r={mode:"xyz50",x:1.0479298208405488*e+.0229467933410191*n-.0501922295431356*i,y:.0296278156881593*e+.990434484573249*n-.0170738250293851*i,z:-.0092430581525912*e+.0150551448965779*n+.7518742899580008*i};return s!==void 0&&(r.alpha=s),r},Mh=t=>{let{x:e,y:n,z:i,alpha:s}=t;e===void 0&&(e=0),n===void 0&&(n=0),i===void 0&&(i=0);let r={mode:"xyz65",x:.9554734527042182*e-.0230985368742614*n+.0632593086610217*i,y:-.0283697069632081*e+1.0099954580058226*n+.021041398966943*i,z:.0123140016883199*e-.0205076964334779*n+1.3303659366080753*i};return s!==void 0&&(r.alpha=s),r},wh={mode:"xyz65",toMode:{rgb:Ze,xyz50:_h},fromMode:{rgb:Ye,xyz50:Mh},ranges:{x:[0,.95],y:[0,1],z:[0,1.088]},channels:["x","y","z","alpha"],parse:["xyz","xyz-d65"],serialize:"xyz-d65",interpolate:{x:T,y:T,z:T,alpha:{use:T,fixup:Y}}},Th=({r:t,g:e,b:n,alpha:i})=>{t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);const s={mode:"yiq",y:.29889531*t+.58662247*e+.11448223*n,i:.59597799*t-.2741761*e-.32180189*n,q:.21147017*t-.52261711*e+.31114694*n};return i!==void 0&&(s.alpha=i),s},kh=({y:t,i:e,q:n,alpha:i})=>{t===void 0&&(t=0),e===void 0&&(e=0),n===void 0&&(n=0);const s={mode:"rgb",r:t+.95608445*e+.6208885*n,g:t-.27137664*e-.6486059*n,b:t-1.10561724*e+1.70250126*n};return i!==void 0&&(s.alpha=i),s},zh={mode:"yiq",toMode:{rgb:kh},fromMode:{rgb:Th},channels:["y","i","q","alpha"],parse:["--yiq"],serialize:"--yiq",ranges:{i:[-.595,.595],q:[-.522,.522]},interpolate:{y:T,i:T,q:T,alpha:{use:T,fixup:Y}}},Ch=(t,e)=>Math.round(t*(e=Math.pow(10,e)))/e,Sh=(t=4)=>e=>typeof e=="number"?Ch(e,t):e;let Ah=Sh(2);const ma=t=>Math.max(0,Math.min(1,t||0)),ct=t=>Math.round(ma(t)*255),pa=xe("rgb"),Eh=t=>{if(t===void 0)return;let e=ct(t.r),n=ct(t.g),i=ct(t.b);return"#"+(1<<24|e<<16|n<<8|i).toString(16).slice(1)},Rh=t=>{if(t===void 0)return;let e=ct(t.r),n=ct(t.g),i=ct(t.b);return t.alpha===void 0||t.alpha===1?`rgb(${e}, ${n}, ${i})`:`rgba(${e}, ${n}, ${i}, ${Ah(ma(t.alpha))})`},Ih=t=>Eh(pa(t)),Mt=t=>Rh(pa(t)),Fh=t=>t!==void 0&&(t.r===void 0||t.r>=0&&t.r<=1)&&(t.g===void 0||t.g>=0&&t.g<=1)&&(t.b===void 0||t.b>=0&&t.b<=1);function qt(t="rgb"){const{gamut:e}=Ur(t);if(!e)return i=>!0;const n=xe(typeof e=="string"?e:t);return i=>Fh(n(i))}D(d0);D(y0);D(_0);D(M0);D(k0);D(Zr);D(Jr);D(P0);D(D0);D(U0);D($0);D(rs);D(B0);D(as);D(W0);D(th);D(nh);D(ih);D(ah);D(oh);D(lh);const wt=D(uh);D(fh);D(dh);D(gh);D(pt);D(vh);D(yh);D(wh);D(zh);const ga="182",xa=300,Ks=1e3,Yt=1001,Js=1002,Oh=1006,Ph=1008,Dh=1009,Nh=1023,jh="",Ct=2e3,Qs=2001;function er(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function je(...t){const e="THREE."+t.shift();console.warn(e,...t)}function tr(...t){const e="THREE."+t.shift();console.error(e,...t)}class ba{addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(n)===-1&&i[e].push(n)}hasEventListener(e,n){const i=this._listeners;return i===void 0?!1:i[e]!==void 0&&i[e].indexOf(n)!==-1}removeEventListener(e,n){const i=this._listeners;if(i===void 0)return;const s=i[e];if(s!==void 0){const r=s.indexOf(n);r!==-1&&s.splice(r,1)}}dispatchEvent(e){const n=this._listeners;if(n===void 0)return;const i=n[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let r=0,a=s.length;r<a;r++)s[r].call(this,e);e.target=null}}}const ee=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let nr=1234567;const It=Math.PI/180,vn=180/Math.PI;function Pn(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(ee[t&255]+ee[t>>8&255]+ee[t>>16&255]+ee[t>>24&255]+"-"+ee[e&255]+ee[e>>8&255]+"-"+ee[e>>16&15|64]+ee[e>>24&255]+"-"+ee[n&63|128]+ee[n>>8&255]+"-"+ee[n>>16&255]+ee[n>>24&255]+ee[i&255]+ee[i>>8&255]+ee[i>>16&255]+ee[i>>24&255]).toLowerCase()}function $(t,e,n){return Math.max(e,Math.min(n,t))}function va(t,e){return(t%e+e)%e}function Lh(t,e,n,i,s){return i+(t-e)*(s-i)/(n-e)}function Uh(t,e,n){return t!==e?(n-t)/(e-t):0}function ya(t,e,n){return(1-n)*t+n*e}function $h(t,e,n,i){return ya(t,e,1-Math.exp(-n*i))}function Vh(t,e=1){return e-Math.abs(va(t,e*2)-e)}function Bh(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*(3-2*t))}function Hh(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*t*(t*(t*6-15)+10))}function Wh(t,e){return t+Math.floor(Math.random()*(e-t+1))}function Xh(t,e){return t+Math.random()*(e-t)}function qh(t){return t*(.5-Math.random())}function Yh(t){t!==void 0&&(nr=t);let e=nr+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function Zh(t){return t*It}function Gh(t){return t*vn}function Kh(t){return(t&t-1)===0&&t!==0}function Jh(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Qh(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function el(t,e,n,i,s){const r=Math.cos,a=Math.sin,o=r(n/2),h=a(n/2),l=r((e+i)/2),c=a((e+i)/2),u=r((e-i)/2),f=a((e-i)/2),d=r((i-e)/2),m=a((i-e)/2);switch(s){case"XYX":t.set(o*c,h*u,h*f,o*l);break;case"YZY":t.set(h*f,o*c,h*u,o*l);break;case"ZXZ":t.set(h*u,h*f,o*c,o*l);break;case"XZX":t.set(o*c,h*m,h*d,o*l);break;case"YXY":t.set(h*d,o*c,h*m,o*l);break;case"ZYZ":t.set(h*m,h*d,o*c,o*l);break;default:je("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function tl(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function nl(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(t*4294967295);case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int32Array:return Math.round(t*2147483647);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}const bi={DEG2RAD:It,RAD2DEG:vn,generateUUID:Pn,clamp:$,euclideanModulo:va,mapLinear:Lh,inverseLerp:Uh,lerp:ya,damp:$h,pingpong:Vh,smoothstep:Bh,smootherstep:Hh,randInt:Wh,randFloat:Xh,randFloatSpread:qh,seededRandom:Yh,degToRad:Zh,radToDeg:Gh,isPowerOfTwo:Kh,ceilPowerOfTwo:Jh,floorPowerOfTwo:Qh,setQuaternionFromProperEuler:el,normalize:nl,denormalize:tl};class He{constructor(e=0,n=0){He.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,i=this.y,s=e.elements;return this.x=s[0]*n+s[3]*i+s[6],this.y=s[1]*n+s[4]*i+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=$(this.x,e.x,n.x),this.y=$(this.y,e.y,n.y),this}clampScalar(e,n){return this.x=$(this.x,e,n),this.y=$(this.y,e,n),this}clampLength(e,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar($(i,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const i=this.dot(e)/n;return Math.acos($(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,i=this.y-e.y;return n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,i){return this.x=e.x+(n.x-e.x)*i,this.y=e.y+(n.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const i=Math.cos(n),s=Math.sin(n),r=this.x-e.x,a=this.y-e.y;return this.x=r*i-a*s+e.x,this.y=r*s+a*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ge{constructor(e=0,n=0,i=0,s=1){this.isQuaternion=!0,this._x=e,this._y=n,this._z=i,this._w=s}static slerpFlat(e,n,i,s,r,a,o){let h=i[s+0],l=i[s+1],c=i[s+2],u=i[s+3],f=r[a+0],d=r[a+1],m=r[a+2],g=r[a+3];if(o<=0){e[n+0]=h,e[n+1]=l,e[n+2]=c,e[n+3]=u;return}if(o>=1){e[n+0]=f,e[n+1]=d,e[n+2]=m,e[n+3]=g;return}if(u!==g||h!==f||l!==d||c!==m){let x=h*f+l*d+c*m+u*g;x<0&&(f=-f,d=-d,m=-m,g=-g,x=-x);let p=1-o;if(x<.9995){const v=Math.acos(x),b=Math.sin(v);p=Math.sin(p*v)/b,o=Math.sin(o*v)/b,h=h*p+f*o,l=l*p+d*o,c=c*p+m*o,u=u*p+g*o}else{h=h*p+f*o,l=l*p+d*o,c=c*p+m*o,u=u*p+g*o;const v=1/Math.sqrt(h*h+l*l+c*c+u*u);h*=v,l*=v,c*=v,u*=v}}e[n]=h,e[n+1]=l,e[n+2]=c,e[n+3]=u}static multiplyQuaternionsFlat(e,n,i,s,r,a){const o=i[s],h=i[s+1],l=i[s+2],c=i[s+3],u=r[a],f=r[a+1],d=r[a+2],m=r[a+3];return e[n]=o*m+c*u+h*d-l*f,e[n+1]=h*m+c*f+l*u-o*d,e[n+2]=l*m+c*d+o*f-h*u,e[n+3]=c*m-o*u-h*f-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,n,i,s){return this._x=e,this._y=n,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,n=!0){const i=e._x,s=e._y,r=e._z,a=e._order,o=Math.cos,h=Math.sin,l=o(i/2),c=o(s/2),u=o(r/2),f=h(i/2),d=h(s/2),m=h(r/2);switch(a){case"XYZ":this._x=f*c*u+l*d*m,this._y=l*d*u-f*c*m,this._z=l*c*m+f*d*u,this._w=l*c*u-f*d*m;break;case"YXZ":this._x=f*c*u+l*d*m,this._y=l*d*u-f*c*m,this._z=l*c*m-f*d*u,this._w=l*c*u+f*d*m;break;case"ZXY":this._x=f*c*u-l*d*m,this._y=l*d*u+f*c*m,this._z=l*c*m+f*d*u,this._w=l*c*u-f*d*m;break;case"ZYX":this._x=f*c*u-l*d*m,this._y=l*d*u+f*c*m,this._z=l*c*m-f*d*u,this._w=l*c*u+f*d*m;break;case"YZX":this._x=f*c*u+l*d*m,this._y=l*d*u+f*c*m,this._z=l*c*m-f*d*u,this._w=l*c*u-f*d*m;break;case"XZY":this._x=f*c*u-l*d*m,this._y=l*d*u-f*c*m,this._z=l*c*m+f*d*u,this._w=l*c*u+f*d*m;break;default:je("Quaternion: .setFromEuler() encountered an unknown order: "+a)}return n===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,n){const i=n/2,s=Math.sin(i);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const n=e.elements,i=n[0],s=n[4],r=n[8],a=n[1],o=n[5],h=n[9],l=n[2],c=n[6],u=n[10],f=i+o+u;if(f>0){const d=.5/Math.sqrt(f+1);this._w=.25/d,this._x=(c-h)*d,this._y=(r-l)*d,this._z=(a-s)*d}else if(i>o&&i>u){const d=2*Math.sqrt(1+i-o-u);this._w=(c-h)/d,this._x=.25*d,this._y=(s+a)/d,this._z=(r+l)/d}else if(o>u){const d=2*Math.sqrt(1+o-i-u);this._w=(r-l)/d,this._x=(s+a)/d,this._y=.25*d,this._z=(h+c)/d}else{const d=2*Math.sqrt(1+u-i-o);this._w=(a-s)/d,this._x=(r+l)/d,this._y=(h+c)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,n){let i=e.dot(n)+1;return i<1e-8?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*n.z-e.z*n.y,this._y=e.z*n.x-e.x*n.z,this._z=e.x*n.y-e.y*n.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs($(this.dot(e),-1,1)))}rotateTowards(e,n){const i=this.angleTo(e);if(i===0)return this;const s=Math.min(1,n/i);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,n){const i=e._x,s=e._y,r=e._z,a=e._w,o=n._x,h=n._y,l=n._z,c=n._w;return this._x=i*c+a*o+s*l-r*h,this._y=s*c+a*h+r*o-i*l,this._z=r*c+a*l+i*h-s*o,this._w=a*c-i*o-s*h-r*l,this._onChangeCallback(),this}slerp(e,n){if(n<=0)return this;if(n>=1)return this.copy(e);let i=e._x,s=e._y,r=e._z,a=e._w,o=this.dot(e);o<0&&(i=-i,s=-s,r=-r,a=-a,o=-o);let h=1-n;if(o<.9995){const l=Math.acos(o),c=Math.sin(l);h=Math.sin(h*l)/c,n=Math.sin(n*l)/c,this._x=this._x*h+i*n,this._y=this._y*h+s*n,this._z=this._z*h+r*n,this._w=this._w*h+a*n,this._onChangeCallback()}else this._x=this._x*h+i*n,this._y=this._y*h+s*n,this._z=this._z*h+r*n,this._w=this._w*h+a*n,this.normalize();return this}slerpQuaternions(e,n,i){return this.copy(e).slerp(n,i)}random(){const e=2*Math.PI*Math.random(),n=2*Math.PI*Math.random(),i=Math.random(),s=Math.sqrt(1-i),r=Math.sqrt(i);return this.set(s*Math.sin(e),s*Math.cos(e),r*Math.sin(n),r*Math.cos(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,n=0){return this._x=e[n],this._y=e[n+1],this._z=e[n+2],this._w=e[n+3],this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._w,e}fromBufferAttribute(e,n){return this._x=e.getX(n),this._y=e.getY(n),this._z=e.getZ(n),this._w=e.getW(n),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class M{constructor(e=0,n=0,i=0){M.prototype.isVector3=!0,this.x=e,this.y=n,this.z=i}set(e,n,i){return i===void 0&&(i=this.z),this.x=e,this.y=n,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,n){return this.x=e.x*n.x,this.y=e.y*n.y,this.z=e.z*n.z,this}applyEuler(e){return this.applyQuaternion(ir.setFromEuler(e))}applyAxisAngle(e,n){return this.applyQuaternion(ir.setFromAxisAngle(e,n))}applyMatrix3(e){const n=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*n+r[3]*i+r[6]*s,this.y=r[1]*n+r[4]*i+r[7]*s,this.z=r[2]*n+r[5]*i+r[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const n=this.x,i=this.y,s=this.z,r=e.elements,a=1/(r[3]*n+r[7]*i+r[11]*s+r[15]);return this.x=(r[0]*n+r[4]*i+r[8]*s+r[12])*a,this.y=(r[1]*n+r[5]*i+r[9]*s+r[13])*a,this.z=(r[2]*n+r[6]*i+r[10]*s+r[14])*a,this}applyQuaternion(e){const n=this.x,i=this.y,s=this.z,r=e.x,a=e.y,o=e.z,h=e.w,l=2*(a*s-o*i),c=2*(o*n-r*s),u=2*(r*i-a*n);return this.x=n+h*l+a*u-o*c,this.y=i+h*c+o*l-r*u,this.z=s+h*u+r*c-a*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const n=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*n+r[4]*i+r[8]*s,this.y=r[1]*n+r[5]*i+r[9]*s,this.z=r[2]*n+r[6]*i+r[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,n){return this.x=$(this.x,e.x,n.x),this.y=$(this.y,e.y,n.y),this.z=$(this.z,e.z,n.z),this}clampScalar(e,n){return this.x=$(this.x,e,n),this.y=$(this.y,e,n),this.z=$(this.z,e,n),this}clampLength(e,n){const i=this.length();return this.divideScalar(i||1).multiplyScalar($(i,e,n))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this}lerpVectors(e,n,i){return this.x=e.x+(n.x-e.x)*i,this.y=e.y+(n.y-e.y)*i,this.z=e.z+(n.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,n){const i=e.x,s=e.y,r=e.z,a=n.x,o=n.y,h=n.z;return this.x=s*h-r*o,this.y=r*a-i*h,this.z=i*o-s*a,this}projectOnVector(e){const n=e.lengthSq();if(n===0)return this.set(0,0,0);const i=e.dot(this)/n;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return vi.copy(this).projectOnVector(e),this.sub(vi)}reflect(e){return this.sub(vi.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const i=this.dot(e)/n;return Math.acos($(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return n*n+i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,n,i){const s=Math.sin(n)*e;return this.x=s*Math.sin(i),this.y=Math.cos(n)*e,this.z=s*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,n,i){return this.x=e*Math.sin(n),this.y=i,this.z=e*Math.cos(n),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(e){const n=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=n,this.y=i,this.z=s,this}setFromMatrixColumn(e,n){return this.fromArray(e.elements,n*4)}setFromMatrix3Column(e,n){return this.fromArray(e.elements,n*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,n=Math.random()*2-1,i=Math.sqrt(1-n*n);return this.x=i*Math.cos(e),this.y=n,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const vi=new M,ir=new Ge;class $t{constructor(e,n,i,s,r,a,o,h,l){$t.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,i,s,r,a,o,h,l)}set(e,n,i,s,r,a,o,h,l){const c=this.elements;return c[0]=e,c[1]=s,c[2]=o,c[3]=n,c[4]=r,c[5]=h,c[6]=i,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,i=e.elements;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],this}extractBasis(e,n,i){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const i=e.elements,s=n.elements,r=this.elements,a=i[0],o=i[3],h=i[6],l=i[1],c=i[4],u=i[7],f=i[2],d=i[5],m=i[8],g=s[0],x=s[3],p=s[6],v=s[1],b=s[4],y=s[7],z=s[2],C=s[5],k=s[8];return r[0]=a*g+o*v+h*z,r[3]=a*x+o*b+h*C,r[6]=a*p+o*y+h*k,r[1]=l*g+c*v+u*z,r[4]=l*x+c*b+u*C,r[7]=l*p+c*y+u*k,r[2]=f*g+d*v+m*z,r[5]=f*x+d*b+m*C,r[8]=f*p+d*y+m*k,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],i=e[1],s=e[2],r=e[3],a=e[4],o=e[5],h=e[6],l=e[7],c=e[8];return n*a*c-n*o*l-i*r*c+i*o*h+s*r*l-s*a*h}invert(){const e=this.elements,n=e[0],i=e[1],s=e[2],r=e[3],a=e[4],o=e[5],h=e[6],l=e[7],c=e[8],u=c*a-o*l,f=o*h-c*r,d=l*r-a*h,m=n*u+i*f+s*d;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/m;return e[0]=u*g,e[1]=(s*l-c*i)*g,e[2]=(o*i-s*a)*g,e[3]=f*g,e[4]=(c*n-s*h)*g,e[5]=(s*r-o*n)*g,e[6]=d*g,e[7]=(i*h-l*n)*g,e[8]=(a*n-i*r)*g,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,i,s,r,a,o){const h=Math.cos(r),l=Math.sin(r);return this.set(i*h,i*l,-i*(h*a+l*o)+a+e,-s*l,s*h,-s*(-l*a+h*o)+o+n,0,0,1),this}scale(e,n){return this.premultiply(yi.makeScale(e,n)),this}rotate(e){return this.premultiply(yi.makeRotation(-e)),this}translate(e,n){return this.premultiply(yi.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),i=Math.sin(e);return this.set(n,-i,0,i,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,i=e.elements;for(let s=0;s<9;s++)if(n[s]!==i[s])return!1;return!0}fromArray(e,n=0){for(let i=0;i<9;i++)this.elements[i]=e[i+n];return this}toArray(e=[],n=0){const i=this.elements;return e[n]=i[0],e[n+1]=i[1],e[n+2]=i[2],e[n+3]=i[3],e[n+4]=i[4],e[n+5]=i[5],e[n+6]=i[6],e[n+7]=i[7],e[n+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const yi=new $t;function _i(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}let et;class il{static getDataURL(e,n="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{et===void 0&&(et=er("canvas")),et.width=e.width,et.height=e.height;const s=et.getContext("2d");e instanceof ImageData?s.putImageData(e,0,0):s.drawImage(e,0,0,e.width,e.height),i=et}return i.toDataURL(n)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const n=er("canvas");n.width=e.width,n.height=e.height;const i=n.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const s=i.getImageData(0,0,e.width,e.height),r=s.data;for(let a=0;a<r.length;a++)r[a]=_i(r[a]/255)*255;return i.putImageData(s,0,0),n}else if(e.data){const n=e.data.slice(0);for(let i=0;i<n.length;i++)n instanceof Uint8Array||n instanceof Uint8ClampedArray?n[i]=Math.floor(_i(n[i]/255)*255):n[i]=_i(n[i]);return{data:n,width:e.width,height:e.height}}else return je("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let sl=0;class rl{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:sl++}),this.uuid=Pn(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const n=this.data;return typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement?e.set(n.videoWidth,n.videoHeight,0):typeof VideoFrame<"u"&&n instanceof VideoFrame?e.set(n.displayHeight,n.displayWidth,0):n!==null?e.set(n.width,n.height,n.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let a=0,o=s.length;a<o;a++)s[a].isDataTexture?r.push(Mi(s[a].image)):r.push(Mi(s[a]))}else r=Mi(s);i.url=r}return n||(e.images[this.uuid]=i),i}}function Mi(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?il.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(je("Texture: Unable to serialize Texture."),{})}let al=0;const wi=new M;class We extends ba{constructor(e=We.DEFAULT_IMAGE,n=We.DEFAULT_MAPPING,i=Yt,s=Yt,r=Oh,a=Ph,o=Nh,h=Dh,l=We.DEFAULT_ANISOTROPY,c=jh){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:al++}),this.uuid=Pn(),this.name="",this.source=new rl(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=i,this.wrapT=s,this.magFilter=r,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=h,this.offset=new He(0,0),this.repeat=new He(1,1),this.center=new He(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new $t,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(wi).x}get height(){return this.source.getSize(wi).y}get depth(){return this.source.getSize(wi).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const n in e){const i=e[n];if(i===void 0){je(`Texture.setValues(): parameter '${n}' has value of undefined.`);continue}const s=this[n];if(s===void 0){je(`Texture.setValues(): property '${n}' does not exist.`);continue}s&&i&&s.isVector2&&i.isVector2||s&&i&&s.isVector3&&i.isVector3||s&&i&&s.isMatrix3&&i.isMatrix3?s.copy(i):this[n]=i}}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),n||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==xa)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ks:e.x=e.x-Math.floor(e.x);break;case Yt:e.x=e.x<0?0:1;break;case Js:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Ks:e.y=e.y-Math.floor(e.y);break;case Yt:e.y=e.y<0?0:1;break;case Js:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}We.DEFAULT_IMAGE=null;We.DEFAULT_MAPPING=xa;We.DEFAULT_ANISOTROPY=1;class J{constructor(e,n,i,s,r,a,o,h,l,c,u,f,d,m,g,x){J.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,n,i,s,r,a,o,h,l,c,u,f,d,m,g,x)}set(e,n,i,s,r,a,o,h,l,c,u,f,d,m,g,x){const p=this.elements;return p[0]=e,p[4]=n,p[8]=i,p[12]=s,p[1]=r,p[5]=a,p[9]=o,p[13]=h,p[2]=l,p[6]=c,p[10]=u,p[14]=f,p[3]=d,p[7]=m,p[11]=g,p[15]=x,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new J().fromArray(this.elements)}copy(e){const n=this.elements,i=e.elements;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],this}copyPosition(e){const n=this.elements,i=e.elements;return n[12]=i[12],n[13]=i[13],n[14]=i[14],this}setFromMatrix3(e){const n=e.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(e,n,i){return this.determinant()===0?(e.set(1,0,0),n.set(0,1,0),i.set(0,0,1),this):(e.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this)}makeBasis(e,n,i){return this.set(e.x,n.x,i.x,0,e.y,n.y,i.y,0,e.z,n.z,i.z,0,0,0,0,1),this}extractRotation(e){if(e.determinant()===0)return this.identity();const n=this.elements,i=e.elements,s=1/tt.setFromMatrixColumn(e,0).length(),r=1/tt.setFromMatrixColumn(e,1).length(),a=1/tt.setFromMatrixColumn(e,2).length();return n[0]=i[0]*s,n[1]=i[1]*s,n[2]=i[2]*s,n[3]=0,n[4]=i[4]*r,n[5]=i[5]*r,n[6]=i[6]*r,n[7]=0,n[8]=i[8]*a,n[9]=i[9]*a,n[10]=i[10]*a,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(e){const n=this.elements,i=e.x,s=e.y,r=e.z,a=Math.cos(i),o=Math.sin(i),h=Math.cos(s),l=Math.sin(s),c=Math.cos(r),u=Math.sin(r);if(e.order==="XYZ"){const f=a*c,d=a*u,m=o*c,g=o*u;n[0]=h*c,n[4]=-h*u,n[8]=l,n[1]=d+m*l,n[5]=f-g*l,n[9]=-o*h,n[2]=g-f*l,n[6]=m+d*l,n[10]=a*h}else if(e.order==="YXZ"){const f=h*c,d=h*u,m=l*c,g=l*u;n[0]=f+g*o,n[4]=m*o-d,n[8]=a*l,n[1]=a*u,n[5]=a*c,n[9]=-o,n[2]=d*o-m,n[6]=g+f*o,n[10]=a*h}else if(e.order==="ZXY"){const f=h*c,d=h*u,m=l*c,g=l*u;n[0]=f-g*o,n[4]=-a*u,n[8]=m+d*o,n[1]=d+m*o,n[5]=a*c,n[9]=g-f*o,n[2]=-a*l,n[6]=o,n[10]=a*h}else if(e.order==="ZYX"){const f=a*c,d=a*u,m=o*c,g=o*u;n[0]=h*c,n[4]=m*l-d,n[8]=f*l+g,n[1]=h*u,n[5]=g*l+f,n[9]=d*l-m,n[2]=-l,n[6]=o*h,n[10]=a*h}else if(e.order==="YZX"){const f=a*h,d=a*l,m=o*h,g=o*l;n[0]=h*c,n[4]=g-f*u,n[8]=m*u+d,n[1]=u,n[5]=a*c,n[9]=-o*c,n[2]=-l*c,n[6]=d*u+m,n[10]=f-g*u}else if(e.order==="XZY"){const f=a*h,d=a*l,m=o*h,g=o*l;n[0]=h*c,n[4]=-u,n[8]=l*c,n[1]=f*u+g,n[5]=a*c,n[9]=d*u-m,n[2]=m*u-d,n[6]=o*c,n[10]=g*u+f}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(e){return this.compose(ol,e,hl)}lookAt(e,n,i){const s=this.elements;return ae.subVectors(e,n),ae.lengthSq()===0&&(ae.z=1),ae.normalize(),Se.crossVectors(i,ae),Se.lengthSq()===0&&(Math.abs(i.z)===1?ae.x+=1e-4:ae.z+=1e-4,ae.normalize(),Se.crossVectors(i,ae)),Se.normalize(),Zt.crossVectors(ae,Se),s[0]=Se.x,s[4]=Zt.x,s[8]=ae.x,s[1]=Se.y,s[5]=Zt.y,s[9]=ae.y,s[2]=Se.z,s[6]=Zt.z,s[10]=ae.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const i=e.elements,s=n.elements,r=this.elements,a=i[0],o=i[4],h=i[8],l=i[12],c=i[1],u=i[5],f=i[9],d=i[13],m=i[2],g=i[6],x=i[10],p=i[14],v=i[3],b=i[7],y=i[11],z=i[15],C=s[0],k=s[4],A=s[8],R=s[12],S=s[1],I=s[5],L=s[9],B=s[13],H=s[2],re=s[6],de=s[10],ne=s[14],ce=s[3],be=s[7],ye=s[11],me=s[15];return r[0]=a*C+o*S+h*H+l*ce,r[4]=a*k+o*I+h*re+l*be,r[8]=a*A+o*L+h*de+l*ye,r[12]=a*R+o*B+h*ne+l*me,r[1]=c*C+u*S+f*H+d*ce,r[5]=c*k+u*I+f*re+d*be,r[9]=c*A+u*L+f*de+d*ye,r[13]=c*R+u*B+f*ne+d*me,r[2]=m*C+g*S+x*H+p*ce,r[6]=m*k+g*I+x*re+p*be,r[10]=m*A+g*L+x*de+p*ye,r[14]=m*R+g*B+x*ne+p*me,r[3]=v*C+b*S+y*H+z*ce,r[7]=v*k+b*I+y*re+z*be,r[11]=v*A+b*L+y*de+z*ye,r[15]=v*R+b*B+y*ne+z*me,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[4]*=e,n[8]*=e,n[12]*=e,n[1]*=e,n[5]*=e,n[9]*=e,n[13]*=e,n[2]*=e,n[6]*=e,n[10]*=e,n[14]*=e,n[3]*=e,n[7]*=e,n[11]*=e,n[15]*=e,this}determinant(){const e=this.elements,n=e[0],i=e[4],s=e[8],r=e[12],a=e[1],o=e[5],h=e[9],l=e[13],c=e[2],u=e[6],f=e[10],d=e[14],m=e[3],g=e[7],x=e[11],p=e[15],v=h*d-l*f,b=o*d-l*u,y=o*f-h*u,z=a*d-l*c,C=a*f-h*c,k=a*u-o*c;return n*(g*v-x*b+p*y)-i*(m*v-x*z+p*C)+s*(m*b-g*z+p*k)-r*(m*y-g*C+x*k)}transpose(){const e=this.elements;let n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}setPosition(e,n,i){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=n,s[14]=i),this}invert(){const e=this.elements,n=e[0],i=e[1],s=e[2],r=e[3],a=e[4],o=e[5],h=e[6],l=e[7],c=e[8],u=e[9],f=e[10],d=e[11],m=e[12],g=e[13],x=e[14],p=e[15],v=u*x*l-g*f*l+g*h*d-o*x*d-u*h*p+o*f*p,b=m*f*l-c*x*l-m*h*d+a*x*d+c*h*p-a*f*p,y=c*g*l-m*u*l+m*o*d-a*g*d-c*o*p+a*u*p,z=m*u*h-c*g*h-m*o*f+a*g*f+c*o*x-a*u*x,C=n*v+i*b+s*y+r*z;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const k=1/C;return e[0]=v*k,e[1]=(g*f*r-u*x*r-g*s*d+i*x*d+u*s*p-i*f*p)*k,e[2]=(o*x*r-g*h*r+g*s*l-i*x*l-o*s*p+i*h*p)*k,e[3]=(u*h*r-o*f*r-u*s*l+i*f*l+o*s*d-i*h*d)*k,e[4]=b*k,e[5]=(c*x*r-m*f*r+m*s*d-n*x*d-c*s*p+n*f*p)*k,e[6]=(m*h*r-a*x*r-m*s*l+n*x*l+a*s*p-n*h*p)*k,e[7]=(a*f*r-c*h*r+c*s*l-n*f*l-a*s*d+n*h*d)*k,e[8]=y*k,e[9]=(m*u*r-c*g*r-m*i*d+n*g*d+c*i*p-n*u*p)*k,e[10]=(a*g*r-m*o*r+m*i*l-n*g*l-a*i*p+n*o*p)*k,e[11]=(c*o*r-a*u*r-c*i*l+n*u*l+a*i*d-n*o*d)*k,e[12]=z*k,e[13]=(c*g*s-m*u*s+m*i*f-n*g*f-c*i*x+n*u*x)*k,e[14]=(m*o*s-a*g*s-m*i*h+n*g*h+a*i*x-n*o*x)*k,e[15]=(a*u*s-c*o*s+c*i*h-n*u*h-a*i*f+n*o*f)*k,this}scale(e){const n=this.elements,i=e.x,s=e.y,r=e.z;return n[0]*=i,n[4]*=s,n[8]*=r,n[1]*=i,n[5]*=s,n[9]*=r,n[2]*=i,n[6]*=s,n[10]*=r,n[3]*=i,n[7]*=s,n[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(n,i,s))}makeTranslation(e,n,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,n,0,0,1,i,0,0,0,1),this}makeRotationX(e){const n=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,n,-i,0,0,i,n,0,0,0,0,1),this}makeRotationY(e){const n=Math.cos(e),i=Math.sin(e);return this.set(n,0,i,0,0,1,0,0,-i,0,n,0,0,0,0,1),this}makeRotationZ(e){const n=Math.cos(e),i=Math.sin(e);return this.set(n,-i,0,0,i,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,n){const i=Math.cos(n),s=Math.sin(n),r=1-i,a=e.x,o=e.y,h=e.z,l=r*a,c=r*o;return this.set(l*a+i,l*o-s*h,l*h+s*o,0,l*o+s*h,c*o+i,c*h-s*a,0,l*h-s*o,c*h+s*a,r*h*h+i,0,0,0,0,1),this}makeScale(e,n,i){return this.set(e,0,0,0,0,n,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,n,i,s,r,a){return this.set(1,i,r,0,e,1,a,0,n,s,1,0,0,0,0,1),this}compose(e,n,i){const s=this.elements,r=n._x,a=n._y,o=n._z,h=n._w,l=r+r,c=a+a,u=o+o,f=r*l,d=r*c,m=r*u,g=a*c,x=a*u,p=o*u,v=h*l,b=h*c,y=h*u,z=i.x,C=i.y,k=i.z;return s[0]=(1-(g+p))*z,s[1]=(d+y)*z,s[2]=(m-b)*z,s[3]=0,s[4]=(d-y)*C,s[5]=(1-(f+p))*C,s[6]=(x+v)*C,s[7]=0,s[8]=(m+b)*k,s[9]=(x-v)*k,s[10]=(1-(f+g))*k,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,n,i){const s=this.elements;if(e.x=s[12],e.y=s[13],e.z=s[14],this.determinant()===0)return i.set(1,1,1),n.identity(),this;let r=tt.set(s[0],s[1],s[2]).length();const a=tt.set(s[4],s[5],s[6]).length(),o=tt.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),ge.copy(this);const l=1/r,c=1/a,u=1/o;return ge.elements[0]*=l,ge.elements[1]*=l,ge.elements[2]*=l,ge.elements[4]*=c,ge.elements[5]*=c,ge.elements[6]*=c,ge.elements[8]*=u,ge.elements[9]*=u,ge.elements[10]*=u,n.setFromRotationMatrix(ge),i.x=r,i.y=a,i.z=o,this}makePerspective(e,n,i,s,r,a,o=Ct,h=!1){const l=this.elements,c=2*r/(n-e),u=2*r/(i-s),f=(n+e)/(n-e),d=(i+s)/(i-s);let m,g;if(h)m=r/(a-r),g=a*r/(a-r);else if(o===Ct)m=-(a+r)/(a-r),g=-2*a*r/(a-r);else if(o===Qs)m=-a/(a-r),g=-a*r/(a-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return l[0]=c,l[4]=0,l[8]=f,l[12]=0,l[1]=0,l[5]=u,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=m,l[14]=g,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,n,i,s,r,a,o=Ct,h=!1){const l=this.elements,c=2/(n-e),u=2/(i-s),f=-(n+e)/(n-e),d=-(i+s)/(i-s);let m,g;if(h)m=1/(a-r),g=a/(a-r);else if(o===Ct)m=-2/(a-r),g=-(a+r)/(a-r);else if(o===Qs)m=-1/(a-r),g=-r/(a-r);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return l[0]=c,l[4]=0,l[8]=0,l[12]=f,l[1]=0,l[5]=u,l[9]=0,l[13]=d,l[2]=0,l[6]=0,l[10]=m,l[14]=g,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const n=this.elements,i=e.elements;for(let s=0;s<16;s++)if(n[s]!==i[s])return!1;return!0}fromArray(e,n=0){for(let i=0;i<16;i++)this.elements[i]=e[i+n];return this}toArray(e=[],n=0){const i=this.elements;return e[n]=i[0],e[n+1]=i[1],e[n+2]=i[2],e[n+3]=i[3],e[n+4]=i[4],e[n+5]=i[5],e[n+6]=i[6],e[n+7]=i[7],e[n+8]=i[8],e[n+9]=i[9],e[n+10]=i[10],e[n+11]=i[11],e[n+12]=i[12],e[n+13]=i[13],e[n+14]=i[14],e[n+15]=i[15],e}}const tt=new M,ge=new J,ol=new M(0,0,0),hl=new M(1,1,1),Se=new M,Zt=new M,ae=new M,sr=new J,rr=new Ge;class bt{constructor(e=0,n=0,i=0,s=bt.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=n,this._z=i,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,n,i,s=this._order){return this._x=e,this._y=n,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,n=this._order,i=!0){const s=e.elements,r=s[0],a=s[4],o=s[8],h=s[1],l=s[5],c=s[9],u=s[2],f=s[6],d=s[10];switch(n){case"XYZ":this._y=Math.asin($(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(f,l),this._z=0);break;case"YXZ":this._x=Math.asin(-$(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(h,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin($(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(h,r));break;case"ZYX":this._y=Math.asin(-$(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(f,d),this._z=Math.atan2(h,r)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin($(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-$(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:je("Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,n,i){return sr.makeRotationFromQuaternion(e),this.setFromRotationMatrix(sr,n,i)}setFromVector3(e,n=this._order){return this.set(e.x,e.y,e.z,n)}reorder(e){return rr.setFromEuler(this),this.setFromQuaternion(rr,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}bt.DEFAULT_ORDER="XYZ";class ll{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let cl=0;const ar=new M,nt=new Ge,Me=new J,Gt=new M,Tt=new M,ul=new M,fl=new Ge,or=new M(1,0,0),hr=new M(0,1,0),lr=new M(0,0,1),cr={type:"added"},dl={type:"removed"},it={type:"childadded",child:null},Ti={type:"childremoved",child:null};class Oe extends ba{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:cl++}),this.uuid=Pn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Oe.DEFAULT_UP.clone();const e=new M,n=new bt,i=new Ge,s=new M(1,1,1);function r(){i.setFromEuler(n,!1)}function a(){n.setFromQuaternion(i,void 0,!1)}n._onChange(r),i._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new J},normalMatrix:{value:new $t}}),this.matrix=new J,this.matrixWorld=new J,this.matrixAutoUpdate=Oe.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Oe.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new ll,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,n){this.quaternion.setFromAxisAngle(e,n)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,n){return nt.setFromAxisAngle(e,n),this.quaternion.multiply(nt),this}rotateOnWorldAxis(e,n){return nt.setFromAxisAngle(e,n),this.quaternion.premultiply(nt),this}rotateX(e){return this.rotateOnAxis(or,e)}rotateY(e){return this.rotateOnAxis(hr,e)}rotateZ(e){return this.rotateOnAxis(lr,e)}translateOnAxis(e,n){return ar.copy(e).applyQuaternion(this.quaternion),this.position.add(ar.multiplyScalar(n)),this}translateX(e){return this.translateOnAxis(or,e)}translateY(e){return this.translateOnAxis(hr,e)}translateZ(e){return this.translateOnAxis(lr,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Me.copy(this.matrixWorld).invert())}lookAt(e,n,i){e.isVector3?Gt.copy(e):Gt.set(e,n,i);const s=this.parent;this.updateWorldMatrix(!0,!1),Tt.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Me.lookAt(Tt,Gt,this.up):Me.lookAt(Gt,Tt,this.up),this.quaternion.setFromRotationMatrix(Me),s&&(Me.extractRotation(s.matrixWorld),nt.setFromRotationMatrix(Me),this.quaternion.premultiply(nt.invert()))}add(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return e===this?(tr("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(cr),it.child=e,this.dispatchEvent(it),it.child=null):tr("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(dl),Ti.child=e,this.dispatchEvent(Ti),Ti.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Me.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Me.multiply(e.parent.matrixWorld)),e.applyMatrix4(Me),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(cr),it.child=e,this.dispatchEvent(it),it.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,n){if(this[e]===n)return this;for(let i=0,s=this.children.length;i<s;i++){const a=this.children[i].getObjectByProperty(e,n);if(a!==void 0)return a}}getObjectsByProperty(e,n,i=[]){this[e]===n&&i.push(this);const s=this.children;for(let r=0,a=s.length;r<a;r++)s[r].getObjectsByProperty(e,n,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Tt,e,ul),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Tt,fl,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(e){e(this);const n=this.children;for(let i=0,s=n.length;i<s;i++)n[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const n=this.children;for(let i=0,s=n.length;i<s;i++)n[i].traverseVisible(e)}traverseAncestors(e){const n=this.parent;n!==null&&(e(n),n.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const n=this.children;for(let i=0,s=n.length;i<s;i++)n[i].updateMatrixWorld(e)}updateWorldMatrix(e,n){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),n===!0){const s=this.children;for(let r=0,a=s.length;r<a;r++)s[r].updateWorldMatrix(!1,!0)}}toJSON(e){const n=e===void 0||typeof e=="string",i={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),s.instanceInfo=this._instanceInfo.map(o=>({...o})),s.availableInstanceIds=this._availableInstanceIds.slice(),s.availableGeometryIds=this._availableGeometryIds.slice(),s.nextIndexStart=this._nextIndexStart,s.nextVertexStart=this._nextVertexStart,s.geometryCount=this._geometryCount,s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.matricesTexture=this._matricesTexture.toJSON(e),s.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(s.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(s.boundingBox=this.boundingBox.toJSON()));function r(o,h){return o[h.uuid]===void 0&&(o[h.uuid]=h.toJSON(e)),h.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const h=o.shapes;if(Array.isArray(h))for(let l=0,c=h.length;l<c;l++){const u=h[l];r(e.shapes,u)}else r(e.shapes,h)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let h=0,l=this.material.length;h<l;h++)o.push(r(e.materials,this.material[h]));s.material=o}else s.material=r(e.materials,this.material);if(this.children.length>0){s.children=[];for(let o=0;o<this.children.length;o++)s.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let o=0;o<this.animations.length;o++){const h=this.animations[o];s.animations.push(r(e.animations,h))}}if(n){const o=a(e.geometries),h=a(e.materials),l=a(e.textures),c=a(e.images),u=a(e.shapes),f=a(e.skeletons),d=a(e.animations),m=a(e.nodes);o.length>0&&(i.geometries=o),h.length>0&&(i.materials=h),l.length>0&&(i.textures=l),c.length>0&&(i.images=c),u.length>0&&(i.shapes=u),f.length>0&&(i.skeletons=f),d.length>0&&(i.animations=d),m.length>0&&(i.nodes=m)}return i.object=s,i;function a(o){const h=[];for(const l in o){const c=o[l];delete c.metadata,h.push(c)}return h}}clone(e){return new this.constructor().copy(this,e)}copy(e,n=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),n===!0)for(let i=0;i<e.children.length;i++){const s=e.children[i];this.add(s.clone())}return this}}Oe.DEFAULT_UP=new M(0,1,0);Oe.DEFAULT_MATRIX_AUTO_UPDATE=!0;Oe.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;class _a extends Oe{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new J,this.projectionMatrix=new J,this.projectionMatrixInverse=new J,this.coordinateSystem=Ct,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,n){return super.copy(e,n),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,n){super.updateWorldMatrix(e,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Ae=new M,ur=new He,fr=new He;class ml extends _a{constructor(e=50,n=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const n=.5*this.getFilmHeight()/e;this.fov=vn*2*Math.atan(n),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(It*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return vn*2*Math.atan(Math.tan(It*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,n,i){Ae.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Ae.x,Ae.y).multiplyScalar(-e/Ae.z),Ae.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Ae.x,Ae.y).multiplyScalar(-e/Ae.z)}getViewSize(e,n){return this.getViewBounds(e,ur,fr),n.subVectors(fr,ur)}setViewOffset(e,n,i,s,r,a){this.aspect=e/n,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let n=e*Math.tan(It*.5*this.fov)/this.zoom,i=2*n,s=this.aspect*i,r=-.5*s;const a=this.view;if(this.view!==null&&this.view.enabled){const h=a.fullWidth,l=a.fullHeight;r+=a.offsetX*s/h,n-=a.offsetY*i/l,s*=a.width/h,i*=a.height/l}const o=this.filmOffset;o!==0&&(r+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,n,n-i,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,this.view!==null&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}}class pl extends _a{constructor(e=-1,n=1,i=1,s=-1,r=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=n,this.top=i,this.bottom=s,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,n,i,s,r,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=i-e,a=i+e,o=s+n,h=s-n;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=l*this.view.offsetX,a=r+l*this.view.width,o-=c*this.view.offsetY,h=o-c*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,h,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,this.view!==null&&(n.object.view=Object.assign({},this.view)),n}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:ga}}));typeof window<"u"&&(window.__THREE__?je("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=ga);const te=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],gl=Math.PI/180;function ls(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(te[t&255]+te[t>>8&255]+te[t>>16&255]+te[t>>24&255]+"-"+te[e&255]+te[e>>8&255]+"-"+te[e>>16&15|64]+te[e>>24&255]+"-"+te[n&63|128]+te[n>>8&255]+"-"+te[n>>16&255]+te[n>>24&255]+te[i&255]+te[i>>8&255]+te[i>>16&255]+te[i>>24&255]).toLowerCase()}function xl(t){return t*gl}function bl(t,e,n=2){const i=t.length;let s=vl(t,0,i,n,!0);const r=[];if(!s||s.next===s.prev)return r;let a,o,h;if(t.length>80*n){a=t[0],o=t[1];let l=a,c=o;for(let u=n;u<i;u+=n){const f=t[u],d=t[u+1];f<a&&(a=f),d<o&&(o=d),f>l&&(l=f),d>c&&(c=d)}h=Math.max(l-a,c-o),h=h!==0?32767/h:0}return Pt(s,r,n,a,o,h,0),r}function vl(t,e,n,i,s){let r;if(s===Rl(t,e,n,i)>0)for(let a=e;a<n;a+=i)r=dr(a/i|0,t[a],t[a+1],r);else for(let a=n-i;a>=e;a-=i)r=dr(a/i|0,t[a],t[a+1],r);return r&&Dn(r,r.next)&&(Dt(r),r=r.next),r}function Ot(t,e){if(!t)return t;e||(e=t);let n=t,i;do if(i=!1,!n.steiner&&(Dn(n,n.next)||V(n.prev,n,n.next)===0)){if(Dt(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function Pt(t,e,n,i,s,r,a){if(!t)return;!a&&r&&Tl(t,i,s,r);let o=t;for(;t.prev!==t.next;){const h=t.prev,l=t.next;if(r?_l(t,i,s,r):yl(t)){e.push(h.i,t.i,l.i),Dt(t),t=l.next,o=l.next;continue}if(t=l,t===o){a?a===1?(t=Ml(Ot(t),e),Pt(t,e,n,i,s,r,2)):a===2&&wl(t,e,n,i,s,r):Pt(Ot(t),e,n,i,s,r,1);break}}}function yl(t){const e=t.prev,n=t,i=t.next;if(V(e,n,i)>=0)return!1;const s=e.x,r=n.x,a=i.x,o=e.y,h=n.y,l=i.y,c=Math.min(s,r,a),u=Math.min(o,h,l),f=Math.max(s,r,a),d=Math.max(o,h,l);let m=i.next;for(;m!==e;){if(m.x>=c&&m.x<=f&&m.y>=u&&m.y<=d&&St(s,o,r,h,a,l,m.x,m.y)&&V(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function _l(t,e,n,i){const s=t.prev,r=t,a=t.next;if(V(s,r,a)>=0)return!1;const o=s.x,h=r.x,l=a.x,c=s.y,u=r.y,f=a.y,d=Math.min(o,h,l),m=Math.min(c,u,f),g=Math.max(o,h,l),x=Math.max(c,u,f),p=Hi(d,m,e,n,i),v=Hi(g,x,e,n,i);let b=t.prevZ,y=t.nextZ;for(;b&&b.z>=p&&y&&y.z<=v;){if(b.x>=d&&b.x<=g&&b.y>=m&&b.y<=x&&b!==s&&b!==a&&St(o,c,h,u,l,f,b.x,b.y)&&V(b.prev,b,b.next)>=0||(b=b.prevZ,y.x>=d&&y.x<=g&&y.y>=m&&y.y<=x&&y!==s&&y!==a&&St(o,c,h,u,l,f,y.x,y.y)&&V(y.prev,y,y.next)>=0))return!1;y=y.nextZ}for(;b&&b.z>=p;){if(b.x>=d&&b.x<=g&&b.y>=m&&b.y<=x&&b!==s&&b!==a&&St(o,c,h,u,l,f,b.x,b.y)&&V(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;y&&y.z<=v;){if(y.x>=d&&y.x<=g&&y.y>=m&&y.y<=x&&y!==s&&y!==a&&St(o,c,h,u,l,f,y.x,y.y)&&V(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function Ml(t,e){let n=t;do{const i=n.prev,s=n.next.next;!Dn(i,s)&&Ma(i,n,n.next,s)&&yn(i,s)&&yn(s,i)&&(e.push(i.i,n.i,s.i),Dt(n),Dt(n.next),n=t=s),n=n.next}while(n!==t);return Ot(n)}function wl(t,e,n,i,s,r){let a=t;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&Cl(a,o)){let h=El(a,o);a=Ot(a,a.next),h=Ot(h,h.next),Pt(a,e,n,i,s,r,0),Pt(h,e,n,i,s,r,0);return}o=o.next}a=a.next}while(a!==t)}function Tl(t,e,n,i){let s=t;do s.z===0&&(s.z=Hi(s.x,s.y,e,n,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,kl(s)}function kl(t){let e,n=1;do{let i=t,s;t=null;let r=null;for(e=0;i;){e++;let a=i,o=0;for(let l=0;l<n&&(o++,a=a.nextZ,!!a);l++);let h=n;for(;o>0||h>0&&a;)o!==0&&(h===0||!a||i.z<=a.z)?(s=i,i=i.nextZ,o--):(s=a,a=a.nextZ,h--),r?r.nextZ=s:t=s,s.prevZ=r,r=s;i=a}r.nextZ=null,n*=2}while(e>1);return t}function Hi(t,e,n,i,s){return t=(t-n)*s|0,e=(e-i)*s|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function zl(t,e,n,i,s,r,a,o){return(s-a)*(e-o)>=(t-a)*(r-o)&&(t-a)*(i-o)>=(n-a)*(e-o)&&(n-a)*(r-o)>=(s-a)*(i-o)}function St(t,e,n,i,s,r,a,o){return!(t===a&&e===o)&&zl(t,e,n,i,s,r,a,o)}function Cl(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!Sl(t,e)&&(yn(t,e)&&yn(e,t)&&Al(t,e)&&(V(t.prev,t,e.prev)||V(t,e.prev,e))||Dn(t,e)&&V(t.prev,t,t.next)>0&&V(e.prev,e,e.next)>0)}function V(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Dn(t,e){return t.x===e.x&&t.y===e.y}function Ma(t,e,n,i){const s=Jt(V(t,e,n)),r=Jt(V(t,e,i)),a=Jt(V(n,i,t)),o=Jt(V(n,i,e));return!!(s!==r&&a!==o||s===0&&Kt(t,n,e)||r===0&&Kt(t,i,e)||a===0&&Kt(n,t,i)||o===0&&Kt(n,e,i))}function Kt(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Jt(t){return t>0?1:t<0?-1:0}function Sl(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Ma(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function yn(t,e){return V(t.prev,t,t.next)<0?V(t,e,t.next)>=0&&V(t,t.prev,e)>=0:V(t,e,t.prev)<0||V(t,t.next,e)<0}function Al(t,e){let n=t,i=!1;const s=(t.x+e.x)/2,r=(t.y+e.y)/2;do n.y>r!=n.next.y>r&&n.next.y!==n.y&&s<(n.next.x-n.x)*(r-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function El(t,e){const n=Wi(t.i,t.x,t.y),i=Wi(e.i,e.x,e.y),s=t.next,r=e.prev;return t.next=e,e.prev=t,n.next=s,s.prev=n,i.next=n,n.prev=i,r.next=i,i.prev=r,i}function dr(t,e,n,i){const s=Wi(t,e,n);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function Dt(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Wi(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Rl(t,e,n,i){let s=0;for(let r=e,a=n-i;r<n;r+=i)s+=(t[a]-t[r])*(t[r+1]+t[a+1]),a=r;return s}var ot=24,ht=4096,Il=class{_buffers;_writeIndex=0;_readIndex=1;constructor(){this._buffers=[this._createBuffer(),this._createBuffer()]}_createBuffer(){return{data:new Float32Array(ht*ot),indices:new Uint32Array(ht),positions:new Float32Array(ht*3),depths:new Float32Array(ht),count:0}}reset(){this._buffers[this._writeIndex].count=0}commit(){const t=this._writeIndex;this._writeIndex=this._readIndex,this._readIndex=t}getReadBuffer(){return this._buffers[this._readIndex]}add(t,e,n){const i=this._buffers[this._writeIndex];if(i.count>=ht)return;const s=i.count;let r=s*ot;const a=i.data;a[r++]=e[0],a[r++]=e[1],a[r++]=e[2],a[r++]=e[3];const o=n||e;a[r++]=o[0],a[r++]=o[1],a[r++]=o[2],a[r++]=o[3];const h=t.elements;for(let u=0;u<16;u++)a[r++]=h[u];const l=i.positions,c=s*3;l[c]=h[12],l[c+1]=h[13],l[c+2]=h[14],i.indices[s]=s,i.count++}sort(t,e=!0){const n=this._buffers[this._readIndex];if(n.count<2)return;const i=n.count,s=n.indices,r=n.positions,a=n.depths,o=t.x,h=t.y,l=t.z;for(let u=0;u<i;u++){const f=r[u*3],d=r[u*3+1],m=r[u*3+2];a[u]=(f-o)**2+(d-h)**2+(m-l)**2}const c=s.subarray(0,i);e?c.sort((u,f)=>a[f]-a[u]):c.sort((u,f)=>a[u]-a[f])}getSortedData(t){const e=this._buffers[this._readIndex],n=e.count;if(n===0)return t;const i=e.indices,s=e.data;for(let r=0;r<n;r++){const o=i[r]*ot,h=r*ot;t.set(s.subarray(o,o+ot),h)}return t}get size(){return this._buffers[this._readIndex].count}get data(){return this._buffers[this._readIndex].data}},Te=class{static isError;static handlers;static opaqueBatches=new Map;static transparentBatches=new Map;static init(){this.isError=!1,this.handlers=new Map,this.opaqueBatches.clear(),this.transparentBatches.clear(),console.info("Runtime Service initialized")}static register(t,e){this.handlers.has(t)&&(console.warn(`[RuntimeService] Component handler for type "${t}" was already registered, the previous entry will be overwritten!`),this.handlers.delete(t)),this.handlers.set(t,e),console.info(`[RuntimeService] Registered component handler "${t}" -> ${e.name}`)}static clean(){this.opaqueBatches.forEach(t=>t.reset()),this.transparentBatches.forEach(t=>t.reset())}static commit(){this.opaqueBatches.forEach(t=>t.commit()),this.transparentBatches.forEach(t=>t.commit())}static update(t,e,n,i){this.isError||!e||e.components.forEach(s=>{this.runHandler(s,t,e,n,i)})}static runHandler(t,e,n,i,s){t.update();const r=t.type(),a=this.handlers.get(r);a?a(this,e,t,n,i,s):console.error(`No handler was registered to handle component "${r}"!`)}static queueMesh(t,e,n,i){const r=n[3]<.99?this.transparentBatches:this.opaqueBatches;let a=r.get(t);a||(a=new Il,r.set(t,a)),a.add(e,n,i)}},Fl={time:0,easing:"Linear",data:[]},Qt=class wa{time;easing;data;random;themeId;randomize;randomizeInterval;randomSeed;constructor(e){this.refreshSeed(),e?this.assign(e):this.assign(structuredClone(Fl))}static from(e){return new wa(e)}serialize(){return{time:this.time,easing:this.easing,data:structuredClone(this.data),random:this.random,themeId:this.themeId,randomize:this.randomize,randomizeInterval:this.randomizeInterval}}assign(e){return this.data=structuredClone(e.data)??this.data??[],this.time=e.time??0,this.easing=e.easing??"Linear",this.random=e.random,this.themeId=e.themeId,this.randomize=e.randomize,this.randomizeInterval=e.randomizeInterval,this}refreshSeed(){this.randomSeed=Math.floor(Math.random()*999999)}setTime(e){return this.time=e,this}setEasing(e){return this.easing=e,this}setData(e){return this.data=e,this}setThemeId(e){return this.themeId=e,this}},Ol=class Ta extends Array{randomSeed;isDirty;constructor(e){super(),this.refreshRandomSeed(),this.isDirty=!0,e&&e.forEach((n,i)=>this[i]=Qt.from(n))}static from(e){return new Ta(e)}serialize(){const e=[];for(const n of this)e.push(n.serialize());return e}refreshRandomSeed(){this.randomSeed=Math.floor(Math.random()*999999);for(const e of this)e.refreshSeed()}sortByTime(){return this.sort((e,n)=>e.time-n.time),this.isDirty=!1,this}addKeyframe(e){return this.push(Qt.from(e)),this.isDirty=!0,this}deleteKeyframe(e){return this[e]&&this.splice(e,1),this.isDirty=!0,this}keyframesAt(e){if(this.length===0)return{prev:new Qt,next:new Qt};if(this.length===1)return{prev:this[0],next:this[0]};this.isDirty&&this.sortByTime();const n=this[0].time,i=this[this.length-1].time;if(e>=i){const l=this[this.length-1];return{prev:l,next:l}}if(e<n)return{prev:this[0],next:this[1]};let s=0,r=this.length-1,a=0;for(;s<=r;){const l=Math.floor(s+(r-s)/2);(this[l].time||0)<=e?(a=l,s=l+1):r=l-1}const o=this[a],h=this[a+1]||o;return{prev:o,next:h}}},Pl=class{_isDirty=!0;init(t){}update(t){}is(t){return this.type()===t.TYPE}},ka=class extends Pl{parentId;tracks={};spawnTime=1;lifetime=30;mesh;parentSettings={};randomSeed=0;_parentIndex;constructor(){super()}init(){this._isDirty=!0,this.tracks={},this.spawnTime=1,this.lifetime=5,this.parentSettings={},this.refreshRandomSeed()}update(){}serializeShared(){var t;const e={};for(const n in this.tracks){const i=n;e[i]=(t=this.tracks[i])==null?void 0:t.serialize()}return{type:this.type(),parentId:this.parentId,mesh:this.mesh,tracks:e,spawnTime:this.spawnTime,lifetime:this.lifetime,parentSettings:structuredClone(this.parentSettings)}}assign(t){if(t.parentId!==void 0&&(this.parentId=t.parentId),t.mesh!==void 0&&(this.mesh=t.mesh),t.spawnTime!==void 0&&(this.spawnTime=t.spawnTime),t.lifetime!==void 0&&(this.lifetime=t.lifetime),t.parentSettings&&(this.parentSettings=structuredClone(t.parentSettings)),t.tracks)for(const e in t.tracks){const n=e;this.createTrack(n,t.tracks[n])}return this}createTrack(t,e){return this.tracks[t]=Ol.from(e??[]),this}deleteTrack(t){return delete this.tracks[t],this}addKeyframe(t,e){var n;return this.tracks[t]||this.createTrack(t),(n=this.tracks[t])==null||n.addKeyframe(e),this}setMesh(t){return this.mesh=t,this}setParent(t,e){return this.parentId=t,this._parentIndex=e,this}setParenting(t,e){return this.parentSettings[t]?this.parentSettings[t].enabled=e:this.parentSettings[t]={enabled:e,offset:0},this}setParentOffset(t,e){return this.parentSettings[t]?this.parentSettings[t].offset=e:this.parentSettings[t]={enabled:!0,offset:e},this}refreshRandomSeed(){this.randomSeed=Math.random()*9999999}},cs=class cn extends ka{static TYPE="Animation2D";zOffset=0;origin={x:0,y:0};constructor(e){super(),this.init(),e&&this.assign(e)}static type(){return this.TYPE}type(){return cn.TYPE}init(){this._isDirty=!0,this.tracks={},this.spawnTime=1,this.lifetime=5,this.parentSettings={},this.zOffset=0,this.origin=structuredClone({x:0,y:0}),this.refreshRandomSeed()}static from(e){return new cn(e)}serialize(){return{...this.serializeShared(),type:cn.TYPE,zOffset:this.zOffset,origin:structuredClone(this.origin)}}assign(e){return super.assign(e),e.zOffset&&(this.zOffset=e.zOffset),e.origin&&(this.origin=structuredClone(e.origin)),this}},za=Math.PI,st=za/2,en=1/2.75,tn=2/2.75,Ee=1.5/2.75,nn=2.5/2.75,Re=2.25/2.75,Ie=2.625/2.75,Dl=t=>mr[t||"Linear"]||mr.Linear,mr={Linear:t=>t,Instant:()=>0,InSine:t=>t===1?1:-Math.cos(st*t)+1,OutSine:t=>Math.sin(st*t),InOutSine:t=>-Math.cos(za*t)/2+.5,InElastic:t=>Math.sin(13*st*t)*Math.pow(2,10*(t-1)),OutElastic:t=>t===1?1:Math.sin(-13*st*(t+1))*Math.pow(2,-10*t)+1,InOutElastic:t=>t<.5?.5*Math.sin(13*st*(2*t))*Math.pow(2,10*(2*t-1)):.5*(Math.sin(-13*st*(2*t-1+1))*Math.pow(2,-10*(2*t-1))+2),InBack:t=>t*t*(2.70158*t-1.70158),OutBack:t=>1- --t*t*(-2.70158*t-1.70158),InOutBack:t=>{const n=2.5949095;return t*=2,t<1?.5*(t*t*((n+1)*t-n)):(t-=2,.5*(t*t*((n+1)*t+n)+2))},InBounce:t=>(t=1-t,t<en?1-7.5625*t*t:t<tn?1-(7.5625*(t-Ee)*(t-Ee)+.75):t<nn?1-(7.5625*(t-Re)*(t-Re)+.9375):1-(7.5625*(t-Ie)*(t-Ie)+.984375)),OutBounce:t=>t<en?7.5625*t*t:t<tn?7.5625*(t-Ee)*(t-Ee)+.75:t<nn?7.5625*(t-Re)*(t-Re)+.9375:7.5625*(t-Ie)*(t-Ie)+.984375,InOutBounce:t=>t<.5?(t=1-t*2,t<en?(1-7.5625*t*t)/2:t<tn?(1-(7.5625*(t-Ee)*(t-Ee)+.75))/2:t<nn?(1-(7.5625*(t-Re)*(t-Re)+.9375))/2:(1-(7.5625*(t-Ie)*(t-Ie)+.984375))/2):(t=t*2-1,t<en?7.5625*t*t/2+.5:t<tn?(7.5625*(t-Ee)*(t-Ee)+.75)/2+.5:t<nn?(7.5625*(t-Re)*(t-Re)+.9375)/2+.5:(7.5625*(t-Ie)*(t-Ie)+.984375)/2+.5),InQuad:t=>t*t,OutQuad:t=>-t*(t-2),InOutQuad:t=>t<=.5?t*t*2:1- --t*t*2,InCirc:t=>-(Math.sqrt(1-t*t)-1),OutCirc:t=>Math.sqrt(1-(t-1)*(t-1)),InOutCirc:t=>t<=.5?(Math.sqrt(1-t*t*4)-1)/-2:(Math.sqrt(1-(t*2-2)*(t*2-2))+1)/2,InExpo:t=>Math.pow(2,10*(t-1)),OutExpo:t=>t===1?1:-Math.pow(2,-10*t)+1,InOutExpo:t=>t===1?1:t<.5?Math.pow(2,10*(t*2-1))/2:(-Math.pow(2,-10*(t*2-1))+2)/2},Nl={r:299,g:587,b:114},jl=200,P=class{static hslFix(t){let e=t.h||0;e>180?e=e-180:e=e+180;let n=t.s;return n=Math.abs(n),{h:e,s:n,l:t.l}}static averageLuminance(t){const{r:e,g:n,b:i}=t,{r:s,g:r,b:a}=Nl;return(e*s+n*r+i*a)/1e3}static averageOrangeness(t){const{h:e}=this.rgbaToHsl(t),n=((e||0)-jl+180)%360-180,i=n<-180?n+360:n;return 1-Math.abs(i)/90}static findMaxChroma(t,e){if(e===void 0||t<=0||t>=100)return 0;const n=qt("rgb");let i=0,s=.4;const r=.001;for(;s-i>r;){const a=(i+s)/2;n({mode:"oklch",l:t/100,h:e,c:a})?i=a:s=a}return i*100}static findMinLightness(t,e){if(t<=0||e===void 0)return 0;const n=qt("rgb");let i=0,s=1;const r=.001;for(;s-i>r;){const a=(i+s)/2;n({mode:"oklch",l:a,c:t/100,h:e})?s=a:i=a}return s*100}static findMaxLightness(t,e){if(t<=0||e===void 0)return 100;const n=qt("rgb");let i=0,s=1;const r=.001;for(;s-i>r;){const a=(i+s)/2;n({mode:"oklch",l:a,c:t/100,h:e})?i=a:s=a}return i*100}static rgbGradientStops(){return{r:[{color:"rgba(0,0,0,1)",pos:0},{color:"rgba(255,0,0,1)",pos:100}],g:[{color:"rgba(0,0,0,1)",pos:0},{color:"rgba(0,255,0,1)",pos:100}],b:[{color:"rgba(0,0,0,1)",pos:0},{color:"rgba(0,0,255,1)",pos:100}]}}static hslGradientStops(t,e=20){return{h:[...Array(e).keys()].map(n=>({color:`rgba(${Object.values(this.hslToRgba({h:n*(360/10),s:t.s,l:t.l})).join(",")})`,pos:n*10})),s:[{color:`rgba(${Object.values(this.hslToRgba({h:t.h,s:0,l:t.l})).join(",")})`,pos:0},{color:`rgba(${Object.values(this.hslToRgba({h:t.h,s:1,l:t.l})).join(",")})`,pos:100}],l:[{color:`rgba(${Object.values(this.hslToRgba({h:t.h,s:t.s,l:0})).join(",")})`,pos:0},{color:`rgba(${Object.values(this.hslToRgba({h:t.h,s:t.s,l:255})).join(",")})`,pos:100}]}}static oklchGradientStops(t,e=!1,n=50){const i=t.h??0,s=t.l,r=t.c,a={l:[],c:[],h:[]},o=qt("rgb"),h=xe("rgb"),l=u=>{if(!e){const x=[];for(let p=0;p<n;p++){const v=p/(n-1),b=u(v),y=h({mode:"oklch",...b});x.push({color:Mt(y),pos:v*100})}return x}const f=Array.from({length:n},(x,p)=>{const v=p/(n-1),b=u(v);return{oklch:b,inGamut:o(wt({mode:"oklch",...b})),pos:v*100}}),d=[],m=f[0];d.push({color:m.inGamut?Mt(wt({mode:"oklch",...m.oklch})):"rgba(0,0,0,1)",pos:m.pos});for(let x=1;x<f.length;x++){const p=f[x],v=f[x-1];if(p.inGamut!==v.inGamut){const b=(p.pos+v.pos)/2;p.inGamut?(d.push({color:"rgba(0,0,0,1)",pos:b}),d.push({color:Mt(wt({mode:"oklch",...p.oklch})),pos:b})):(d.push({color:Mt(wt({mode:"oklch",...v.oklch})),pos:b}),d.push({color:"rgba(0,0,0,1)",pos:b}))}else p.inGamut&&d.push({color:Mt(wt({mode:"oklch",...p.oklch})),pos:p.pos})}const g=f[n-1];return g.inGamut||d.push({color:"rgba(0,0,0,1)",pos:g.pos}),d};a.l=l(u=>({l:u,c:r/100,h:i}));const c=.4;return a.c=l(u=>({l:s/100,c:u*c,h:i})),a.h=l(u=>({l:s/100,c:r/100,h:u*360})),a}static rgbaToRaw(t){return[t.r/255,t.g/255,t.b/255,t.a??1]}static rawToRgba(t){return{r:t[0]*255,g:t[1]*255,b:t[2]*255,a:t[3]}}static hexToRaw(t){return this.rgbaToRaw(this.hexToRgba(t)??{r:0,g:0,b:0})}static hexToRgba(t){const e=Vr(t);if(!e)return;const n=xe("rgb"),{r:i,g:s,b:r}=n(e);return{r:i*255,g:s*255,b:r*255}}static rgbaToHex(t){const{r:e,g:n,b:i}=t;return Ih({mode:"rgb",r:e/255,g:n/255,b:i/255})}static oklchToRgba(t){const e=xe("rgb"),{r:n,g:i,b:s}=e({mode:"oklch",...t});return{r:n,g:i,b:s}}static rgbaToOklch(t){const e=xe("oklch"),{l:n,c:i,h:s}=e({mode:"rgb",...t});return{l:n,c:i,h:s}}static hslToRgba(t){const e=xe("rgb"),{r:n,g:i,b:s}=e({mode:"hsl",...t});return{r:n,g:i,b:s}}static rgbaToHsl(t){const e=xe("hsl"),{h:n,s:i,l:s}=this.hslFix(e({mode:"rgb",...t}));return{h:n,s:i,l:s}}static hslToOklch(t){const e=xe("oklch"),{l:n,c:i,h:s}=e({mode:"hsl",...t});return{l:n,c:i,h:s}}static oklchToHsl(t){const e=xe("hsl"),{h:n,s:i,l:s}=this.hslFix(e({mode:"oklch",...t}));return{h:n,s:i,l:s}}},ki=new Map,ue=[],Ll=[],Ul=[],rt={prev:null,next:null,t:0},he=class{static interpolateTracks(t,e,n,i,s=!0){for(const r in e.tracks){const a=r,o=e.tracks[a];if(!o)continue;let h=!0,l=0;if(i){const g=i[a];g&&(h=g.enabled,l=g.offset)}this.interpolateTrack(o,t-l);const{prev:c,next:u,t:f}=rt;let d=c.data,m=u.data;if(c.randomize&&(d=this.getRandom(c,Ll)),u.randomize&&(m=this.getRandom(u,Ul)),h||s){let g=n[a];g||(g=new Array(d.length).fill(0),n[a]=g),this.lerpArrays(d,m,f,g)}}return n}static interpolateTheme(t,e,n){this.interpolateTrack(n,t);const{prev:i,next:s,t:r}=rt,a=e.get(i.themeId??""),o=e.get(s.themeId??"");if(!a&&!o)throw new Error("Missing themes for interpolation");if(!a)return o;if(!o)return a;const h=this.getCachedTheme(a),l=this.getCachedTheme(o);this.lerpArrays(h.background,l.background,r,ue);const c=P.rawToRgba(ue);this.lerpArrays(h.gui,l.gui,r,ue);const u=P.rawToRgba(ue);this.lerpArrays(h.guiAccent,l.guiAccent,r,ue);const f=P.rawToRgba(ue),d=h.effects.map((x,p)=>(this.lerpArrays(x,l.effects[p],r,ue),P.rawToRgba(ue))),m=h.parallax.map((x,p)=>(this.lerpArrays(x,l.parallax[p],r,ue),P.rawToRgba(ue))),g=h.objects.map((x,p)=>(this.lerpArrays(x,l.objects[p],r,ue),P.rawToRgba(ue)));return{id:a.id,name:a.name,background:c,gui:u,guiAccent:f,effects:d,parallax:m,objects:g}}static lerpArrays(t,e,n,i){const s=t.length,r=i||new Array(s);r.length!==s&&(r.length=s);for(let a=0;a<s;a++)r[a]=t[a]+(e[a]-t[a])*n;return r}static getRandom(t,e,n){if(!t.random||!t.randomize||t.randomize===0)return t.data;const i=761,s=t.data,r=t.random,a=s.length,o=e||new Array(a);o.length!==a&&(o.length=a);const h=n??t.randomSeed;switch(t.randomize){case 1:{for(let l=0;l<a;l++){const c=h+l*i;let f=this.seededRandom(c)*(r[l]-s[l])+s[l];if(t.randomizeInterval!==void 0){const d=t.randomizeInterval;f=d===0?f:Math.round(f/d)*d}e[l]=f}break}case 2:{const l=h+i,c=this.seededRandom(l)>=.5?s:r;for(let u=0;u<a;u++)o[u]=c[u];break}case 3:{const l=h+i,u=this.seededRandom(l)*(r[1]-r[0])*r[0];for(let f=0;f<a;f++)e[f]=s[f]*u;break}}return o}static interpolateTrack(t,e){const{prev:n,next:i}=t.keyframesAt(e),s=i.time-n.time,r=s===0?1:(e-n.time)/s,a=r<0?0:r>1?1:r;return rt.prev=n,rt.next=i,rt.t=Dl(i.easing)(a),rt}static seededRandom(t){let e=t+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)*23283064365386963e-26}static seededRandomBetween(t,e,n){return this.seededRandom(n)*(e-t)+t}static getCachedTheme(t){if(!ki.has(t.id)){const e=P.rgbaToRaw(t.background),n=P.rgbaToRaw(t.gui),i=P.rgbaToRaw(t.guiAccent),s=t.effects.map(o=>P.rgbaToRaw(o)),r=t.parallax.map(o=>P.rgbaToRaw(o)),a=t.objects.map(o=>P.rgbaToRaw(o));ki.set(t.id,{background:e,gui:n,guiAccent:i,effects:s,parallax:r,objects:a})}return ki.get(t.id)}},_n=class{static _pool=[];static _count=0;static get(){return this._count>0?(this._count--,this._pool[this._count]):new J}static release(t){t.identity(),this._pool[this._count]=t,this._count++}static logStatus(){console.log(`Matrix4Pool: ${this._count} available`)}},pr=new M,gr=new M,xr=new bt,zi=new Ge,br=new J,vr=class{static getLocalTRS(t,e){t.identity();const n=e.Move?e.Move[0]:0,i=e.Move?e.Move[1]:0,s=e.Scale?e.Scale[0]:1,r=e.Scale?e.Scale[1]:1,a=e.Rotation?e.Rotation[0]:0;return pr.set(n,i,0),gr.set(s,r,1),a!==0?(xr.set(0,0,xl(a)),zi.setFromEuler(xr)):zi.set(0,0,0,1),t.compose(pr,zi,gr),t}static _accumulateTRS(t,e,n,i,s){var r;this.getLocalTRS(t,s);let a=n,o=(r=a.getComponent("Animation2D"))==null?void 0:r.parentId;for(;o;){const h=i.getObject(o);if(!h)break;const l={},c=h.getComponent("Animation2D"),u=a.getComponent("Animation2D"),f=_n.get(),d=he.interpolateTracks(e,c,l,u.parentSettings,!1);this.getLocalTRS(f,d),t.premultiply(f),_n.release(f),a=h,o=c.parentId}}static getWorldMatrix(t,e,n,i){const s=e.getComponent("Animation2D");if(!s)throw new Error(`Object "${e.name}" [ ${e.id} ] does not have an Animation2D component!`);const r=new J;return this._accumulateTRS(r,t,e,n,i),s.origin&&(s.origin.x!==0||s.origin.y!==0)&&(br.makeTranslation(s.origin.x,s.origin.y,0),r.multiply(br)),s.zOffset&&(r.elements[14]+=(s.zOffset+he.seededRandom(s.randomSeed))*2),r}static getColorAt(t,e,n,i){const s=e.tracks.Color;if(!s)return P.rgbaToRaw(n.background);const{prev:r,next:a,t:o}=he.interpolateTrack(s,t);if(o===0){const c=P.rgbaToRaw(n.objects[r.data[0]]);return c[3]=r.data[1],c}if(o===1){const c=P.rgbaToRaw(n.objects[a.data[0]]);return c[3]=r.data[1],c}const h=P.rgbaToRaw(n.objects[r.data[0]]);h[3]=r.data[1];const l=P.rgbaToRaw(n.objects[a.data[0]]);return l[3]=a.data[1],i?(i=he.lerpArrays(h,l,o,i),i):he.lerpArrays(h,l,o)}},yr={},Ci=[1,1,1,1],$l=(t,e,n,i,s,r)=>{if(e<n.spawnTime||e>n.spawnTime+n.lifetime)return;he.interpolateTracks(e,n,yr,n.parentId?n.parentSettings:void 0,!0);const a=n.tracks.Move!==void 0,o=n.tracks.Rotation!==void 0,h=n.tracks.Scale!==void 0;if((a||o||h)&&n.tracks.Color&&n.mesh){const l=vr.getWorldMatrix(e,i,s,yr);Ci=vr.getColorAt(e,n,r),t.queueMesh(n.mesh,l,Ci,Ci)}},us=class un extends ka{static TYPE="Animation3D";origin={x:0,y:0,z:0};constructor(e){super(),this.init(),e&&this.assign(e)}static type(){return this.TYPE}type(){return un.TYPE}init(){this._isDirty=!0,this.tracks={},this.spawnTime=1,this.lifetime=5,this.parentSettings={},this.origin=structuredClone({x:0,y:0,z:0}),this.refreshRandomSeed()}static from(e){return new un(e)}serialize(){return{...this.serializeShared(),type:un.TYPE,origin:structuredClone(this.origin)}}assign(e){return super.assign(e),e.origin&&(this.origin=structuredClone(e.origin)),this}},_r=new M,Mr=new M,wr=new bt,Si=new Ge,Tr=new J,kr=class{static getLocalTRS(t,e){t.identity();const n=e.Move?e.Move[0]:0,i=e.Move?e.Move[1]:0,s=e.Move?e.Move[2]:0,r=e.Scale?e.Scale[0]:1,a=e.Scale?e.Scale[1]:1,o=e.Scale?e.Scale[2]:1;return _r.set(n,i,s),Mr.set(r,a,o),e.Rotation?(wr.set(bi.degToRad(e.Rotation[0]),bi.degToRad(e.Rotation[1]),bi.degToRad(e.Rotation[2])),Si.setFromEuler(wr)):Si.set(0,0,0,1),t.compose(_r,Si,Mr),t}static _accumulateTRS(t,e,n,i,s){var r;this.getLocalTRS(t,s);let a=n,o=(r=a.getComponent("Animation3D"))==null?void 0:r.parentId;for(;o;){const h=i.getObject(o);if(!h)break;const l={},c=h.getComponent("Animation3D"),u=a.getComponent("Animation3D"),f=_n.get(),d=he.interpolateTracks(e,c,l,u.parentSettings,!0);this.getLocalTRS(f,d),t.premultiply(f),_n.release(f),a=h,o=c.parentId}}static getWorldMatrix(t,e,n,i){const s=e.getComponent("Animation3D");if(!s)throw new Error(`Object "${e.name}" [ ${e.id} ] does not have an Animation3D component!`);const r=new J;return this._accumulateTRS(r,t,e,n,i),s.origin&&(s.origin.x!==0||s.origin.y!==0||s.origin.z!==0)&&(Tr.makeTranslation(s.origin.x,s.origin.y,s.origin.z),r.multiply(Tr)),r}static getColorsAt(t,e,n){const i=e.tracks.Color;if(!i){const u=P.rgbaToRaw(n.background);return{color:u,shade:u}}const{prev:s,next:r,t:a}=he.interpolateTrack(i,t);if(a===0)return{color:this._resolveColor(s.data[0],n),shade:this._resolveColor(s.data[1],n)};if(a===1)return{color:this._resolveColor(r.data[0],n),shade:this._resolveColor(r.data[1],n)};const o=this._resolveColor(s.data[0],n),h=this._resolveColor(r.data[0],n),l=this._resolveColor(s.data[1],n),c=this._resolveColor(r.data[1],n);return{color:he.lerpArrays(o,h,a),shade:he.lerpArrays(l,c,a)}}static _resolveColor(t,e){const n=e.objects[t];return n?P.rgbaToRaw(n):[0,0,0,1]}},zr={},Vl=(t,e,n,i,s,r)=>{if(e<n.spawnTime||e>n.spawnTime+n.lifetime)return;he.interpolateTracks(e,n,zr,n.parentId?n.parentSettings:void 0,!1);const a=n.tracks.Move!==void 0,o=n.tracks.Rotation!==void 0,h=n.tracks.Scale!==void 0;if((a||o||h)&&n.tracks.Color&&n.mesh){const l=kr.getWorldMatrix(e,i,s,zr),{color:c,shade:u}=kr.getColorsAt(e,n,r);t.queueMesh(n.mesh,l,c,u)}},Bl=[{id:us.TYPE,callback:Vl},{id:cs.TYPE,callback:$l}];function Hl(){Te.init();for(const t of Bl){const{id:e,callback:n}=t;Te.register(e,n)}}var Xi=class{static handlers;static init(){this.handlers=new Map,console.info("Export Registry initialized")}static register(t,e){this.handlers.has(t)&&(console.warn(`[ExportRegistry] Component exporter for type "${t}" was already registered, the previous entry will be overwritten!`),this.handlers.delete(t)),this.handlers.set(t,e),console.info(`[ExportRegistry] Registered component exporter "${t}" -> ${e.name}`)}static runHandler(t,e,n){t.update();const i=t.type(),s=this.handlers.get(i);if(s)try{return s(t,e,n)}catch(r){return console.error(`[ExportRegistry] Error exporting component ${i} in object "${e.name}" [${e.id}]:
${r}`),console.error(r.stack),console.error(`Offending object:
`,e),[]}else return console.error(`[ExportRegistry] No handler was registered to export component "${i}"!`),[]}},Ca=(t=>(t[t.None=0]="None",t[t.Linear=1]="Linear",t[t.Toggle=3]="Toggle",t[t.Relative=4]="Relative",t))(Ca||{}),sn=class{static toVgdLevel(t){const e={events:[[],[],[],[],[],[],[],[],[]],objects:[],themes:[]};return t._objects.forEach(n=>{n&&e.objects.push(...this.toVgdLevelObject(n,t._objects))}),t.themes.forEach(n=>{e.themes.push(this.toVgdTheme(n))}),e}static toVgdLevelObject(t,e){const n=[];return t.components.forEach(i=>{const s=Xi.runHandler(i,t,e??[]);for(const r of s)n.push(r)}),n}static toVgdTheme(t){return{name:t.name,id:t.id,pla:["E57373","64B5F6","81C784","FFB74D"],obj:t.objects.map(n=>P.rgbaToHex(n)),fx:t.effects.map(n=>P.rgbaToHex(n)),bg:t.parallax.map(n=>P.rgbaToHex(n)),base_bg:P.rgbaToHex(t.background),base_gui:P.rgbaToHex(t.gui),base_gui_accent:P.rgbaToHex(t.guiAccent)}}static toVgdKeyframeTrack(t,e,n){const i=[];for(const s of e)i.push(this.toVgdKeyframe(t,s,n));return i}static toVgdKeyframe(t,e,n){const i={ev:[]};switch(t){case"Color":{i.ev=[e.data[0]],e.data[1]!==100&&i.ev.push(e.data[1]);break}case"Rotation":{i.ev=[e.data[0]],e.data[1]&&i.ev.push(e.data[1]);break}default:{i.ev=[e.data[0],e.data[1]];break}}return e.time&&e.time-n>0&&(i.t=e.time-n),e.randomize&&e.randomize!==0&&(i.r=Object.values(Ca).indexOf(e.randomize)),e.easing&&e.easing!=="Linear"&&(i.ct=e.easing),e.themeId&&(i.evs=[e.themeId]),e.random&&(i.er=[e.random[0],e.random[1]],e.randomizeInterval!==void 0&&(i.er[2]=e.randomizeInterval)),i}},Sa=[{name:"SquareFilled",vertices:[[-.5,.5,0],[-.5,-.5,0],[.5,-.5,0],[.5,.5,0]],faces:[[0,1,2],[3,2,0]]},{name:"SquareOutline",vertices:[[-.5,.5,0],[.5,.5,0],[-.5,.375,0],[.5,.375,0],[-.5,-.375,0],[.5,-.375,0],[-.5,-.5,0],[.5,-.5,0],[-.375,.375,0],[-.375,-.375,0],[.375,.375,0],[.375,-.375,0]],faces:[[0,1,2],[3,2,1],[4,5,6],[7,6,5],[2,8,4],[9,4,8],[10,3,11],[5,11,3]]},{name:"SquareOutlineThin",vertices:[[-.5,.5,0],[.5,.5,0],[-.5,.45,0],[.5,.45,0],[-.5,-.45,0],[.5,-.45,0],[-.5,-.5,0],[.5,-.5,0],[-.45,.45,0],[-.45,-.45,0],[.45,.45,0],[.45,-.45,0]],faces:[[0,1,2],[3,2,1],[4,5,6],[7,6,5],[2,8,4],[9,4,8],[10,3,11],[5,11,3]]}],Aa=[{name:"TriangleFilled",vertices:[[352086e-22,.575,0],[-.497965,-.2875,0],[.497965,-.2875,0]],faces:[[0,1,2]]},{name:"TriangleOutline",vertices:[[352086e-22,.575,0],[-.497965,-.2875,0],[213889e-22,.349307,0],[-.302509,-.174654,0],[.302509,-.174654,0],[.497965,-.2875,0]],faces:[[0,1,2],[2,1,3],[3,1,4],[4,1,5],[5,4,2],[2,0,5]]},{name:"TriangleRightFilled",vertices:[[-.5,.5,0],[-.5,-.5,0],[.5,-.5,0]],faces:[[0,1,2]]},{name:"TriangleRightOutline",vertices:[[-.393333,.236667,0],[-.5,.5,0],[-.393333,-.393333,0],[-.5,-.5,0],[.236667,-.393333,0],[.5,-.5,0]],faces:[[0,1,2],[2,1,3],[3,2,4],[4,3,5],[5,4,0],[0,5,1]]},{name:"TriangleOffset",vertices:[[352086e-22,.8625,0],[-.497965,0,0],[.497965,0,0]],faces:[[0,1,2]]},{name:"TriangleOffsetOutline",vertices:[[352086e-22,.7875,0],[-.497965,-.075,0],[213889e-22,.561807,0],[-.302509,.037846,0],[.302509,.037846,0],[.497965,-.075,0]],faces:[[0,1,2],[2,1,3],[3,1,4],[4,1,5],[5,4,2],[2,0,5]]}],Ea=[{name:"Point",vertices:[[0,0,0]],faces:[[0,0,0]]}],Ra=[{name:"CircleFilled",vertices:[[0,0,0],[.5,0,0],[.490393,.0975452,0],[.46194,.191342,0],[.415735,.277785,0],[.353553,.353553,0],[.277785,.415735,0],[.191342,.46194,0],[.0975452,.490393,0],[306162e-22,.5,0],[-.0975452,.490393,0],[-.191342,.46194,0],[-.277785,.415735,0],[-.353553,.353553,0],[-.415735,.277785,0],[-.46194,.191342,0],[-.490393,.0975452,0],[-.5,612323e-22,0],[-.490393,-.0975452,0],[-.46194,-.191342,0],[-.415735,-.277785,0],[-.353553,-.353553,0],[-.277785,-.415735,0],[-.191342,-.46194,0],[-.0975452,-.490393,0],[-918485e-22,-.5,0],[.0975452,-.490393,0],[.191342,-.46194,0],[.277785,-.415735,0],[.353553,-.353553,0],[.415735,-.277785,0],[.46194,-.191342,0],[.490393,-.0975452,0],[.5,-122465e-21,0]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,6],[0,6,7],[0,7,8],[0,8,9],[0,9,10],[0,10,11],[0,11,12],[0,12,13],[0,13,14],[0,14,15],[0,15,16],[0,16,17],[0,17,18],[0,18,19],[0,19,20],[0,20,21],[0,21,22],[0,22,23],[0,23,24],[0,24,25],[0,25,26],[0,26,27],[0,27,28],[0,28,29],[0,29,30],[0,30,31],[0,31,32],[0,32,33]]},{name:"CircleOutline",vertices:[[.375,0,0],[.5,0,0],[.490393,.0975452,0],[.367794,.0731589,0],[.46194,.191342,0],[.346455,.143506,0],[.415735,.277785,0],[.311801,.208339,0],[.353553,.353553,0],[.265165,.265165,0],[.277785,.415735,0],[.208339,.311801,0],[.191342,.46194,0],[.143506,.346455,0],[.0975452,.490393,0],[.0731589,.367794,0],[306162e-22,.5,0],[229621e-22,.375,0],[-.0975452,.490393,0],[-.0731589,.367794,0],[-.191342,.46194,0],[-.143506,.346455,0],[-.277785,.415735,0],[-.208339,.311801,0],[-.353553,.353553,0],[-.265165,.265165,0],[-.415735,.277785,0],[-.311801,.208339,0],[-.46194,.191342,0],[-.346455,.143506,0],[-.490393,.0975452,0],[-.367794,.0731589,0],[-.5,612323e-22,0],[-.375,459243e-22,0],[-.490393,-.0975452,0],[-.367794,-.0731589,0],[-.46194,-.191342,0],[-.346455,-.143506,0],[-.415735,-.277785,0],[-.311801,-.208339,0],[-.353553,-.353553,0],[-.265165,-.265165,0],[-.277785,-.415735,0],[-.208339,-.311801,0],[-.191342,-.46194,0],[-.143506,-.346455,0],[-.0975452,-.490393,0],[-.0731589,-.367794,0],[-918485e-22,-.5,0],[-688864e-22,-.375,0],[.0975452,-.490393,0],[.0731589,-.367794,0],[.191342,-.46194,0],[.143506,-.346455,0],[.277785,-.415735,0],[.208339,-.311801,0],[.353553,-.353553,0],[.265165,-.265165,0],[.415735,-.277785,0],[.311801,-.208339,0],[.46194,-.191342,0],[.346455,-.143506,0],[.490393,-.0975452,0],[.367794,-.0731589,0],[.5,-122465e-21,0],[.375,-918485e-22,0]],faces:[[0,1,2],[0,3,2],[3,2,4],[3,5,4],[5,4,6],[5,7,6],[7,6,8],[7,9,8],[9,8,10],[9,11,10],[11,10,12],[11,13,12],[13,12,14],[13,15,14],[15,14,16],[15,17,16],[17,16,18],[17,19,18],[19,18,20],[19,21,20],[21,20,22],[21,23,22],[23,22,24],[23,25,24],[25,24,26],[25,27,26],[27,26,28],[27,29,28],[29,28,30],[29,31,30],[31,30,32],[31,33,32],[33,32,34],[33,35,34],[35,34,36],[35,37,36],[37,36,38],[37,39,38],[39,38,40],[39,41,40],[41,40,42],[41,43,42],[43,42,44],[43,45,44],[45,44,46],[45,47,46],[47,46,48],[47,49,48],[49,48,50],[49,51,50],[51,50,52],[51,53,52],[53,52,54],[53,55,54],[55,54,56],[55,57,56],[57,56,58],[57,59,58],[59,58,60],[59,61,60],[61,60,62],[61,63,62],[63,62,64],[63,65,64]]},{name:"CircleHalf",vertices:[[0,0,0],[306162e-22,-.5,0],[.0975452,-.490393,0],[.191342,-.46194,0],[.277785,-.415735,0],[.353553,-.353553,0],[.415735,-.277785,0],[.46194,-.191342,0],[.490393,-.0975452,0],[.5,0,0],[.490393,.0975452,0],[.46194,.191342,0],[.415735,.277785,0],[.353553,.353553,0],[.277785,.415735,0],[.191342,.46194,0],[.0975452,.490393,0],[306162e-22,.5,0]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,6],[0,6,7],[0,7,8],[0,8,9],[0,9,10],[0,10,11],[0,11,12],[0,12,13],[0,13,14],[0,14,15],[0,15,16],[0,16,17]]},{name:"CircleHalfOutline",vertices:[[229621e-22,-.375,0],[306162e-22,-.5,0],[.0975452,-.490393,0],[.0731589,-.367794,0],[.191342,-.46194,0],[.143506,-.346455,0],[.277785,-.415735,0],[.208339,-.311801,0],[.353553,-.353553,0],[.265165,-.265165,0],[.415735,-.277785,0],[.311801,-.208339,0],[.46194,-.191342,0],[.346455,-.143506,0],[.490393,-.0975452,0],[.367794,-.0731589,0],[.5,0,0],[.375,0,0],[.490393,.0975452,0],[.367794,.0731589,0],[.46194,.191342,0],[.346455,.143506,0],[.415735,.277785,0],[.311801,.208339,0],[.353553,.353553,0],[.265165,.265165,0],[.277785,.415735,0],[.208339,.311801,0],[.191342,.46194,0],[.143506,.346455,0],[.0975452,.490393,0],[.0731589,.367794,0],[306162e-22,.5,0],[229621e-22,.375,0]],faces:[[0,1,2],[0,3,2],[3,2,4],[3,5,4],[5,4,6],[5,7,6],[7,6,8],[7,9,8],[9,8,10],[9,11,10],[11,10,12],[11,13,12],[13,12,14],[13,15,14],[15,14,16],[15,17,16],[17,16,18],[17,19,18],[19,18,20],[19,21,20],[21,20,22],[21,23,22],[23,22,24],[23,25,24],[25,24,26],[25,27,26],[27,26,28],[27,29,28],[29,28,30],[29,31,30],[31,30,32],[31,33,32]]},{name:"CircleOutlineThin",vertices:[[.45,0,0],[.5,0,0],[.490393,.0975452,0],[.441353,.0877906,0],[.46194,.191342,0],[.415746,.172208,0],[.415735,.277785,0],[.374161,.250007,0],[.353553,.353553,0],[.318198,.318198,0],[.277785,.415735,0],[.250007,.374161,0],[.191342,.46194,0],[.172208,.415746,0],[.0975452,.490393,0],[.0877906,.441353,0],[306162e-22,.5,0],[275546e-22,.45,0],[-.0975452,.490393,0],[-.0877906,.441353,0],[-.191342,.46194,0],[-.172208,.415746,0],[-.277785,.415735,0],[-.250007,.374161,0],[-.353553,.353553,0],[-.318198,.318198,0],[-.415735,.277785,0],[-.374161,.250007,0],[-.46194,.191342,0],[-.415746,.172208,0],[-.490393,.0975452,0],[-.441353,.0877906,0],[-.5,612323e-22,0],[-.45,551091e-22,0],[-.490393,-.0975452,0],[-.441353,-.0877906,0],[-.46194,-.191342,0],[-.415746,-.172208,0],[-.415735,-.277785,0],[-.374161,-.250007,0],[-.353553,-.353553,0],[-.318198,-.318198,0],[-.277785,-.415735,0],[-.250007,-.374161,0],[-.191342,-.46194,0],[-.172208,-.415746,0],[-.0975452,-.490393,0],[-.0877906,-.441353,0],[-918485e-22,-.5,0],[-826637e-22,-.45,0],[.0975452,-.490393,0],[.0877906,-.441353,0],[.191342,-.46194,0],[.172208,-.415746,0],[.277785,-.415735,0],[.250007,-.374161,0],[.353553,-.353553,0],[.318198,-.318198,0],[.415735,-.277785,0],[.374161,-.250007,0],[.46194,-.191342,0],[.415746,-.172208,0],[.490393,-.0975452,0],[.441353,-.0877906,0],[.5,-122465e-21,0],[.45,-110218e-21,0]],faces:[[0,1,2],[0,3,2],[3,2,4],[3,5,4],[5,4,6],[5,7,6],[7,6,8],[7,9,8],[9,8,10],[9,11,10],[11,10,12],[11,13,12],[13,12,14],[13,15,14],[15,14,16],[15,17,16],[17,16,18],[17,19,18],[19,18,20],[19,21,20],[21,20,22],[21,23,22],[23,22,24],[23,25,24],[25,24,26],[25,27,26],[27,26,28],[27,29,28],[29,28,30],[29,31,30],[31,30,32],[31,33,32],[33,32,34],[33,35,34],[35,34,36],[35,37,36],[37,36,38],[37,39,38],[39,38,40],[39,41,40],[41,40,42],[41,43,42],[43,42,44],[43,45,44],[45,44,46],[45,47,46],[47,46,48],[47,49,48],[49,48,50],[49,51,50],[51,50,52],[51,53,52],[53,52,54],[53,55,54],[55,54,56],[55,57,56],[57,56,58],[57,59,58],[59,58,60],[59,61,60],[61,60,62],[61,63,62],[63,62,64],[63,65,64]]},{name:"CircleQuarter",vertices:[[0,0,0],[.5,0,0],[.490393,.0975452,0],[.46194,.191342,0],[.415735,.277785,0],[.353553,.353553,0],[.277785,.415735,0],[.191342,.46194,0],[.0975452,.490393,0],[306162e-22,.5,0]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,6],[0,6,7],[0,7,8],[0,8,9]]},{name:"CircleQuarterOutline",vertices:[[.375,0,0],[.5,0,0],[.490393,.0975452,0],[.367794,.0731589,0],[.46194,.191342,0],[.346455,.143506,0],[.415735,.277785,0],[.311801,.208339,0],[.353553,.353553,0],[.265165,.265165,0],[.277785,.415735,0],[.208339,.311801,0],[.191342,.46194,0],[.143506,.346455,0],[.0975452,.490393,0],[.0731589,.367794,0],[306162e-22,.5,0],[229621e-22,.375,0]],faces:[[0,1,2],[0,3,2],[3,2,4],[3,5,4],[5,4,6],[5,7,6],[7,6,8],[7,9,8],[9,8,10],[9,11,10],[11,10,12],[11,13,12],[13,12,14],[13,15,14],[15,14,16],[15,17,16]]},{name:"CircleHalfQuarter",vertices:[[0,0,0],[.353553,.353553,0],[.277785,.415735,0],[.191342,.46194,0],[.0975452,.490393,0],[306162e-22,.5,0]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5]]},{name:"CircleHalfQuarterOutline",vertices:[[.265165,.265165,0],[.353553,.353553,0],[.277785,.415735,0],[.208339,.311801,0],[.191342,.46194,0],[.143506,.346455,0],[.0975452,.490393,0],[.0731589,.367794,0],[306162e-22,.5,0],[229621e-22,.375,0]],faces:[[0,1,2],[0,3,2],[3,2,4],[3,5,4],[5,4,6],[5,7,6],[7,6,8],[7,9,8]]}],Ia=[{name:"Arrow",vertices:[[.114711,.0941153,0],[-.385289,.0941153,0],[-.385289,-.0941153,0],[.114711,-.0941153,0],[.0131641,.403351,0],[.495352,0,0],[-.0995,.272262,0],[-.0995,-.272262,0],[.0131641,-.403351,0]],faces:[[0,1,2],[2,3,0],[4,5,6],[6,5,0],[0,5,3],[3,5,7],[7,5,8]]},{name:"ArrowHead",vertices:[[.0131641,.403352,0],[.495352,24e-8,0],[-.0995,.272262,0],[.218477,24e-8,0],[-.0995,-.272262,0],[.0131641,-.403351,0]],faces:[[0,1,2],[2,1,3],[3,1,4],[4,1,5]]}],Fa=[{name:"HexagonFilled",vertices:[[0,0,0],[306162e-22,.5,0],[-.433013,.25,0],[-.433013,-.25,0],[-918485e-22,-.5,0],[.433013,-.25,0],[.433013,.25,0],[153081e-21,.5,0]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,6],[0,6,7]]},{name:"HexagonOutline",vertices:[[213889e-22,.349307,0],[306162e-22,.5,0],[-.433013,.25,0],[-.302509,.174654,0],[-.433013,-.25,0],[-.302509,-.174654,0],[-918485e-22,-.5,0],[-641667e-22,-.349307,0],[.433013,-.25,0],[.302509,-.174654,0],[.433013,.25,0],[.302509,.174654,0],[153081e-21,.5,0],[106944e-21,.349307,0]],faces:[[0,1,2],[0,3,2],[3,2,4],[3,5,4],[5,4,6],[5,7,6],[7,6,8],[7,9,8],[9,8,10],[9,11,10],[11,10,12],[11,13,12]]},{name:"HexagonOutlineThin",vertices:[[278607e-22,.455,0],[306162e-22,.5,0],[-.433013,.25,0],[-.394042,.2275,0],[-.433013,-.25,0],[-.394042,-.2275,0],[-918485e-22,-.5,0],[-835821e-22,-.455,0],[.433013,-.25,0],[.394042,-.2275,0],[.433013,.25,0],[.394042,.2275,0],[153081e-21,.5,0],[139304e-21,.455,0]],faces:[[0,1,2],[0,3,2],[3,2,4],[3,5,4],[5,4,6],[5,7,6],[7,6,8],[7,9,8],[9,8,10],[9,11,10],[11,10,12],[11,13,12]]},{name:"HexagonHalf",vertices:[[0,.5,0],[0,-.5,0],[.433013,.25,0],[.433013,-.25,0]],faces:[[0,1,2],[2,1,3]]},{name:"HexagonHalfOutline",vertices:[[0,.5,0],[0,.35,0],[.433013,.25,0],[.303109,.175,0],[.433013,-.25,0],[.303109,-.175,0],[0,-.5,0],[0,-.35,0]],faces:[[0,1,2],[2,1,3],[3,2,4],[4,3,5],[5,4,6],[6,5,7]]},{name:"HexagonHalfOutlineThin",vertices:[[0,.5,0],[0,.45,0],[.433013,.25,0],[.394042,.2275,0],[.433013,-.25,0],[.394042,-.2275,0],[0,-.5,0],[0,-.45,0]],faces:[[0,1,2],[2,1,3],[3,2,4],[4,3,5],[5,4,6],[6,5,7]]}];[...Sa.map(t=>t.name),...Ra.map(t=>t.name),...Aa.map(t=>t.name),...Ia.map(t=>t.name),...Ea.map(t=>t.name),...Fa.map(t=>t.name)];var Xe=[Sa,Ra,Aa,Ia,Ea,Fa];function Wl(t,e){return Xe[t||0][e||0].name}function Xl(t){let e=0,n=0;for(e=0;e<100&&Xe[e]!==void 0;e++)for(n=0;n<100&&Xe[e][n]!==void 0;n++)if(Xe[e][n].name===t)return{s:e,so:n};return{s:e,so:n}}var ql=(t,e)=>{var n,i,s,r,a,o;const h={id:e.id,n:e.name,ak_t:3,ak_o:t.lifetime,st:t.spawnTime,e:[{k:[{ev:[0,0]}]},{k:[{ev:[1,1]}]},{k:[{ev:[0,0]}]},{k:[{ev:[0,0]}]}]};if(t.tracks.Move&&(h.e[0].k=sn.toVgdKeyframeTrack("Move",t.tracks.Move,t.spawnTime)),t.tracks.Scale&&(h.e[1].k=sn.toVgdKeyframeTrack("Scale",t.tracks.Scale,t.spawnTime)),t.tracks.Rotation&&(h.e[2].k=sn.toVgdKeyframeTrack("Rotation",t.tracks.Rotation,t.spawnTime)),t.tracks.Color&&(h.e[3].k=sn.toVgdKeyframeTrack("Color",t.tracks.Color,t.spawnTime)),t.parentId&&(h.p_id=t.parentId),t.origin&&t.origin.x!==0&&t.origin.y!==0&&(h.o=structuredClone(t.origin)),t.zOffset&&t.zOffset!==-30&&(h.d=Math.max(Math.min(0-Math.floor(t.zOffset),60),0)),t.parentSettings){const l=[(n=t.parentSettings.Move)!=null&&n.enabled?"1":"0",(i=t.parentSettings.Scale)!=null&&i.enabled?"1":"0",(s=t.parentSettings.Rotation)!=null&&s.enabled?"1":"0"],c=[((r=t.parentSettings.Move)==null?void 0:r.offset)??0,((a=t.parentSettings.Scale)==null?void 0:a.offset)??0,((o=t.parentSettings.Rotation)==null?void 0:o.offset)??0];l.join("")!=="101"&&(h.p_t=l.join("")),c.every(u=>u==0)||(h.p_o=c)}if(t.mesh){h.ot=5;const{s:l,so:c}=Xl(t.mesh);l>0&&(h.s=l),c>0&&(h.so=c)}else h.ot=6;return[h]},Yl=(t,e)=>[],Zl=[{id:cs.TYPE,callback:ql},{id:us.TYPE,callback:Yl}];function Gl(){Xi.init();for(const t of Zl){const{id:e,callback:n}=t;Xi.register(e,n)}}var Ai="ComponentRegistry",qi=class{static components=new Map;static init(){this.components.clear();for(const t of Kl)this.register(t.TYPE,t);console.info(`[${Ai}] Registered ${this.components.size} components.`)}static register(t,e){this.components.has(t)&&console.warn(`[${Ai}] Overwriting component "${t}"`),this.components.set(t,e)}static get(t){const e=this.components.get(t);if(!e)throw new Error(`[${Ai}] Component "${t}" not registered.`);return e}static create(t){return this.get(t.type).from(t)}},Kl=[us,cs];function Jl(){qi.init()}var Ei=class{static prepareMesh(t,e=!1){const{vertices:n,faces:i}=t,s=this.getGeometricCenter(t),r=new Yi(t);let a;if(e){let o=[];i.forEach(h=>o=[...o,...h]),a=new Uint16Array(o)}else a=this.triangulateMesh(n,i),a=this.fixIndexWindingOrder(a,n,s);return r._indices=new Uint16Array(a),r._flatMesh=this.flatMapMesh(r.vertices,r._indices),r._flatNormals=this.flatMapNormals(r.vertices,r._indices),r}static getGeometricCenter(t){if(t.vertices.length===0)return new M(0,0,0);const e=new M(0,0,0);for(const n of t.vertices)e.add(n);return e.divideScalar(t.vertices.length)}static triangulateMesh(t,e){if(t.length===0)return new Uint16Array;const n=[];for(const i of e){const s=i.length;if(s<3)continue;if(s===3){n.push(...i);continue}const r=i.map(v=>t[v]),a=r[0],o=r[1],h=r[2],l=new M().subVectors(o,a),c=new M().subVectors(h,a),u=new M().crossVectors(l,c),f=Math.abs(u.x),d=Math.abs(u.y),m=Math.abs(u.z);let g;switch(!0){case(f>d&&f>m):{g=r.flatMap(v=>[v.y,v.z]);break}case d>m:{g=r.flatMap(v=>[v.x,v.z]);break}default:{g=r.flatMap(v=>[v.x,v.y]);break}}const p=bl(g).map(v=>i[v]);n.push(...p)}return new Uint16Array(n)}static fixIndexWindingOrder(t,e,n){if(!t||t.length===0)return console.error("Geometry winding failed; mesh has no indices."),new Uint16Array;const i=new Map;for(let b=0;b<=t.length;b+=3){const y=t[b],z=t[b+1],C=t[b+2],k=[[y,z],[z,C],[C,y]].map(A=>A.sort((R,S)=>R-S).join("-"));for(const A of k)i.has(A)||i.set(A,[]),i.get(A).push(b)}const s=t.length/3,r=new Array(s).fill(!1),a=[];let o=-1,h=0;for(let b=0;b<t.length;b+=3){const y=e[t[b]],z=e[t[b+1]],C=e[t[b+2]],A=y.clone().add(z).add(C).divideScalar(3).lengthSq();A>o&&(o=A,h=b)}const l=t[h],c=t[h+1],u=t[h+2],f=e[l],d=e[c],m=e[u],g=new M().subVectors(d,f),x=new M().subVectors(m,f),p=new M().crossVectors(g,x),v=new M().subVectors(f,n);for(p.dot(v)<0&&(t[h+1]=u,t[h+2]=c),a.push(h),r[h/3]=!0;a.length>0;){const b=a.shift(),y=t[b],z=t[b+1],C=t[b+2],k=[[y,z],[z,C],[C,y]];for(const A of k){const R=[...A].sort((I,L)=>I-L).join("-"),S=i.get(R)||[];for(const I of S){if(I===b)continue;const L=I/3;if(!r[L]){r[L]=!0;const B=t[I],H=t[I+1],re=t[I+2],de=[[B,H],[H,re],[re,B]];for(const ne of de)if(ne[0]===A[0]&&ne[1]===A[1]){const ce=t[I+1];t[I+1]=t[I+2],t[I+2]=ce;break}a.push(I)}}}}return t}static flatMapMesh(t,e){if(!e||e.length===0)return console.error("Geometry unindexing failed; mesh has no indices."),new Float32Array;const n=new Float32Array(e.length*3);for(let i=0;i<e.length;i++){const s=e[i],r=t[s],a=i*3;n[a+0]=r.x,n[a+1]=r.y,n[a+2]=r.z}return n}static flatMapNormals(t,e){if(!e||e.length===0)return console.error("Normal calculation failed; mesh has no indices."),new Float32Array;const n=new Float32Array(e.length*3);for(let i=0;i<e.length;i+=3){const s=e[i],r=e[i+1],a=e[i+2],o=t[s],h=t[r],l=t[a],c=new M().subVectors(h,o),u=new M().subVectors(l,o),f=new M().crossVectors(c,u).normalize(),d=i*3,m=(i+1)*3,g=(i+2)*3;n[d]=f.x,n[d+1]=f.y,n[d+2]=f.z,n[m]=f.x,n[m+1]=f.y,n[m+2]=f.z,n[g]=f.x,n[g+1]=f.y,n[g+2]=f.z}return n}},Ri={name:"Empty",vertices:[],faces:[]},Yi=class{name;vertices;faces;_isDirty;_indices;_flatMesh;_flatNormals;_material;constructor(t){this._isDirty=!0,this._indices=new Uint16Array,this._flatMesh=new Float32Array,this._flatNormals=new Float32Array,this._material={color:[1,1,1],shade:[0,0,0]},t?(this.name=t.name,this.vertices=structuredClone(t.vertices),this.faces=structuredClone(t.faces)):(this.name=Ri.name,this.vertices=structuredClone(Ri.vertices),this.faces=structuredClone(Ri.faces))}static from(t,e=!1){const n=Ei.prepareMesh(t,e);return n._flatMesh||(n._flatMesh=new Float32Array(0)),n._flatNormals||(n._flatNormals=new Float32Array(0)),n}applyMatrix4(t){const e=[];for(const n of this.vertices)n.applyMatrix4(t);return this._flatMesh=Ei.flatMapMesh(e,this._indices),this._flatNormals=Ei.flatMapNormals(e,this._indices),this}},ut=class{static meshData;static meshes;static init(){this.meshData=new Map,this.meshes=new Map,console.info("MeshRegistry initialized")}static registerMesh(t,e=!1){this.meshData.has(t.name)&&(console.warn(`Mesh with name "${t.name}" was already registered! The previous entry will be overwritten!`),this.meshData.delete(t.name),this.meshes.delete(t.name)),this.meshData.set(t.name,structuredClone(t));const n=Yi.from(t,e);this.meshes.set(n.name,n)}static new(t){const e=this.meshData.get(t);if(!e)throw new Error(`Mesh with name "${t}" was not registered.`);return Yi.from(e)}static getFlatMesh(t){const e=this.meshes.get(t);if(!e)throw new Error(`Mesh with name "${t}" was not registered.`);return e._flatMesh}static getFlatNormals(t){const e=this.meshes.get(t);if(!e)throw new Error(`Mesh with name "${t}" was not registered.`);return e._flatNormals}},Ql=()=>({name:"Cube",vertices:[new M(-1,-1,-1),new M(1,-1,-1),new M(1,1,-1),new M(-1,1,-1),new M(-1,-1,1),new M(1,-1,1),new M(1,1,1),new M(-1,1,1)],faces:[[4,7,6,5],[1,2,3,0],[7,3,2,6],[4,5,1,0],[5,6,2,1],[0,3,7,4]]}),ec=()=>({name:"Dodecahedron",vertices:[new M(.57735,.57735,-.57735),new M(.57735,-.57735,-.57735),new M(.57735,.57735,.57735),new M(.57735,-.57735,.57735),new M(-.57735,.57735,-.57735),new M(-.57735,-.57735,-.57735),new M(-.57735,.57735,.57735),new M(-.57735,-.57735,.57735),new M(.356822,0,-.934172),new M(-.356822,0,-.934172),new M(.356822,0,.934172),new M(-.356822,0,.934172),new M(.934172,.356822,0),new M(.934172,-.356822,0),new M(-.934172,.356822,0),new M(-.934172,-.356822,0),new M(0,.934172,-.356822),new M(0,.934172,.356822),new M(0,-.934172,-.356822),new M(0,-.934172,.356822)],faces:[[0,8,9,4,16],[0,12,13,1,8],[0,16,17,2,12],[8,1,18,5,9],[12,2,10,3,13],[16,4,14,6,17],[9,5,15,14,4],[6,11,10,2,17],[3,19,18,1,13],[7,15,5,18,19],[7,11,6,14,15],[7,19,3,10,11]]}),tc=(t=1,e=0)=>{const n=(1+Math.sqrt(5))/2,i=[new M(-1,n,0).normalize(),new M(1,n,0).normalize(),new M(-1,-n,0).normalize(),new M(1,-n,0).normalize(),new M(0,-1,n).normalize(),new M(0,1,n).normalize(),new M(0,-1,-n).normalize(),new M(0,1,-n).normalize(),new M(n,0,-1).normalize(),new M(n,0,1).normalize(),new M(-n,0,-1).normalize(),new M(-n,0,1).normalize()];let s=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];const r=new Map,a=(o,h)=>{const l=Math.min(o,h),c=Math.max(o,h),u=`${l}-${c}`;if(r.has(u))return r.get(u);const f=i[o],d=i[h],m=f.clone().add(d).multiply(new M(.5)).normalize();i.push(m);const g=i.length-1;return r.set(u,g),g};for(let o=0;o<e;o++){const h=[];for(const l of s){const c=l[0],u=l[1],f=l[2],d=a(c,u),m=a(u,f),g=a(f,c);h.push([c,d,g]),h.push([u,m,d]),h.push([f,g,m]),h.push([d,m,g])}s=h}if(t!==1)for(const o of i)o.multiply(new M(t));return{name:"Icosahedron",vertices:i,faces:s}},Cr={Cube:Ql,Dodecahedron:ec,Icosahedron:tc};function nc(){ut.init();for(const t in Cr){const n=Cr[t];ut.registerMesh(n())}for(let t=0;t<Xe.length;t++)for(let e=0;e<Xe[t].length;e++){const n=structuredClone(Xe[t][e]),i={name:n.name,faces:n.faces,vertices:[]};n.vertices.forEach(s=>{i.vertices.push(new M().fromArray(s))}),ut.registerMesh(i,!0)}}var Pe=class Oa{id;name;components;constructor(e){this.id=ls(),this.name="New Object",this.components=[],e&&this.assign(e)}static from(e){return new Oa(e)}serialize(){const e=[];return this.components.forEach(n=>{e.push(n.serialize())}),{id:this.id,name:this.name,components:e}}assign(e){return e.id&&(this.id=e.id),e.name&&(this.name=e.name),e.components&&e.components.forEach(n=>{this.components.push(qi.create(n))}),this}_setDirty(){this.components.forEach(e=>e._isDirty=!0)}addComponent(e){const n=qi.create({type:e});return this.components.push(n),n}deleteComponent(e){return this.components.forEach((n,i)=>{n.type()===e&&this.components.splice(i,1)}),this}getComponent(e){for(const n of this.components)if(n.type()===e)return n;throw new Error(`[Animatable] Animatable "${this.name}" [ ${this.id} ] does not possess the component "${e}"`)}},Mn=class{constructor(t,e,n){this.gl=t,this.width=e,this.height=n,this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,n,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.fbo=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0);const i=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,i),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e,n),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,i),t.bindFramebuffer(t.FRAMEBUFFER,null)}fbo;texture;width;height;bind(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbo),this.gl.viewport(0,0,this.width,this.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}unbind(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}},Pa=class{constructor(t){this.gl=t;const e=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);this.vao=t.createVertexArray();const n=t.createBuffer();t.bindVertexArray(this.vao),t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0),t.bindVertexArray(null)}vao;draw(){this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}},ic=class{passes=[];quad;readBuffer;writeBuffer;constructor(t,e,n){this.quad=new Pa(t),this.readBuffer=new Mn(t,e,n),this.writeBuffer=new Mn(t,e,n)}addPass(t){this.passes.push(t)}resize(){}render(t,e){let n=e;for(let i=0;i<this.passes.length;i++){const s=this.passes[i];if(!s.enabled)continue;const r=i===this.passes.length-1;r?(t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,t.canvas.width,t.canvas.height)):this.writeBuffer.bind(),t.clear(t.COLOR_BUFFER_BIT),s.shader.use(),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,n),s.shader.setUniform("uTexture","1i",0),s.onApply&&s.onApply(s.shader),this.quad.draw(),r||(n=this.writeBuffer.texture,this.swapBuffers())}this.passes.length===0&&(t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,t.canvas.width,t.canvas.height))}swapBuffers(){const t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}},Sr=class{constructor(t,e,n){if(this.gl=t,this.vertexCount=e.length/3,this.vao=t.createVertexArray(),this.vboPos=t.createBuffer(),this.vboNor=t.createBuffer(),this.vboInst=t.createBuffer(),!this.vao)throw new Error("Failed to create VertexAtrributeArray!");this.gl.bindVertexArray(this.vao),this.bindAttribute(this.vboPos,e,0,3),this.bindAttribute(this.vboNor,n,1,3),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboInst);const i=96;t.enableVertexAttribArray(2),t.vertexAttribPointer(2,4,t.FLOAT,!1,i,0),t.vertexAttribDivisor(2,1),t.enableVertexAttribArray(3),t.vertexAttribPointer(3,4,t.FLOAT,!1,i,16),t.vertexAttribDivisor(3,1);for(let s=0;s<4;s++){const r=4+s;t.enableVertexAttribArray(r),t.vertexAttribPointer(r,4,t.FLOAT,!1,i,32+s*16),t.vertexAttribDivisor(r,1)}this.gl.bindVertexArray(null)}vao;vboPos;vboNor;vboInst;vertexCount=0;instanceCount=0;bindAttribute(t,e,n,i){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.bufferData(this.gl.ARRAY_BUFFER,e,this.gl.STATIC_DRAW),this.gl.enableVertexAttribArray(n),this.gl.vertexAttribPointer(n,i,this.gl.FLOAT,!1,0,0)}bind(){this.vao&&this.gl.bindVertexArray(this.vao)}unbind(){this.gl.bindVertexArray(null)}draw(){this.instanceCount!==0&&(this.gl.bindVertexArray(this.vao),this.gl.drawArraysInstanced(this.gl.TRIANGLES,0,this.vertexCount,this.instanceCount),this.gl.bindVertexArray(null))}uploadInstanceData(t,e){this.instanceCount=e,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboInst);const n=e*24,i=t.subarray(0,n);this.gl.bufferData(this.gl.ARRAY_BUFFER,i,this.gl.DYNAMIC_DRAW)}dispose(){this.vboPos&&this.gl.deleteBuffer(this.vboPos),this.vboNor&&this.gl.deleteBuffer(this.vboNor),this.vboInst&&this.gl.deleteBuffer(this.vboInst),this.vao&&this.gl.deleteVertexArray(this.vao),this.vboPos=null,this.vboNor=null,this.vboInst=null,this.vao=null}},wn=class{constructor(t,e,n){this.gl=t;const i=this.compile(t.VERTEX_SHADER,e),s=this.compile(t.FRAGMENT_SHADER,n);if(this.program=t.createProgram(),t.attachShader(this.program,i),t.attachShader(this.program,s),t.linkProgram(this.program),!t.getProgramParameter(this.program,t.LINK_STATUS))throw new Error(t.getProgramInfoLog(this.program)||"Link Error")}program;uniforms=new Map;compile(t,e){const n=this.gl.createShader(t);if(this.gl.shaderSource(n,e),this.gl.compileShader(n),!this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS))throw new Error(this.gl.getShaderInfoLog(n)||"Compile Error");return n}use(){this.gl.useProgram(this.program)}setUniform(t,e,n){if(!this.uniforms.has(t)){const s=this.gl.getUniformLocation(this.program,t);s&&this.uniforms.set(t,s)}const i=this.uniforms.get(t);i&&(e==="1f"&&this.gl.uniform1f(i,n),e==="2fv"&&this.gl.uniform2fv(i,n),e==="3fv"&&this.gl.uniform3fv(i,n),e==="4fv"&&this.gl.uniform4fv(i,n),e==="1i"&&this.gl.uniform1i(i,n))}},Zi=`#version 300 es
layout(location=0) in vec2 aPos;

out vec2 vUv;

void main() {
  vUv = aPos * 0.5 + 0.5;
  gl_Position = vec4(aPos, 0.0, 1.0);
}`,sc=`#version 300 es
precision mediump float;
in vec2 vUv;
uniform sampler2D uTexture;
uniform vec2 uTexelSize;
uniform float uThreshold;
uniform bool uIsFirstPass;

out vec4 FragColor;

void main() {
  vec4 d = uTexelSize.xyxy * vec4(-1.0, -1.0, 1.0, 1.0);

  vec4 s1 = texture(uTexture, vUv + d.xy);
  vec4 s2 = texture(uTexture, vUv + d.zy);
  vec4 s3 = texture(uTexture, vUv + d.xw);
  vec4 s4 = texture(uTexture, vUv + d.zw);

  vec4 color = (s1 + s2 + s3 + s4) * 0.25;

  if (uIsFirstPass) {
    float brightness = dot(color.rgb, vec3(0.2126, 0.7152, 0.0722));

    if(brightness < uThreshold) {
      color = vec4(0.0);
    }
  }

  FragColor = color;
}`,rc=`#version 300 es
precision mediump float;

in vec2 vUv;

uniform sampler2D uTexture;
uniform float uIntensity;
uniform vec2 uTexelSize;

out vec4 FragColor;

void main() {
  float x = uTexelSize.x;
  float y = uTexelSize.y;

  vec4 d = uTexelSize.xyxy * vec4(1.0, 1.0, -1.0, 0.0);

  vec4 s1 = texture(uTexture, vUv - d.xy);
  vec4 s2 = texture(uTexture, vUv - d.wy);
  vec4 s3 = texture(uTexture, vUv - d.zy);

  vec4 s4 = texture(uTexture, vUv - d.xw);
  vec4 s5 = texture(uTexture, vUv);
  vec4 s6 = texture(uTexture, vUv + d.xw);

  vec4 s7 = texture(uTexture, vUv + d.zy);
  vec4 s8 = texture(uTexture, vUv + d.wy);
  vec4 s9 = texture(uTexture, vUv + d.xy);

  vec4 result = (
    s1 + s3 + s7 + s9 + 
    2.0 * (s2 + s4 + s6 + s8) + 
    4.0 * s5
  ) / 16.0;

  FragColor = result * uIntensity;
}`,ac=class{constructor(t,e,n,i=5){this.gl=t,this.quad=new Pa(t),this.shaderDown=new wn(t,Zi,sc),this.shaderUp=new wn(t,Zi,rc);let s=e,r=n;for(let a=0;a<i&&(s=Math.floor(s/2),r=Math.floor(r/2),!(s<1||r<1));a++)this.mips.push(new Mn(t,s,r))}mips=[];shaderDown;shaderUp;quad;render(t){const e=this.gl;this.quad.draw(),this.shaderDown.use(),e.activeTexture(e.TEXTURE0);let n=t;for(let i=0;i<this.mips.length;i++){const s=this.mips[i],r=i===0;s.bind(),e.viewport(0,0,s.width,s.height),e.clear(e.COLOR_BUFFER_BIT),e.bindTexture(e.TEXTURE_2D,n),this.shaderDown.setUniform("uTexture","1i",0),this.shaderDown.setUniform("uTexelSize","2fv",[1/s.width,1/s.height]),this.shaderDown.setUniform("uIsFirstPass","1i",r?1:0),r&&this.shaderDown.setUniform("uThreshold","1f",1),e.drawArrays(e.TRIANGLES,0,6),n=s.texture}this.shaderUp.use(),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE);for(let i=this.mips.length-1;i>0;i--){const s=this.mips[i],r=this.mips[i-1];r.bind(),e.viewport(0,0,r.width,r.height),e.bindTexture(e.TEXTURE_2D,s.texture),this.shaderUp.setUniform("uTexture","1i",0),this.shaderUp.setUniform("uTexelSize","2fv",[1/s.width,1/s.height]),this.shaderUp.setUniform("uIntensity","1f",1),e.drawArrays(e.TRIANGLES,0,6)}return e.disable(e.BLEND),this.mips[0].texture}},oc=`#version 300 es
layout(location=0) in vec3 a_position;
layout(location=1) in vec3 a_normal;
layout(location=2) in vec4 a_color;
layout(location=3) in vec4 a_shade;
layout(location=4) in mat4 a_modelMatrix; 

uniform mat4 u_viewMatrix;
uniform mat4 u_projectionMatrix;

out vec3 v_worldPosition;
out vec3 v_normal;
out vec4 v_color;
out vec4 v_shade;

void main() {
  vec4 worldPos = a_modelMatrix * vec4(a_position, 1.0);
  gl_Position = u_projectionMatrix * u_viewMatrix * worldPos;

  v_worldPosition = worldPos.xyz;
  v_normal = mat3(a_modelMatrix) * a_normal; 
  
  v_color = a_color;
  v_shade = a_shade;
}`,hc=`#version 300 es
precision highp float;

#define MAX_LIGHTS 10

in vec3 v_worldPosition;
in vec3 v_normal;
in vec4 v_color;
in vec4 v_shade;

struct Light {
  vec3 pos;
  float lum;
};

uniform Light u_lights[MAX_LIGHTS];
uniform vec3 u_ambientLight;
uniform int u_numLights;

out vec4 FragColor;

void main() {
  vec3 normal = normalize(v_normal);

  float diffuseIntensity = 0.0;
  
  for (int i = 0; i < u_numLights; i++) {
    vec3 lightDir = normalize(u_lights[i].pos - v_worldPosition);
    float diffuseFactor = max(dot(normal, lightDir), 0.0);
    diffuseIntensity += u_lights[i].lum * diffuseFactor;
  }

  float ambientIntensity = length(u_ambientLight);
  float lightingFactor = ambientIntensity + diffuseIntensity;
  lightingFactor = clamp(lightingFactor, 0.0, 1.0);

  vec3 finalColor = mix(v_shade.rgb, v_color.rgb, lightingFactor);

  FragColor = vec4(finalColor, v_color.a);
}`,lc=`#version 300 es
precision mediump float;

in vec2 vUv;

uniform sampler2D uTexture;
uniform float uThreshold;

out vec4 FragColor;

void main() { 
  vec4 color = texture(uTexture, vUv);
  FragColor = color;
}`,cc=new Float32Array(ht*ot),uc=class{gl;canvas;meshCache=new Map;quadGeometry;sceneShader;sceneTarget;ppStack;bloom;uniformLocs={};renderQueue=[];renderQueueCount=0;constructor(t,e){this.canvas=t;const n=this.canvas.getContext("webgl2",e);if(!n)throw new Error("WebGL2 not supported");this.gl=n,this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.disable(this.gl.CULL_FACE)}init(){this.quadGeometry=new Sr(this.gl,new Float32Array([-1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0]),new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1])),this.sceneShader=new wn(this.gl,oc,hc),this.cacheSceneUniforms(),this.sceneTarget=new Mn(this.gl,this.canvas.width,this.canvas.height),this.ppStack=new ic(this.gl,this.canvas.width,this.canvas.height),this.bloom=new ac(this.gl,this.canvas.width,this.canvas.height,6);const t={shader:new wn(this.gl,Zi,lc),enabled:!0,onApply:e=>{e.setUniform("uThreshold","1f",.8)}};this.ppStack.addPass(t)}registerMesh(t,e,n){this.meshCache.has(t)&&this.unregisterMesh(t),this.meshCache.set(t,new Sr(this.gl,e,n))}unregisterMesh(t){var e;(e=this.meshCache.get(t))==null||e.dispose(),this.meshCache.delete(t)}dispose(){var t;this.meshCache.forEach(e=>e.dispose()),this.meshCache.clear(),this.quadGeometry.dispose(),(t=this.gl.getExtension("WEBGL_lose_context"))==null||t.loseContext()}render(t,e,n,i){this.sceneTarget.bind(),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clearColor(i[0],i[1],i[2],1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.sceneShader.use(),this.uploadGlobalUniforms(t,n,i),this.renderBatches(Te.opaqueBatches,e,!1),this.gl.depthMask(!1),this.renderBatches(Te.transparentBatches,e,!0),this.gl.depthMask(!0),this.sceneTarget.unbind(),this.ppStack.render(this.gl,this.sceneTarget.texture)}renderBatches(t,e,n){t.forEach((i,s)=>{const r=i.size;if(r===0)return;const a=this.meshCache.get(s);if(!a)return;let o;n?(i.sort(e,!0),o=i.getSortedData(cc)):o=i.data,a.bind(),a.uploadInstanceData(o,r),a.draw(),a.unbind()})}cacheSceneUniforms(){this.sceneShader.use();const t=["u_projectionMatrix","u_viewMatrix","u_modelMatrix","u_ambientLight","u_numLights","u_objectColor","u_shadeColor"];for(let e=0;e<10;e++)t.push(`u_lights[${e}].pos`),t.push(`u_lights[${e}].lum`);t.forEach(e=>{this.uniformLocs[e]=this.gl.getUniformLocation(this.sceneShader.program,e)})}uploadGlobalUniforms(t,e,n){const i=this.uniformLocs.u_ambientLight;i&&this.gl.uniform3fv(i,n);const s=this.uniformLocs.u_projectionMatrix,r=this.uniformLocs.u_viewMatrix;s&&this.gl.uniformMatrix4fv(s,!1,t.projection.elements),r&&this.gl.uniformMatrix4fv(r,!1,t.view.elements);const a=this.uniformLocs.u_numLights;a&&this.gl.uniform1i(a,e.length);for(let o=0;o<e.length;o++){const h=e[o],l=this.uniformLocs[`u_lights[${o}].pos`],c=this.uniformLocs[`u_lights[${o}].lum`];l&&this.gl.uniform3f(l,h.pos.x,h.pos.y,h.pos.z),c&&this.gl.uniform1f(c,h.luminosity)}}},fn=class Da{id;displayName;events;themes;_objects;_idToIndex;_freeIndices;constructor(e){this.id=ls(),this.displayName="My Cool 3D",this.events=new Pe,this.themes=new Map,this._objects=[],this._idToIndex=new Map,this._freeIndices=[],e&&this.assign(e)}get rawObjects(){return this._objects}static from(e){return new Da(e)}assign(e){if(e.metadata&&(e.metadata.id&&(this.id=e.metadata.id),e.metadata.displayName&&(this.displayName=e.metadata.displayName),e.events&&(this.events=Pe.from(e.events)),e.themes)){this.themes.clear();for(const n of e.themes)this.themes.set(n.id,n)}if(e.objects)for(const n of e.objects){const i=Pe.from(n);this.addObject(i)}return this}serialize(){const e=new Array(this._idToIndex.size);let n=0;const i=this._objects.length;for(let a=0;a<i;a++){const o=this._objects[a];o!==null&&(e[n++]=o.serialize())}const s=new Array(this.themes.size);let r=0;for(const a of this.themes.values())s[r++]=a;return{objects:e,events:this.events.serialize(),themes:s,metadata:{id:this.id,displayName:this.displayName}}}addObject(e){if(this._idToIndex.has(e.id))return console.warn(`[Level] Object ID [${e.id}] already exists. Skipping.`),this._idToIndex.get(e.id);let n;return this._freeIndices.length>0?(n=this._freeIndices.pop(),this._objects[n]=e):(n=this._objects.length,this._objects.push(e)),this._idToIndex.set(e.id,n),n}getObject(e){const n=this._idToIndex.get(e);if(n!==void 0)return this._objects[n]}deleteObject(e,n=!1){const i=this._idToIndex.get(e);return i===void 0?!1:(this._objects[i]=null,this._freeIndices.push(i),this._idToIndex.delete(e),n&&this.rawObjects.forEach(s=>{s&&s.components.forEach(r=>{r.parentId===e&&(r._isDirty=!0)})}),!0)}},kt=new M(0,0,100),rn=new M(0,0,-100),fc=new M(0,1,0),an={id:"DEFAULT_THEME",name:"New Theme",objects:[{r:25,g:25,b:25},{r:50,g:50,b:50},{r:75,g:75,b:75},{r:100,g:100,b:100},{r:125,g:125,b:125},{r:150,g:150,b:150},{r:175,g:175,b:175},{r:200,g:200,b:200},{r:225,g:225,b:225}],effects:[{r:25,g:25,b:25},{r:50,g:50,b:50},{r:75,g:75,b:75},{r:100,g:100,b:100},{r:125,g:125,b:125},{r:150,g:150,b:150},{r:175,g:175,b:175},{r:200,g:200,b:200},{r:225,g:225,b:225}],parallax:[{r:25,g:25,b:25},{r:50,g:50,b:50},{r:75,g:75,b:75},{r:100,g:100,b:100},{r:125,g:125,b:125},{r:150,g:150,b:150},{r:175,g:175,b:175},{r:200,g:200,b:200},{r:225,g:225,b:225}],background:{r:25,g:25,b:25},gui:{r:200,g:200,b:200},guiAccent:{r:200,g:200,b:200}},Ar=class Na{isHeadless;level;renderer;freecamEnabled=!0;freecamPos=new M(0,0,100);freecamTarget=new M(0,0,0);freecamFov=45;_viewMatrix=new J;_events;_theme;cameraType;perspectiveCamera;orthographicCamera;_activeCamera;constructor(e,n,i){if(e?this.assign(e):(this.level=new fn,this.level.themes.set(an.id,an),this.newEffectsObject()),n){this.isHeadless=!1;const a=n.getBoundingClientRect(),o=Math.min(window.devicePixelRatio||1,2);n.width=a.width*o,n.height=a.height*o,this.renderer=new uc(n,i),this.renderer.init(),console.info("[Editor] Registering meshes to vbuffer...");let h=0;ut.meshes.forEach((l,c)=>{const u=c,f=ut.getFlatMesh(u),d=ut.getFlatNormals(u);this.renderer.registerMesh(u,f,d),h++}),console.info(`[Editor] Registered ${h} meshes to vbuffer.`),this._theme=structuredClone(an)}else this.isHeadless=!0,console.warn("[Editor] Editor is running in headless mode, no attempt to render will be made.");this.perspectiveCamera=new ml(45,16/9,.1,1e4);const s=100,r={left:s*(16/9)/-2,right:s*(16/9)/2,top:s/2,bottom:s/-2,near:.1,far:1e4};this.orthographicCamera=new pl(...Object.values(r)),this.orthographicCamera.zoom=1,this.cameraType="perspective",this._activeCamera=this.perspectiveCamera,this.updateCameraMatrix()}static from(e){return new Na(e)}assign(e){return e.level&&(this.level=fn.from(e.level)),this}serialize(){return{level:this.level.serialize()}}update(e){const n=this.level.events.getComponent("Animation3D");this._events=he.interpolateTracks(e,n,this._events??{}),this.freecamEnabled?(kt.copy(this.freecamPos),rn.copy(this.freecamTarget),this.perspectiveCamera.fov=this.freecamFov,this.perspectiveCamera.updateProjectionMatrix(),this.orthographicCamera.zoom=this.fovToOrtho(this.freecamFov,100),this.orthographicCamera.updateProjectionMatrix()):(this._events.CameraMove&&kt.fromArray(this._events.CameraMove),this._events.CameraTarget&&rn.fromArray(this._events.CameraTarget),this._events.CameraFOV&&(this.perspectiveCamera.fov=this._events.CameraFOV[0],this.perspectiveCamera.updateProjectionMatrix(),this.orthographicCamera.zoom=this.fovToOrtho(this._events.CameraFOV[0],100),this.orthographicCamera.updateProjectionMatrix())),this.updateCameraMatrix();let i=an;n.tracks.Theme&&(i=he.interpolateTheme(e,this.level.themes,n.tracks.Theme),this._theme=i),Te.clean(),this.level.rawObjects.forEach(s=>{Te.update(e,s,this.level,i)}),Te.commit()}render(){if(this.isHeadless||!this.renderer)return;const e=[{pos:new M(20,20,20),luminosity:1}],n=P.rgbaToRaw(this._theme.background),i=new M().copy(kt),s={projection:this._activeCamera.projectionMatrix,view:this._viewMatrix};this.renderer.render(s,i,e,n)}resize(e,n){if(this.isHeadless)return;const i=e/n;this.perspectiveCamera.aspect=i,this.perspectiveCamera.updateProjectionMatrix();const r=(this.orthographicCamera.top-this.orthographicCamera.bottom)*i;this.orthographicCamera.left=-r/2,this.orthographicCamera.right=r/2,this.orthographicCamera.updateProjectionMatrix()}load(e){return this.level=fn.from(e),this}getEndTime(){let e=0;return this.level.rawObjects.forEach(n=>{n&&n.components.forEach(i=>{const s=i.lifetime+i.spawnTime;s>e&&(e=s)})}),e}newObject(e){const n=Pe.from(e??{});return n.addComponent("Animation3D").addKeyframe("Move",{data:[0,0,0]}).addKeyframe("Scale",{data:[1,1,1]}).addKeyframe("Rotation",{data:[0,0,0]}).addKeyframe("Color",{data:[0,8]}).setParenting("Move",!0).setParenting("Scale",!1).setParenting("Rotation",!0),this.level.addObject(n),n}newEffectsObject(e){var n;const i=Pe.from(e??{});return i.addComponent("Animation3D").addKeyframe("AmbientLight",{data:[40]}).addKeyframe("CameraFOV",{data:[45]}).addKeyframe("CameraMove",{data:[0,0,100]}).addKeyframe("CameraTarget",{data:[0,0,0]}).addKeyframe("LightSourceLuminosity",{data:[100]}).addKeyframe("LightSourceMove",{data:[100,100,0]}).addKeyframe("Theme",{themeId:(n=this.level.themes.entries().next().value)==null?void 0:n[1].id}),this.level.events=i,i}updateCameraMatrix(){this._viewMatrix.lookAt(kt,rn,fc),this._activeCamera.position.copy(kt),this._activeCamera.lookAt(rn),this._viewMatrix.copy(this._activeCamera.matrixWorldInverse)}setCameraType(e){this.cameraType!==e&&(this.cameraType=e,e==="perspective"?this._activeCamera=this.perspectiveCamera:this._activeCamera=this.orthographicCamera,this._activeCamera.updateProjectionMatrix())}toggleFreecam(){this.freecamEnabled=!this.freecamEnabled,this.updateCameraMatrix()}fovToOrtho(e,n){const i=e/2*(Math.PI/180),s=2*n*Math.tan(i),a=(this.orthographicCamera.top-this.orthographicCamera.bottom)/s;return Math.max(.001,a)}},on=class{static stats;static resetStats(){this.stats={conversionTime:0,themes:0,objects:0,prefabs:0,prefabInstances:0,keyframes:{}}}static levelFromVgd(t){this.resetStats();const e=performance.now(),n=new fn;if(n.events=this.eventsFromVgd(t.events),t.objects&&t.objects.forEach(s=>{n.addObject(this.animatableFromVgd(s)),this.stats.objects++}),(t.prefabObjects||t.prefab_objects)&&t.prefabs&&t.prefabs.length>0){const s=t.prefabObjects??t.prefab_objects;s&&s.length>0&&s.forEach(r=>{const a=t.prefabs.filter(o=>o.id===r.pid)[0];a&&(this.prefabInstanceFromVgd(r,a).forEach(o=>{n.addObject(o),this.stats.objects++}),this.stats.prefabInstances++)})}t.prefabs&&(this.stats.prefabs=t.prefabs.length),t.themes&&t.themes.forEach(s=>{n.themes.set(s.id,this.themeFromVgd(s))});const i=performance.now();return this.stats.conversionTime=i-e,n}static prefabInstanceFromVgd(t,e){var n,i,s;const r=[],a={},o=new Pe;o.id=t.id,o.name="Prefab Root";const h=o.addComponent("Animation2D");if(h.spawnTime=t.t,t.e){const l=((n=t.e[0])==null?void 0:n.ev)??[0,0],c=((i=t.e[1])==null?void 0:i.ev)??[1,1],u=((s=t.e[2])==null?void 0:s.ev)??[0,0];h.addKeyframe("Move",{data:[l[0]??0,l[1]??0]}),h.addKeyframe("Scale",{data:[c[0]??0,c[1]??0]}),h.addKeyframe("Rotation",{data:[u[0]??0,u[1]??0]})}return r.push(o),e.objs.forEach(l=>{a[l.id.toString()]=ls()}),e.objs.forEach(l=>{const c=structuredClone(l),u=l.id.toString();c.id=a[u],!c.p_id||!a[c.p_id]?(c.p_id=o.id,c.p_t="111"):c.p_id=a[c.p_id],r.push(this.animatableFromVgd(c,t.t))}),r}static animatableFromVgd(t,e=0){const n=new Pe;n.addComponent("Animation2D");const i=n.getComponent("Animation2D"),s=(t.st??0)+e;i.zOffset=0-(t.d??20),i.spawnTime=s,i.setParenting("Move",!0).setParenting("Scale",!1).setParenting("Rotation",!0);const r=this.keyframeTrackFromVgd(t.e[0].k,"Move",s),a=this.keyframeTrackFromVgd(t.e[1].k,"Scale",s),o=this.keyframeTrackFromVgd(t.e[2].k,"Rotation",s),h=this.keyframeTrackFromVgd(t.e[3].k,"Color",s);if(i.createTrack("Move",r),i.createTrack("Scale",a),i.createTrack("Rotation",o),i.createTrack("Color",h),t.ak_t)switch(t.ak_t){case 1:{let l=0;[r,a,o,h].forEach(c=>{c.forEach(u=>{u.time>l&&(l=u.time)})}),i.lifetime=l-i.spawnTime;break}case 2:{let l=0;[r,a,o,h].forEach(c=>{c.forEach(u=>{u.time>l&&(l=u.time)})}),i.lifetime=l-i.spawnTime+(t.ak_o||0);break}case 3:{i.lifetime=t.ak_o||0;break}case 4:{i.lifetime=(t.ak_o||0)-i.spawnTime;break}}if(t.id&&(n.id=t.id),t.n&&(n.name=t.n),t.o&&(i.origin={x:t.o.x,y:t.o.y}),t.p_id&&(i.parentId=t.p_id),t.p_t){const l=t.p_t.split("");i.setParenting("Move",l[0]=="1"),i.setParenting("Scale",l[1]=="1"),i.setParenting("Rotation",l[2]=="1")}if(t.p_o&&(i.setParentOffset("Move",t.p_o[0]),i.setParentOffset("Scale",t.p_o[1]),i.setParentOffset("Rotation",t.p_o[2])),t.s&&t.s>5&&(t.s=0),t.so&&t.so>[2,8,5,1,0,5][t.s??0]&&(t.so=0),t.ot!=6&&t.ot!=3){const l=Wl(t.s,t.so);i.mesh=l}else i.mesh=void 0;return n}static keyframeTrackFromVgd(t,e,n=0){const i=[];if(e=="Rotation"){let s=0;t.forEach(r=>{r.ev[1]==1&&(s=0),s+=r.ev[0],r.ev[0]=s,i.push(this.keyframeFromVgd(r,e,n))})}else t.forEach(s=>{i.push(this.keyframeFromVgd(s,e,n))});return i}static keyframeFromVgd(t,e,n=0){const i={time:0,data:[]};if(i.time=(t.t??0)+n,t.ct&&(i.easing=t.ct),t.r&&(i.randomize=t.r>1?t.r-1:t.r),t.ev)switch(e){case"Color":{i.data=[t.ev[0],(t.ev[1]==null?100:t.ev[1])/100];break}case"Rotation":{i.data=[t.ev[0]];break}default:i.data=t.ev}if(t.er){switch(e){case"Color":{i.random=[t.er[0],t.er[1]??0];break}case"Rotation":{i.random=[t.er[0]];break}default:i.random=t.er}i.randomizeInterval=t.er[2]}return this.stats.keyframes[e]?this.stats.keyframes[e]++:this.stats.keyframes[e]=1,i}static themeFromVgd(t){const e={id:t.id,name:t.name,objects:t.obj.map(n=>P.hexToRgba(n)||{r:0,g:0,b:0}),effects:t.fx.map(n=>P.hexToRgba(n)||{r:0,g:0,b:0}),parallax:t.bg.map(n=>P.hexToRgba(n)||{r:0,g:0,b:0}),background:P.hexToRgba(t.base_bg),gui:P.hexToRgba(t.base_gui),guiAccent:P.hexToRgba(t.base_gui_accent)};return this.stats.themes++,e}static eventsFromVgd(t){const e=new Pe,n=e.addComponent("Animation3D").addKeyframe("AmbientLight",{data:[40]}).addKeyframe("CameraFOV",{data:[45]}).addKeyframe("CameraMove",{data:[0,0,100]}).addKeyframe("CameraTarget",{data:[0,0,0]}).addKeyframe("LightSourceLuminosity",{data:[100]}).addKeyframe("LightSourceMove",{data:[100,100,0]});for(const i of t[0])n.addKeyframe("CameraMove",{data:[...i.ev,100],time:i.t??0,easing:i.ct}),n.addKeyframe("CameraTarget",{data:[...i.ev,100],time:i.t??0,easing:i.ct}),this.stats.keyframes.CameraMove?this.stats.keyframes.CameraMove++:this.stats.keyframes.CameraMove=1;for(const i of t[1]){const s=this.toPaZoom(i.ev[0]??30);n.addKeyframe("CameraFOV",{data:[s],time:i.t??0,easing:i.ct}),this.stats.keyframes.CameraFOV?this.stats.keyframes.CameraFOV++:this.stats.keyframes.CameraFOV=1}for(const i of t[4])n.addKeyframe("Theme",{themeId:i.evs[0],time:i.t??0,easing:i.ct}),this.stats.keyframes.Theme?this.stats.keyframes.Theme++:this.stats.keyframes.Theme=1;return e}static toPaZoom(t){return-.0028*Math.pow(t,2)+1.2*t+-.1}};function dc(){const t=performance.now();nc(),Jl(),Gl(),Hl();const e=performance.now();console.info(`Finished initialization in ${e-t}ms`)}var mc=se('<span class="text-white/50 text-sm"> </span>'),pc=se('<div class="w-8 h-8"></div>'),gc=se('<div class="flex flex-col gap-4"><div class="w-full flex flex-col gap-2 mb-4"><div class="w-full flex gap-4"><!></div> <!></div> <div class="flex gap-4"><!> <!></div> <div class="flex gap-4"><!></div></div> <div class="flex flex-col gap-4"><div class="flex gap-4"><!> <!> <!> <!></div> <div class="flex gap-4"><!> <!> <!></div> <div class="flex gap-2 justify-center"><!></div></div>',1),xc=se(`<main class="max-w-screen max-h-screen flex flex-col gap-2"><section class="relative w-full bg-zinc-900/50 font-mono z-50 pointer-events-none"><!></section> <div class="flex grow"><section class="flex flex-col justify-between basis-1/3 p-4 gap-4"><!></section> <section class="flex w-full flex-1 min-h-0"><div class="w-full border-2 border-zinc-900 bg-black overflow-hidden" style="aspect-ratio:16/9;"><canvas class="w-full h-full block"></canvas></div></section></div> <section class="flex w-full gap-4"><button aria-label="Play / Pause" class="
        flex justify-center p-1 w-9 h-9
        bg-zinc-700 rounded-md font-bold
        hover:bg-amber-700 active:bg-amber-600
        active:scale-95
        transition-all duration-150

        bg-contain bg-no-repeat bg-origin-content 
      "></button> <svg class="w-full h-9 bg-zinc-900"><!></svg></section></main>`);function kc(t,e){dt(e,!0);let n=oe(180),i=500,s=oe(null),r=null,a=0,o=0,h=0,l=0,c=0,u=oe(0),f=oe(Ts({opaque:0,transparent:0})),d=oe(null),m=oe(Ts([])),g=oe(void 0),x=At(()=>on.stats),p=oe(0),v=oe(!1),b=oe(!0),y=0;Xa(()=>{dc(),X(s,r?new Ar(null,r):new Ar,!0),requestAnimationFrame(C)}),qa(()=>{w(s)&&!w(s).isHeadless&&(w(s).renderer.dispose(),X(s,null))});function z(){if(w(v)){const N=performance.now();X(p,w(p)+(N-y)/1e3),y=N}else y=performance.now()}function C(){if(!w(s))return;z(),requestAnimationFrame(C);const N=performance.now();w(s).update(w(p)),h+=performance.now()-N,a++,X(b,w(s).cameraType=="perspective"),X(d,w(s)._theme,!0);const ie=performance.now();w(s).render(),l+=performance.now()-ie,o++,y-c>i&&w(v)&&k(ie,w(p))}function k(N,ie){const pe=N-c,_e=Math.round(a*1e3/pe),vt=Math.round(o*1e3/pe),Nn=o>0?h/o:0,jn=a>0?l/a:0;X(u,ie,!0),X(f,{opaque:0,transparent:0},!0),Te.opaqueBatches.forEach(Je=>{w(f).opaque+=Je.size}),Te.transparentBatches.forEach(Je=>{w(f).transparent+=Je.size});const Bt=Math.floor(w(p)*1e3/i),Le={ups:_e,fps:vt,cpuMs:Nn,renderMs:jn,activeObjs:w(f)};X(g,Le,!0),w(m)[Bt]?w(m)[Bt]=Le:w(m).push(Le),a=0,o=0,h=0,l=0,c=N}function A(N){if(!w(s)){alert("The editor has not loaded yet!");return}try{console.info("Loading level...");const ie=JSON.parse(N),pe=on.levelFromVgd(ie);w(s).level=pe,X(n,Math.min(w(s).getEndTime(),300),!0),console.info(`Done! (${on.stats.conversionTime}ms)`),X(x,on.stats),X(m,[],!0),X(v,!0)}catch(ie){console.error(ie),alert(`There was an error parsing this level! Please report this!

Error: ${ie}`)}}function R(N){N.code=="Space"&&X(v,!w(v))}var S=xc();hn("keydown",Oi,R);var I=O(S),L=O(I);Oo(L,{get snapshots(){return w(m)},interval:i,get duration(){return w(n)},get currentSnapshot(){return w(g)}}),F(I);var B=j(I,2),H=O(B),re=O(H);{var de=N=>{var ie=gc(),pe=Fi(ie),_e=O(pe),vt=O(_e),Nn=O(vt);Do(Nn,{onUpload:A}),F(vt);var jn=j(vt,2);{var Bt=U=>{var Qe=mc(),$n=O(Qe);F(Qe),le(()=>$e($n,`Parsed ${w(x).objects??""} objects in ${w(x).conversionTime??""}ms`)),K(U,Qe)};Ve(jn,U=>{w(x)&&U(Bt)})}F(_e);var Le=j(_e,2),Je=O(Le);Zn(Je,{label:"Perspective",get isChecked(){return w(b)},onClick:()=>w(s).setCameraType("perspective")});var ja=j(Je,2);Zn(ja,{label:"Freecam",isChecked:!0,onClick:()=>w(s).toggleFreecam()}),F(Le);var fs=j(Le,2),La=O(fs);{let U=At(()=>!w(b));Zn(La,{label:"Orthographic",get isChecked(){return w(U)},onClick:()=>w(s).setCameraType("orthographic")})}F(fs),F(pe);var ds=j(pe,2),Ln=O(ds),ms=O(Ln);Ue(ms,{value:0,shiftStep:.1,step:1,ctrlStep:10,onChange:U=>w(s).freecamPos.x=U,label:"Camera X"});var ps=j(ms,2);Ue(ps,{value:0,shiftStep:.1,step:1,ctrlStep:10,onChange:U=>w(s).freecamPos.y=U,label:"Camera Y"});var gs=j(ps,2);Ue(gs,{value:100,shiftStep:.1,step:1,ctrlStep:10,onChange:U=>w(s).freecamPos.z=U,label:"Camera Z"});var Ua=j(gs,2);Ue(Ua,{value:45,shiftStep:.1,step:1,ctrlStep:10,onChange:U=>w(s).freecamFov=U,label:"FoV"}),F(Ln);var Un=j(Ln,2),xs=O(Un);Ue(xs,{value:0,shiftStep:.1,step:1,ctrlStep:10,onChange:U=>w(s).freecamTarget.x=U,label:"Target X"});var bs=j(xs,2);Ue(bs,{value:0,shiftStep:.1,step:1,ctrlStep:10,onChange:U=>w(s).freecamTarget.y=U,label:"Target Y"});var $a=j(bs,2);Ue($a,{value:0,shiftStep:.1,step:1,ctrlStep:10,onChange:U=>w(s).freecamTarget.z=U,label:"Target Z"}),F(Un);var vs=j(Un,2),Va=O(vs);{var Ba=U=>{var Qe=Wa(),$n=Fi(Qe);ln($n,17,()=>w(d).objects,Dr,(Ha,Vn)=>{var ys=pc();le(()=>Di(ys,`background-color: rgb(${w(Vn).r??""}, ${w(Vn).g??""}, ${w(Vn).b??""});`)),K(Ha,ys)}),K(U,Qe)};Ve(Va,U=>{w(d)!==null&&U(Ba)})}F(vs),F(ds),K(N,ie)};Ve(re,N=>{w(s)&&N(de)})}F(H);var ne=j(H,2),ce=O(ne),be=O(ce);Qi(be,N=>r=N,()=>r),F(ce),F(ne),F(B);var ye=j(B,2),me=O(ye),Ke=j(me,2),Vt=O(Ke);$o(Vt,{get duration(){return w(n)},timeToPx:N=>(console.log(N),N),pxToTime:N=>(console.log(N),N),get timestamp(){return w(p)},set timestamp(N){X(p,N,!0)}}),F(Ke),F(ye),F(S),le(()=>Di(me,`background-image: url(${yo??""}/icons/${w(v)?"pause.png":"play.png"});`)),qe("click",me,()=>X(v,!w(v))),K(t,S),mt()}Nt(["click"]);export{kc as component};
