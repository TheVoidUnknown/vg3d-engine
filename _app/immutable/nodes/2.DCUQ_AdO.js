import{a as K,f as ie,d as Gi,c as Na}from"../chunks/qiDBJ8aT.js";import{o as ja,a as La}from"../chunks/CJlhnFNh.js";import{e as Wn,n as Ua,aR as Ar,h as me,w as Xn,V as $a,o as Va,C as w,t as Ba,H as Ha,v as _s,x as qn,i as Xt,af as Wa,aJ as Xa,ar as Ms,c as at,aS as Te,f as Fi,aT as qa,s as Ya,Q as Za,aU as Ga,aH as Ki,aV as Ka,aW as Qa,aN as Ja,ad as ws,aX as eo,r as Er,p as Rr,aY as Yn,q as to,aZ as no,a_ as io,aG as so,d as ro,aD as ao,a$ as Ir,k as Qi,z as Fr,aO as oo,b0 as ho,y as lo,a5 as pt,a7 as ce,a8 as gt,a9 as O,ab as L,aa as I,as as co,F as Y,aQ as un,aP as de,a6 as Oi,b1 as Pi,D as Ts}from"../chunks/wsYffcW8.js";import{s as Ve,d as Ut,e as ln}from"../chunks/DfZZmcBE.js";import{p as Z,b as Ji,i as Be}from"../chunks/D6COVnyx.js";import{s as W,r as Or}from"../chunks/BpG0UDt9.js";import{b as uo}from"../chunks/CWztvADN.js";function Pr(n,e){return e}function fo(n,e,t){for(var i=[],s=e.length,r,a=e.length,o=0;o<s;o++){let u=e[o];Rr(u,()=>{if(r){if(r.pending.delete(u),r.done.add(u),r.pending.size===0){var f=n.outrogroups;Di(Ki(r.done)),f.delete(r),f.size===0&&(n.outrogroups=null)}}else a-=1},!1)}if(a===0){var h=i.length===0&&t!==null;if(h){var l=t,c=l.parentNode;so(c),c.append(l),n.items.clear()}Di(e,!h)}else r={pending:new Set(e),done:new Set},(n.outrogroups??=new Set).add(r)}function Di(n,e=!0){for(var t=0;t<n.length;t++)ro(n[t],e)}var ks;function cn(n,e,t,i,s,r=null){var a=n,o=new Map,h=(e&Ar)!==0;if(h){var l=n;a=me?Xn($a(l)):l.appendChild(Wn())}me&&Va();var c=null,u=Za(()=>{var p=t();return Ga(p)?p:p==null?[]:Ki(p)}),f,d=!0;function m(){g.fallback=c,mo(g,f,a,e,i),c!==null&&(f.length===0?(c.f&Te)===0?Er(c):(c.f^=Te,St(c,null,a)):Rr(c,()=>{c=null}))}var x=Ua(()=>{f=w(u);var p=f.length;let y=!1;if(me){var b=Ba(a)===Ha;b!==(p===0)&&(a=_s(),Xn(a),qn(!1),y=!0)}for(var v=new Set,z=at,C=Ya(),k=0;k<p;k+=1){me&&Xt.nodeType===Wa&&Xt.data===Xa&&(a=Xt,y=!0,qn(!1));var R=f[k],S=i(R,k),A=d?null:o.get(S);A?(A.v&&Ms(A.v,R),A.i&&Ms(A.i,k),C&&z.unskip_effect(A.e)):(A=po(o,d?a:ks??=Wn(),R,S,k,s,e,t),d||(A.e.f|=Te),o.set(S,A)),v.add(S)}if(p===0&&r&&!c&&(d?c=Fi(()=>r(a)):(c=Fi(()=>r(ks??=Wn())),c.f|=Te)),p>v.size&&qa(),me&&p>0&&Xn(_s()),!d)if(C){for(const[D,F]of o)v.has(D)||z.skip_effect(F.e);z.oncommit(m),z.ondiscard(()=>{})}else m();y&&qn(!0),w(u)}),g={effect:x,items:o,outrogroups:null,fallback:c};d=!1,me&&(a=Xt)}function Mt(n){for(;n!==null&&(n.f&no)===0;)n=n.next;return n}function mo(n,e,t,i,s){var r=(i&io)!==0,a=e.length,o=n.items,h=Mt(n.effect.first),l,c=null,u,f=[],d=[],m,x,g,p;if(r)for(p=0;p<a;p+=1)m=e[p],x=s(m,p),g=o.get(x).e,(g.f&Te)===0&&(g.nodes?.a?.measure(),(u??=new Set).add(g));for(p=0;p<a;p+=1){if(m=e[p],x=s(m,p),g=o.get(x).e,n.outrogroups!==null)for(const A of n.outrogroups)A.pending.delete(g),A.done.delete(g);if((g.f&Te)!==0)if(g.f^=Te,g===h)St(g,null,t);else{var y=c?c.next:h;g===n.effect.last&&(n.effect.last=g.prev),g.prev&&(g.prev.next=g.next),g.next&&(g.next.prev=g.prev),Ae(n,c,g),Ae(n,g,y),St(g,y,t),c=g,f=[],d=[],h=Mt(c.next);continue}if((g.f&Yn)!==0&&(Er(g),r&&(g.nodes?.a?.unfix(),(u??=new Set).delete(g))),g!==h){if(l!==void 0&&l.has(g)){if(f.length<d.length){var b=d[0],v;c=b.prev;var z=f[0],C=f[f.length-1];for(v=0;v<f.length;v+=1)St(f[v],b,t);for(v=0;v<d.length;v+=1)l.delete(d[v]);Ae(n,z.prev,C.next),Ae(n,c,z),Ae(n,C,b),h=b,c=C,p-=1,f=[],d=[]}else l.delete(g),St(g,h,t),Ae(n,g.prev,g.next),Ae(n,g,c===null?n.effect.first:c.next),Ae(n,c,g),c=g;continue}for(f=[],d=[];h!==null&&h!==g;)(l??=new Set).add(h),d.push(h),h=Mt(h.next);if(h===null)continue}(g.f&Te)===0&&f.push(g),c=g,h=Mt(g.next)}if(n.outrogroups!==null){for(const A of n.outrogroups)A.pending.size===0&&(Di(Ki(A.done)),n.outrogroups?.delete(A));n.outrogroups.size===0&&(n.outrogroups=null)}if(h!==null||l!==void 0){var k=[];if(l!==void 0)for(g of l)(g.f&Yn)===0&&k.push(g);for(;h!==null;)(h.f&Yn)===0&&h!==n.fallback&&k.push(h),h=Mt(h.next);var R=k.length;if(R>0){var S=(i&Ar)!==0&&a===0?t:null;if(r){for(p=0;p<R;p+=1)k[p].nodes?.a?.measure();for(p=0;p<R;p+=1)k[p].nodes?.a?.fix()}fo(n,k,S)}}r&&to(()=>{if(u!==void 0)for(g of u)g.nodes?.a?.apply()})}function po(n,e,t,i,s,r,a,o){var h=(a&Ka)!==0?(a&Qa)===0?Ja(t,!1,!1):ws(t):null,l=(a&eo)!==0?ws(s):null;return{v:h,i:l,e:Fi(()=>(r(e,h??t,l??s,o),()=>{n.delete(i)}))}}function St(n,e,t){if(n.nodes)for(var i=n.nodes.start,s=n.nodes.end,r=e&&(e.f&Te)===0?e.nodes.start:t;i!==null;){var a=ao(i);if(r.before(i),i===s)return;i=a}}function Ae(n,e,t){e===null?n.effect.first=t:e.next=t,t===null?n.effect.last=e:t.prev=e}function go(n,e,t){var i=n==null?"":""+n;return i===""?null:i}function xo(n,e){return n==null?null:String(n)}function Rt(n,e,t,i,s,r){var a=n.__className;if(me||a!==t||a===void 0){var o=go(t);(!me||o!==n.getAttribute("class"))&&(o==null?n.removeAttribute("class"):n.className=o),n.__className=t}return r}function Ni(n,e,t,i){var s=n.__style;if(me||s!==e){var r=xo(e);(!me||r!==n.getAttribute("style"))&&(r==null?n.removeAttribute("style"):n.style.cssText=r),n.__style=e}return i}function bo(n,e,t=e){var i=new WeakSet;Ir(n,"input",async s=>{var r=s?n.defaultValue:n.value;if(r=Zn(n)?Gn(r):r,t(r),at!==null&&i.add(at),await oo(),r!==(r=e())){var a=n.selectionStart,o=n.selectionEnd,h=n.value.length;if(n.value=r??"",o!==null){var l=n.value.length;a===o&&o===h&&l>h?(n.selectionStart=l,n.selectionEnd=l):(n.selectionStart=a,n.selectionEnd=Math.min(o,l))}}}),(me&&n.defaultValue!==n.value||Qi(e)==null&&n.value)&&(t(Zn(n)?Gn(n.value):n.value),at!==null&&i.add(at)),Fr(()=>{var s=e();if(n===document.activeElement){var r=ho??at;if(i.has(r))return}Zn(n)&&s===Gn(n.value)||n.type==="date"&&!s&&!n.value||s!==n.value&&(n.value=s??"")})}function yo(n,e,t=e){Ir(n,"change",i=>{var s=i?n.defaultChecked:n.checked;t(s)}),(me&&n.defaultChecked!==n.checked||Qi(e)==null)&&t(n.checked),Fr(()=>{var i=e();n.checked=!!i})}function Zn(n){var e=n.type;return e==="number"||e==="range"}function Gn(n){return n===""?null:+n}class es{#e=new WeakMap;#t;#n;static entries=new WeakMap;constructor(e){this.#n=e}observe(e,t){var i=this.#e.get(e)||new Set;return i.add(t),this.#e.set(e,i),this.#i().observe(e,this.#n),()=>{var s=this.#e.get(e);s.delete(t),s.size===0&&(this.#e.delete(e),this.#t.unobserve(e))}}#i(){return this.#t??(this.#t=new ResizeObserver(e=>{for(var t of e){es.entries.set(t.target,t);for(var i of this.#e.get(t.target)||[])i(t)}}))}}var vo=new es({box:"border-box"});function zs(n,e,t){var i=vo.observe(n,()=>t(n[e]));lo(()=>(Qi(()=>t(n[e])),i))}var _o=ie('<div class="flex items-center gap-2 text-xs"><div class="w-2.5 h-2.5 rounded-full shadow-[0_0_8px]"></div> <div class="flex flex-col leading-none"><span class="text-zinc-400 font-medium uppercase tracking-wider text-[10px]"> </span> <span class="text-zinc-100 font-mono font-bold mt-0.5"> <span class="text-zinc-500 text-[10px]"> </span></span></div></div>'),Mo=ie('<div class="text-zinc-500 text-xs italic">Waiting for data...</div>'),wo=Gi('<line x1="0" x2="100%" stroke="white" stroke-dasharray="2 4" stroke-width="1"></line>'),To=Gi('<path fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" vector-effect="non-scaling-stroke" class="opacity-90 drop-shadow-md transition-all duration-300 ease-linear"></path>'),ko=ie('<div class="flex flex-col h-full w-full gap-3 p-4 bg-zinc-900/80  font-mono"><div class="flex flex-wrap gap-x-5 gap-y-2 shrink-0"></div> <div class="relative grow w-full min-h-12 max-h-12 bg-zinc-950/50 rounded border border-zinc-800/50 overflow-hidden"><svg class="absolute inset-0 pointer-events-none w-full h-full opacity-20"><!><line x1="0" y1="99%" x2="100%" y2="99%" stroke="white" stroke-width="1"></line></svg> <svg class="absolute inset-0 overflow-visible opacity-75" preserveAspectRatio="none"></svg></div></div>');function zo(n,e){pt(e,!0);let t=Z(e,"smooth",3,!0),i=Z(e,"snapshots",19,()=>[]),s=de(0),r=de(0);const a=[{key:"ups",label:"UPS",color:"#3b82f6",getValue:p=>Number(p.ups)},{key:"fps",label:"FPS",color:"#22c55e",getValue:p=>Number(p.fps)},{key:"cpuMs",label:"CPU",color:"#ef4444",unit:"ms",getValue:p=>Number(p.cpuMs)},{key:"renderMs",label:"Render",color:"#eab308",unit:"ms",getValue:p=>Number(p.renderMs)},{key:"activeObjs",label:"Objs",color:"#a855f7",getValue:p=>p.activeObjs.opaque+p.activeObjs.transparent}];function o(p){let y=0;for(let b=0;b<p.length;b++)p[b]>y&&(y=p[b]);return y||1}function h(p){if(p.length===0)return"";if(p.length===1)return`M ${p[0].x} ${p[0].y}`;let y=`M ${p[0].x} ${p[0].y}`;for(let b=0;b<p.length-1;b++){const v=p[b===0?0:b-1],z=p[b],C=p[b+1],k=p[b+2]||C,R=z.x+(C.x-v.x)/6,S=z.y+(C.y-v.y)/6,A=C.x-(k.x-z.x)/6,D=C.y-(k.y-z.y)/6;y+=` C ${R} ${S}, ${A} ${D}, ${C.x} ${C.y}`}return y}const l=un(()=>{if(!i().length)return[];const p=Math.ceil(e.duration*1e3/e.interval);return i().length>p?i().slice(-p):i()}),c=un(()=>w(l).length<2||w(s)===0||w(r)===0?[]:a.map(p=>{const y=w(l).map(p.getValue),b=y[y.length-1]??0,v=o(y),z=y.map((k,R)=>({x:R/(y.length-1)*w(s),y:w(r)-k/v*w(r)})),C=t()?h(z):`M ${z.map(k=>`${k.x},${k.y}`).join(" L ")}`;return{...p,d:C,current:b,max:v}}));var u=ko(),f=O(u);cn(f,21,()=>w(c),p=>p.key,(p,y)=>{var b=_o(),v=O(b),z=L(v,2),C=O(z),k=O(C,!0);I(C);var R=L(C,2),S=O(R),A=L(S),D=O(A,!0);I(A),I(R),I(z),I(b),ce(F=>{Ni(v,`background-color: ${w(y).color??""}; shadow-color: ${w(y).color??""}`),Ve(k,w(y).label),Ve(S,`${F??""} `),Ve(D,w(y).unit??"")},[()=>w(y).current.toFixed(1)]),K(p,b)},p=>{var y=Mo();K(p,y)}),I(f);var d=L(f,2),m=O(d),x=O(m);cn(x,16,()=>[.25,.5,.75],Pr,(p,y)=>{var b=wo();ce(()=>{W(b,"y1",`${y*100}%`),W(b,"y2",`${y*100}%`)}),K(p,b)}),co(),I(m);var g=L(m,2);cn(g,21,()=>w(c),p=>p.key,(p,y)=>{var b=To();ce(()=>{W(b,"d",w(y).d),W(b,"stroke",w(y).color)}),K(p,b)}),I(g),I(d),I(u),ce(()=>{W(g,"width",w(s)),W(g,"height",w(r)),W(g,"viewBox",`0 0 ${w(s)??""} ${w(r)??""}`)}),zs(d,"clientWidth",p=>Y(s,p)),zs(d,"clientHeight",p=>Y(r,p)),K(n,u),gt()}var Co=ie(`<button class="
    flex grow justify-center p-1 px-2
    bg-zinc-700 rounded-md font-bold
    hover:bg-amber-700 active:bg-amber-600
    active:scale-95
    transition-all duration-150
  "> </button> <input type="file" accept=".vgd" style="display: none;"/>`,1);function So(n,e){pt(e,!0);let t=Z(e,"label",3,"Upload VGD"),i;async function s(l){const c=l.target,u=c.files?.[0];if(u)try{const f=await u.text();e.onUpload(f),c.value=""}catch(f){throw new Error(`Error reading .vgd file: ${f}`)}}var r=Co(),a=Oi(r);a.__click=()=>i.click();var o=O(a,!0);I(a);var h=L(a,2);h.__change=s,Ji(h,l=>i=l,()=>i),ce(()=>Ve(o,t())),K(n,r),gt()}Ut(["click","change"]);var Ao=ie('<label class="block text-zinc-200 mb-1"> </label>'),Eo=ie('<span class="flex justify-between items-center"><!></span>'),Ro=ie('<div><!> <input type="number"/></div>');function Ue(n,e){pt(e,!0);let t=Z(e,"value",15),i=Z(e,"scrollable",3,!0),s=Z(e,"label",3,void 0),r=Z(e,"disabled",3,!1),a=Z(e,"min",19,()=>-2e16),o=Z(e,"max",3,2e16),h=Z(e,"step",3,1),l=Z(e,"shiftStep",3,.1),c=Z(e,"ctrlStep",3,.01),u=Z(e,"placeholder",3,"0.00"),f=Z(e,"mini",3,!1);const d=`number-input-${Math.random().toString(36).substring(2,9)}`,m=[h(),l(),c()].sort((S,A)=>S-A)[0];let x=de(!1);function g(S){if(!i()||r())return;S.preventDefault();const A=Number(t())||0;let D;S.deltaY<0?D=A+(S.ctrlKey?c():w(x)?l():h()):D=A-(S.ctrlKey?c():w(x)?l():h());const F=Math.max(a(),Math.min(o(),D));t(y(F,m)),e.onChange&&e.onChange(t()??0)}function p(){t(t()===0?0:y(t(),m)),e.onChange&&e.onChange(t()??0)}function y(S,A){if(S)return Math.round(S/A)*A}function b(S){S.key==="Shift"&&Y(x,!0)}function v(S){S.key==="Shift"&&Y(x,!1)}var z=Ro();ln("keydown",Pi,b),ln("keyup",Pi,v);var C=O(z);{var k=S=>{var A=Eo(),D=O(A);{var F=B=>{var q=Ao(),se=O(q,!0);I(q),ce(()=>{W(q,"for",d),Ve(se,s())}),K(B,q)};Be(D,B=>{s()&&B(F)})}I(A),K(S,A)};Be(C,S=>{(s()||e.tooltip)&&S(k)})}var R=L(C,2);Or(R),R.__change=p,I(z),ce(()=>{Rt(z,1,`flex flex-col gap-1 text-left ${f()?"w-full":"min-w-8"}`),W(R,"id",d),R.disabled=r(),W(R,"placeholder",u()),W(R,"min",a()),W(R,"max",o()),W(R,"step",h()),Rt(R,1,`w-full rounded-lg bg-zinc-700 px-2 py-1 text-zinc-100 
           focus:outline-none focus:ring-2 focus:ring-amber-600 
           disabled:cursor-not-allowed disabled:opacity-50
           [appearance:textfield] [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none
           ${f()?"text-center":""}
    `)}),ln("wheel",R,g),bo(R,t),K(n,z),gt()}Ut(["change"]);var Io=Gi('<g data-draggable="true" data-disable-drag="true"><rect height="100%" width="100%" fill="transparent" role="button" tabindex="-7" style="cursor:ew-resize;clip-path: polygon(100% 0, 100% 100%, 0% 100%, 0% 0%, 0 0);"></rect><rect y="0" height="100%" fill="oklch(66.6% 0.179 58.318)" role="button" tabindex="-7" style="cursor:ew-resize;clip-path: polygon(100% 0, 100% 100%, 0% 100%, 0% 0%, 0 0);"></rect></g>');function Fo(n,e){pt(e,!0);let t=Z(e,"timestamp",15,0),i=Z(e,"duration",3,1/0),s=Z(e,"width",3,10),r,a=!1;function o(d){a=!0,window.addEventListener("mousemove",h),window.addEventListener("mouseup",l)}function h(d){if(a&&r){const m=r.getClientRects().item(0);if(!m?.width)return;t(d.offsetX/m.width*i())}}function l(){a=!1,window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",l)}var c=Io(),u=O(c);W(u,"y",0),u.__mousedown=o;var f=L(u);f.__mousedown=o,I(c),Ji(c,d=>r=d,()=>r),ce(()=>{W(f,"x",`${t()/i()*100}%`),W(f,"width",s())}),K(n,c),gt()}Ut(["mousedown"]);var Oo=ie("<label> </label>"),Po=ie('<span class="flex justify-between items-center select-none gap-2"><!></span>'),Do=ie('<div class="flex gap-4 text-left w-full items-center"><input type="checkbox" class="hidden"/> <button><span></span></button> <!></div>');function Kn(n,e){pt(e,!0);let t=Z(e,"isChecked",15);const i=`number-input-${Math.random().toString(36).substring(2,9)}`;function s(){e.disabled||(t(!t()),e.onClick&&e.onClick())}var r=Do(),a=O(r);Or(a);var o=L(a,2);o.__click=s;var h=O(o);I(o);var l=L(o,2);{var c=u=>{var f=Po(),d=O(f);{var m=x=>{var g=Oo(),p=O(g,!0);I(g),ce(()=>{W(g,"for",i),Rt(g,1,`
            block text-zinc-200
            ${e.disabled?"cursor-not-allowed opacity-50":"cursor-pointer"}
          `),Ve(p,e.label)}),K(x,g)};Be(d,x=>{e.label&&x(m)})}I(f),K(u,f)};Be(l,u=>{(e.label||e.tooltip)&&u(c)})}I(r),ce(()=>{W(a,"id",i),a.disabled=e.disabled,W(o,"aria-label",i),Rt(o,1,`
      relative border-2 w-6 h-6 rounded-md transition-colors duration-150 
      ${e.disabled?"cursor-not-allowed":"cursor-pointer"}
      ${t()?"border-amber-600":"border-zinc-700"}
    `),Rt(h,1,`absolute transition-all duration-50 bg-amber-600 rounded-sm top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 ${t()?"w-4 h-4":"w-0 h-0"}`)}),yo(a,t),K(n,r),gt()}Ut(["click"]);const te=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],No=Math.PI/180;function ts(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(te[n&255]+te[n>>8&255]+te[n>>16&255]+te[n>>24&255]+"-"+te[e&255]+te[e>>8&255]+"-"+te[e>>16&15|64]+te[e>>24&255]+"-"+te[t&63|128]+te[t>>8&255]+"-"+te[t>>16&255]+te[t>>24&255]+te[i&255]+te[i>>8&255]+te[i>>16&255]+te[i>>24&255]).toLowerCase()}function jo(n){return n*No}class fn{static components=new Map;static init(){this.components=new Map,console.info("Component Registry initialized")}static register(e,t){this.components.has(e)&&(console.warn(`[ComponentRegistry] Component with name "${e}" was already registered, the previous entry will be overwritten!`),this.components.delete(e)),this.components.set(e,t),console.info(`[ComponentRegistry] Registered component "${e}" -> ${t.name}`)}static get(e){return this.components.get(e)}static create(e){const t=this.components.get(e.type);if(!t)throw new Error(`[ComponentRegistry] Component type "${e.type}" is not registered.`);return t.from(e)}}class _e{id;name;components;constructor(e){this.id=ts(),this.name="New Object",this.components=[],e&&this.assign(e)}static from(e){return new _e(e)}serialize(){const e=[];return this.components.forEach(t=>{e.push(t.serialize())}),{id:this.id,name:this.name,components:e}}assign(e){return e.id&&(this.id=e.id),e.name&&(this.name=e.name),e.components&&e.components.forEach(t=>{this.components.push(fn.create(t))}),this}_setDirty(){this.components.forEach(e=>e._isDirty=!0)}addComponent(e){const t=fn.create({type:e});return this.components.push(t),t}deleteComponent(e){return this.components.forEach((t,i)=>{t.type()===e&&this.components.splice(i,1)}),this}getComponent(e){for(const t of this.components)if(t.type()===e)return t;throw new Error(`[Animatable] Animatable "${this.name}" [ ${this.id} ] does not possess the component "${e}"`)}}class lt{id;displayName;events;themes;_objects;_idToIndex;_freeIndices;constructor(e){this.id=ts(),this.displayName="My Cool 3D",this.events=new _e,this.themes=new Map,this._objects=[],this._idToIndex=new Map,this._freeIndices=[],e&&this.assign(e)}get rawObjects(){return this._objects}static from(e){return new lt(e)}assign(e){if(e.metadata&&(e.metadata.id&&(this.id=e.metadata.id),e.metadata.displayName&&(this.displayName=e.metadata.displayName),e.events&&(this.events=_e.from(e.events)),e.themes)){this.themes.clear();for(const t of e.themes)this.themes.set(t.id,t)}if(e.objects)for(const t of e.objects){const i=_e.from(t);this.addObject(i)}return this}serialize(){const e=new Array(this._idToIndex.size);let t=0;const i=this._objects.length;for(let a=0;a<i;a++){const o=this._objects[a];o!==null&&(e[t++]=o.serialize())}const s=new Array(this.themes.size);let r=0;for(const a of this.themes.values())s[r++]=a;return{objects:e,events:this.events.serialize(),themes:s,metadata:{id:this.id,displayName:this.displayName}}}addObject(e){if(this._idToIndex.has(e.id))return console.warn(`[Level] Object ID [${e.id}] already exists. Skipping.`),this._idToIndex.get(e.id);let t;return this._freeIndices.length>0?(t=this._freeIndices.pop(),this._objects[t]=e):(t=this._objects.length,this._objects.push(e)),this._idToIndex.set(e.id,t),t}getObject(e){const t=this._idToIndex.get(e);if(t!==void 0)return this._objects[t]}deleteObject(e,t=!1){const i=this._idToIndex.get(e);return i===void 0?!1:(this._objects[i]=null,this._freeIndices.push(i),this._idToIndex.delete(e),t&&this.rawObjects.forEach(s=>{s&&s.components.forEach(r=>{r.parentId===e&&(r._isDirty=!0)})}),!0)}}const Lo={time:0,easing:"Linear",data:[]};class $e{time;easing;data;random;themeId;randomize;randomSeed;constructor(e){Object.assign(this,structuredClone(Lo)),this.refreshRandomSeed(),e&&this.assign(e)}static from(e){return new $e(e)}serialize(){return{time:this.time,easing:this.easing,data:structuredClone(this.data),random:this.random,themeId:this.themeId,randomize:this.randomize}}assign(e){return this.data=structuredClone(e.data)??this.data,this.easing=e.easing??"Linear",this.random=e.random,this.randomize=e.randomize,this.themeId=e.themeId,this.time=e.time??0,this}refreshRandomSeed(){this.randomSeed=Math.floor(Math.random()*999999)}setTime(e){return this.time=e,this}setEasing(e){return this.easing=e,this}setData(e){return this.data=e,this}setThemeId(e){return this.themeId=e,this}}class kn extends Array{randomSeed;isDirty;constructor(e){super(),this.refreshRandomSeed(),this.isDirty=!0,e&&e.forEach((t,i)=>this[i]=$e.from(t))}static from(e){return new kn(e)}serialize(){const e=[];for(const t of this)e.push(t.serialize());return e}refreshRandomSeed(){this.randomSeed=Math.floor(Math.random()*999999);for(const e of this)e.refreshRandomSeed()}sortByTime(){return this.sort((e,t)=>e.time-t.time),this.isDirty=!1,this}addKeyframe(e){return this.push($e.from(e)),this.isDirty=!0,this}deleteKeyframe(e){return this[e]&&this.splice(e,1),this.isDirty=!0,this}keyframesAt(e){if(this.length===0)return{prev:new $e,next:new $e};if(this.length===1)return{prev:this[0],next:this[0]};this.isDirty&&this.sortByTime();const t=this[0].time,i=this[this.length-1].time;if(e>=i){const l=this[this.length-1];return{prev:l,next:l}}if(e<t)return{prev:this[0],next:this[1]};let s=0,r=this.length-1,a=0;for(;s<=r;){const l=Math.floor(s+(r-s)/2);(this[l].time||0)<=e?(a=l,s=l+1):r=l-1}const o=this[a],h=this[a+1]||o;return{prev:o,next:h}}}const Dr=(n,e)=>{if(typeof n=="number"){if(e===3)return{mode:"rgb",r:(n>>8&15|n>>4&240)/255,g:(n>>4&15|n&240)/255,b:(n&15|n<<4&240)/255};if(e===4)return{mode:"rgb",r:(n>>12&15|n>>8&240)/255,g:(n>>8&15|n>>4&240)/255,b:(n>>4&15|n&240)/255,alpha:(n&15|n<<4&240)/255};if(e===6)return{mode:"rgb",r:(n>>16&255)/255,g:(n>>8&255)/255,b:(n&255)/255};if(e===8)return{mode:"rgb",r:(n>>24&255)/255,g:(n>>16&255)/255,b:(n>>8&255)/255,alpha:(n&255)/255}}},Uo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},$o=n=>Dr(Uo[n.toLowerCase()],6),Vo=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,Bo=n=>{let e;return(e=n.match(Vo))?Dr(parseInt(e[1],16),e[1].length):void 0},Pe="([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)",It=`${Pe}%`,ns=`(?:${Pe}%|${Pe})`,Ho=`(?:${Pe}(deg|grad|rad|turn)|${Pe})`,dt="\\s*,\\s*",Wo=new RegExp(`^rgba?\\(\\s*${Pe}${dt}${Pe}${dt}${Pe}\\s*(?:,\\s*${ns}\\s*)?\\)$`),Xo=new RegExp(`^rgba?\\(\\s*${It}${dt}${It}${dt}${It}\\s*(?:,\\s*${ns}\\s*)?\\)$`),qo=n=>{let e={mode:"rgb"},t;if(t=n.match(Wo))t[1]!==void 0&&(e.r=t[1]/255),t[2]!==void 0&&(e.g=t[2]/255),t[3]!==void 0&&(e.b=t[3]/255);else if(t=n.match(Xo))t[1]!==void 0&&(e.r=t[1]/100),t[2]!==void 0&&(e.g=t[2]/100),t[3]!==void 0&&(e.b=t[3]/100);else return;return t[4]!==void 0?e.alpha=Math.max(0,Math.min(1,t[4]/100)):t[5]!==void 0&&(e.alpha=Math.max(0,Math.min(1,+t[5]))),e},Yo=(n,e)=>n===void 0?void 0:typeof n!="object"?$r(n):n.mode!==void 0?n:e?{...n,mode:e}:void 0,xe=(n="rgb")=>e=>(e=Yo(e,n))!==void 0?e.mode===n?e:ve[e.mode][n]?ve[e.mode][n](e):n==="rgb"?ve[e.mode].rgb(e):ve.rgb[n](ve[e.mode].rgb(e)):void 0,ve={},Nr={},dn=[],jr={},Zo=n=>n,N=n=>(ve[n.mode]={...ve[n.mode],...n.toMode},Object.keys(n.fromMode||{}).forEach(e=>{ve[e]||(ve[e]={}),ve[e][n.mode]=n.fromMode[e]}),n.ranges||(n.ranges={}),n.difference||(n.difference={}),n.channels.forEach(e=>{if(n.ranges[e]===void 0&&(n.ranges[e]=[0,1]),!n.interpolate[e])throw new Error(`Missing interpolator for: ${e}`);typeof n.interpolate[e]=="function"&&(n.interpolate[e]={use:n.interpolate[e]}),n.interpolate[e].fixup||(n.interpolate[e].fixup=Zo)}),Nr[n.mode]=n,(n.parse||[]).forEach(e=>{Go(e,n.mode)}),xe(n.mode)),Lr=n=>Nr[n],Go=(n,e)=>{if(typeof n=="string"){if(!e)throw new Error("'mode' required when 'parser' is a string");jr[n]=e}else typeof n=="function"&&dn.indexOf(n)<0&&dn.push(n)},ji=/[^\x00-\x7F]|[a-zA-Z_]/,Ko=/[^\x00-\x7F]|[-\w]/,_={Function:"function",Ident:"ident",Number:"number",Percentage:"percentage",ParenClose:")",None:"none",Hue:"hue",Alpha:"alpha"};let E=0;function qt(n){let e=n[E],t=n[E+1];return e==="-"||e==="+"?/\d/.test(t)||t==="."&&/\d/.test(n[E+2]):e==="."?/\d/.test(t):/\d/.test(e)}function Li(n){if(E>=n.length)return!1;let e=n[E];if(ji.test(e))return!0;if(e==="-"){if(n.length-E<2)return!1;let t=n[E+1];return!!(t==="-"||ji.test(t))}return!1}const Qo={deg:1,rad:180/Math.PI,grad:9/10,turn:360};function wt(n){let e="";if((n[E]==="-"||n[E]==="+")&&(e+=n[E++]),e+=Yt(n),n[E]==="."&&/\d/.test(n[E+1])&&(e+=n[E++]+Yt(n)),(n[E]==="e"||n[E]==="E")&&((n[E+1]==="-"||n[E+1]==="+")&&/\d/.test(n[E+2])?e+=n[E++]+n[E++]+Yt(n):/\d/.test(n[E+1])&&(e+=n[E++]+Yt(n))),Li(n)){let t=mn(n);return t==="deg"||t==="rad"||t==="turn"||t==="grad"?{type:_.Hue,value:e*Qo[t]}:void 0}return n[E]==="%"?(E++,{type:_.Percentage,value:+e}):{type:_.Number,value:+e}}function Yt(n){let e="";for(;/\d/.test(n[E]);)e+=n[E++];return e}function mn(n){let e="";for(;E<n.length&&Ko.test(n[E]);)e+=n[E++];return e}function Jo(n){let e=mn(n);return n[E]==="("?(E++,{type:_.Function,value:e}):e==="none"?{type:_.None,value:void 0}:{type:_.Ident,value:e}}function e0(n=""){let e=n.trim(),t=[],i;for(E=0;E<e.length;){if(i=e[E++],i===`
`||i==="	"||i===" "){for(;E<e.length&&(e[E]===`
`||e[E]==="	"||e[E]===" ");)E++;continue}if(i===",")return;if(i===")"){t.push({type:_.ParenClose});continue}if(i==="+"){if(E--,qt(e)){t.push(wt(e));continue}return}if(i==="-"){if(E--,qt(e)){t.push(wt(e));continue}if(Li(e)){t.push({type:_.Ident,value:mn(e)});continue}return}if(i==="."){if(E--,qt(e)){t.push(wt(e));continue}return}if(i==="/"){for(;E<e.length&&(e[E]===`
`||e[E]==="	"||e[E]===" ");)E++;let s;if(qt(e)&&(s=wt(e),s.type!==_.Hue)){t.push({type:_.Alpha,value:s});continue}if(Li(e)&&mn(e)==="none"){t.push({type:_.Alpha,value:{type:_.None,value:void 0}});continue}return}if(/\d/.test(i)){E--,t.push(wt(e));continue}if(ji.test(i)){E--,t.push(Jo(e));continue}return}return t}function t0(n){n._i=0;let e=n[n._i++];if(!e||e.type!==_.Function||e.value!=="color"||(e=n[n._i++],e.type!==_.Ident))return;const t=jr[e.value];if(!t)return;const i={mode:t},s=Ur(n,!1);if(!s)return;const r=Lr(t).channels;for(let a=0,o,h;a<r.length;a++)o=s[a],h=r[a],o.type!==_.None&&(i[h]=o.type===_.Number?o.value:o.value/100,h==="alpha"&&(i[h]=Math.max(0,Math.min(1,i[h]))));return i}function Ur(n,e){const t=[];let i;for(;n._i<n.length;){if(i=n[n._i++],i.type===_.None||i.type===_.Number||i.type===_.Alpha||i.type===_.Percentage||e&&i.type===_.Hue){t.push(i);continue}if(i.type===_.ParenClose){if(n._i<n.length)return;continue}return}if(!(t.length<3||t.length>4)){if(t.length===4){if(t[3].type!==_.Alpha)return;t[3]=t[3].value}return t.length===3&&t.push({type:_.None,value:void 0}),t.every(s=>s.type!==_.Alpha)?t:void 0}}function n0(n,e){n._i=0;let t=n[n._i++];if(!t||t.type!==_.Function)return;let i=Ur(n,e);if(i)return i.unshift(t.value),i}const $r=n=>{if(typeof n!="string")return;const e=e0(n),t=e?n0(e,!0):void 0;let i,s=0,r=dn.length;for(;s<r;)if((i=dn[s++](n,t))!==void 0)return i;return e?t0(e):void 0};function i0(n,e){if(!e||e[0]!=="rgb"&&e[0]!=="rgba")return;const t={mode:"rgb"},[,i,s,r,a]=e;if(!(i.type===_.Hue||s.type===_.Hue||r.type===_.Hue))return i.type!==_.None&&(t.r=i.type===_.Number?i.value/255:i.value/100),s.type!==_.None&&(t.g=s.type===_.Number?s.value/255:s.value/100),r.type!==_.None&&(t.b=r.type===_.Number?r.value/255:r.value/100),a.type!==_.None&&(t.alpha=Math.min(1,Math.max(0,a.type===_.Number?a.value:a.value/100))),t}const s0=n=>n==="transparent"?{mode:"rgb",r:0,g:0,b:0,alpha:0}:void 0,r0=(n,e,t)=>n+t*(e-n),a0=n=>{let e=[];for(let t=0;t<n.length-1;t++){let i=n[t],s=n[t+1];i===void 0&&s===void 0?e.push(void 0):i!==void 0&&s!==void 0?e.push([i,s]):e.push(i!==void 0?[i,i]:[s,s])}return e},o0=n=>e=>{let t=a0(e);return i=>{let s=i*t.length,r=i>=1?t.length-1:Math.max(Math.floor(s),0),a=t[r];return a===void 0?void 0:n(a[0],a[1],s-r)}},T=o0(r0),X=n=>{let e=!1,t=n.map(i=>i!==void 0?(e=!0,i):1);return e?t:n},xt={mode:"rgb",channels:["r","g","b","alpha"],parse:[i0,Bo,qo,$o,s0,"srgb"],serialize:"srgb",interpolate:{r:T,g:T,b:T,alpha:{use:T,fixup:X}},gamut:!0,white:{r:1,g:1,b:1},black:{r:0,g:0,b:0}},Qn=(n=0)=>Math.pow(Math.abs(n),563/256)*Math.sign(n),Cs=n=>{let e=Qn(n.r),t=Qn(n.g),i=Qn(n.b),s={mode:"xyz65",x:.5766690429101305*e+.1855582379065463*t+.1882286462349947*i,y:.297344975250536*e+.6273635662554661*t+.0752914584939979*i,z:.0270313613864123*e+.0706888525358272*t+.9913375368376386*i};return n.alpha!==void 0&&(s.alpha=n.alpha),s},Jn=n=>Math.pow(Math.abs(n),256/563)*Math.sign(n),Ss=({x:n,y:e,z:t,alpha:i})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let s={mode:"a98",r:Jn(n*2.0415879038107465-e*.5650069742788597-.3447313507783297*t),g:Jn(n*-.9692436362808798+e*1.8759675015077206+.0415550574071756*t),b:Jn(n*.0134442806320312-e*.1183623922310184+1.0151749943912058*t)};return i!==void 0&&(s.alpha=i),s},ei=(n=0)=>{const e=Math.abs(n);return e<=.04045?n/12.92:(Math.sign(n)||1)*Math.pow((e+.055)/1.055,2.4)},bt=({r:n,g:e,b:t,alpha:i})=>{let s={mode:"lrgb",r:ei(n),g:ei(e),b:ei(t)};return i!==void 0&&(s.alpha=i),s},Ye=n=>{let{r:e,g:t,b:i,alpha:s}=bt(n),r={mode:"xyz65",x:.4123907992659593*e+.357584339383878*t+.1804807884018343*i,y:.2126390058715102*e+.715168678767756*t+.0721923153607337*i,z:.0193308187155918*e+.119194779794626*t+.9505321522496607*i};return s!==void 0&&(r.alpha=s),r},ti=(n=0)=>{const e=Math.abs(n);return e>.0031308?(Math.sign(n)||1)*(1.055*Math.pow(e,1/2.4)-.055):n*12.92},yt=({r:n,g:e,b:t,alpha:i},s="rgb")=>{let r={mode:s,r:ti(n),g:ti(e),b:ti(t)};return i!==void 0&&(r.alpha=i),r},Ze=({x:n,y:e,z:t,alpha:i})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let s=yt({r:n*3.2409699419045226-e*1.537383177570094-.4986107602930034*t,g:n*-.9692436362808796+e*1.8759675015077204+.0415550574071756*t,b:n*.0556300796969936-e*.2039769588889765+1.0569715142428784*t});return i!==void 0&&(s.alpha=i),s},h0={...xt,mode:"a98",parse:["a98-rgb"],serialize:"a98-rgb",fromMode:{rgb:n=>Ss(Ye(n)),xyz65:Ss},toMode:{rgb:n=>Ze(Cs(n)),xyz65:Cs}},J=n=>(n=n%360)<0?n+360:n,l0=(n,e)=>n.map((t,i,s)=>{if(t===void 0)return t;let r=J(t);return i===0||n[i-1]===void 0?r:e(r-J(s[i-1]))}).reduce((t,i)=>!t.length||i===void 0||t[t.length-1]===void 0?(t.push(i),t):(t.push(i+t[t.length-1]),t),[]),ze=n=>l0(n,e=>Math.abs(e)<=180?e:e-360*Math.sign(e)),G=[-.14861,1.78277,-.29227,-.90649,1.97294,0],c0=Math.PI/180,u0=180/Math.PI;let As=G[3]*G[4],Es=G[1]*G[4],Rs=G[1]*G[2]-G[0]*G[3];const f0=({r:n,g:e,b:t,alpha:i})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let s=(Rs*t+n*As-e*Es)/(Rs+As-Es),r=t-s,a=(G[4]*(e-s)-G[2]*r)/G[3],o={mode:"cubehelix",l:s,s:s===0||s===1?void 0:Math.sqrt(r*r+a*a)/(G[4]*s*(1-s))};return o.s&&(o.h=Math.atan2(a,r)*u0-120),i!==void 0&&(o.alpha=i),o},d0=({h:n,s:e,l:t,alpha:i})=>{let s={mode:"rgb"};n=(n===void 0?0:n+120)*c0,t===void 0&&(t=0);let r=e===void 0?0:e*t*(1-t),a=Math.cos(n),o=Math.sin(n);return s.r=t+r*(G[0]*a+G[1]*o),s.g=t+r*(G[2]*a+G[3]*o),s.b=t+r*(G[4]*a+G[5]*o),i!==void 0&&(s.alpha=i),s},zn=(n,e)=>{if(n.h===void 0||e.h===void 0||!n.s||!e.s)return 0;let t=J(n.h),i=J(e.h),s=Math.sin((i-t+360)/2*Math.PI/180);return 2*Math.sqrt(n.s*e.s)*s},m0=(n,e)=>{if(n.h===void 0||e.h===void 0)return 0;let t=J(n.h),i=J(e.h);return Math.abs(i-t)>180?t-(i-360*Math.sign(i-t)):i-t},Cn=(n,e)=>{if(n.h===void 0||e.h===void 0||!n.c||!e.c)return 0;let t=J(n.h),i=J(e.h),s=Math.sin((i-t+360)/2*Math.PI/180);return 2*Math.sqrt(n.c*e.c)*s},Ce=n=>{let e=n.reduce((i,s)=>{if(s!==void 0){let r=s*Math.PI/180;i.sin+=Math.sin(r),i.cos+=Math.cos(r)}return i},{sin:0,cos:0}),t=Math.atan2(e.sin,e.cos)*180/Math.PI;return t<0?360+t:t},p0={mode:"cubehelix",channels:["h","s","l","alpha"],parse:["--cubehelix"],serialize:"--cubehelix",ranges:{h:[0,360],s:[0,4.614],l:[0,1]},fromMode:{rgb:f0},toMode:{rgb:d0},interpolate:{h:{use:T,fixup:ze},s:T,l:T,alpha:{use:T,fixup:X}},difference:{h:zn},average:{h:Ce}},Ne=({l:n,a:e,b:t,alpha:i},s="lch")=>{e===void 0&&(e=0),t===void 0&&(t=0);let r=Math.sqrt(e*e+t*t),a={mode:s,l:n,c:r};return r&&(a.h=J(Math.atan2(t,e)*180/Math.PI)),i!==void 0&&(a.alpha=i),a},je=({l:n,c:e,h:t,alpha:i},s="lab")=>{t===void 0&&(t=0);let r={mode:s,l:n,a:e?e*Math.cos(t/180*Math.PI):0,b:e?e*Math.sin(t/180*Math.PI):0};return i!==void 0&&(r.alpha=i),r},Vr=Math.pow(29,3)/Math.pow(3,3),Br=Math.pow(6,3)/Math.pow(29,3),H={X:.3457/.3585,Y:1,Z:(1-.3457-.3585)/.3585},ct={X:.3127/.329,Y:1,Z:(1-.3127-.329)/.329};let ni=n=>Math.pow(n,3)>Br?Math.pow(n,3):(116*n-16)/Vr;const Hr=({l:n,a:e,b:t,alpha:i})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let s=(n+16)/116,r=e/500+s,a=s-t/200,o={mode:"xyz65",x:ni(r)*ct.X,y:ni(s)*ct.Y,z:ni(a)*ct.Z};return i!==void 0&&(o.alpha=i),o},Sn=n=>Ze(Hr(n)),ii=n=>n>Br?Math.cbrt(n):(Vr*n+16)/116,Wr=({x:n,y:e,z:t,alpha:i})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let s=ii(n/ct.X),r=ii(e/ct.Y),a=ii(t/ct.Z),o={mode:"lab65",l:116*r-16,a:500*(s-r),b:200*(r-a)};return i!==void 0&&(o.alpha=i),o},An=n=>{let e=Wr(Ye(n));return n.r===n.b&&n.b===n.g&&(e.a=e.b=0),e},pn=1,Xr=1,Ot=26/180*Math.PI,gn=Math.cos(Ot),xn=Math.sin(Ot),qr=100/Math.log(139/100),Ui=({l:n,c:e,h:t,alpha:i})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let s={mode:"lab65",l:(Math.exp(n*pn/qr)-1)/.0039},r=(Math.exp(.0435*e*Xr*pn)-1)/.075,a=r*Math.cos(t/180*Math.PI-Ot),o=r*Math.sin(t/180*Math.PI-Ot);return s.a=a*gn-o/.83*xn,s.b=a*xn+o/.83*gn,i!==void 0&&(s.alpha=i),s},$i=({l:n,a:e,b:t,alpha:i})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let s=e*gn+t*xn,r=.83*(t*gn-e*xn),a=Math.sqrt(s*s+r*r),o={mode:"dlch",l:qr/pn*Math.log(1+.0039*n),c:Math.log(1+.075*a)/(.0435*Xr*pn)};return o.c&&(o.h=J((Math.atan2(r,s)+Ot)/Math.PI*180)),i!==void 0&&(o.alpha=i),o},Is=n=>Ui(Ne(n,"dlch")),Fs=n=>je($i(n),"dlab"),g0={mode:"dlab",parse:["--din99o-lab"],serialize:"--din99o-lab",toMode:{lab65:Is,rgb:n=>Sn(Is(n))},fromMode:{lab65:Fs,rgb:n=>Fs(An(n))},channels:["l","a","b","alpha"],ranges:{l:[0,100],a:[-40.09,45.501],b:[-40.469,44.344]},interpolate:{l:T,a:T,b:T,alpha:{use:T,fixup:X}}},x0={mode:"dlch",parse:["--din99o-lch"],serialize:"--din99o-lch",toMode:{lab65:Ui,dlab:n=>je(n,"dlab"),rgb:n=>Sn(Ui(n))},fromMode:{lab65:$i,dlab:n=>Ne(n,"dlch"),rgb:n=>$i(An(n))},channels:["l","c","h","alpha"],ranges:{l:[0,100],c:[0,51.484],h:[0,360]},interpolate:{l:T,c:T,h:{use:T,fixup:ze},alpha:{use:T,fixup:X}},difference:{h:Cn},average:{h:Ce}};function b0({h:n,s:e,i:t,alpha:i}){n=J(n!==void 0?n:0),e===void 0&&(e=0),t===void 0&&(t=0);let s=Math.abs(n/60%2-1),r;switch(Math.floor(n/60)){case 0:r={r:t*(1+e*(3/(2-s)-1)),g:t*(1+e*(3*(1-s)/(2-s)-1)),b:t*(1-e)};break;case 1:r={r:t*(1+e*(3*(1-s)/(2-s)-1)),g:t*(1+e*(3/(2-s)-1)),b:t*(1-e)};break;case 2:r={r:t*(1-e),g:t*(1+e*(3/(2-s)-1)),b:t*(1+e*(3*(1-s)/(2-s)-1))};break;case 3:r={r:t*(1-e),g:t*(1+e*(3*(1-s)/(2-s)-1)),b:t*(1+e*(3/(2-s)-1))};break;case 4:r={r:t*(1+e*(3*(1-s)/(2-s)-1)),g:t*(1-e),b:t*(1+e*(3/(2-s)-1))};break;case 5:r={r:t*(1+e*(3/(2-s)-1)),g:t*(1-e),b:t*(1+e*(3*(1-s)/(2-s)-1))};break;default:r={r:t*(1-e),g:t*(1-e),b:t*(1-e)}}return r.mode="rgb",i!==void 0&&(r.alpha=i),r}function y0({r:n,g:e,b:t,alpha:i}){n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let s=Math.max(n,e,t),r=Math.min(n,e,t),a={mode:"hsi",s:n+e+t===0?0:1-3*r/(n+e+t),i:(n+e+t)/3};return s-r!==0&&(a.h=(s===n?(e-t)/(s-r)+(e<t)*6:s===e?(t-n)/(s-r)+2:(n-e)/(s-r)+4)*60),i!==void 0&&(a.alpha=i),a}const v0={mode:"hsi",toMode:{rgb:b0},parse:["--hsi"],serialize:"--hsi",fromMode:{rgb:y0},channels:["h","s","i","alpha"],ranges:{h:[0,360]},gamut:"rgb",interpolate:{h:{use:T,fixup:ze},s:T,i:T,alpha:{use:T,fixup:X}},difference:{h:zn},average:{h:Ce}};function _0({h:n,s:e,l:t,alpha:i}){n=J(n!==void 0?n:0),e===void 0&&(e=0),t===void 0&&(t=0);let s=t+e*(t<.5?t:1-t),r=s-(s-t)*2*Math.abs(n/60%2-1),a;switch(Math.floor(n/60)){case 0:a={r:s,g:r,b:2*t-s};break;case 1:a={r,g:s,b:2*t-s};break;case 2:a={r:2*t-s,g:s,b:r};break;case 3:a={r:2*t-s,g:r,b:s};break;case 4:a={r,g:2*t-s,b:s};break;case 5:a={r:s,g:2*t-s,b:r};break;default:a={r:2*t-s,g:2*t-s,b:2*t-s}}return a.mode="rgb",i!==void 0&&(a.alpha=i),a}function M0({r:n,g:e,b:t,alpha:i}){n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let s=Math.max(n,e,t),r=Math.min(n,e,t),a={mode:"hsl",s:s===r?0:(s-r)/(1-Math.abs(s+r-1)),l:.5*(s+r)};return s-r!==0&&(a.h=(s===n?(e-t)/(s-r)+(e<t)*6:s===e?(t-n)/(s-r)+2:(n-e)/(s-r)+4)*60),i!==void 0&&(a.alpha=i),a}const w0=(n,e)=>{switch(e){case"deg":return+n;case"rad":return n/Math.PI*180;case"grad":return n/10*9;case"turn":return n*360}},T0=new RegExp(`^hsla?\\(\\s*${Ho}${dt}${It}${dt}${It}\\s*(?:,\\s*${ns}\\s*)?\\)$`),k0=n=>{let e=n.match(T0);if(!e)return;let t={mode:"hsl"};return e[3]!==void 0?t.h=+e[3]:e[1]!==void 0&&e[2]!==void 0&&(t.h=w0(e[1],e[2])),e[4]!==void 0&&(t.s=Math.min(Math.max(0,e[4]/100),1)),e[5]!==void 0&&(t.l=Math.min(Math.max(0,e[5]/100),1)),e[6]!==void 0?t.alpha=Math.max(0,Math.min(1,e[6]/100)):e[7]!==void 0&&(t.alpha=Math.max(0,Math.min(1,+e[7]))),t};function z0(n,e){if(!e||e[0]!=="hsl"&&e[0]!=="hsla")return;const t={mode:"hsl"},[,i,s,r,a]=e;if(i.type!==_.None){if(i.type===_.Percentage)return;t.h=i.value}if(s.type!==_.None){if(s.type===_.Hue)return;t.s=s.value/100}if(r.type!==_.None){if(r.type===_.Hue)return;t.l=r.value/100}return a.type!==_.None&&(t.alpha=Math.min(1,Math.max(0,a.type===_.Number?a.value:a.value/100))),t}const Yr={mode:"hsl",toMode:{rgb:_0},fromMode:{rgb:M0},channels:["h","s","l","alpha"],ranges:{h:[0,360]},gamut:"rgb",parse:[z0,k0],serialize:n=>`hsl(${n.h!==void 0?n.h:"none"} ${n.s!==void 0?n.s*100+"%":"none"} ${n.l!==void 0?n.l*100+"%":"none"}${n.alpha<1?` / ${n.alpha}`:""})`,interpolate:{h:{use:T,fixup:ze},s:T,l:T,alpha:{use:T,fixup:X}},difference:{h:zn},average:{h:Ce}};function Zr({h:n,s:e,v:t,alpha:i}){n=J(n!==void 0?n:0),e===void 0&&(e=0),t===void 0&&(t=0);let s=Math.abs(n/60%2-1),r;switch(Math.floor(n/60)){case 0:r={r:t,g:t*(1-e*s),b:t*(1-e)};break;case 1:r={r:t*(1-e*s),g:t,b:t*(1-e)};break;case 2:r={r:t*(1-e),g:t,b:t*(1-e*s)};break;case 3:r={r:t*(1-e),g:t*(1-e*s),b:t};break;case 4:r={r:t*(1-e*s),g:t*(1-e),b:t};break;case 5:r={r:t,g:t*(1-e),b:t*(1-e*s)};break;default:r={r:t*(1-e),g:t*(1-e),b:t*(1-e)}}return r.mode="rgb",i!==void 0&&(r.alpha=i),r}function Gr({r:n,g:e,b:t,alpha:i}){n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let s=Math.max(n,e,t),r=Math.min(n,e,t),a={mode:"hsv",s:s===0?0:1-r/s,v:s};return s-r!==0&&(a.h=(s===n?(e-t)/(s-r)+(e<t)*6:s===e?(t-n)/(s-r)+2:(n-e)/(s-r)+4)*60),i!==void 0&&(a.alpha=i),a}const Kr={mode:"hsv",toMode:{rgb:Zr},parse:["--hsv"],serialize:"--hsv",fromMode:{rgb:Gr},channels:["h","s","v","alpha"],ranges:{h:[0,360]},gamut:"rgb",interpolate:{h:{use:T,fixup:ze},s:T,v:T,alpha:{use:T,fixup:X}},difference:{h:zn},average:{h:Ce}};function C0({h:n,w:e,b:t,alpha:i}){if(e===void 0&&(e=0),t===void 0&&(t=0),e+t>1){let s=e+t;e/=s,t/=s}return Zr({h:n,s:t===1?1:1-e/(1-t),v:1-t,alpha:i})}function S0(n){let e=Gr(n);if(e===void 0)return;let t=e.s!==void 0?e.s:0,i=e.v!==void 0?e.v:0,s={mode:"hwb",w:(1-t)*i,b:1-i};return e.h!==void 0&&(s.h=e.h),e.alpha!==void 0&&(s.alpha=e.alpha),s}function A0(n,e){if(!e||e[0]!=="hwb")return;const t={mode:"hwb"},[,i,s,r,a]=e;if(i.type!==_.None){if(i.type===_.Percentage)return;t.h=i.value}if(s.type!==_.None){if(s.type===_.Hue)return;t.w=s.value/100}if(r.type!==_.None){if(r.type===_.Hue)return;t.b=r.value/100}return a.type!==_.None&&(t.alpha=Math.min(1,Math.max(0,a.type===_.Number?a.value:a.value/100))),t}const E0={mode:"hwb",toMode:{rgb:C0},fromMode:{rgb:S0},channels:["h","w","b","alpha"],ranges:{h:[0,360]},gamut:"rgb",parse:[A0],serialize:n=>`hwb(${n.h!==void 0?n.h:"none"} ${n.w!==void 0?n.w*100+"%":"none"} ${n.b!==void 0?n.b*100+"%":"none"}${n.alpha<1?` / ${n.alpha}`:""})`,interpolate:{h:{use:T,fixup:ze},w:T,b:T,alpha:{use:T,fixup:X}},difference:{h:m0},average:{h:Ce}},Qr=203,En=.1593017578125,Jr=78.84375,Rn=.8359375,In=18.8515625,Fn=18.6875;function si(n){if(n<0)return 0;const e=Math.pow(n,1/Jr);return 1e4*Math.pow(Math.max(0,e-Rn)/(In-Fn*e),1/En)}function ri(n){if(n<0)return 0;const e=Math.pow(n/1e4,En);return Math.pow((Rn+In*e)/(1+Fn*e),Jr)}const ai=n=>Math.max(n/Qr,0),Os=({i:n,t:e,p:t,alpha:i})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);const s=si(n+.008609037037932761*e+.11102962500302593*t),r=si(n-.00860903703793275*e-.11102962500302599*t),a=si(n+.5600313357106791*e-.32062717498731885*t),o={mode:"xyz65",x:ai(2.070152218389422*s-1.3263473389671556*r+.2066510476294051*a),y:ai(.3647385209748074*s+.680566024947227*r-.0453045459220346*a),z:ai(-.049747207535812*s-.0492609666966138*r+1.1880659249923042*a)};return i!==void 0&&(o.alpha=i),o},oi=(n=0)=>Math.max(n*Qr,0),Ps=({x:n,y:e,z:t,alpha:i})=>{const s=oi(n),r=oi(e),a=oi(t),o=ri(.3592832590121217*s+.6976051147779502*r-.0358915932320289*a),h=ri(-.1920808463704995*s+1.1004767970374323*r+.0753748658519118*a),l=ri(.0070797844607477*s+.0748396662186366*r+.8433265453898765*a),c=.5*o+.5*h,u=1.61376953125*o-3.323486328125*h+1.709716796875*l,f=4.378173828125*o-4.24560546875*h-.132568359375*l,d={mode:"itp",i:c,t:u,p:f};return i!==void 0&&(d.alpha=i),d},R0={mode:"itp",channels:["i","t","p","alpha"],parse:["--ictcp"],serialize:"--ictcp",toMode:{xyz65:Os,rgb:n=>Ze(Os(n))},fromMode:{xyz65:Ps,rgb:n=>Ps(Ye(n))},ranges:{i:[0,.581],t:[-.369,.272],p:[-.164,.331]},interpolate:{i:T,t:T,p:T,alpha:{use:T,fixup:X}}},I0=134.03437499999998,F0=16295499532821565e-27,hi=n=>{if(n<0)return 0;let e=Math.pow(n/1e4,En);return Math.pow((Rn+In*e)/(1+Fn*e),I0)},li=(n=0)=>Math.max(n*203,0),ea=({x:n,y:e,z:t,alpha:i})=>{n=li(n),e=li(e),t=li(t);let s=1.15*n-.15*t,r=.66*e+.34*n,a=hi(.41478972*s+.579999*r+.014648*t),o=hi(-.20151*s+1.120649*r+.0531008*t),h=hi(-.0166008*s+.2648*r+.6684799*t),l=(a+o)/2,c={mode:"jab",j:.44*l/(1-.56*l)-F0,a:3.524*a-4.066708*o+.542708*h,b:.199076*a+1.096799*o-1.295875*h};return i!==void 0&&(c.alpha=i),c},O0=134.03437499999998,Ds=16295499532821565e-27,ci=n=>{if(n<0)return 0;let e=Math.pow(n,1/O0);return 1e4*Math.pow((Rn-e)/(Fn*e-In),1/En)},ui=n=>n/203,ta=({j:n,a:e,b:t,alpha:i})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let s=(n+Ds)/(.44+.56*(n+Ds)),r=ci(s+.13860504*e+.058047316*t),a=ci(s-.13860504*e-.058047316*t),o=ci(s-.096019242*e-.8118919*t),h={mode:"xyz65",x:ui(1.661373024652174*r-.914523081304348*a+.23136208173913045*o),y:ui(-.3250758611844533*r+1.571847026732543*a-.21825383453227928*o),z:ui(-.090982811*r-.31272829*a+1.5227666*o)};return i!==void 0&&(h.alpha=i),h},na=n=>{let e=ea(Ye(n));return n.r===n.b&&n.b===n.g&&(e.a=e.b=0),e},ia=n=>Ze(ta(n)),P0={mode:"jab",channels:["j","a","b","alpha"],parse:["--jzazbz"],serialize:"--jzazbz",fromMode:{rgb:na,xyz65:ea},toMode:{rgb:ia,xyz65:ta},ranges:{j:[0,.222],a:[-.109,.129],b:[-.185,.134]},interpolate:{j:T,a:T,b:T,alpha:{use:T,fixup:X}}},Ns=({j:n,a:e,b:t,alpha:i})=>{e===void 0&&(e=0),t===void 0&&(t=0);let s=Math.sqrt(e*e+t*t),r={mode:"jch",j:n,c:s};return s&&(r.h=J(Math.atan2(t,e)*180/Math.PI)),i!==void 0&&(r.alpha=i),r},js=({j:n,c:e,h:t,alpha:i})=>{t===void 0&&(t=0);let s={mode:"jab",j:n,a:e?e*Math.cos(t/180*Math.PI):0,b:e?e*Math.sin(t/180*Math.PI):0};return i!==void 0&&(s.alpha=i),s},D0={mode:"jch",parse:["--jzczhz"],serialize:"--jzczhz",toMode:{jab:js,rgb:n=>ia(js(n))},fromMode:{rgb:n=>Ns(na(n)),jab:Ns},channels:["j","c","h","alpha"],ranges:{j:[0,.221],c:[0,.19],h:[0,360]},interpolate:{h:{use:T,fixup:ze},c:T,j:T,alpha:{use:T,fixup:X}},difference:{h:Cn},average:{h:Ce}},On=Math.pow(29,3)/Math.pow(3,3),is=Math.pow(6,3)/Math.pow(29,3);let fi=n=>Math.pow(n,3)>is?Math.pow(n,3):(116*n-16)/On;const ss=({l:n,a:e,b:t,alpha:i})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let s=(n+16)/116,r=e/500+s,a=s-t/200,o={mode:"xyz50",x:fi(r)*H.X,y:fi(s)*H.Y,z:fi(a)*H.Z};return i!==void 0&&(o.alpha=i),o},$t=({x:n,y:e,z:t,alpha:i})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let s=yt({r:n*3.1341359569958707-e*1.6173863321612538-.4906619460083532*t,g:n*-.978795502912089+e*1.916254567259524+.03344273116131949*t,b:n*.07195537988411677-e*.2289768264158322+1.405386058324125*t});return i!==void 0&&(s.alpha=i),s},sa=n=>$t(ss(n)),Vt=n=>{let{r:e,g:t,b:i,alpha:s}=bt(n),r={mode:"xyz50",x:.436065742824811*e+.3851514688337912*t+.14307845442264197*i,y:.22249319175623702*e+.7168870538238823*t+.06061979053616537*i,z:.013923904500943465*e+.09708128566574634*t+.7140993584005155*i};return s!==void 0&&(r.alpha=s),r},di=n=>n>is?Math.cbrt(n):(On*n+16)/116,rs=({x:n,y:e,z:t,alpha:i})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let s=di(n/H.X),r=di(e/H.Y),a=di(t/H.Z),o={mode:"lab",l:116*r-16,a:500*(s-r),b:200*(r-a)};return i!==void 0&&(o.alpha=i),o},ra=n=>{let e=rs(Vt(n));return n.r===n.b&&n.b===n.g&&(e.a=e.b=0),e};function N0(n,e){if(!e||e[0]!=="lab")return;const t={mode:"lab"},[,i,s,r,a]=e;if(!(i.type===_.Hue||s.type===_.Hue||r.type===_.Hue))return i.type!==_.None&&(t.l=Math.min(Math.max(0,i.value),100)),s.type!==_.None&&(t.a=s.type===_.Number?s.value:s.value*125/100),r.type!==_.None&&(t.b=r.type===_.Number?r.value:r.value*125/100),a.type!==_.None&&(t.alpha=Math.min(1,Math.max(0,a.type===_.Number?a.value:a.value/100))),t}const as={mode:"lab",toMode:{xyz50:ss,rgb:sa},fromMode:{xyz50:rs,rgb:ra},channels:["l","a","b","alpha"],ranges:{l:[0,100],a:[-125,125],b:[-125,125]},parse:[N0],serialize:n=>`lab(${n.l!==void 0?n.l:"none"} ${n.a!==void 0?n.a:"none"} ${n.b!==void 0?n.b:"none"}${n.alpha<1?` / ${n.alpha}`:""})`,interpolate:{l:T,a:T,b:T,alpha:{use:T,fixup:X}}},j0={...as,mode:"lab65",parse:["--lab-d65"],serialize:"--lab-d65",toMode:{xyz65:Hr,rgb:Sn},fromMode:{xyz65:Wr,rgb:An},ranges:{l:[0,100],a:[-125,125],b:[-125,125]}};function L0(n,e){if(!e||e[0]!=="lch")return;const t={mode:"lch"},[,i,s,r,a]=e;if(i.type!==_.None){if(i.type===_.Hue)return;t.l=Math.min(Math.max(0,i.value),100)}if(s.type!==_.None&&(t.c=Math.max(0,s.type===_.Number?s.value:s.value*150/100)),r.type!==_.None){if(r.type===_.Percentage)return;t.h=r.value}return a.type!==_.None&&(t.alpha=Math.min(1,Math.max(0,a.type===_.Number?a.value:a.value/100))),t}const os={mode:"lch",toMode:{lab:je,rgb:n=>sa(je(n))},fromMode:{rgb:n=>Ne(ra(n)),lab:Ne},channels:["l","c","h","alpha"],ranges:{l:[0,100],c:[0,150],h:[0,360]},parse:[L0],serialize:n=>`lch(${n.l!==void 0?n.l:"none"} ${n.c!==void 0?n.c:"none"} ${n.h!==void 0?n.h:"none"}${n.alpha<1?` / ${n.alpha}`:""})`,interpolate:{h:{use:T,fixup:ze},c:T,l:T,alpha:{use:T,fixup:X}},difference:{h:Cn},average:{h:Ce}},U0={...os,mode:"lch65",parse:["--lch-d65"],serialize:"--lch-d65",toMode:{lab65:n=>je(n,"lab65"),rgb:n=>Sn(je(n,"lab65"))},fromMode:{rgb:n=>Ne(An(n),"lch65"),lab65:n=>Ne(n,"lch65")},ranges:{l:[0,100],c:[0,150],h:[0,360]}},aa=({l:n,u:e,v:t,alpha:i})=>{e===void 0&&(e=0),t===void 0&&(t=0);let s=Math.sqrt(e*e+t*t),r={mode:"lchuv",l:n,c:s};return s&&(r.h=J(Math.atan2(t,e)*180/Math.PI)),i!==void 0&&(r.alpha=i),r},oa=({l:n,c:e,h:t,alpha:i})=>{t===void 0&&(t=0);let s={mode:"luv",l:n,u:e?e*Math.cos(t/180*Math.PI):0,v:e?e*Math.sin(t/180*Math.PI):0};return i!==void 0&&(s.alpha=i),s},ha=(n,e,t)=>4*n/(n+15*e+3*t),la=(n,e,t)=>9*e/(n+15*e+3*t),$0=ha(H.X,H.Y,H.Z),V0=la(H.X,H.Y,H.Z),B0=n=>n<=is?On*n:116*Math.cbrt(n)-16,Vi=({x:n,y:e,z:t,alpha:i})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let s=B0(e/H.Y),r=ha(n,e,t),a=la(n,e,t);!isFinite(r)||!isFinite(a)?s=r=a=0:(r=13*s*(r-$0),a=13*s*(a-V0));let o={mode:"luv",l:s,u:r,v:a};return i!==void 0&&(o.alpha=i),o},H0=(n,e,t)=>4*n/(n+15*e+3*t),W0=(n,e,t)=>9*e/(n+15*e+3*t),X0=H0(H.X,H.Y,H.Z),q0=W0(H.X,H.Y,H.Z),Bi=({l:n,u:e,v:t,alpha:i})=>{if(n===void 0&&(n=0),n===0)return{mode:"xyz50",x:0,y:0,z:0};e===void 0&&(e=0),t===void 0&&(t=0);let s=e/(13*n)+X0,r=t/(13*n)+q0,a=H.Y*(n<=8?n/On:Math.pow((n+16)/116,3)),o=a*(9*s)/(4*r),h=a*(12-3*s-20*r)/(4*r),l={mode:"xyz50",x:o,y:a,z:h};return i!==void 0&&(l.alpha=i),l},Y0=n=>aa(Vi(Vt(n))),Z0=n=>$t(Bi(oa(n))),G0={mode:"lchuv",toMode:{luv:oa,rgb:Z0},fromMode:{rgb:Y0,luv:aa},channels:["l","c","h","alpha"],parse:["--lchuv"],serialize:"--lchuv",ranges:{l:[0,100],c:[0,176.956],h:[0,360]},interpolate:{h:{use:T,fixup:ze},c:T,l:T,alpha:{use:T,fixup:X}},difference:{h:Cn},average:{h:Ce}},K0={...xt,mode:"lrgb",toMode:{rgb:yt},fromMode:{rgb:bt},parse:["srgb-linear"],serialize:"srgb-linear"},Q0={mode:"luv",toMode:{xyz50:Bi,rgb:n=>$t(Bi(n))},fromMode:{xyz50:Vi,rgb:n=>Vi(Vt(n))},channels:["l","u","v","alpha"],parse:["--luv"],serialize:"--luv",ranges:{l:[0,100],u:[-84.936,175.042],v:[-125.882,87.243]},interpolate:{l:T,u:T,v:T,alpha:{use:T,fixup:X}}},ca=({r:n,g:e,b:t,alpha:i})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let s=Math.cbrt(.412221469470763*n+.5363325372617348*e+.0514459932675022*t),r=Math.cbrt(.2119034958178252*n+.6806995506452344*e+.1073969535369406*t),a=Math.cbrt(.0883024591900564*n+.2817188391361215*e+.6299787016738222*t),o={mode:"oklab",l:.210454268309314*s+.7936177747023054*r-.0040720430116193*a,a:1.9779985324311684*s-2.42859224204858*r+.450593709617411*a,b:.0259040424655478*s+.7827717124575296*r-.8086757549230774*a};return i!==void 0&&(o.alpha=i),o},Pn=n=>{let e=ca(bt(n));return n.r===n.b&&n.b===n.g&&(e.a=e.b=0),e},Bt=({l:n,a:e,b:t,alpha:i})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let s=Math.pow(n+.3963377773761749*e+.2158037573099136*t,3),r=Math.pow(n-.1055613458156586*e-.0638541728258133*t,3),a=Math.pow(n-.0894841775298119*e-1.2914855480194092*t,3),o={mode:"lrgb",r:4.076741636075957*s-3.3077115392580616*r+.2309699031821044*a,g:-1.2684379732850317*s+2.6097573492876887*r-.3413193760026573*a,b:-.0041960761386756*s-.7034186179359362*r+1.7076146940746117*a};return i!==void 0&&(o.alpha=i),o},Dn=n=>yt(Bt(n));function Hi(n){const i=1.170873786407767;return .5*(i*n-.206+Math.sqrt((i*n-.206)*(i*n-.206)+4*.03*i*n))}function bn(n){return(n*n+.206*n)/(1.170873786407767*(n+.03))}function J0(n,e){let t,i,s,r,a,o,h,l;-1.88170328*n-.80936493*e>1?(t=1.19086277,i=1.76576728,s=.59662641,r=.75515197,a=.56771245,o=4.0767416621,h=-3.3077115913,l=.2309699292):1.81444104*n-1.19445276*e>1?(t=.73956515,i=-.45954404,s=.08285427,r=.1254107,a=.14503204,o=-1.2684380046,h=2.6097574011,l=-.3413193965):(t=1.35733652,i=-.00915799,s=-1.1513021,r=-.50559606,a=.00692167,o=-.0041960863,h=-.7034186147,l=1.707614701);let c=t+i*n+s*e+r*n*n+a*n*e,u=.3963377774*n+.2158037573*e,f=-.1055613458*n-.0638541728*e,d=-.0894841775*n-1.291485548*e;{let m=1+c*u,x=1+c*f,g=1+c*d,p=m*m*m,y=x*x*x,b=g*g*g,v=3*u*m*m,z=3*f*x*x,C=3*d*g*g,k=6*u*u*m,R=6*f*f*x,S=6*d*d*g,A=o*p+h*y+l*b,D=o*v+h*z+l*C,F=o*k+h*R+l*S;c=c-A*D/(D*D-.5*A*F)}return c}function hs(n,e){let t=J0(n,e),i=Bt({l:1,a:t*n,b:t*e}),s=Math.cbrt(1/Math.max(i.r,i.g,i.b)),r=s*t;return[s,r]}function eh(n,e,t,i,s,r=null){r||(r=hs(n,e));let a;if((t-s)*r[1]-(r[0]-s)*i<=0)a=r[1]*s/(i*r[0]+r[1]*(s-t));else{a=r[1]*(s-1)/(i*(r[0]-1)+r[1]*(s-t));{let o=t-s,h=i,l=.3963377774*n+.2158037573*e,c=-.1055613458*n-.0638541728*e,u=-.0894841775*n-1.291485548*e,f=o+h*l,d=o+h*c,m=o+h*u;{let x=s*(1-a)+a*t,g=a*i,p=x+g*l,y=x+g*c,b=x+g*u,v=p*p*p,z=y*y*y,C=b*b*b,k=3*f*p*p,R=3*d*y*y,S=3*m*b*b,A=6*f*f*p,D=6*d*d*y,F=6*m*m*b,B=4.0767416621*v-3.3077115913*z+.2309699292*C-1,q=4.0767416621*k-3.3077115913*R+.2309699292*S,se=4.0767416621*A-3.3077115913*D+.2309699292*F,re=q/(q*q-.5*B*se),ae=-B*re,ue=-1.2684380046*v+2.6097574011*z-.3413193965*C-1,oe=-1.2684380046*k+2.6097574011*R-.3413193965*S,be=-1.2684380046*A+2.6097574011*D-.3413193965*F,ye=oe/(oe*oe-.5*ue*be),_t=-ue*ye,j=-.0041960863*v-.7034186147*z+1.707614701*C-1,ee=-.0041960863*k-.7034186147*R+1.707614701*S,pe=-.0041960863*A-.7034186147*D+1.707614701*F,Se=ee/(ee*ee-.5*j*pe),Me=-j*Se;ae=re>=0?ae:1e6,_t=ye>=0?_t:1e6,Me=Se>=0?Me:1e6,a+=Math.min(ae,Math.min(_t,Me))}}}return a}function ls(n,e,t=null){t||(t=hs(n,e));let i=t[0],s=t[1];return[s/i,s/(1-i)]}function ua(n,e,t){let i=hs(e,t),s=eh(e,t,n,1,n,i),r=ls(e,t,i),a=.11516993+1/(7.4477897+4.1590124*t+e*(-2.19557347+1.75198401*t+e*(-2.13704948-10.02301043*t+e*(-4.24894561+5.38770819*t+4.69891013*e)))),o=.11239642+1/(1.6132032-.68124379*t+e*(.40370612+.90148123*t+e*(-.27087943+.6122399*t+e*(.00299215-.45399568*t-.14661872*e)))),h=s/Math.min(n*r[0],(1-n)*r[1]),l=n*a,c=(1-n)*o,u=.9*h*Math.sqrt(Math.sqrt(1/(1/(l*l*l*l)+1/(c*c*c*c))));return l=n*.4,c=(1-n)*.8,[Math.sqrt(1/(1/(l*l)+1/(c*c))),u,s]}function Ls(n){const e=n.l!==void 0?n.l:0,t=n.a!==void 0?n.a:0,i=n.b!==void 0?n.b:0,s={mode:"okhsl",l:Hi(e)};n.alpha!==void 0&&(s.alpha=n.alpha);let r=Math.sqrt(t*t+i*i);if(!r)return s.s=0,s;let[a,o,h]=ua(e,t/r,i/r),l;if(r<o){let c=0,u=.8*a,f=1-u/o;l=(r-c)/(u+f*(r-c))*.8}else{let c=o,u=.2*o*o*1.25*1.25/a,f=1-u/(h-o);l=.8+.2*((r-c)/(u+f*(r-c)))}return l&&(s.s=l,s.h=J(Math.atan2(i,t)*180/Math.PI)),s}function Us(n){let e=n.h!==void 0?n.h:0,t=n.s!==void 0?n.s:0,i=n.l!==void 0?n.l:0;const s={mode:"oklab",l:bn(i)};if(n.alpha!==void 0&&(s.alpha=n.alpha),!t||i===1)return s.a=s.b=0,s;let r=Math.cos(e/180*Math.PI),a=Math.sin(e/180*Math.PI),[o,h,l]=ua(s.l,r,a),c,u,f,d;t<.8?(c=1.25*t,u=0,f=.8*o,d=1-f/h):(c=5*(t-.8),u=h,f=.2*h*h*1.25*1.25/o,d=1-f/(l-h));let m=u+c*f/(1-d*c);return s.a=m*r,s.b=m*a,s}const th={...Yr,mode:"okhsl",channels:["h","s","l","alpha"],parse:["--okhsl"],serialize:"--okhsl",fromMode:{oklab:Ls,rgb:n=>Ls(Pn(n))},toMode:{oklab:Us,rgb:n=>Dn(Us(n))}};function $s(n){let e=n.l!==void 0?n.l:0,t=n.a!==void 0?n.a:0,i=n.b!==void 0?n.b:0,s=Math.sqrt(t*t+i*i),r=s?t/s:1,a=s?i/s:1,[o,h]=ls(r,a),l=.5,c=1-l/o,u=h/(s+e*h),f=u*e,d=u*s,m=bn(f),x=d*m/f,g=Bt({l:m,a:r*x,b:a*x}),p=Math.cbrt(1/Math.max(g.r,g.g,g.b,0));e=e/p,s=s/p*Hi(e)/e,e=Hi(e);const y={mode:"okhsv",s:s?(l+h)*d/(h*l+h*c*d):0,v:e?e/f:0};return y.s&&(y.h=J(Math.atan2(i,t)*180/Math.PI)),n.alpha!==void 0&&(y.alpha=n.alpha),y}function Vs(n){const e={mode:"oklab"};n.alpha!==void 0&&(e.alpha=n.alpha);const t=n.h!==void 0?n.h:0,i=n.s!==void 0?n.s:0,s=n.v!==void 0?n.v:0,r=Math.cos(t/180*Math.PI),a=Math.sin(t/180*Math.PI),[o,h]=ls(r,a),l=.5,c=1-l/o,u=1-i*l/(l+h-h*c*i),f=i*h*l/(l+h-h*c*i),d=bn(u),m=f*d/u,x=Bt({l:d,a:r*m,b:a*m}),g=Math.cbrt(1/Math.max(x.r,x.g,x.b,0)),p=bn(s*u),y=f*p/u;return e.l=p*g,e.a=y*r*g,e.b=y*a*g,e}const nh={...Kr,mode:"okhsv",channels:["h","s","v","alpha"],parse:["--okhsv"],serialize:"--okhsv",fromMode:{oklab:$s,rgb:n=>$s(Pn(n))},toMode:{oklab:Vs,rgb:n=>Dn(Vs(n))}};function ih(n,e){if(!e||e[0]!=="oklab")return;const t={mode:"oklab"},[,i,s,r,a]=e;if(!(i.type===_.Hue||s.type===_.Hue||r.type===_.Hue))return i.type!==_.None&&(t.l=Math.min(Math.max(0,i.type===_.Number?i.value:i.value/100),1)),s.type!==_.None&&(t.a=s.type===_.Number?s.value:s.value*.4/100),r.type!==_.None&&(t.b=r.type===_.Number?r.value:r.value*.4/100),a.type!==_.None&&(t.alpha=Math.min(1,Math.max(0,a.type===_.Number?a.value:a.value/100))),t}const sh={...as,mode:"oklab",toMode:{lrgb:Bt,rgb:Dn},fromMode:{lrgb:ca,rgb:Pn},ranges:{l:[0,1],a:[-.4,.4],b:[-.4,.4]},parse:[ih],serialize:n=>`oklab(${n.l!==void 0?n.l:"none"} ${n.a!==void 0?n.a:"none"} ${n.b!==void 0?n.b:"none"}${n.alpha<1?` / ${n.alpha}`:""})`};function rh(n,e){if(!e||e[0]!=="oklch")return;const t={mode:"oklch"},[,i,s,r,a]=e;if(i.type!==_.None){if(i.type===_.Hue)return;t.l=Math.min(Math.max(0,i.type===_.Number?i.value:i.value/100),1)}if(s.type!==_.None&&(t.c=Math.max(0,s.type===_.Number?s.value:s.value*.4/100)),r.type!==_.None){if(r.type===_.Percentage)return;t.h=r.value}return a.type!==_.None&&(t.alpha=Math.min(1,Math.max(0,a.type===_.Number?a.value:a.value/100))),t}const ah={...os,mode:"oklch",toMode:{oklab:n=>je(n,"oklab"),rgb:n=>Dn(je(n,"oklab"))},fromMode:{rgb:n=>Ne(Pn(n),"oklch"),oklab:n=>Ne(n,"oklch")},parse:[rh],serialize:n=>`oklch(${n.l!==void 0?n.l:"none"} ${n.c!==void 0?n.c:"none"} ${n.h!==void 0?n.h:"none"}${n.alpha<1?` / ${n.alpha}`:""})`,ranges:{l:[0,1],c:[0,.4],h:[0,360]}},Bs=n=>{let{r:e,g:t,b:i,alpha:s}=bt(n),r={mode:"xyz65",x:.486570948648216*e+.265667693169093*t+.1982172852343625*i,y:.2289745640697487*e+.6917385218365062*t+.079286914093745*i,z:0*e+.0451133818589026*t+1.043944368900976*i};return s!==void 0&&(r.alpha=s),r},Hs=({x:n,y:e,z:t,alpha:i})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let s=yt({r:n*2.4934969119414263-e*.9313836179191242-.402710784450717*t,g:n*-.8294889695615749+e*1.7626640603183465+.0236246858419436*t,b:n*.0358458302437845-e*.0761723892680418+.9568845240076871*t},"p3");return i!==void 0&&(s.alpha=i),s},oh={...xt,mode:"p3",parse:["display-p3"],serialize:"display-p3",fromMode:{rgb:n=>Hs(Ye(n)),xyz65:Hs},toMode:{rgb:n=>Ze(Bs(n)),xyz65:Bs}},mi=n=>{let e=Math.abs(n);return e>=1/512?Math.sign(n)*Math.pow(e,1/1.8):16*n},Ws=({x:n,y:e,z:t,alpha:i})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let s={mode:"prophoto",r:mi(n*1.3457868816471585-e*.2555720873797946-.0511018649755453*t),g:mi(n*-.5446307051249019+e*1.5082477428451466+.0205274474364214*t),b:mi(n*0+e*0+1.2119675456389452*t)};return i!==void 0&&(s.alpha=i),s},pi=(n=0)=>{let e=Math.abs(n);return e>=16/512?Math.sign(n)*Math.pow(e,1.8):n/16},Xs=n=>{let e=pi(n.r),t=pi(n.g),i=pi(n.b),s={mode:"xyz50",x:.7977666449006423*e+.1351812974005331*t+.0313477341283922*i,y:.2880748288194013*e+.7118352342418731*t+899369387256e-16*i,z:0*e+0*t+.8251046025104602*i};return n.alpha!==void 0&&(s.alpha=n.alpha),s},hh={...xt,mode:"prophoto",parse:["prophoto-rgb"],serialize:"prophoto-rgb",fromMode:{xyz50:Ws,rgb:n=>Ws(Vt(n))},toMode:{xyz50:Xs,rgb:n=>$t(Xs(n))}},qs=1.09929682680944,lh=.018053968510807,gi=n=>{const e=Math.abs(n);return e>lh?(Math.sign(n)||1)*(qs*Math.pow(e,.45)-(qs-1)):4.5*n},Ys=({x:n,y:e,z:t,alpha:i})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let s={mode:"rec2020",r:gi(n*1.7166511879712683-e*.3556707837763925-.2533662813736599*t),g:gi(n*-.6666843518324893+e*1.6164812366349395+.0157685458139111*t),b:gi(n*.0176398574453108-e*.0427706132578085+.9421031212354739*t)};return i!==void 0&&(s.alpha=i),s},Zs=1.09929682680944,ch=.018053968510807,xi=(n=0)=>{let e=Math.abs(n);return e<ch*4.5?n/4.5:(Math.sign(n)||1)*Math.pow((e+Zs-1)/Zs,1/.45)},Gs=n=>{let e=xi(n.r),t=xi(n.g),i=xi(n.b),s={mode:"xyz65",x:.6369580483012911*e+.1446169035862083*t+.1688809751641721*i,y:.262700212011267*e+.6779980715188708*t+.059301716469862*i,z:0*e+.0280726930490874*t+1.0609850577107909*i};return n.alpha!==void 0&&(s.alpha=n.alpha),s},uh={...xt,mode:"rec2020",fromMode:{xyz65:Ys,rgb:n=>Ys(Ye(n))},toMode:{xyz65:Gs,rgb:n=>Ze(Gs(n))},parse:["rec2020"],serialize:"rec2020"},He=.0037930732552754493,fa=Math.cbrt(He),bi=n=>Math.cbrt(n)-fa,fh=n=>{const{r:e,g:t,b:i,alpha:s}=bt(n),r=bi(.3*e+.622*t+.078*i+He),a=bi(.23*e+.692*t+.078*i+He),o=bi(.2434226892454782*e+.2047674442449682*t+.5518098665095535*i+He),h={mode:"xyb",x:(r-a)/2,y:(r+a)/2,b:o-(r+a)/2};return s!==void 0&&(h.alpha=s),h},yi=n=>Math.pow(n+fa,3),dh=({x:n,y:e,b:t,alpha:i})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);const s=yi(n+e)-He,r=yi(e-n)-He,a=yi(t+e)-He,o=yt({r:11.031566904639861*s-9.866943908131562*r-.16462299650829934*a,g:-3.2541473810744237*s+4.418770377582723*r-.16462299650829934*a,b:-3.6588512867136815*s+2.7129230459360922*r+1.9459282407775895*a});return i!==void 0&&(o.alpha=i),o},mh={mode:"xyb",channels:["x","y","b","alpha"],parse:["--xyb"],serialize:"--xyb",toMode:{rgb:dh},fromMode:{rgb:fh},ranges:{x:[-.0154,.0281],y:[0,.8453],b:[-.2778,.388]},interpolate:{x:T,y:T,b:T,alpha:{use:T,fixup:X}}},ph={mode:"xyz50",parse:["xyz-d50"],serialize:"xyz-d50",toMode:{rgb:$t,lab:rs},fromMode:{rgb:Vt,lab:ss},channels:["x","y","z","alpha"],ranges:{x:[0,.964],y:[0,.999],z:[0,.825]},interpolate:{x:T,y:T,z:T,alpha:{use:T,fixup:X}}},gh=n=>{let{x:e,y:t,z:i,alpha:s}=n;e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0);let r={mode:"xyz50",x:1.0479298208405488*e+.0229467933410191*t-.0501922295431356*i,y:.0296278156881593*e+.990434484573249*t-.0170738250293851*i,z:-.0092430581525912*e+.0150551448965779*t+.7518742899580008*i};return s!==void 0&&(r.alpha=s),r},xh=n=>{let{x:e,y:t,z:i,alpha:s}=n;e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0);let r={mode:"xyz65",x:.9554734527042182*e-.0230985368742614*t+.0632593086610217*i,y:-.0283697069632081*e+1.0099954580058226*t+.021041398966943*i,z:.0123140016883199*e-.0205076964334779*t+1.3303659366080753*i};return s!==void 0&&(r.alpha=s),r},bh={mode:"xyz65",toMode:{rgb:Ze,xyz50:gh},fromMode:{rgb:Ye,xyz50:xh},ranges:{x:[0,.95],y:[0,1],z:[0,1.088]},channels:["x","y","z","alpha"],parse:["xyz","xyz-d65"],serialize:"xyz-d65",interpolate:{x:T,y:T,z:T,alpha:{use:T,fixup:X}}},yh=({r:n,g:e,b:t,alpha:i})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);const s={mode:"yiq",y:.29889531*n+.58662247*e+.11448223*t,i:.59597799*n-.2741761*e-.32180189*t,q:.21147017*n-.52261711*e+.31114694*t};return i!==void 0&&(s.alpha=i),s},vh=({y:n,i:e,q:t,alpha:i})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);const s={mode:"rgb",r:n+.95608445*e+.6208885*t,g:n-.27137664*e-.6486059*t,b:n-1.10561724*e+1.70250126*t};return i!==void 0&&(s.alpha=i),s},_h={mode:"yiq",toMode:{rgb:vh},fromMode:{rgb:yh},channels:["y","i","q","alpha"],parse:["--yiq"],serialize:"--yiq",ranges:{i:[-.595,.595],q:[-.522,.522]},interpolate:{y:T,i:T,q:T,alpha:{use:T,fixup:X}}},Mh=(n,e)=>Math.round(n*(e=Math.pow(10,e)))/e,wh=(n=4)=>e=>typeof e=="number"?Mh(e,n):e;let Th=wh(2);const da=n=>Math.max(0,Math.min(1,n||0)),ut=n=>Math.round(da(n)*255),ma=xe("rgb"),kh=n=>{if(n===void 0)return;let e=ut(n.r),t=ut(n.g),i=ut(n.b);return"#"+(1<<24|e<<16|t<<8|i).toString(16).slice(1)},zh=n=>{if(n===void 0)return;let e=ut(n.r),t=ut(n.g),i=ut(n.b);return n.alpha===void 0||n.alpha===1?`rgb(${e}, ${t}, ${i})`:`rgba(${e}, ${t}, ${i}, ${Th(da(n.alpha))})`},Ch=n=>kh(ma(n)),Tt=n=>zh(ma(n)),Sh=n=>n!==void 0&&(n.r===void 0||n.r>=0&&n.r<=1)&&(n.g===void 0||n.g>=0&&n.g<=1)&&(n.b===void 0||n.b>=0&&n.b<=1);function Zt(n="rgb"){const{gamut:e}=Lr(n);if(!e)return i=>!0;const t=xe(typeof e=="string"?e:n);return i=>Sh(t(i))}N(h0);N(p0);N(g0);N(x0);N(v0);N(Yr);N(Kr);N(E0);N(R0);N(P0);N(D0);N(as);N(j0);N(os);N(U0);N(G0);N(K0);N(Q0);N(th);N(nh);N(sh);const kt=N(ah);N(oh);N(hh);N(uh);N(xt);N(mh);N(ph);N(bh);N(_h);const Ah={r:299,g:587,b:114},Eh=200;class P{static hslFix(e){let t=e.h||0;t>180?t=t-180:t=t+180;let i=e.s;return i=Math.abs(i),{h:t,s:i,l:e.l}}static averageLuminance(e){const{r:t,g:i,b:s}=e,{r,g:a,b:o}=Ah;return(t*r+i*a+s*o)/1e3}static averageOrangeness(e){const{h:t}=this.rgbaToHsl(e),i=((t||0)-Eh+180)%360-180,s=i<-180?i+360:i;return 1-Math.abs(s)/90}static findMaxChroma(e,t){if(t===void 0||e<=0||e>=100)return 0;const i=Zt("rgb");let s=0,r=.4;const a=.001;for(;r-s>a;){const o=(s+r)/2;i({mode:"oklch",l:e/100,h:t,c:o})?s=o:r=o}return s*100}static findMinLightness(e,t){if(e<=0||t===void 0)return 0;const i=Zt("rgb");let s=0,r=1;const a=.001;for(;r-s>a;){const o=(s+r)/2;i({mode:"oklch",l:o,c:e/100,h:t})?r=o:s=o}return r*100}static findMaxLightness(e,t){if(e<=0||t===void 0)return 100;const i=Zt("rgb");let s=0,r=1;const a=.001;for(;r-s>a;){const o=(s+r)/2;i({mode:"oklch",l:o,c:e/100,h:t})?s=o:r=o}return s*100}static rgbGradientStops(){return{r:[{color:"rgba(0,0,0,1)",pos:0},{color:"rgba(255,0,0,1)",pos:100}],g:[{color:"rgba(0,0,0,1)",pos:0},{color:"rgba(0,255,0,1)",pos:100}],b:[{color:"rgba(0,0,0,1)",pos:0},{color:"rgba(0,0,255,1)",pos:100}]}}static hslGradientStops(e,t=20){return{h:[...Array(t).keys()].map(i=>({color:`rgba(${Object.values(this.hslToRgba({h:i*(360/10),s:e.s,l:e.l})).join(",")})`,pos:i*10})),s:[{color:`rgba(${Object.values(this.hslToRgba({h:e.h,s:0,l:e.l})).join(",")})`,pos:0},{color:`rgba(${Object.values(this.hslToRgba({h:e.h,s:1,l:e.l})).join(",")})`,pos:100}],l:[{color:`rgba(${Object.values(this.hslToRgba({h:e.h,s:e.s,l:0})).join(",")})`,pos:0},{color:`rgba(${Object.values(this.hslToRgba({h:e.h,s:e.s,l:255})).join(",")})`,pos:100}]}}static oklchGradientStops(e,t=!1,i=50){const s=e.h??0,r=e.l,a=e.c,o={l:[],c:[],h:[]},h=Zt("rgb"),l=xe("rgb"),c=f=>{if(!t){const p=[];for(let y=0;y<i;y++){const b=y/(i-1),v=f(b),z=l({mode:"oklch",...v});p.push({color:Tt(z),pos:b*100})}return p}const d=Array.from({length:i},(p,y)=>{const b=y/(i-1),v=f(b);return{oklch:v,inGamut:h(kt({mode:"oklch",...v})),pos:b*100}}),m=[],x=d[0];m.push({color:x.inGamut?Tt(kt({mode:"oklch",...x.oklch})):"rgba(0,0,0,1)",pos:x.pos});for(let p=1;p<d.length;p++){const y=d[p],b=d[p-1];if(y.inGamut!==b.inGamut){const v=(y.pos+b.pos)/2;y.inGamut?(m.push({color:"rgba(0,0,0,1)",pos:v}),m.push({color:Tt(kt({mode:"oklch",...y.oklch})),pos:v})):(m.push({color:Tt(kt({mode:"oklch",...b.oklch})),pos:v}),m.push({color:"rgba(0,0,0,1)",pos:v}))}else y.inGamut&&m.push({color:Tt(kt({mode:"oklch",...y.oklch})),pos:y.pos})}const g=d[i-1];return g.inGamut||m.push({color:"rgba(0,0,0,1)",pos:g.pos}),m};o.l=c(f=>({l:f,c:a/100,h:s}));const u=.4;return o.c=c(f=>({l:r/100,c:f*u,h:s})),o.h=c(f=>({l:r/100,c:a/100,h:f*360})),o}static rgbaToRaw(e){return[e.r/255,e.g/255,e.b/255,e.a??1]}static rawToRgba(e){return{r:e[0]*255,g:e[1]*255,b:e[2]*255,a:e[3]}}static hexToRaw(e){return this.rgbaToRaw(this.hexToRgba(e)??{r:0,g:0,b:0})}static hexToRgba(e){const t=$r(e);if(!t)return;const i=xe("rgb"),{r:s,g:r,b:a}=i(t);return{r:s*255,g:r*255,b:a*255}}static rgbaToHex(e){const{r:t,g:i,b:s}=e;return Ch({mode:"rgb",r:t/255,g:i/255,b:s/255})}static oklchToRgba(e){const t=xe("rgb"),{r:i,g:s,b:r}=t({mode:"oklch",...e});return{r:i,g:s,b:r}}static rgbaToOklch(e){const t=xe("oklch"),{l:i,c:s,h:r}=t({mode:"rgb",...e});return{l:i,c:s,h:r}}static hslToRgba(e){const t=xe("rgb"),{r:i,g:s,b:r}=t({mode:"hsl",...e});return{r:i,g:s,b:r}}static rgbaToHsl(e){const t=xe("hsl"),{h:i,s,l:r}=this.hslFix(t({mode:"rgb",...e}));return{h:i,s,l:r}}static hslToOklch(e){const t=xe("oklch"),{l:i,c:s,h:r}=t({mode:"hsl",...e});return{l:i,c:s,h:r}}static oklchToHsl(e){const t=xe("hsl"),{h:i,s,l:r}=this.hslFix(t({mode:"oklch",...e}));return{h:i,s,l:r}}}var cs=(n=>(n.None="none",n.Linear="linear",n.Toggle="toggle",n.Relative="relative",n))(cs||{});const pa="182",ga=300,Ks=1e3,Gt=1001,Qs=1002,Rh=1006,Ih=1008,Fh=1009,Oh=1023,Ph="",At=2e3,Js=2001;function er(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function Le(...n){const e="THREE."+n.shift();console.warn(e,...n)}function tr(...n){const e="THREE."+n.shift();console.error(e,...n)}class xa{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){const i=this._listeners;return i===void 0?!1:i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){const i=this._listeners;if(i===void 0)return;const s=i[e];if(s!==void 0){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const i=t[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let r=0,a=s.length;r<a;r++)s[r].call(this,e);e.target=null}}}const ne=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let nr=1234567;const Ft=Math.PI/180,yn=180/Math.PI;function Nn(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(ne[n&255]+ne[n>>8&255]+ne[n>>16&255]+ne[n>>24&255]+"-"+ne[e&255]+ne[e>>8&255]+"-"+ne[e>>16&15|64]+ne[e>>24&255]+"-"+ne[t&63|128]+ne[t>>8&255]+"-"+ne[t>>16&255]+ne[t>>24&255]+ne[i&255]+ne[i>>8&255]+ne[i>>16&255]+ne[i>>24&255]).toLowerCase()}function $(n,e,t){return Math.max(e,Math.min(t,n))}function ba(n,e){return(n%e+e)%e}function Dh(n,e,t,i,s){return i+(n-e)*(s-i)/(t-e)}function Nh(n,e,t){return n!==e?(t-n)/(e-n):0}function ya(n,e,t){return(1-t)*n+t*e}function jh(n,e,t,i){return ya(n,e,1-Math.exp(-t*i))}function Lh(n,e=1){return e-Math.abs(ba(n,e*2)-e)}function Uh(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function $h(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function Vh(n,e){return n+Math.floor(Math.random()*(e-n+1))}function Bh(n,e){return n+Math.random()*(e-n)}function Hh(n){return n*(.5-Math.random())}function Wh(n){n!==void 0&&(nr=n);let e=nr+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function Xh(n){return n*Ft}function qh(n){return n*yn}function Yh(n){return(n&n-1)===0&&n!==0}function Zh(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Gh(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function Kh(n,e,t,i,s){const r=Math.cos,a=Math.sin,o=r(t/2),h=a(t/2),l=r((e+i)/2),c=a((e+i)/2),u=r((e-i)/2),f=a((e-i)/2),d=r((i-e)/2),m=a((i-e)/2);switch(s){case"XYX":n.set(o*c,h*u,h*f,o*l);break;case"YZY":n.set(h*f,o*c,h*u,o*l);break;case"ZXZ":n.set(h*u,h*f,o*c,o*l);break;case"XZX":n.set(o*c,h*m,h*d,o*l);break;case"YXY":n.set(h*d,o*c,h*m,o*l);break;case"ZYZ":n.set(h*m,h*d,o*c,o*l);break;default:Le("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Qh(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Jh(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const vi={DEG2RAD:Ft,RAD2DEG:yn,generateUUID:Nn,clamp:$,euclideanModulo:ba,mapLinear:Dh,inverseLerp:Nh,lerp:ya,damp:jh,pingpong:Lh,smoothstep:Uh,smootherstep:$h,randInt:Vh,randFloat:Bh,randFloatSpread:Hh,seededRandom:Wh,degToRad:Xh,radToDeg:qh,isPowerOfTwo:Yh,ceilPowerOfTwo:Zh,floorPowerOfTwo:Gh,setQuaternionFromProperEuler:Kh,normalize:Jh,denormalize:Qh};class We{constructor(e=0,t=0){We.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6],this.y=s[1]*t+s[4]*i+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=$(this.x,e.x,t.x),this.y=$(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=$(this.x,e,t),this.y=$(this.y,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar($(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos($(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),s=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*i-a*s+e.x,this.y=r*s+a*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ge{constructor(e=0,t=0,i=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=s}static slerpFlat(e,t,i,s,r,a,o){let h=i[s+0],l=i[s+1],c=i[s+2],u=i[s+3],f=r[a+0],d=r[a+1],m=r[a+2],x=r[a+3];if(o<=0){e[t+0]=h,e[t+1]=l,e[t+2]=c,e[t+3]=u;return}if(o>=1){e[t+0]=f,e[t+1]=d,e[t+2]=m,e[t+3]=x;return}if(u!==x||h!==f||l!==d||c!==m){let g=h*f+l*d+c*m+u*x;g<0&&(f=-f,d=-d,m=-m,x=-x,g=-g);let p=1-o;if(g<.9995){const y=Math.acos(g),b=Math.sin(y);p=Math.sin(p*y)/b,o=Math.sin(o*y)/b,h=h*p+f*o,l=l*p+d*o,c=c*p+m*o,u=u*p+x*o}else{h=h*p+f*o,l=l*p+d*o,c=c*p+m*o,u=u*p+x*o;const y=1/Math.sqrt(h*h+l*l+c*c+u*u);h*=y,l*=y,c*=y,u*=y}}e[t]=h,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,i,s,r,a){const o=i[s],h=i[s+1],l=i[s+2],c=i[s+3],u=r[a],f=r[a+1],d=r[a+2],m=r[a+3];return e[t]=o*m+c*u+h*d-l*f,e[t+1]=h*m+c*f+l*u-o*d,e[t+2]=l*m+c*d+o*f-h*u,e[t+3]=c*m-o*u-h*f-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,s){return this._x=e,this._y=t,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,s=e._y,r=e._z,a=e._order,o=Math.cos,h=Math.sin,l=o(i/2),c=o(s/2),u=o(r/2),f=h(i/2),d=h(s/2),m=h(r/2);switch(a){case"XYZ":this._x=f*c*u+l*d*m,this._y=l*d*u-f*c*m,this._z=l*c*m+f*d*u,this._w=l*c*u-f*d*m;break;case"YXZ":this._x=f*c*u+l*d*m,this._y=l*d*u-f*c*m,this._z=l*c*m-f*d*u,this._w=l*c*u+f*d*m;break;case"ZXY":this._x=f*c*u-l*d*m,this._y=l*d*u+f*c*m,this._z=l*c*m+f*d*u,this._w=l*c*u-f*d*m;break;case"ZYX":this._x=f*c*u-l*d*m,this._y=l*d*u+f*c*m,this._z=l*c*m-f*d*u,this._w=l*c*u+f*d*m;break;case"YZX":this._x=f*c*u+l*d*m,this._y=l*d*u+f*c*m,this._z=l*c*m-f*d*u,this._w=l*c*u-f*d*m;break;case"XZY":this._x=f*c*u-l*d*m,this._y=l*d*u-f*c*m,this._z=l*c*m+f*d*u,this._w=l*c*u+f*d*m;break;default:Le("Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,s=Math.sin(i);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],s=t[4],r=t[8],a=t[1],o=t[5],h=t[9],l=t[2],c=t[6],u=t[10],f=i+o+u;if(f>0){const d=.5/Math.sqrt(f+1);this._w=.25/d,this._x=(c-h)*d,this._y=(r-l)*d,this._z=(a-s)*d}else if(i>o&&i>u){const d=2*Math.sqrt(1+i-o-u);this._w=(c-h)/d,this._x=.25*d,this._y=(s+a)/d,this._z=(r+l)/d}else if(o>u){const d=2*Math.sqrt(1+o-i-u);this._w=(r-l)/d,this._x=(s+a)/d,this._y=.25*d,this._z=(h+c)/d}else{const d=2*Math.sqrt(1+u-i-o);this._w=(a-s)/d,this._x=(r+l)/d,this._y=(h+c)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<1e-8?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs($(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const s=Math.min(1,t/i);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,s=e._y,r=e._z,a=e._w,o=t._x,h=t._y,l=t._z,c=t._w;return this._x=i*c+a*o+s*l-r*h,this._y=s*c+a*h+r*o-i*l,this._z=r*c+a*l+i*h-s*o,this._w=a*c-i*o-s*h-r*l,this._onChangeCallback(),this}slerp(e,t){if(t<=0)return this;if(t>=1)return this.copy(e);let i=e._x,s=e._y,r=e._z,a=e._w,o=this.dot(e);o<0&&(i=-i,s=-s,r=-r,a=-a,o=-o);let h=1-t;if(o<.9995){const l=Math.acos(o),c=Math.sin(l);h=Math.sin(h*l)/c,t=Math.sin(t*l)/c,this._x=this._x*h+i*t,this._y=this._y*h+s*t,this._z=this._z*h+r*t,this._w=this._w*h+a*t,this._onChangeCallback()}else this._x=this._x*h+i*t,this._y=this._y*h+s*t,this._z=this._z*h+r*t,this._w=this._w*h+a*t,this.normalize();return this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),s=Math.sqrt(1-i),r=Math.sqrt(i);return this.set(s*Math.sin(e),s*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class M{constructor(e=0,t=0,i=0){M.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(ir.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(ir.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*s,this.y=r[1]*t+r[4]*i+r[7]*s,this.z=r[2]*t+r[5]*i+r[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,r=e.elements,a=1/(r[3]*t+r[7]*i+r[11]*s+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*s+r[12])*a,this.y=(r[1]*t+r[5]*i+r[9]*s+r[13])*a,this.z=(r[2]*t+r[6]*i+r[10]*s+r[14])*a,this}applyQuaternion(e){const t=this.x,i=this.y,s=this.z,r=e.x,a=e.y,o=e.z,h=e.w,l=2*(a*s-o*i),c=2*(o*t-r*s),u=2*(r*i-a*t);return this.x=t+h*l+a*u-o*c,this.y=i+h*c+o*l-r*u,this.z=s+h*u+r*c-a*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*s,this.y=r[1]*t+r[5]*i+r[9]*s,this.z=r[2]*t+r[6]*i+r[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=$(this.x,e.x,t.x),this.y=$(this.y,e.y,t.y),this.z=$(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=$(this.x,e,t),this.y=$(this.y,e,t),this.z=$(this.z,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar($(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,s=e.y,r=e.z,a=t.x,o=t.y,h=t.z;return this.x=s*h-r*o,this.y=r*a-i*h,this.z=i*o-s*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return _i.copy(this).projectOnVector(e),this.sub(_i)}reflect(e){return this.sub(_i.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos($(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return t*t+i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const s=Math.sin(t)*e;return this.x=s*Math.sin(i),this.y=Math.cos(t)*e,this.z=s*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _i=new M,ir=new Ge;class Ht{constructor(e,t,i,s,r,a,o,h,l){Ht.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,s,r,a,o,h,l)}set(e,t,i,s,r,a,o,h,l){const c=this.elements;return c[0]=e,c[1]=s,c[2]=o,c[3]=t,c[4]=r,c[5]=h,c[6]=i,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,r=this.elements,a=i[0],o=i[3],h=i[6],l=i[1],c=i[4],u=i[7],f=i[2],d=i[5],m=i[8],x=s[0],g=s[3],p=s[6],y=s[1],b=s[4],v=s[7],z=s[2],C=s[5],k=s[8];return r[0]=a*x+o*y+h*z,r[3]=a*g+o*b+h*C,r[6]=a*p+o*v+h*k,r[1]=l*x+c*y+u*z,r[4]=l*g+c*b+u*C,r[7]=l*p+c*v+u*k,r[2]=f*x+d*y+m*z,r[5]=f*g+d*b+m*C,r[8]=f*p+d*v+m*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],a=e[4],o=e[5],h=e[6],l=e[7],c=e[8];return t*a*c-t*o*l-i*r*c+i*o*h+s*r*l-s*a*h}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],a=e[4],o=e[5],h=e[6],l=e[7],c=e[8],u=c*a-o*l,f=o*h-c*r,d=l*r-a*h,m=t*u+i*f+s*d;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const x=1/m;return e[0]=u*x,e[1]=(s*l-c*i)*x,e[2]=(o*i-s*a)*x,e[3]=f*x,e[4]=(c*t-s*h)*x,e[5]=(s*r-o*t)*x,e[6]=d*x,e[7]=(i*h-l*t)*x,e[8]=(a*t-i*r)*x,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,s,r,a,o){const h=Math.cos(r),l=Math.sin(r);return this.set(i*h,i*l,-i*(h*a+l*o)+a+e,-s*l,s*h,-s*(-l*a+h*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(Mi.makeScale(e,t)),this}rotate(e){return this.premultiply(Mi.makeRotation(-e)),this}translate(e,t){return this.premultiply(Mi.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<9;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Mi=new Ht;function wi(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}let et;class el{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{et===void 0&&(et=er("canvas")),et.width=e.width,et.height=e.height;const s=et.getContext("2d");e instanceof ImageData?s.putImageData(e,0,0):s.drawImage(e,0,0,e.width,e.height),i=et}return i.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=er("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const s=i.getImageData(0,0,e.width,e.height),r=s.data;for(let a=0;a<r.length;a++)r[a]=wi(r[a]/255)*255;return i.putImageData(s,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(wi(t[i]/255)*255):t[i]=wi(t[i]);return{data:t,width:e.width,height:e.height}}else return Le("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let tl=0;class nl{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:tl++}),this.uuid=Nn(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):typeof VideoFrame<"u"&&t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let a=0,o=s.length;a<o;a++)s[a].isDataTexture?r.push(Ti(s[a].image)):r.push(Ti(s[a]))}else r=Ti(s);i.url=r}return t||(e.images[this.uuid]=i),i}}function Ti(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?el.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(Le("Texture: Unable to serialize Texture."),{})}let il=0;const ki=new M;class Xe extends xa{constructor(e=Xe.DEFAULT_IMAGE,t=Xe.DEFAULT_MAPPING,i=Gt,s=Gt,r=Rh,a=Ih,o=Oh,h=Fh,l=Xe.DEFAULT_ANISOTROPY,c=Ph){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:il++}),this.uuid=Nn(),this.name="",this.source=new nl(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=s,this.magFilter=r,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=h,this.offset=new We(0,0),this.repeat=new We(1,1),this.center=new We(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ht,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(ki).x}get height(){return this.source.getSize(ki).y}get depth(){return this.source.getSize(ki).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const i=e[t];if(i===void 0){Le(`Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const s=this[t];if(s===void 0){Le(`Texture.setValues(): property '${t}' does not exist.`);continue}s&&i&&s.isVector2&&i.isVector2||s&&i&&s.isVector3&&i.isVector3||s&&i&&s.isMatrix3&&i.isMatrix3?s.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==ga)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ks:e.x=e.x-Math.floor(e.x);break;case Gt:e.x=e.x<0?0:1;break;case Qs:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Ks:e.y=e.y-Math.floor(e.y);break;case Gt:e.y=e.y<0?0:1;break;case Qs:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Xe.DEFAULT_IMAGE=null;Xe.DEFAULT_MAPPING=ga;Xe.DEFAULT_ANISOTROPY=1;class Q{constructor(e,t,i,s,r,a,o,h,l,c,u,f,d,m,x,g){Q.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,s,r,a,o,h,l,c,u,f,d,m,x,g)}set(e,t,i,s,r,a,o,h,l,c,u,f,d,m,x,g){const p=this.elements;return p[0]=e,p[4]=t,p[8]=i,p[12]=s,p[1]=r,p[5]=a,p[9]=o,p[13]=h,p[2]=l,p[6]=c,p[10]=u,p[14]=f,p[3]=d,p[7]=m,p[11]=x,p[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Q().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return this.determinant()===0?(e.set(1,0,0),t.set(0,1,0),i.set(0,0,1),this):(e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this)}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){if(e.determinant()===0)return this.identity();const t=this.elements,i=e.elements,s=1/tt.setFromMatrixColumn(e,0).length(),r=1/tt.setFromMatrixColumn(e,1).length(),a=1/tt.setFromMatrixColumn(e,2).length();return t[0]=i[0]*s,t[1]=i[1]*s,t[2]=i[2]*s,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*a,t[9]=i[9]*a,t[10]=i[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,s=e.y,r=e.z,a=Math.cos(i),o=Math.sin(i),h=Math.cos(s),l=Math.sin(s),c=Math.cos(r),u=Math.sin(r);if(e.order==="XYZ"){const f=a*c,d=a*u,m=o*c,x=o*u;t[0]=h*c,t[4]=-h*u,t[8]=l,t[1]=d+m*l,t[5]=f-x*l,t[9]=-o*h,t[2]=x-f*l,t[6]=m+d*l,t[10]=a*h}else if(e.order==="YXZ"){const f=h*c,d=h*u,m=l*c,x=l*u;t[0]=f+x*o,t[4]=m*o-d,t[8]=a*l,t[1]=a*u,t[5]=a*c,t[9]=-o,t[2]=d*o-m,t[6]=x+f*o,t[10]=a*h}else if(e.order==="ZXY"){const f=h*c,d=h*u,m=l*c,x=l*u;t[0]=f-x*o,t[4]=-a*u,t[8]=m+d*o,t[1]=d+m*o,t[5]=a*c,t[9]=x-f*o,t[2]=-a*l,t[6]=o,t[10]=a*h}else if(e.order==="ZYX"){const f=a*c,d=a*u,m=o*c,x=o*u;t[0]=h*c,t[4]=m*l-d,t[8]=f*l+x,t[1]=h*u,t[5]=x*l+f,t[9]=d*l-m,t[2]=-l,t[6]=o*h,t[10]=a*h}else if(e.order==="YZX"){const f=a*h,d=a*l,m=o*h,x=o*l;t[0]=h*c,t[4]=x-f*u,t[8]=m*u+d,t[1]=u,t[5]=a*c,t[9]=-o*c,t[2]=-l*c,t[6]=d*u+m,t[10]=f-x*u}else if(e.order==="XZY"){const f=a*h,d=a*l,m=o*h,x=o*l;t[0]=h*c,t[4]=-u,t[8]=l*c,t[1]=f*u+x,t[5]=a*c,t[9]=d*u-m,t[2]=m*u-d,t[6]=o*c,t[10]=x*u+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(sl,e,rl)}lookAt(e,t,i){const s=this.elements;return he.subVectors(e,t),he.lengthSq()===0&&(he.z=1),he.normalize(),Ee.crossVectors(i,he),Ee.lengthSq()===0&&(Math.abs(i.z)===1?he.x+=1e-4:he.z+=1e-4,he.normalize(),Ee.crossVectors(i,he)),Ee.normalize(),Kt.crossVectors(he,Ee),s[0]=Ee.x,s[4]=Kt.x,s[8]=he.x,s[1]=Ee.y,s[5]=Kt.y,s[9]=he.y,s[2]=Ee.z,s[6]=Kt.z,s[10]=he.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,r=this.elements,a=i[0],o=i[4],h=i[8],l=i[12],c=i[1],u=i[5],f=i[9],d=i[13],m=i[2],x=i[6],g=i[10],p=i[14],y=i[3],b=i[7],v=i[11],z=i[15],C=s[0],k=s[4],R=s[8],S=s[12],A=s[1],D=s[5],F=s[9],B=s[13],q=s[2],se=s[6],re=s[10],ae=s[14],ue=s[3],oe=s[7],be=s[11],ye=s[15];return r[0]=a*C+o*A+h*q+l*ue,r[4]=a*k+o*D+h*se+l*oe,r[8]=a*R+o*F+h*re+l*be,r[12]=a*S+o*B+h*ae+l*ye,r[1]=c*C+u*A+f*q+d*ue,r[5]=c*k+u*D+f*se+d*oe,r[9]=c*R+u*F+f*re+d*be,r[13]=c*S+u*B+f*ae+d*ye,r[2]=m*C+x*A+g*q+p*ue,r[6]=m*k+x*D+g*se+p*oe,r[10]=m*R+x*F+g*re+p*be,r[14]=m*S+x*B+g*ae+p*ye,r[3]=y*C+b*A+v*q+z*ue,r[7]=y*k+b*D+v*se+z*oe,r[11]=y*R+b*F+v*re+z*be,r[15]=y*S+b*B+v*ae+z*ye,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],s=e[8],r=e[12],a=e[1],o=e[5],h=e[9],l=e[13],c=e[2],u=e[6],f=e[10],d=e[14],m=e[3],x=e[7],g=e[11],p=e[15],y=h*d-l*f,b=o*d-l*u,v=o*f-h*u,z=a*d-l*c,C=a*f-h*c,k=a*u-o*c;return t*(x*y-g*b+p*v)-i*(m*y-g*z+p*C)+s*(m*b-x*z+p*k)-r*(m*v-x*C+g*k)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],a=e[4],o=e[5],h=e[6],l=e[7],c=e[8],u=e[9],f=e[10],d=e[11],m=e[12],x=e[13],g=e[14],p=e[15],y=u*g*l-x*f*l+x*h*d-o*g*d-u*h*p+o*f*p,b=m*f*l-c*g*l-m*h*d+a*g*d+c*h*p-a*f*p,v=c*x*l-m*u*l+m*o*d-a*x*d-c*o*p+a*u*p,z=m*u*h-c*x*h-m*o*f+a*x*f+c*o*g-a*u*g,C=t*y+i*b+s*v+r*z;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const k=1/C;return e[0]=y*k,e[1]=(x*f*r-u*g*r-x*s*d+i*g*d+u*s*p-i*f*p)*k,e[2]=(o*g*r-x*h*r+x*s*l-i*g*l-o*s*p+i*h*p)*k,e[3]=(u*h*r-o*f*r-u*s*l+i*f*l+o*s*d-i*h*d)*k,e[4]=b*k,e[5]=(c*g*r-m*f*r+m*s*d-t*g*d-c*s*p+t*f*p)*k,e[6]=(m*h*r-a*g*r-m*s*l+t*g*l+a*s*p-t*h*p)*k,e[7]=(a*f*r-c*h*r+c*s*l-t*f*l-a*s*d+t*h*d)*k,e[8]=v*k,e[9]=(m*u*r-c*x*r-m*i*d+t*x*d+c*i*p-t*u*p)*k,e[10]=(a*x*r-m*o*r+m*i*l-t*x*l-a*i*p+t*o*p)*k,e[11]=(c*o*r-a*u*r-c*i*l+t*u*l+a*i*d-t*o*d)*k,e[12]=z*k,e[13]=(c*x*s-m*u*s+m*i*f-t*x*f-c*i*g+t*u*g)*k,e[14]=(m*o*s-a*x*s-m*i*h+t*x*h+a*i*g-t*o*g)*k,e[15]=(a*u*s-c*o*s+c*i*h-t*u*h-a*i*f+t*o*f)*k,this}scale(e){const t=this.elements,i=e.x,s=e.y,r=e.z;return t[0]*=i,t[4]*=s,t[8]*=r,t[1]*=i,t[5]*=s,t[9]*=r,t[2]*=i,t[6]*=s,t[10]*=r,t[3]*=i,t[7]*=s,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,s))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),s=Math.sin(t),r=1-i,a=e.x,o=e.y,h=e.z,l=r*a,c=r*o;return this.set(l*a+i,l*o-s*h,l*h+s*o,0,l*o+s*h,c*o+i,c*h-s*a,0,l*h-s*o,c*h+s*a,r*h*h+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,s,r,a){return this.set(1,i,r,0,e,1,a,0,t,s,1,0,0,0,0,1),this}compose(e,t,i){const s=this.elements,r=t._x,a=t._y,o=t._z,h=t._w,l=r+r,c=a+a,u=o+o,f=r*l,d=r*c,m=r*u,x=a*c,g=a*u,p=o*u,y=h*l,b=h*c,v=h*u,z=i.x,C=i.y,k=i.z;return s[0]=(1-(x+p))*z,s[1]=(d+v)*z,s[2]=(m-b)*z,s[3]=0,s[4]=(d-v)*C,s[5]=(1-(f+p))*C,s[6]=(g+y)*C,s[7]=0,s[8]=(m+b)*k,s[9]=(g-y)*k,s[10]=(1-(f+x))*k,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,i){const s=this.elements;if(e.x=s[12],e.y=s[13],e.z=s[14],this.determinant()===0)return i.set(1,1,1),t.identity(),this;let r=tt.set(s[0],s[1],s[2]).length();const a=tt.set(s[4],s[5],s[6]).length(),o=tt.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),ge.copy(this);const l=1/r,c=1/a,u=1/o;return ge.elements[0]*=l,ge.elements[1]*=l,ge.elements[2]*=l,ge.elements[4]*=c,ge.elements[5]*=c,ge.elements[6]*=c,ge.elements[8]*=u,ge.elements[9]*=u,ge.elements[10]*=u,t.setFromRotationMatrix(ge),i.x=r,i.y=a,i.z=o,this}makePerspective(e,t,i,s,r,a,o=At,h=!1){const l=this.elements,c=2*r/(t-e),u=2*r/(i-s),f=(t+e)/(t-e),d=(i+s)/(i-s);let m,x;if(h)m=r/(a-r),x=a*r/(a-r);else if(o===At)m=-(a+r)/(a-r),x=-2*a*r/(a-r);else if(o===Js)m=-a/(a-r),x=-a*r/(a-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return l[0]=c,l[4]=0,l[8]=f,l[12]=0,l[1]=0,l[5]=u,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=m,l[14]=x,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,s,r,a,o=At,h=!1){const l=this.elements,c=2/(t-e),u=2/(i-s),f=-(t+e)/(t-e),d=-(i+s)/(i-s);let m,x;if(h)m=1/(a-r),x=a/(a-r);else if(o===At)m=-2/(a-r),x=-(a+r)/(a-r);else if(o===Js)m=-1/(a-r),x=-r/(a-r);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return l[0]=c,l[4]=0,l[8]=0,l[12]=f,l[1]=0,l[5]=u,l[9]=0,l[13]=d,l[2]=0,l[6]=0,l[10]=m,l[14]=x,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<16;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const tt=new M,ge=new Q,sl=new M(0,0,0),rl=new M(1,1,1),Ee=new M,Kt=new M,he=new M,sr=new Q,rr=new Ge;class vt{constructor(e=0,t=0,i=0,s=vt.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,s=this._order){return this._x=e,this._y=t,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const s=e.elements,r=s[0],a=s[4],o=s[8],h=s[1],l=s[5],c=s[9],u=s[2],f=s[6],d=s[10];switch(t){case"XYZ":this._y=Math.asin($(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(f,l),this._z=0);break;case"YXZ":this._x=Math.asin(-$(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(h,l)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin($(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(h,r));break;case"ZYX":this._y=Math.asin(-$(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(f,d),this._z=Math.atan2(h,r)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin($(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-$(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:Le("Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return sr.makeRotationFromQuaternion(e),this.setFromRotationMatrix(sr,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return rr.setFromEuler(this),this.setFromQuaternion(rr,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}vt.DEFAULT_ORDER="XYZ";class al{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let ol=0;const ar=new M,nt=new Ge,we=new Q,Qt=new M,zt=new M,hl=new M,ll=new Ge,or=new M(1,0,0),hr=new M(0,1,0),lr=new M(0,0,1),cr={type:"added"},cl={type:"removed"},it={type:"childadded",child:null},zi={type:"childremoved",child:null};class De extends xa{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ol++}),this.uuid=Nn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=De.DEFAULT_UP.clone();const e=new M,t=new vt,i=new Ge,s=new M(1,1,1);function r(){i.setFromEuler(t,!1)}function a(){t.setFromQuaternion(i,void 0,!1)}t._onChange(r),i._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Q},normalMatrix:{value:new Ht}}),this.matrix=new Q,this.matrixWorld=new Q,this.matrixAutoUpdate=De.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=De.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new al,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return nt.setFromAxisAngle(e,t),this.quaternion.multiply(nt),this}rotateOnWorldAxis(e,t){return nt.setFromAxisAngle(e,t),this.quaternion.premultiply(nt),this}rotateX(e){return this.rotateOnAxis(or,e)}rotateY(e){return this.rotateOnAxis(hr,e)}rotateZ(e){return this.rotateOnAxis(lr,e)}translateOnAxis(e,t){return ar.copy(e).applyQuaternion(this.quaternion),this.position.add(ar.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(or,e)}translateY(e){return this.translateOnAxis(hr,e)}translateZ(e){return this.translateOnAxis(lr,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(we.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Qt.copy(e):Qt.set(e,t,i);const s=this.parent;this.updateWorldMatrix(!0,!1),zt.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?we.lookAt(zt,Qt,this.up):we.lookAt(Qt,zt,this.up),this.quaternion.setFromRotationMatrix(we),s&&(we.extractRotation(s.matrixWorld),nt.setFromRotationMatrix(we),this.quaternion.premultiply(nt.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(tr("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(cr),it.child=e,this.dispatchEvent(it),it.child=null):tr("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(cl),zi.child=e,this.dispatchEvent(zi),zi.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),we.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),we.multiply(e.parent.matrixWorld)),e.applyMatrix4(we),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(cr),it.child=e,this.dispatchEvent(it),it.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,s=this.children.length;i<s;i++){const a=this.children[i].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const s=this.children;for(let r=0,a=s.length;r<a;r++)s[r].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(zt,e,hl),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(zt,ll,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const s=this.children;for(let r=0,a=s.length;r<a;r++)s[r].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),s.instanceInfo=this._instanceInfo.map(o=>({...o})),s.availableInstanceIds=this._availableInstanceIds.slice(),s.availableGeometryIds=this._availableGeometryIds.slice(),s.nextIndexStart=this._nextIndexStart,s.nextVertexStart=this._nextVertexStart,s.geometryCount=this._geometryCount,s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.matricesTexture=this._matricesTexture.toJSON(e),s.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(s.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(s.boundingBox=this.boundingBox.toJSON()));function r(o,h){return o[h.uuid]===void 0&&(o[h.uuid]=h.toJSON(e)),h.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const h=o.shapes;if(Array.isArray(h))for(let l=0,c=h.length;l<c;l++){const u=h[l];r(e.shapes,u)}else r(e.shapes,h)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let h=0,l=this.material.length;h<l;h++)o.push(r(e.materials,this.material[h]));s.material=o}else s.material=r(e.materials,this.material);if(this.children.length>0){s.children=[];for(let o=0;o<this.children.length;o++)s.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let o=0;o<this.animations.length;o++){const h=this.animations[o];s.animations.push(r(e.animations,h))}}if(t){const o=a(e.geometries),h=a(e.materials),l=a(e.textures),c=a(e.images),u=a(e.shapes),f=a(e.skeletons),d=a(e.animations),m=a(e.nodes);o.length>0&&(i.geometries=o),h.length>0&&(i.materials=h),l.length>0&&(i.textures=l),c.length>0&&(i.images=c),u.length>0&&(i.shapes=u),f.length>0&&(i.skeletons=f),d.length>0&&(i.animations=d),m.length>0&&(i.nodes=m)}return i.object=s,i;function a(o){const h=[];for(const l in o){const c=o[l];delete c.metadata,h.push(c)}return h}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const s=e.children[i];this.add(s.clone())}return this}}De.DEFAULT_UP=new M(0,1,0);De.DEFAULT_MATRIX_AUTO_UPDATE=!0;De.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;class va extends De{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Q,this.projectionMatrix=new Q,this.projectionMatrixInverse=new Q,this.coordinateSystem=At,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Re=new M,ur=new We,fr=new We;class ul extends va{constructor(e=50,t=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=yn*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Ft*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return yn*2*Math.atan(Math.tan(Ft*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){Re.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Re.x,Re.y).multiplyScalar(-e/Re.z),Re.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Re.x,Re.y).multiplyScalar(-e/Re.z)}getViewSize(e,t){return this.getViewBounds(e,ur,fr),t.subVectors(fr,ur)}setViewOffset(e,t,i,s,r,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Ft*.5*this.fov)/this.zoom,i=2*t,s=this.aspect*i,r=-.5*s;const a=this.view;if(this.view!==null&&this.view.enabled){const h=a.fullWidth,l=a.fullHeight;r+=a.offsetX*s/h,t-=a.offsetY*i/l,s*=a.width/h,i*=a.height/l}const o=this.filmOffset;o!==0&&(r+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,t,t-i,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}class fl extends va{constructor(e=-1,t=1,i=1,s=-1,r=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=s,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,s,r,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=i-e,a=i+e,o=s+t,h=s-t;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=l*this.view.offsetX,a=r+l*this.view.width,o-=c*this.view.offsetY,h=o-c*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,h,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:pa}}));typeof window<"u"&&(window.__THREE__?Le("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=pa);const _a=[{name:"SquareFilled",vertices:[[-.5,.5,0],[-.5,-.5,0],[.5,-.5,0],[.5,.5,0]],faces:[[0,1,2],[3,2,0]]},{name:"SquareOutline",vertices:[[-.5,.5,0],[.5,.5,0],[-.5,.375,0],[.5,.375,0],[-.5,-.375,0],[.5,-.375,0],[-.5,-.5,0],[.5,-.5,0],[-.375,.375,0],[-.375,-.375,0],[.375,.375,0],[.375,-.375,0]],faces:[[0,1,2],[3,2,1],[4,5,6],[7,6,5],[2,8,4],[9,4,8],[10,3,11],[5,11,3]]},{name:"SquareOutlineThin",vertices:[[-.5,.5,0],[.5,.5,0],[-.5,.45,0],[.5,.45,0],[-.5,-.45,0],[.5,-.45,0],[-.5,-.5,0],[.5,-.5,0],[-.45,.45,0],[-.45,-.45,0],[.45,.45,0],[.45,-.45,0]],faces:[[0,1,2],[3,2,1],[4,5,6],[7,6,5],[2,8,4],[9,4,8],[10,3,11],[5,11,3]]}],Ma=[{name:"TriangleFilled",vertices:[[352086e-22,.575,0],[-.497965,-.2875,0],[.497965,-.2875,0]],faces:[[0,1,2]]},{name:"TriangleOutline",vertices:[[352086e-22,.575,0],[-.497965,-.2875,0],[213889e-22,.349307,0],[-.302509,-.174654,0],[.302509,-.174654,0],[.497965,-.2875,0]],faces:[[0,1,2],[2,1,3],[3,1,4],[4,1,5],[5,4,2],[2,0,5]]},{name:"TriangleRightFilled",vertices:[[-.5,.5,0],[-.5,-.5,0],[.5,-.5,0]],faces:[[0,1,2]]},{name:"TriangleRightOutline",vertices:[[-.393333,.236667,0],[-.5,.5,0],[-.393333,-.393333,0],[-.5,-.5,0],[.236667,-.393333,0],[.5,-.5,0]],faces:[[0,1,2],[2,1,3],[3,2,4],[4,3,5],[5,4,0],[0,5,1]]},{name:"TriangleOffset",vertices:[[352086e-22,.8625,0],[-.497965,0,0],[.497965,0,0]],faces:[[0,1,2]]},{name:"TriangleOffsetOutline",vertices:[[352086e-22,.7875,0],[-.497965,-.075,0],[213889e-22,.561807,0],[-.302509,.037846,0],[.302509,.037846,0],[.497965,-.075,0]],faces:[[0,1,2],[2,1,3],[3,1,4],[4,1,5],[5,4,2],[2,0,5]]}],wa=[{name:"Point",vertices:[[0,0,0]],faces:[[0,0,0]]}],Ta=[{name:"CircleFilled",vertices:[[0,0,0],[.5,0,0],[.490393,.0975452,0],[.46194,.191342,0],[.415735,.277785,0],[.353553,.353553,0],[.277785,.415735,0],[.191342,.46194,0],[.0975452,.490393,0],[306162e-22,.5,0],[-.0975452,.490393,0],[-.191342,.46194,0],[-.277785,.415735,0],[-.353553,.353553,0],[-.415735,.277785,0],[-.46194,.191342,0],[-.490393,.0975452,0],[-.5,612323e-22,0],[-.490393,-.0975452,0],[-.46194,-.191342,0],[-.415735,-.277785,0],[-.353553,-.353553,0],[-.277785,-.415735,0],[-.191342,-.46194,0],[-.0975452,-.490393,0],[-918485e-22,-.5,0],[.0975452,-.490393,0],[.191342,-.46194,0],[.277785,-.415735,0],[.353553,-.353553,0],[.415735,-.277785,0],[.46194,-.191342,0],[.490393,-.0975452,0],[.5,-122465e-21,0]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,6],[0,6,7],[0,7,8],[0,8,9],[0,9,10],[0,10,11],[0,11,12],[0,12,13],[0,13,14],[0,14,15],[0,15,16],[0,16,17],[0,17,18],[0,18,19],[0,19,20],[0,20,21],[0,21,22],[0,22,23],[0,23,24],[0,24,25],[0,25,26],[0,26,27],[0,27,28],[0,28,29],[0,29,30],[0,30,31],[0,31,32],[0,32,33]]},{name:"CircleOutline",vertices:[[.375,0,0],[.5,0,0],[.490393,.0975452,0],[.367794,.0731589,0],[.46194,.191342,0],[.346455,.143506,0],[.415735,.277785,0],[.311801,.208339,0],[.353553,.353553,0],[.265165,.265165,0],[.277785,.415735,0],[.208339,.311801,0],[.191342,.46194,0],[.143506,.346455,0],[.0975452,.490393,0],[.0731589,.367794,0],[306162e-22,.5,0],[229621e-22,.375,0],[-.0975452,.490393,0],[-.0731589,.367794,0],[-.191342,.46194,0],[-.143506,.346455,0],[-.277785,.415735,0],[-.208339,.311801,0],[-.353553,.353553,0],[-.265165,.265165,0],[-.415735,.277785,0],[-.311801,.208339,0],[-.46194,.191342,0],[-.346455,.143506,0],[-.490393,.0975452,0],[-.367794,.0731589,0],[-.5,612323e-22,0],[-.375,459243e-22,0],[-.490393,-.0975452,0],[-.367794,-.0731589,0],[-.46194,-.191342,0],[-.346455,-.143506,0],[-.415735,-.277785,0],[-.311801,-.208339,0],[-.353553,-.353553,0],[-.265165,-.265165,0],[-.277785,-.415735,0],[-.208339,-.311801,0],[-.191342,-.46194,0],[-.143506,-.346455,0],[-.0975452,-.490393,0],[-.0731589,-.367794,0],[-918485e-22,-.5,0],[-688864e-22,-.375,0],[.0975452,-.490393,0],[.0731589,-.367794,0],[.191342,-.46194,0],[.143506,-.346455,0],[.277785,-.415735,0],[.208339,-.311801,0],[.353553,-.353553,0],[.265165,-.265165,0],[.415735,-.277785,0],[.311801,-.208339,0],[.46194,-.191342,0],[.346455,-.143506,0],[.490393,-.0975452,0],[.367794,-.0731589,0],[.5,-122465e-21,0],[.375,-918485e-22,0]],faces:[[0,1,2],[0,3,2],[3,2,4],[3,5,4],[5,4,6],[5,7,6],[7,6,8],[7,9,8],[9,8,10],[9,11,10],[11,10,12],[11,13,12],[13,12,14],[13,15,14],[15,14,16],[15,17,16],[17,16,18],[17,19,18],[19,18,20],[19,21,20],[21,20,22],[21,23,22],[23,22,24],[23,25,24],[25,24,26],[25,27,26],[27,26,28],[27,29,28],[29,28,30],[29,31,30],[31,30,32],[31,33,32],[33,32,34],[33,35,34],[35,34,36],[35,37,36],[37,36,38],[37,39,38],[39,38,40],[39,41,40],[41,40,42],[41,43,42],[43,42,44],[43,45,44],[45,44,46],[45,47,46],[47,46,48],[47,49,48],[49,48,50],[49,51,50],[51,50,52],[51,53,52],[53,52,54],[53,55,54],[55,54,56],[55,57,56],[57,56,58],[57,59,58],[59,58,60],[59,61,60],[61,60,62],[61,63,62],[63,62,64],[63,65,64]]},{name:"CircleHalf",vertices:[[0,0,0],[306162e-22,-.5,0],[.0975452,-.490393,0],[.191342,-.46194,0],[.277785,-.415735,0],[.353553,-.353553,0],[.415735,-.277785,0],[.46194,-.191342,0],[.490393,-.0975452,0],[.5,0,0],[.490393,.0975452,0],[.46194,.191342,0],[.415735,.277785,0],[.353553,.353553,0],[.277785,.415735,0],[.191342,.46194,0],[.0975452,.490393,0],[306162e-22,.5,0]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,6],[0,6,7],[0,7,8],[0,8,9],[0,9,10],[0,10,11],[0,11,12],[0,12,13],[0,13,14],[0,14,15],[0,15,16],[0,16,17]]},{name:"CircleHalfOutline",vertices:[[229621e-22,-.375,0],[306162e-22,-.5,0],[.0975452,-.490393,0],[.0731589,-.367794,0],[.191342,-.46194,0],[.143506,-.346455,0],[.277785,-.415735,0],[.208339,-.311801,0],[.353553,-.353553,0],[.265165,-.265165,0],[.415735,-.277785,0],[.311801,-.208339,0],[.46194,-.191342,0],[.346455,-.143506,0],[.490393,-.0975452,0],[.367794,-.0731589,0],[.5,0,0],[.375,0,0],[.490393,.0975452,0],[.367794,.0731589,0],[.46194,.191342,0],[.346455,.143506,0],[.415735,.277785,0],[.311801,.208339,0],[.353553,.353553,0],[.265165,.265165,0],[.277785,.415735,0],[.208339,.311801,0],[.191342,.46194,0],[.143506,.346455,0],[.0975452,.490393,0],[.0731589,.367794,0],[306162e-22,.5,0],[229621e-22,.375,0]],faces:[[0,1,2],[0,3,2],[3,2,4],[3,5,4],[5,4,6],[5,7,6],[7,6,8],[7,9,8],[9,8,10],[9,11,10],[11,10,12],[11,13,12],[13,12,14],[13,15,14],[15,14,16],[15,17,16],[17,16,18],[17,19,18],[19,18,20],[19,21,20],[21,20,22],[21,23,22],[23,22,24],[23,25,24],[25,24,26],[25,27,26],[27,26,28],[27,29,28],[29,28,30],[29,31,30],[31,30,32],[31,33,32]]},{name:"CircleOutlineThin",vertices:[[.45,0,0],[.5,0,0],[.490393,.0975452,0],[.441353,.0877906,0],[.46194,.191342,0],[.415746,.172208,0],[.415735,.277785,0],[.374161,.250007,0],[.353553,.353553,0],[.318198,.318198,0],[.277785,.415735,0],[.250007,.374161,0],[.191342,.46194,0],[.172208,.415746,0],[.0975452,.490393,0],[.0877906,.441353,0],[306162e-22,.5,0],[275546e-22,.45,0],[-.0975452,.490393,0],[-.0877906,.441353,0],[-.191342,.46194,0],[-.172208,.415746,0],[-.277785,.415735,0],[-.250007,.374161,0],[-.353553,.353553,0],[-.318198,.318198,0],[-.415735,.277785,0],[-.374161,.250007,0],[-.46194,.191342,0],[-.415746,.172208,0],[-.490393,.0975452,0],[-.441353,.0877906,0],[-.5,612323e-22,0],[-.45,551091e-22,0],[-.490393,-.0975452,0],[-.441353,-.0877906,0],[-.46194,-.191342,0],[-.415746,-.172208,0],[-.415735,-.277785,0],[-.374161,-.250007,0],[-.353553,-.353553,0],[-.318198,-.318198,0],[-.277785,-.415735,0],[-.250007,-.374161,0],[-.191342,-.46194,0],[-.172208,-.415746,0],[-.0975452,-.490393,0],[-.0877906,-.441353,0],[-918485e-22,-.5,0],[-826637e-22,-.45,0],[.0975452,-.490393,0],[.0877906,-.441353,0],[.191342,-.46194,0],[.172208,-.415746,0],[.277785,-.415735,0],[.250007,-.374161,0],[.353553,-.353553,0],[.318198,-.318198,0],[.415735,-.277785,0],[.374161,-.250007,0],[.46194,-.191342,0],[.415746,-.172208,0],[.490393,-.0975452,0],[.441353,-.0877906,0],[.5,-122465e-21,0],[.45,-110218e-21,0]],faces:[[0,1,2],[0,3,2],[3,2,4],[3,5,4],[5,4,6],[5,7,6],[7,6,8],[7,9,8],[9,8,10],[9,11,10],[11,10,12],[11,13,12],[13,12,14],[13,15,14],[15,14,16],[15,17,16],[17,16,18],[17,19,18],[19,18,20],[19,21,20],[21,20,22],[21,23,22],[23,22,24],[23,25,24],[25,24,26],[25,27,26],[27,26,28],[27,29,28],[29,28,30],[29,31,30],[31,30,32],[31,33,32],[33,32,34],[33,35,34],[35,34,36],[35,37,36],[37,36,38],[37,39,38],[39,38,40],[39,41,40],[41,40,42],[41,43,42],[43,42,44],[43,45,44],[45,44,46],[45,47,46],[47,46,48],[47,49,48],[49,48,50],[49,51,50],[51,50,52],[51,53,52],[53,52,54],[53,55,54],[55,54,56],[55,57,56],[57,56,58],[57,59,58],[59,58,60],[59,61,60],[61,60,62],[61,63,62],[63,62,64],[63,65,64]]},{name:"CircleQuarter",vertices:[[0,0,0],[.5,0,0],[.490393,.0975452,0],[.46194,.191342,0],[.415735,.277785,0],[.353553,.353553,0],[.277785,.415735,0],[.191342,.46194,0],[.0975452,.490393,0],[306162e-22,.5,0]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,6],[0,6,7],[0,7,8],[0,8,9]]},{name:"CircleQuarterOutline",vertices:[[.375,0,0],[.5,0,0],[.490393,.0975452,0],[.367794,.0731589,0],[.46194,.191342,0],[.346455,.143506,0],[.415735,.277785,0],[.311801,.208339,0],[.353553,.353553,0],[.265165,.265165,0],[.277785,.415735,0],[.208339,.311801,0],[.191342,.46194,0],[.143506,.346455,0],[.0975452,.490393,0],[.0731589,.367794,0],[306162e-22,.5,0],[229621e-22,.375,0]],faces:[[0,1,2],[0,3,2],[3,2,4],[3,5,4],[5,4,6],[5,7,6],[7,6,8],[7,9,8],[9,8,10],[9,11,10],[11,10,12],[11,13,12],[13,12,14],[13,15,14],[15,14,16],[15,17,16]]},{name:"CircleHalfQuarter",vertices:[[0,0,0],[.353553,.353553,0],[.277785,.415735,0],[.191342,.46194,0],[.0975452,.490393,0],[306162e-22,.5,0]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5]]},{name:"CircleHalfQuarterOutline",vertices:[[.265165,.265165,0],[.353553,.353553,0],[.277785,.415735,0],[.208339,.311801,0],[.191342,.46194,0],[.143506,.346455,0],[.0975452,.490393,0],[.0731589,.367794,0],[306162e-22,.5,0],[229621e-22,.375,0]],faces:[[0,1,2],[0,3,2],[3,2,4],[3,5,4],[5,4,6],[5,7,6],[7,6,8],[7,9,8]]}],ka=[{name:"Arrow",vertices:[[.114711,.0941153,0],[-.385289,.0941153,0],[-.385289,-.0941153,0],[.114711,-.0941153,0],[.0131641,.403351,0],[.495352,0,0],[-.0995,.272262,0],[-.0995,-.272262,0],[.0131641,-.403351,0]],faces:[[0,1,2],[2,3,0],[4,5,6],[6,5,0],[0,5,3],[3,5,7],[7,5,8]]},{name:"ArrowHead",vertices:[[.0131641,.403352,0],[.495352,24e-8,0],[-.0995,.272262,0],[.218477,24e-8,0],[-.0995,-.272262,0],[.0131641,-.403351,0]],faces:[[0,1,2],[2,1,3],[3,1,4],[4,1,5]]}],za=[{name:"HexagonFilled",vertices:[[0,0,0],[306162e-22,.5,0],[-.433013,.25,0],[-.433013,-.25,0],[-918485e-22,-.5,0],[.433013,-.25,0],[.433013,.25,0],[153081e-21,.5,0]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,6],[0,6,7]]},{name:"HexagonOutline",vertices:[[213889e-22,.349307,0],[306162e-22,.5,0],[-.433013,.25,0],[-.302509,.174654,0],[-.433013,-.25,0],[-.302509,-.174654,0],[-918485e-22,-.5,0],[-641667e-22,-.349307,0],[.433013,-.25,0],[.302509,-.174654,0],[.433013,.25,0],[.302509,.174654,0],[153081e-21,.5,0],[106944e-21,.349307,0]],faces:[[0,1,2],[0,3,2],[3,2,4],[3,5,4],[5,4,6],[5,7,6],[7,6,8],[7,9,8],[9,8,10],[9,11,10],[11,10,12],[11,13,12]]},{name:"HexagonOutlineThin",vertices:[[278607e-22,.455,0],[306162e-22,.5,0],[-.433013,.25,0],[-.394042,.2275,0],[-.433013,-.25,0],[-.394042,-.2275,0],[-918485e-22,-.5,0],[-835821e-22,-.455,0],[.433013,-.25,0],[.394042,-.2275,0],[.433013,.25,0],[.394042,.2275,0],[153081e-21,.5,0],[139304e-21,.455,0]],faces:[[0,1,2],[0,3,2],[3,2,4],[3,5,4],[5,4,6],[5,7,6],[7,6,8],[7,9,8],[9,8,10],[9,11,10],[11,10,12],[11,13,12]]},{name:"HexagonHalf",vertices:[[0,.5,0],[0,-.5,0],[.433013,.25,0],[.433013,-.25,0]],faces:[[0,1,2],[2,1,3]]},{name:"HexagonHalfOutline",vertices:[[0,.5,0],[0,.35,0],[.433013,.25,0],[.303109,.175,0],[.433013,-.25,0],[.303109,-.175,0],[0,-.5,0],[0,-.35,0]],faces:[[0,1,2],[2,1,3],[3,2,4],[4,3,5],[5,4,6],[6,5,7]]},{name:"HexagonHalfOutlineThin",vertices:[[0,.5,0],[0,.45,0],[.433013,.25,0],[.394042,.2275,0],[.433013,-.25,0],[.394042,-.2275,0],[0,-.5,0],[0,-.45,0]],faces:[[0,1,2],[2,1,3],[3,2,4],[4,3,5],[5,4,6],[6,5,7]]}];[..._a.map(n=>n.name),...Ta.map(n=>n.name),...Ma.map(n=>n.name),...ka.map(n=>n.name),...wa.map(n=>n.name),...za.map(n=>n.name)];const qe=[_a,Ta,Ma,ka,wa,za];function dl(n,e){return qe[n||0][e||0].name}function ml(n){let e=0,t=0;for(e=0;e<100&&qe[e]!==void 0;e++)for(t=0;t<100&&qe[e][t]!==void 0;t++)if(qe[e][t].name===n)return{s:e,so:t};return{s:e,so:t}}class Jt{static stats;static resetStats(){this.stats={conversionTime:0,themes:0,objects:0,prefabs:0,prefabInstances:0,keyframes:{}}}static levelFromVgd(e){this.resetStats();const t=performance.now(),i=new lt;if(i.events=this.eventsFromVgd(e.events),e.objects&&e.objects.forEach(r=>{i.addObject(this.animatableFromVgd(r)),this.stats.objects++}),(e.prefabObjects||e.prefab_objects)&&e.prefabs&&e.prefabs.length>0){const r=e.prefabObjects??e.prefab_objects;r&&r.length>0&&r.forEach(a=>{const o=e.prefabs.filter(h=>h.id===a.pid)[0];o&&(this.prefabInstanceFromVgd(a,o).forEach(h=>{i.addObject(h),this.stats.objects++}),this.stats.prefabInstances++)})}e.prefabs&&(this.stats.prefabs=e.prefabs.length),e.themes&&e.themes.forEach(r=>{i.themes.set(r.id,this.themeFromVgd(r))});const s=performance.now();return this.stats.conversionTime=s-t,i}static prefabInstanceFromVgd(e,t){const i=[],s=new _e,r=s.addComponent("Animation2D");if(s.id=e.id,s.name="Prefab Parent",r.spawnTime=e.t,e.e){const a=e.e[0]?.ev??[0,0],o=e.e[1]?.ev??[1,1];r.addKeyframe("Move",{data:[a[0]??0,a[1]??0]}),r.addKeyframe("Scale",{data:[o[0]??0,o[1]??0]})}return i.push(s),t.objs.forEach(a=>{a.id=ts(),a.p_id||(a.p_id=s.id,a.p_t="111"),i.push(this.animatableFromVgd(a,e.t))}),i}static animatableFromVgd(e,t=0){const i=new _e;i.addComponent("Animation2D");const s=i.getComponent("Animation2D"),r=(e.st??0)+t;s.zOffset=0-(e.d??20),s.spawnTime=r,s.setParenting("Move",!0).setParenting("Scale",!1).setParenting("Rotation",!0);const a=this.keyframeTrackFromVgd(e.e[0].k,"Move",r),o=this.keyframeTrackFromVgd(e.e[1].k,"Scale",r),h=this.keyframeTrackFromVgd(e.e[2].k,"Rotation",r),l=this.keyframeTrackFromVgd(e.e[3].k,"Color",r);if(s.createTrack("Move",a),s.createTrack("Scale",o),s.createTrack("Rotation",h),s.createTrack("Color",l),e.ak_t)switch(e.ak_t){case 1:{let c=0;[a,o,h,l].forEach(u=>{u.sortByTime(),u.forEach(f=>{f.time>c&&(c=f.time)})}),s.lifetime=c-s.spawnTime;break}case 2:{let c=0;[a,o,h,l].forEach(u=>{u.sortByTime(),u.forEach(f=>{f.time>c&&(c=f.time)})}),s.lifetime=c-s.spawnTime+(e.ak_o||0);break}case 3:{s.lifetime=e.ak_o||0;break}case 4:{s.lifetime=(e.ak_o||0)-s.spawnTime;break}}if(e.id&&(i.id=e.id),e.n&&(i.name=e.n),e.o&&(s.origin={x:e.o.x,y:e.o.y}),e.p_id&&(s.parentId=e.p_id),e.p_t){const c=e.p_t.split("");s.setParenting("Move",c[0]=="1"),s.setParenting("Scale",c[1]=="1"),s.setParenting("Rotation",c[2]=="1")}if(e.p_o&&(s.setParentOffset("Move",e.p_o[0]),s.setParentOffset("Scale",e.p_o[1]),s.setParentOffset("Rotation",e.p_o[2])),e.s&&e.s>5&&(e.s=0),e.so&&e.so>[2,8,5,1,0,5][e.s??0]&&(e.so=0),e.ot!=6&&e.ot!=3){const c=dl(e.s,e.so);s.mesh=c}else s.mesh=void 0;return i}static keyframeTrackFromVgd(e,t,i=0){const s=new kn;if(t=="Rotation"){let r=0;e.forEach(a=>{a.ev[1]==1&&(r=0),r+=a.ev[0],a.ev[0]=r,s.push(this.keyframeFromVgd(a,t,i))})}else e.forEach(r=>{s.push(this.keyframeFromVgd(r,t,i))});return s}static keyframeFromVgd(e,t,i=0){const s=new $e;if(s.time=(e.t??0)+i,e.ct&&(s.easing=e.ct),e.r&&(s.randomize=Object.keys(cs)[e.r]),e.ev)switch(t){case"Color":{s.data=[e.ev[0],(e.ev[1]==null?100:e.ev[1])/100];break}case"Rotation":{s.data=[e.ev[0]];break}default:s.data=e.ev}if(e.er)switch(t){case"Color":{s.random=[e.er[0],e.er[1]??0];break}case"Rotation":{s.random=[e.er[0]];break}default:s.random=e.er}return this.stats.keyframes[t]?this.stats.keyframes[t]++:this.stats.keyframes[t]=1,s}static themeFromVgd(e){const t={id:e.id,name:e.name,objects:e.obj.map(i=>P.hexToRgba(i)||{r:0,g:0,b:0}),effects:e.fx.map(i=>P.hexToRgba(i)||{r:0,g:0,b:0}),parallax:e.bg.map(i=>P.hexToRgba(i)||{r:0,g:0,b:0}),background:P.hexToRgba(e.base_bg),gui:P.hexToRgba(e.base_gui),guiAccent:P.hexToRgba(e.base_gui_accent)};return this.stats.themes++,t}static eventsFromVgd(e){const t=new _e,i=t.addComponent("Animation3D").addKeyframe("AmbientLight",{data:[40]}).addKeyframe("CameraFOV",{data:[45]}).addKeyframe("CameraMove",{data:[0,0,100]}).addKeyframe("CameraTarget",{data:[0,0,0]}).addKeyframe("LightSourceLuminosity",{data:[100]}).addKeyframe("LightSourceMove",{data:[100,100,0]});for(const s of e[0])i.addKeyframe("CameraMove",{data:[...s.ev,100],time:s.t??0,easing:s.ct}),i.addKeyframe("CameraTarget",{data:[...s.ev,100],time:s.t??0,easing:s.ct}),this.stats.keyframes.CameraMove?this.stats.keyframes.CameraMove++:this.stats.keyframes.CameraMove=1;for(const s of e[1]){const r=this.toPaZoom(s.ev[0]??30);i.addKeyframe("CameraFOV",{data:[r],time:s.t??0,easing:s.ct}),this.stats.keyframes.CameraFOV?this.stats.keyframes.CameraFOV++:this.stats.keyframes.CameraFOV=1}for(const s of e[4])i.addKeyframe("Theme",{themeId:s.evs[0],time:s.t??0,easing:s.ct}),this.stats.keyframes.Theme?this.stats.keyframes.Theme++:this.stats.keyframes.Theme=1;return t}static toPaZoom(e){return-.0028*Math.pow(e,2)+1.2*e+-.1}}const ot=24,ht=4096;class pl{_buffers;_writeIndex=0;_readIndex=1;constructor(){this._buffers=[this._createBuffer(),this._createBuffer()]}_createBuffer(){return{data:new Float32Array(ht*ot),indices:new Uint32Array(ht),positions:new Float32Array(ht*3),depths:new Float32Array(ht),count:0}}reset(){this._buffers[this._writeIndex].count=0}commit(){const e=this._writeIndex;this._writeIndex=this._readIndex,this._readIndex=e}getReadBuffer(){return this._buffers[this._readIndex]}add(e,t,i){const s=this._buffers[this._writeIndex];if(s.count>=ht)return;const r=s.count;let a=r*ot;const o=s.data;o[a++]=t[0],o[a++]=t[1],o[a++]=t[2],o[a++]=t[3];const h=i||t;o[a++]=h[0],o[a++]=h[1],o[a++]=h[2],o[a++]=h[3];const l=e.elements;for(let f=0;f<16;f++)o[a++]=l[f];const c=s.positions,u=r*3;c[u]=l[12],c[u+1]=l[13],c[u+2]=l[14],s.indices[r]=r,s.count++}sort(e,t=!0){const i=this._buffers[this._readIndex];if(i.count<2)return;const s=i.count,r=i.indices,a=i.positions,o=i.depths,h=e.x,l=e.y,c=e.z;for(let f=0;f<s;f++){const d=a[f*3],m=a[f*3+1],x=a[f*3+2];o[f]=(d-h)**2+(m-l)**2+(x-c)**2}const u=r.subarray(0,s);t?u.sort((f,d)=>o[d]-o[f]):u.sort((f,d)=>o[f]-o[d])}getSortedData(e){const t=this._buffers[this._readIndex],i=t.count;if(i===0)return e;const s=t.indices,r=t.data;for(let a=0;a<i;a++){const h=s[a]*ot,l=a*ot;e.set(r.subarray(h,h+ot),l)}return e}get size(){return this._buffers[this._readIndex].count}get data(){return this._buffers[this._readIndex].data}}class ke{static isError;static handlers;static opaqueBatches=new Map;static transparentBatches=new Map;static init(){this.isError=!1,this.handlers=new Map,this.opaqueBatches.clear(),this.transparentBatches.clear(),console.info("Runtime Service initialized")}static register(e,t){this.handlers.has(e)&&(console.warn(`[RuntimeService] Component handler for type "${e}" was already registered, the previous entry will be overwritten!`),this.handlers.delete(e)),this.handlers.set(e,t),console.info(`[RuntimeService] Registered component handler "${e}" -> ${t.name}`)}static clean(){this.opaqueBatches.forEach(e=>e.reset()),this.transparentBatches.forEach(e=>e.reset())}static commit(){this.opaqueBatches.forEach(e=>e.commit()),this.transparentBatches.forEach(e=>e.commit())}static update(e,t,i,s){this.isError||!t||t.components.forEach(r=>{this.runHandler(r,e,t,i,s)})}static runHandler(e,t,i,s,r){e.update();const a=e.type(),o=this.handlers.get(a);o?o(this,t,e,i,s,r):console.error(`No handler was registered to handle component "${a}"!`)}static queueMesh(e,t,i,s){const a=i[3]<.99?this.transparentBatches:this.opaqueBatches;let o=a.get(e);o||(o=new pl,a.set(e,o)),o.add(t,i,s)}}const Ca=Math.PI,st=Ca/2,en=1/2.75,tn=2/2.75,Ie=1.5/2.75,nn=2.5/2.75,Fe=2.25/2.75,Oe=2.625/2.75,gl=n=>dr[n||"Linear"]||dr.Linear,dr={Linear:n=>n,Instant:()=>0,InSine:n=>n===1?1:-Math.cos(st*n)+1,OutSine:n=>Math.sin(st*n),InOutSine:n=>-Math.cos(Ca*n)/2+.5,InElastic:n=>Math.sin(13*st*n)*Math.pow(2,10*(n-1)),OutElastic:n=>n===1?1:Math.sin(-13*st*(n+1))*Math.pow(2,-10*n)+1,InOutElastic:n=>n<.5?.5*Math.sin(13*st*(2*n))*Math.pow(2,10*(2*n-1)):.5*(Math.sin(-13*st*(2*n-1+1))*Math.pow(2,-10*(2*n-1))+2),InBack:n=>n*n*(2.70158*n-1.70158),OutBack:n=>1- --n*n*(-2.70158*n-1.70158),InOutBack:n=>{const t=2.5949095;return n*=2,n<1?.5*(n*n*((t+1)*n-t)):(n-=2,.5*(n*n*((t+1)*n+t)+2))},InBounce:n=>(n=1-n,n<en?1-7.5625*n*n:n<tn?1-(7.5625*(n-Ie)*(n-Ie)+.75):n<nn?1-(7.5625*(n-Fe)*(n-Fe)+.9375):1-(7.5625*(n-Oe)*(n-Oe)+.984375)),OutBounce:n=>n<en?7.5625*n*n:n<tn?7.5625*(n-Ie)*(n-Ie)+.75:n<nn?7.5625*(n-Fe)*(n-Fe)+.9375:7.5625*(n-Oe)*(n-Oe)+.984375,InOutBounce:n=>n<.5?(n=1-n*2,n<en?(1-7.5625*n*n)/2:n<tn?(1-(7.5625*(n-Ie)*(n-Ie)+.75))/2:n<nn?(1-(7.5625*(n-Fe)*(n-Fe)+.9375))/2:(1-(7.5625*(n-Oe)*(n-Oe)+.984375))/2):(n=n*2-1,n<en?7.5625*n*n/2+.5:n<tn?(7.5625*(n-Ie)*(n-Ie)+.75)/2+.5:n<nn?(7.5625*(n-Fe)*(n-Fe)+.9375)/2+.5:(7.5625*(n-Oe)*(n-Oe)+.984375)/2+.5),InQuad:n=>n*n,OutQuad:n=>-n*(n-2),InOutQuad:n=>n<=.5?n*n*2:1- --n*n*2,InCirc:n=>-(Math.sqrt(1-n*n)-1),OutCirc:n=>Math.sqrt(1-(n-1)*(n-1)),InOutCirc:n=>n<=.5?(Math.sqrt(1-n*n*4)-1)/-2:(Math.sqrt(1-(n*2-2)*(n*2-2))+1)/2,InExpo:n=>Math.pow(2,10*(n-1)),OutExpo:n=>n===1?1:-Math.pow(2,-10*n)+1,InOutExpo:n=>n===1?1:n<.5?Math.pow(2,10*(n*2-1))/2:(-Math.pow(2,-10*(n*2-1))+2)/2},Ci=new Map,fe=[],xl=[],bl=[],rt={prev:null,next:null,t:0};class le{static interpolateTracks(e,t,i,s=!1,r={}){for(const a in t.tracks){const o=a,h=t.tracks[o];if(!h)continue;let l=!0,c=0;if(i){const g=i[o];g&&(l=g.enabled,c=g.offset)}this.interpolateTrack(h,e-c);const{prev:u,next:f,t:d}=rt;let m=u.data,x=f.data;if(u.randomize&&(m=this.getRandom(u,xl)),f.randomize&&(x=this.getRandom(f,bl)),l||!s){let g=r[o];g||(g=[],r[o]=g),this.lerpArrays(m,x,d,g)}}return r}static interpolateTheme(e,t,i){this.interpolateTrack(i,e);const{prev:s,next:r,t:a}=rt,o=t.get(s.themeId??""),h=t.get(r.themeId??"");if(!o&&!h)throw new Error("Missing themes for interpolation");if(!o)return h;if(!h)return o;const l=this.getCachedTheme(o),c=this.getCachedTheme(h);this.lerpArrays(l.background,c.background,a,fe);const u=P.rawToRgba(fe);this.lerpArrays(l.gui,c.gui,a,fe);const f=P.rawToRgba(fe);this.lerpArrays(l.guiAccent,c.guiAccent,a,fe);const d=P.rawToRgba(fe),m=l.effects.map((p,y)=>(this.lerpArrays(p,c.effects[y],a,fe),P.rawToRgba(fe))),x=l.parallax.map((p,y)=>(this.lerpArrays(p,c.parallax[y],a,fe),P.rawToRgba(fe))),g=l.objects.map((p,y)=>(this.lerpArrays(p,c.objects[y],a,fe),P.rawToRgba(fe)));return{id:o.id,name:o.name,background:u,gui:f,guiAccent:d,effects:m,parallax:x,objects:g}}static lerpArrays(e,t,i,s){const r=e.length,a=s||new Array(r);a.length!==r&&(a.length=r);for(let o=0;o<r;o++)a[o]=e[o]+(t[o]-e[o])*i;return a}static getRandom(e,t,i){if(!e.random||!e.randomize||e.randomize==="None")return e.data;const s=e.data,r=e.random,a=s.length,o=t||new Array(a);o.length!==a&&(o.length=a);const h=i??e.randomSeed;switch(e.randomize){case"Linear":{for(let l=0;l<a;l++){const c=h+l*761;o[l]=this.seededRandomBetween(s[l],r[l],c)}break}case"Toggle":{for(let l=0;l<a;l++){const c=h+l*761,u=this.seededRandom(c)>=.5?s:r;o[l]=u[l]}break}}return o}static interpolateTrack(e,t){const{prev:i,next:s}=e.keyframesAt(t),r=s.time-i.time,a=r===0?1:Math.max(0,Math.min(1,(t-i.time)/r));return rt.prev=i,rt.next=s,rt.t=gl(s.easing)(a),rt}static seededRandom(e){let t=e+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}static seededRandomBetween(e,t,i){return this.seededRandom(i)*(t-e)+e}static getCachedTheme(e){if(!Ci.has(e.id)){const t=P.rgbaToRaw(e.background),i=P.rgbaToRaw(e.gui),s=P.rgbaToRaw(e.guiAccent),r=e.effects.map(h=>P.rgbaToRaw(h)),a=e.parallax.map(h=>P.rgbaToRaw(h)),o=e.objects.map(h=>P.rgbaToRaw(h));Ci.set(e.id,{background:t,gui:i,guiAccent:s,effects:r,parallax:a,objects:o})}return Ci.get(e.id)}}class mr{constructor(e,t,i){if(this.gl=e,this.vertexCount=t.length/3,this.vao=e.createVertexArray(),this.vboPos=e.createBuffer(),this.vboNor=e.createBuffer(),this.vboInst=e.createBuffer(),!this.vao)throw new Error("Failed to create VertexAtrributeArray!");this.gl.bindVertexArray(this.vao),this.bindAttribute(this.vboPos,t,0,3),this.bindAttribute(this.vboNor,i,1,3),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboInst);const s=96;e.enableVertexAttribArray(2),e.vertexAttribPointer(2,4,e.FLOAT,!1,s,0),e.vertexAttribDivisor(2,1),e.enableVertexAttribArray(3),e.vertexAttribPointer(3,4,e.FLOAT,!1,s,16),e.vertexAttribDivisor(3,1);for(let r=0;r<4;r++){const a=4+r;e.enableVertexAttribArray(a),e.vertexAttribPointer(a,4,e.FLOAT,!1,s,32+r*16),e.vertexAttribDivisor(a,1)}this.gl.bindVertexArray(null)}vao;vboPos;vboNor;vboInst;vertexCount=0;instanceCount=0;bindAttribute(e,t,i,s){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e),this.gl.bufferData(this.gl.ARRAY_BUFFER,t,this.gl.STATIC_DRAW),this.gl.enableVertexAttribArray(i),this.gl.vertexAttribPointer(i,s,this.gl.FLOAT,!1,0,0)}bind(){this.vao&&this.gl.bindVertexArray(this.vao)}unbind(){this.gl.bindVertexArray(null)}draw(){this.instanceCount!==0&&(this.gl.bindVertexArray(this.vao),this.gl.drawArraysInstanced(this.gl.TRIANGLES,0,this.vertexCount,this.instanceCount),this.gl.bindVertexArray(null))}uploadInstanceData(e,t){this.instanceCount=t,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboInst);const i=t*24,s=e.subarray(0,i);this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.DYNAMIC_DRAW)}dispose(){this.vboPos&&this.gl.deleteBuffer(this.vboPos),this.vboNor&&this.gl.deleteBuffer(this.vboNor),this.vboInst&&this.gl.deleteBuffer(this.vboInst),this.vao&&this.gl.deleteVertexArray(this.vao),this.vboPos=null,this.vboNor=null,this.vboInst=null,this.vao=null}}class vn{constructor(e,t,i){this.gl=e,this.width=t,this.height=i,this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,i,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.fbo=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.fbo),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0);const s=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,s),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t,i),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,s),e.bindFramebuffer(e.FRAMEBUFFER,null)}fbo;texture;width;height;bind(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbo),this.gl.viewport(0,0,this.width,this.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}unbind(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}}class Sa{constructor(e){this.gl=e;const t=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);this.vao=e.createVertexArray();const i=e.createBuffer();e.bindVertexArray(this.vao),e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0),e.bindVertexArray(null)}vao;draw(){this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}}class yl{passes=[];quad;readBuffer;writeBuffer;constructor(e,t,i){this.quad=new Sa(e),this.readBuffer=new vn(e,t,i),this.writeBuffer=new vn(e,t,i)}addPass(e){this.passes.push(e)}resize(){}render(e,t){let i=t;for(let s=0;s<this.passes.length;s++){const r=this.passes[s];if(!r.enabled)continue;const a=s===this.passes.length-1;a?(e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height)):this.writeBuffer.bind(),e.clear(e.COLOR_BUFFER_BIT),r.shader.use(),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i),r.shader.setUniform("uTexture","1i",0),r.onApply&&r.onApply(r.shader),this.quad.draw(),a||(i=this.writeBuffer.texture,this.swapBuffers())}this.passes.length===0&&(e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height))}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}}class _n{constructor(e,t,i){this.gl=e;const s=this.compile(e.VERTEX_SHADER,t),r=this.compile(e.FRAGMENT_SHADER,i);if(this.program=e.createProgram(),e.attachShader(this.program,s),e.attachShader(this.program,r),e.linkProgram(this.program),!e.getProgramParameter(this.program,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(this.program)||"Link Error")}program;uniforms=new Map;compile(e,t){const i=this.gl.createShader(e);if(this.gl.shaderSource(i,t),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))throw new Error(this.gl.getShaderInfoLog(i)||"Compile Error");return i}use(){this.gl.useProgram(this.program)}setUniform(e,t,i){if(!this.uniforms.has(e)){const r=this.gl.getUniformLocation(this.program,e);r&&this.uniforms.set(e,r)}const s=this.uniforms.get(e);s&&(t==="1f"&&this.gl.uniform1f(s,i),t==="2fv"&&this.gl.uniform2fv(s,i),t==="3fv"&&this.gl.uniform3fv(s,i),t==="4fv"&&this.gl.uniform4fv(s,i),t==="1i"&&this.gl.uniform1i(s,i))}}const Wi=`#version 300 es
layout(location=0) in vec2 aPos;

out vec2 vUv;

void main() {
  vUv = aPos * 0.5 + 0.5;
  gl_Position = vec4(aPos, 0.0, 1.0);
}`,vl=`#version 300 es
precision mediump float;
in vec2 vUv;
uniform sampler2D uTexture;
uniform vec2 uTexelSize;
uniform float uThreshold;
uniform bool uIsFirstPass;

out vec4 FragColor;

void main() {
  vec4 d = uTexelSize.xyxy * vec4(-1.0, -1.0, 1.0, 1.0);

  vec4 s1 = texture(uTexture, vUv + d.xy);
  vec4 s2 = texture(uTexture, vUv + d.zy);
  vec4 s3 = texture(uTexture, vUv + d.xw);
  vec4 s4 = texture(uTexture, vUv + d.zw);

  vec4 color = (s1 + s2 + s3 + s4) * 0.25;

  if (uIsFirstPass) {
    float brightness = dot(color.rgb, vec3(0.2126, 0.7152, 0.0722));

    if(brightness < uThreshold) {
      color = vec4(0.0);
    }
  }

  FragColor = color;
}`,_l=`#version 300 es
precision mediump float;

in vec2 vUv;

uniform sampler2D uTexture;
uniform float uIntensity;
uniform vec2 uTexelSize;

out vec4 FragColor;

void main() {
  float x = uTexelSize.x;
  float y = uTexelSize.y;

  vec4 d = uTexelSize.xyxy * vec4(1.0, 1.0, -1.0, 0.0);

  vec4 s1 = texture(uTexture, vUv - d.xy);
  vec4 s2 = texture(uTexture, vUv - d.wy);
  vec4 s3 = texture(uTexture, vUv - d.zy);

  vec4 s4 = texture(uTexture, vUv - d.xw);
  vec4 s5 = texture(uTexture, vUv);
  vec4 s6 = texture(uTexture, vUv + d.xw);

  vec4 s7 = texture(uTexture, vUv + d.zy);
  vec4 s8 = texture(uTexture, vUv + d.wy);
  vec4 s9 = texture(uTexture, vUv + d.xy);

  vec4 result = (
    s1 + s3 + s7 + s9 + 
    2.0 * (s2 + s4 + s6 + s8) + 
    4.0 * s5
  ) / 16.0;

  FragColor = result * uIntensity;
}`;class Ml{constructor(e,t,i,s=5){this.gl=e,this.quad=new Sa(e),this.shaderDown=new _n(e,Wi,vl),this.shaderUp=new _n(e,Wi,_l);let r=t,a=i;for(let o=0;o<s&&(r=Math.floor(r/2),a=Math.floor(a/2),!(r<1||a<1));o++)this.mips.push(new vn(e,r,a))}mips=[];shaderDown;shaderUp;quad;render(e){const t=this.gl;this.quad.draw(),this.shaderDown.use(),t.activeTexture(t.TEXTURE0);let i=e;for(let s=0;s<this.mips.length;s++){const r=this.mips[s],a=s===0;r.bind(),t.viewport(0,0,r.width,r.height),t.clear(t.COLOR_BUFFER_BIT),t.bindTexture(t.TEXTURE_2D,i),this.shaderDown.setUniform("uTexture","1i",0),this.shaderDown.setUniform("uTexelSize","2fv",[1/r.width,1/r.height]),this.shaderDown.setUniform("uIsFirstPass","1i",a?1:0),a&&this.shaderDown.setUniform("uThreshold","1f",1),t.drawArrays(t.TRIANGLES,0,6),i=r.texture}this.shaderUp.use(),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE);for(let s=this.mips.length-1;s>0;s--){const r=this.mips[s],a=this.mips[s-1];a.bind(),t.viewport(0,0,a.width,a.height),t.bindTexture(t.TEXTURE_2D,r.texture),this.shaderUp.setUniform("uTexture","1i",0),this.shaderUp.setUniform("uTexelSize","2fv",[1/r.width,1/r.height]),this.shaderUp.setUniform("uIntensity","1f",1),t.drawArrays(t.TRIANGLES,0,6)}return t.disable(t.BLEND),this.mips[0].texture}}const wl=`#version 300 es
layout(location=0) in vec3 a_position;
layout(location=1) in vec3 a_normal;
layout(location=2) in vec4 a_color;
layout(location=3) in vec4 a_shade;
layout(location=4) in mat4 a_modelMatrix; 

uniform mat4 u_viewMatrix;
uniform mat4 u_projectionMatrix;

out vec3 v_worldPosition;
out vec3 v_normal;
out vec4 v_color;
out vec4 v_shade;

void main() {
  vec4 worldPos = a_modelMatrix * vec4(a_position, 1.0);
  gl_Position = u_projectionMatrix * u_viewMatrix * worldPos;

  v_worldPosition = worldPos.xyz;
  v_normal = mat3(a_modelMatrix) * a_normal; 
  
  v_color = a_color;
  v_shade = a_shade;
}`,Tl=`#version 300 es
precision highp float;

#define MAX_LIGHTS 10

in vec3 v_worldPosition;
in vec3 v_normal;
in vec4 v_color;
in vec4 v_shade;

struct Light {
  vec3 pos;
  float lum;
};

uniform Light u_lights[MAX_LIGHTS];
uniform vec3 u_ambientLight;
uniform int u_numLights;

out vec4 FragColor;

void main() {
  vec3 normal = normalize(v_normal);

  float diffuseIntensity = 0.0;
  
  for (int i = 0; i < u_numLights; i++) {
    vec3 lightDir = normalize(u_lights[i].pos - v_worldPosition);
    float diffuseFactor = max(dot(normal, lightDir), 0.0);
    diffuseIntensity += u_lights[i].lum * diffuseFactor;
  }

  float ambientIntensity = length(u_ambientLight);
  float lightingFactor = ambientIntensity + diffuseIntensity;
  lightingFactor = clamp(lightingFactor, 0.0, 1.0);

  vec3 finalColor = mix(v_shade.rgb, v_color.rgb, lightingFactor);

  FragColor = vec4(finalColor, v_color.a);
}`,kl=`#version 300 es
precision mediump float;

in vec2 vUv;

uniform sampler2D uTexture;
uniform float uThreshold;

out vec4 FragColor;

void main() { 
  vec4 color = texture(uTexture, vUv);
  FragColor = color;
}`,zl=new Float32Array(ht*ot);class Cl{gl;canvas;meshCache=new Map;quadGeometry;sceneShader;sceneTarget;ppStack;bloom;uniformLocs={};renderQueue=[];renderQueueCount=0;constructor(e,t){this.canvas=e;const i=this.canvas.getContext("webgl2",t);if(!i)throw new Error("WebGL2 not supported");this.gl=i,this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.disable(this.gl.CULL_FACE)}init(){this.quadGeometry=new mr(this.gl,new Float32Array([-1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0]),new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1])),this.sceneShader=new _n(this.gl,wl,Tl),this.cacheSceneUniforms(),this.sceneTarget=new vn(this.gl,this.canvas.width,this.canvas.height),this.ppStack=new yl(this.gl,this.canvas.width,this.canvas.height),this.bloom=new Ml(this.gl,this.canvas.width,this.canvas.height,6);const e={shader:new _n(this.gl,Wi,kl),enabled:!0,onApply:t=>{t.setUniform("uThreshold","1f",.8)}};this.ppStack.addPass(e)}registerMesh(e,t,i){this.meshCache.has(e)&&this.unregisterMesh(e),this.meshCache.set(e,new mr(this.gl,t,i))}unregisterMesh(e){this.meshCache.get(e)?.dispose(),this.meshCache.delete(e)}dispose(){this.meshCache.forEach(e=>e.dispose()),this.meshCache.clear(),this.quadGeometry.dispose(),this.gl.getExtension("WEBGL_lose_context")?.loseContext()}render(e,t,i,s){this.sceneTarget.bind(),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clearColor(s[0],s[1],s[2],1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.sceneShader.use(),this.uploadGlobalUniforms(e,i,s),this.renderBatches(ke.opaqueBatches,t,!1),this.gl.depthMask(!1),this.renderBatches(ke.transparentBatches,t,!0),this.gl.depthMask(!0),this.sceneTarget.unbind(),this.ppStack.render(this.gl,this.sceneTarget.texture)}renderBatches(e,t,i){e.forEach((s,r)=>{const a=s.size;if(a===0)return;const o=this.meshCache.get(r);if(!o)return;let h;i?(s.sort(t,!0),h=s.getSortedData(zl)):h=s.data,o.bind(),o.uploadInstanceData(h,a),o.draw(),o.unbind()})}cacheSceneUniforms(){this.sceneShader.use();const e=["u_projectionMatrix","u_viewMatrix","u_modelMatrix","u_ambientLight","u_numLights","u_objectColor","u_shadeColor"];for(let t=0;t<10;t++)e.push(`u_lights[${t}].pos`),e.push(`u_lights[${t}].lum`);e.forEach(t=>{this.uniformLocs[t]=this.gl.getUniformLocation(this.sceneShader.program,t)})}uploadGlobalUniforms(e,t,i){const s=this.uniformLocs.u_ambientLight;s&&this.gl.uniform3fv(s,i);const r=this.uniformLocs.u_projectionMatrix,a=this.uniformLocs.u_viewMatrix;r&&this.gl.uniformMatrix4fv(r,!1,e.projection.elements),a&&this.gl.uniformMatrix4fv(a,!1,e.view.elements);const o=this.uniformLocs.u_numLights;o&&this.gl.uniform1i(o,t.length);for(let h=0;h<t.length;h++){const l=t[h],c=this.uniformLocs[`u_lights[${h}].pos`],u=this.uniformLocs[`u_lights[${h}].lum`];c&&this.gl.uniform3f(c,l.pos.x,l.pos.y,l.pos.z),u&&this.gl.uniform1f(u,l.luminosity)}}}function Sl(n,e,t=2){const i=n.length;let s=Al(n,0,i,t,!0);const r=[];if(!s||s.next===s.prev)return r;let a,o,h;if(n.length>80*t){a=n[0],o=n[1];let l=a,c=o;for(let u=t;u<i;u+=t){const f=n[u],d=n[u+1];f<a&&(a=f),d<o&&(o=d),f>l&&(l=f),d>c&&(c=d)}h=Math.max(l-a,c-o),h=h!==0?32767/h:0}return Dt(s,r,t,a,o,h,0),r}function Al(n,e,t,i,s){let r;if(s===$l(n,e,t,i)>0)for(let a=e;a<t;a+=i)r=pr(a/i|0,n[a],n[a+1],r);else for(let a=t-i;a>=e;a-=i)r=pr(a/i|0,n[a],n[a+1],r);return r&&jn(r,r.next)&&(Nt(r),r=r.next),r}function Pt(n,e){if(!n)return n;e||(e=n);let t=n,i;do if(i=!1,!t.steiner&&(jn(t,t.next)||V(t.prev,t,t.next)===0)){if(Nt(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function Dt(n,e,t,i,s,r,a){if(!n)return;!a&&r&&Ol(n,i,s,r);let o=n;for(;n.prev!==n.next;){const h=n.prev,l=n.next;if(r?Rl(n,i,s,r):El(n)){e.push(h.i,n.i,l.i),Nt(n),n=l.next,o=l.next;continue}if(n=l,n===o){a?a===1?(n=Il(Pt(n),e),Dt(n,e,t,i,s,r,2)):a===2&&Fl(n,e,t,i,s,r):Dt(Pt(n),e,t,i,s,r,1);break}}}function El(n){const e=n.prev,t=n,i=n.next;if(V(e,t,i)>=0)return!1;const s=e.x,r=t.x,a=i.x,o=e.y,h=t.y,l=i.y,c=Math.min(s,r,a),u=Math.min(o,h,l),f=Math.max(s,r,a),d=Math.max(o,h,l);let m=i.next;for(;m!==e;){if(m.x>=c&&m.x<=f&&m.y>=u&&m.y<=d&&Et(s,o,r,h,a,l,m.x,m.y)&&V(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function Rl(n,e,t,i){const s=n.prev,r=n,a=n.next;if(V(s,r,a)>=0)return!1;const o=s.x,h=r.x,l=a.x,c=s.y,u=r.y,f=a.y,d=Math.min(o,h,l),m=Math.min(c,u,f),x=Math.max(o,h,l),g=Math.max(c,u,f),p=Xi(d,m,e,t,i),y=Xi(x,g,e,t,i);let b=n.prevZ,v=n.nextZ;for(;b&&b.z>=p&&v&&v.z<=y;){if(b.x>=d&&b.x<=x&&b.y>=m&&b.y<=g&&b!==s&&b!==a&&Et(o,c,h,u,l,f,b.x,b.y)&&V(b.prev,b,b.next)>=0||(b=b.prevZ,v.x>=d&&v.x<=x&&v.y>=m&&v.y<=g&&v!==s&&v!==a&&Et(o,c,h,u,l,f,v.x,v.y)&&V(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;b&&b.z>=p;){if(b.x>=d&&b.x<=x&&b.y>=m&&b.y<=g&&b!==s&&b!==a&&Et(o,c,h,u,l,f,b.x,b.y)&&V(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;v&&v.z<=y;){if(v.x>=d&&v.x<=x&&v.y>=m&&v.y<=g&&v!==s&&v!==a&&Et(o,c,h,u,l,f,v.x,v.y)&&V(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function Il(n,e){let t=n;do{const i=t.prev,s=t.next.next;!jn(i,s)&&Aa(i,t,t.next,s)&&Mn(i,s)&&Mn(s,i)&&(e.push(i.i,t.i,s.i),Nt(t),Nt(t.next),t=n=s),t=t.next}while(t!==n);return Pt(t)}function Fl(n,e,t,i,s,r){let a=n;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&Nl(a,o)){let h=Ul(a,o);a=Pt(a,a.next),h=Pt(h,h.next),Dt(a,e,t,i,s,r,0),Dt(h,e,t,i,s,r,0);return}o=o.next}a=a.next}while(a!==n)}function Ol(n,e,t,i){let s=n;do s.z===0&&(s.z=Xi(s.x,s.y,e,t,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==n);s.prevZ.nextZ=null,s.prevZ=null,Pl(s)}function Pl(n){let e,t=1;do{let i=n,s;n=null;let r=null;for(e=0;i;){e++;let a=i,o=0;for(let l=0;l<t&&(o++,a=a.nextZ,!!a);l++);let h=t;for(;o>0||h>0&&a;)o!==0&&(h===0||!a||i.z<=a.z)?(s=i,i=i.nextZ,o--):(s=a,a=a.nextZ,h--),r?r.nextZ=s:n=s,s.prevZ=r,r=s;i=a}r.nextZ=null,t*=2}while(e>1);return n}function Xi(n,e,t,i,s){return n=(n-t)*s|0,e=(e-i)*s|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function Dl(n,e,t,i,s,r,a,o){return(s-a)*(e-o)>=(n-a)*(r-o)&&(n-a)*(i-o)>=(t-a)*(e-o)&&(t-a)*(r-o)>=(s-a)*(i-o)}function Et(n,e,t,i,s,r,a,o){return!(n===a&&e===o)&&Dl(n,e,t,i,s,r,a,o)}function Nl(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!jl(n,e)&&(Mn(n,e)&&Mn(e,n)&&Ll(n,e)&&(V(n.prev,n,e.prev)||V(n,e.prev,e))||jn(n,e)&&V(n.prev,n,n.next)>0&&V(e.prev,e,e.next)>0)}function V(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function jn(n,e){return n.x===e.x&&n.y===e.y}function Aa(n,e,t,i){const s=rn(V(n,e,t)),r=rn(V(n,e,i)),a=rn(V(t,i,n)),o=rn(V(t,i,e));return!!(s!==r&&a!==o||s===0&&sn(n,t,e)||r===0&&sn(n,i,e)||a===0&&sn(t,n,i)||o===0&&sn(t,e,i))}function sn(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function rn(n){return n>0?1:n<0?-1:0}function jl(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&Aa(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function Mn(n,e){return V(n.prev,n,n.next)<0?V(n,e,n.next)>=0&&V(n,n.prev,e)>=0:V(n,e,n.prev)<0||V(n,n.next,e)<0}function Ll(n,e){let t=n,i=!1;const s=(n.x+e.x)/2,r=(n.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&s<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i}function Ul(n,e){const t=qi(n.i,n.x,n.y),i=qi(e.i,e.x,e.y),s=n.next,r=e.prev;return n.next=e,e.prev=n,t.next=s,s.prev=t,i.next=t,t.prev=i,r.next=i,i.prev=r,i}function pr(n,e,t,i){const s=qi(n,e,t);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function Nt(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function qi(n,e,t){return{i:n,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function $l(n,e,t,i){let s=0;for(let r=e,a=t-i;r<t;r+=i)s+=(n[a]-n[r])*(n[r+1]+n[a+1]),a=r;return s}class Si{static prepareMesh(e,t=!1){const{vertices:i,faces:s}=e,r=this.getGeometricCenter(e),a=new Yi(e);let o;if(t){let h=[];s.forEach(l=>h=[...h,...l]),o=new Uint16Array(h)}else o=this.triangulateMesh(i,s),o=this.fixIndexWindingOrder(o,i,r);return a._indices=new Uint16Array(o),a._flatMesh=this.flatMapMesh(a.vertices,a._indices),a._flatNormals=this.flatMapNormals(a.vertices,a._indices),a}static getGeometricCenter(e){if(e.vertices.length===0)return new M(0,0,0);const t=new M(0,0,0);for(const i of e.vertices)t.add(i);return t.divideScalar(e.vertices.length)}static triangulateMesh(e,t){if(e.length===0)return new Uint16Array;const i=[];for(const s of t){const r=s.length;if(r<3)continue;if(r===3){i.push(...s);continue}const a=s.map(b=>e[b]),o=a[0],h=a[1],l=a[2],c=new M().subVectors(h,o),u=new M().subVectors(l,o),f=new M().crossVectors(c,u),d=Math.abs(f.x),m=Math.abs(f.y),x=Math.abs(f.z);let g;switch(!0){case(d>m&&d>x):{g=a.flatMap(b=>[b.y,b.z]);break}case m>x:{g=a.flatMap(b=>[b.x,b.z]);break}default:{g=a.flatMap(b=>[b.x,b.y]);break}}const y=Sl(g).map(b=>s[b]);i.push(...y)}return new Uint16Array(i)}static fixIndexWindingOrder(e,t,i){if(!e||e.length===0)return console.error("Geometry winding failed; mesh has no indices."),new Uint16Array;const s=new Map;for(let v=0;v<=e.length;v+=3){const z=e[v],C=e[v+1],k=e[v+2],R=[[z,C],[C,k],[k,z]].map(S=>S.sort((A,D)=>A-D).join("-"));for(const S of R)s.has(S)||s.set(S,[]),s.get(S).push(v)}const r=e.length/3,a=new Array(r).fill(!1),o=[];let h=-1,l=0;for(let v=0;v<e.length;v+=3){const z=t[e[v]],C=t[e[v+1]],k=t[e[v+2]],S=z.clone().add(C).add(k).divideScalar(3).lengthSq();S>h&&(h=S,l=v)}const c=e[l],u=e[l+1],f=e[l+2],d=t[c],m=t[u],x=t[f],g=new M().subVectors(m,d),p=new M().subVectors(x,d),y=new M().crossVectors(g,p),b=new M().subVectors(d,i);for(y.dot(b)<0&&(e[l+1]=f,e[l+2]=u),o.push(l),a[l/3]=!0;o.length>0;){const v=o.shift(),z=e[v],C=e[v+1],k=e[v+2],R=[[z,C],[C,k],[k,z]];for(const S of R){const A=[...S].sort((F,B)=>F-B).join("-"),D=s.get(A)||[];for(const F of D){if(F===v)continue;const B=F/3;if(!a[B]){a[B]=!0;const q=e[F],se=e[F+1],re=e[F+2],ae=[[q,se],[se,re],[re,q]];for(const ue of ae)if(ue[0]===S[0]&&ue[1]===S[1]){const oe=e[F+1];e[F+1]=e[F+2],e[F+2]=oe;break}o.push(F)}}}}return e}static flatMapMesh(e,t){if(!t||t.length===0)return console.error("Geometry unindexing failed; mesh has no indices."),new Float32Array;const i=new Float32Array(t.length*3);for(let s=0;s<t.length;s++){const r=t[s],a=e[r],o=s*3;i[o+0]=a.x,i[o+1]=a.y,i[o+2]=a.z}return i}static flatMapNormals(e,t){if(!t||t.length===0)return console.error("Normal calculation failed; mesh has no indices."),new Float32Array;const i=new Float32Array(t.length*3);for(let s=0;s<t.length;s+=3){const r=t[s],a=t[s+1],o=t[s+2],h=e[r],l=e[a],c=e[o],u=new M().subVectors(l,h),f=new M().subVectors(c,h),d=new M().crossVectors(u,f).normalize(),m=s*3,x=(s+1)*3,g=(s+2)*3;i[m]=d.x,i[m+1]=d.y,i[m+2]=d.z,i[x]=d.x,i[x+1]=d.y,i[x+2]=d.z,i[g]=d.x,i[g+1]=d.y,i[g+2]=d.z}return i}}const Ai={name:"Empty",vertices:[],faces:[]};class Yi{name;vertices;faces;isDirty;_indices;_flatMesh;_flatNormals;_material;constructor(e){this.isDirty=!0,this._indices=new Uint16Array,this._flatMesh=new Float32Array,this._flatNormals=new Float32Array,this._material={color:[1,1,1],shade:[0,0,0]},e?(this.name=e.name,this.vertices=structuredClone(e.vertices),this.faces=structuredClone(e.faces)):(this.name=Ai.name,this.vertices=structuredClone(Ai.vertices),this.faces=structuredClone(Ai.faces))}static from(e,t=!1){const i=Si.prepareMesh(e,t);return i._flatMesh||(i._flatMesh=new Float32Array(0)),i._flatNormals||(i._flatNormals=new Float32Array(0)),i}applyMatrix4(e){const t=[];for(const i of this.vertices)i.applyMatrix4(e);return this._flatMesh=Si.flatMapMesh(t,this._indices),this._flatNormals=Si.flatMapNormals(t,this._indices),this}}class ft{static meshData;static meshes;static init(){this.meshData=new Map,this.meshes=new Map,console.info("MeshRegistry initialized")}static registerMesh(e,t=!1){this.meshData.has(e.name)&&(console.warn(`Mesh with name "${e.name}" was already registered! The previous entry will be overwritten!`),this.meshData.delete(e.name),this.meshes.delete(e.name)),this.meshData.set(e.name,structuredClone(e));const i=Yi.from(e,t);this.meshes.set(i.name,i)}static new(e){const t=this.meshData.get(e);if(!t)throw new Error(`Mesh with name "${e}" was not registered.`);return Yi.from(t)}static getFlatMesh(e){const t=this.meshes.get(e);if(!t)throw new Error(`Mesh with name "${e}" was not registered.`);return t._flatMesh}static getFlatNormals(e){const t=this.meshes.get(e);if(!t)throw new Error(`Mesh with name "${e}" was not registered.`);return t._flatNormals}}const Ct=new M(0,0,100),an=new M(0,0,-100),Vl=new M(0,1,0),on={id:"DEFAULT_THEME",name:"New Theme",objects:[{r:25,g:25,b:25},{r:50,g:50,b:50},{r:75,g:75,b:75},{r:100,g:100,b:100},{r:125,g:125,b:125},{r:150,g:150,b:150},{r:175,g:175,b:175},{r:200,g:200,b:200},{r:225,g:225,b:225}],effects:[{r:25,g:25,b:25},{r:50,g:50,b:50},{r:75,g:75,b:75},{r:100,g:100,b:100},{r:125,g:125,b:125},{r:150,g:150,b:150},{r:175,g:175,b:175},{r:200,g:200,b:200},{r:225,g:225,b:225}],parallax:[{r:25,g:25,b:25},{r:50,g:50,b:50},{r:75,g:75,b:75},{r:100,g:100,b:100},{r:125,g:125,b:125},{r:150,g:150,b:150},{r:175,g:175,b:175},{r:200,g:200,b:200},{r:225,g:225,b:225}],background:{r:25,g:25,b:25},gui:{r:200,g:200,b:200},guiAccent:{r:200,g:200,b:200}};class wn{isHeadless;level;renderer;freecamEnabled=!0;freecamPos=new M(0,0,100);freecamTarget=new M(0,0,0);freecamFov=45;_viewMatrix=new Q;_events;_theme;cameraType;perspectiveCamera;orthographicCamera;_activeCamera;constructor(e,t,i){if(e?this.assign(e):(this.level=new lt,this.level.themes.set(on.id,on),this.newEffectsObject()),t){this.isHeadless=!1;const s=t.getBoundingClientRect(),r=s.width/s.height;this.perspectiveCamera=new ul(45,r,.1,1e4);const a=100,o={left:a*r/-2,right:a*r/2,top:a/2,bottom:a/-2,near:.1,far:1e4};this.orthographicCamera=new fl(...Object.values(o)),this.orthographicCamera.zoom=1,this.cameraType="perspective",this._activeCamera=this.perspectiveCamera,this.updateCameraMatrix();const h=Math.min(window.devicePixelRatio||1,2);t.width=s.width*h,t.height=s.height*h,this.renderer=new Cl(t,i),this.renderer.init(),console.info("[Editor] Registering meshes to vbuffer...");let l=0;ft.meshes.forEach((c,u)=>{const f=u,d=ft.getFlatMesh(f),m=ft.getFlatNormals(f);this.renderer.registerMesh(f,d,m),l++}),console.info(`[Editor] Registered ${l} meshes to vbuffer.`),this._theme=structuredClone(on)}else this.isHeadless=!0,console.warn("[Editor] Editor is running in headless mode, no attempt to render will be made.")}static from(e){return new wn(e)}assign(e){return e.level&&(this.level=lt.from(e.level)),this}serialize(){return{level:this.level.serialize()}}update(e){const t=this.level.events.getComponent("Animation3D");this._events=le.interpolateTracks(e,t),this.freecamEnabled?(Ct.copy(this.freecamPos),an.copy(this.freecamTarget),this.perspectiveCamera.fov=this.freecamFov,this.perspectiveCamera.updateProjectionMatrix(),this.orthographicCamera.zoom=this.fovToOrtho(this.freecamFov,100),this.orthographicCamera.updateProjectionMatrix()):(this._events.CameraMove&&Ct.fromArray(this._events.CameraMove),this._events.CameraTarget&&an.fromArray(this._events.CameraTarget),this._events.CameraFOV&&(this.perspectiveCamera.fov=this._events.CameraFOV[0],this.perspectiveCamera.updateProjectionMatrix(),this.orthographicCamera.zoom=this.fovToOrtho(this._events.CameraFOV[0],100),this.orthographicCamera.updateProjectionMatrix())),this.updateCameraMatrix();let i=on;t.tracks.Theme&&(i=le.interpolateTheme(e,this.level.themes,t.tracks.Theme),this._theme=i),ke.clean(),this.level.rawObjects.forEach(s=>{ke.update(e,s,this.level,i)}),ke.commit()}render(){if(this.isHeadless||!this.renderer)return;const e=[{pos:new M(20,20,20),luminosity:1}],t=P.rgbaToRaw(this._theme.background),i=new M().copy(Ct),s={projection:this._activeCamera.projectionMatrix,view:this._viewMatrix};this.renderer.render(s,i,e,t)}resize(e,t){if(this.isHeadless)return;const i=e/t;this.perspectiveCamera.aspect=i,this.perspectiveCamera.updateProjectionMatrix();const r=(this.orthographicCamera.top-this.orthographicCamera.bottom)*i;this.orthographicCamera.left=-r/2,this.orthographicCamera.right=r/2,this.orthographicCamera.updateProjectionMatrix()}load(e){return this.level=lt.from(e),this}getEndTime(){let e=0;return this.level.rawObjects.forEach(t=>{t&&t.components.forEach(i=>{const s=i.lifetime+i.spawnTime;s>e&&(e=s)})}),e}newObject(e){const t=_e.from(e??{});return t.addComponent("Animation3D").addKeyframe("Move",{data:[0,0,0]}).addKeyframe("Scale",{data:[1,1,1]}).addKeyframe("Rotation",{data:[0,0,0]}).addKeyframe("Color",{data:[0,8]}).setParenting("Move",!0).setParenting("Scale",!1).setParenting("Rotation",!0),this.level.addObject(t),t}newEffectsObject(e){const t=_e.from(e??{});return t.addComponent("Animation3D").addKeyframe("AmbientLight",{data:[40]}).addKeyframe("CameraFOV",{data:[45]}).addKeyframe("CameraMove",{data:[0,0,100]}).addKeyframe("CameraTarget",{data:[0,0,0]}).addKeyframe("LightSourceLuminosity",{data:[100]}).addKeyframe("LightSourceMove",{data:[100,100,0]}).addKeyframe("Theme",{themeId:this.level.themes.entries().toArray()[0][1].id}),this.level.events=t,t}updateCameraMatrix(){this._viewMatrix.lookAt(Ct,an,Vl),this._activeCamera.position.copy(Ct),this._activeCamera.lookAt(an),this._viewMatrix.copy(this._activeCamera.matrixWorldInverse)}setCameraType(e){this.cameraType!==e&&(this.cameraType=e,e==="perspective"?this._activeCamera=this.perspectiveCamera:this._activeCamera=this.orthographicCamera,this._activeCamera.updateProjectionMatrix())}toggleFreecam(){this.freecamEnabled=!this.freecamEnabled,this.updateCameraMatrix()}fovToOrtho(e,t){const i=e/2*(Math.PI/180),s=2*t*Math.tan(i),a=(this.orthographicCamera.top-this.orthographicCamera.bottom)/s;return Math.max(.001,a)}}class us{isDirty=!0;static type(){return"Component"}type(){return us.type()}init(){}update(){}serialize(){return{}}}class jt extends us{static TYPE="Animation";_isDirty;_parentIndex;parentId;tracks;spawnTime;lifetime;mesh;parentSettings;randomSeed;constructor(e){super(),this.init(),e&&this.assign(e)}static from(e){return new jt(e)}static type(){return this.TYPE}type(){return jt.type()}init(){this._isDirty=!0,this.tracks={},this.spawnTime=0,this.lifetime=30,this.parentSettings={},this.refreshRandomSeed()}update(){}serialize(){const e={};for(const t in this.tracks){const i=t;e[i]=this.tracks[i]?.serialize()}return{type:this.type(),parentId:this.parentId,mesh:this.mesh,tracks:e,spawnTime:this.spawnTime,lifetime:this.lifetime,parentSettings:structuredClone(this.parentSettings)}}assign(e){if(e.parentId&&(this.parentId=e.parentId),e.mesh&&(this.mesh=e.mesh),e.tracks!==void 0)for(const t in e.tracks){const i=t;this.createTrack(i,e.tracks[i])}return e.spawnTime!==void 0&&(this.spawnTime=e.spawnTime),e.lifetime!==void 0&&(this.lifetime=e.lifetime),e.parentSettings&&(this.parentSettings=structuredClone(e.parentSettings)),this}createTrack(e,t){return this.tracks[e]=kn.from(t??[]),this}deleteTrack(e){return delete this.tracks[e],this}addKeyframe(e,t){return this.tracks[e]||this.createTrack(e),this.tracks[e]&&t&&this.tracks[e].addKeyframe(t),this}setMesh(e){return this.mesh=e,this}setParent(e,t){return this.parentId=e,this._parentIndex=t,this}setParenting(e,t){return this.parentSettings[e]?this.parentSettings[e].enabled=t:this.parentSettings[e]={enabled:t,offset:0},this}setParentOffset(e,t){return this.parentSettings[e]?this.parentSettings[e].offset=t:this.parentSettings[e]={enabled:!0,offset:t},this}refreshRandomSeed(){this.randomSeed=Math.random()*9999999}}class mt extends jt{static TYPE="Animation2D";mesh;zOffset;origin;constructor(e){super(),this.init(),e&&this.assign(e)}static from(e){return new mt(e)}static type(){return this.TYPE}type(){return mt.type()}init(){this._isDirty=!0,this.tracks={},this.spawnTime=1,this.lifetime=5,this.zOffset=0,this.origin={x:0,y:0},this.parentSettings={}}update(){}serialize(){const e={};for(const t in this.tracks){const i=t;e[i]=this.tracks[i]?.serialize()}return{type:this.type(),parentId:this.parentId,zOffset:this.zOffset,mesh:this.mesh,tracks:e,spawnTime:this.spawnTime,lifetime:this.lifetime,origin:structuredClone(this.origin),parentSettings:structuredClone(this.parentSettings)}}assign(e){if(e.parentId&&(this.parentId=e.parentId),e.mesh&&(this.mesh=e.mesh),e.tracks!==void 0)for(const t in e.tracks){const i=t;this.createTrack(i,e.tracks[i])}return e.zOffset!==void 0&&(this.zOffset=e.zOffset),e.spawnTime!==void 0&&(this.spawnTime=e.spawnTime),e.lifetime!==void 0&&(this.lifetime=e.lifetime),e.origin&&(this.origin=structuredClone(e.origin)),e.parentSettings&&(this.parentSettings=structuredClone(e.parentSettings)),this}}class Lt extends jt{static TYPE="Animation3D";origin;constructor(e){super(),this.init(),e&&this.assign(e)}static from(e){return new Lt(e)}static type(){return this.TYPE}type(){return Lt.type()}init(){this._isDirty=!0,this.tracks={},this.spawnTime=0,this.lifetime=30,this.mesh="Cube",this.origin={x:0,y:0,z:0},this.parentSettings={}}update(){}serialize(){const e={};for(const t in this.tracks){const i=t;e[i]=this.tracks[i]?.serialize()}return{type:this.type(),parentId:this.parentId,mesh:this.mesh,tracks:e,spawnTime:this.spawnTime,lifetime:this.lifetime,origin:structuredClone(this.origin),parentSettings:structuredClone(this.parentSettings)}}assign(e){if(e.parentId&&(this.parentId=e.parentId),e.mesh&&(this.mesh=e.mesh),e.tracks!==void 0)for(const t in e.tracks){const i=t;this.createTrack(i,e.tracks[i])}return e.spawnTime&&(this.spawnTime=e.spawnTime),e.lifetime&&(this.lifetime=e.lifetime),e.origin&&(this.origin=structuredClone(e.origin)),e.parentSettings&&(this.parentSettings=structuredClone(e.parentSettings)),this}}class Tn{static _pool=[];static _count=0;static get(){return this._count>0?(this._count--,this._pool[this._count]):new Q}static release(e){e.identity(),this._pool[this._count]=e,this._count++}static logStatus(){console.log(`Matrix4Pool: ${this._count} available`)}}const gr=new M,xr=new M,br=new vt,Ei=new Ge,yr=new Q;class vr{static getLocalTRS(e,t){e.identity();const i=t.Move?t.Move[0]:0,s=t.Move?t.Move[1]:0,r=t.Scale?t.Scale[0]:1,a=t.Scale?t.Scale[1]:1,o=t.Rotation?t.Rotation[0]:0;return gr.set(i,s,0),xr.set(r,a,1),o!==0?(br.set(0,0,jo(o)),Ei.setFromEuler(br)):Ei.set(0,0,0,1),e.compose(gr,Ei,xr),e}static _accumulateTRS(e,t,i,s,r){this.getLocalTRS(e,r);let a=i,o=a.getComponent("Animation2D")?.parentId;for(;o;){const h=s.getObject(o);if(!h)break;const l=h.getComponent("Animation2D"),c=a.getComponent("Animation2D"),u=Tn.get(),f=le.interpolateTracks(t,l,c.parentSettings,!0);this.getLocalTRS(u,f),e.premultiply(u),Tn.release(u),a=h,o=l.parentId}}static getWorldMatrix(e,t,i,s){const r=t.getComponent("Animation2D");if(!r)throw new Error(`Object "${t.name}" [ ${t.id} ] does not have an Animation2D component!`);const a=new Q;return this._accumulateTRS(a,e,t,i,s),r.origin&&(r.origin.x!==0||r.origin.y!==0)&&(yr.makeTranslation(r.origin.x,r.origin.y,0),a.multiply(yr)),r.zOffset&&(a.elements[14]+=(r.zOffset+le.seededRandom(r.randomSeed))*2),a}static getColorAt(e,t,i,s){const r=t.tracks.Color;if(!r)return P.rgbaToRaw(i.background);const{prev:a,next:o,t:h}=le.interpolateTrack(r,e);if(h===0){const u=P.rgbaToRaw(i.objects[a.data[0]]);return u[3]=a.data[1],u}if(h===1){const u=P.rgbaToRaw(i.objects[o.data[0]]);return u[3]=a.data[1],u}const l=P.rgbaToRaw(i.objects[a.data[0]]);l[3]=a.data[1];const c=P.rgbaToRaw(i.objects[o.data[0]]);return c[3]=o.data[1],s?(s=le.lerpArrays(l,c,h,s),s):le.lerpArrays(l,c,h)}}const _r={};let Ri=[1,1,1,1];const Bl=(n,e,t,i,s,r)=>{if(e<t.spawnTime||e>t.spawnTime+t.lifetime)return;le.interpolateTracks(e,t,t.parentId?t.parentSettings:void 0,!1,_r);const a=t.tracks.Move!==void 0,o=t.tracks.Rotation!==void 0,h=t.tracks.Scale!==void 0;if((a||o||h)&&t.tracks.Color&&t.mesh){const l=vr.getWorldMatrix(e,i,s,_r);Ri=vr.getColorAt(e,t,r),n.queueMesh(t.mesh,l,Ri,Ri)}},Mr=new M,wr=new M,Tr=new vt,Ii=new Ge,kr=new Q;class zr{static getLocalTRS(e,t){e.identity();const i=t.Move?t.Move[0]:0,s=t.Move?t.Move[1]:0,r=t.Move?t.Move[2]:0,a=t.Scale?t.Scale[0]:1,o=t.Scale?t.Scale[1]:1,h=t.Scale?t.Scale[2]:1;return Mr.set(i,s,r),wr.set(a,o,h),t.Rotation?(Tr.set(vi.degToRad(t.Rotation[0]),vi.degToRad(t.Rotation[1]),vi.degToRad(t.Rotation[2])),Ii.setFromEuler(Tr)):Ii.set(0,0,0,1),e.compose(Mr,Ii,wr),e}static _accumulateTRS(e,t,i,s,r){this.getLocalTRS(e,r);let a=i,o=a.getComponent("Animation3D")?.parentId;for(;o;){const h=s.getObject(o);if(!h)break;const l=h.getComponent("Animation3D"),c=a.getComponent("Animation3D"),u=Tn.get(),f=le.interpolateTracks(t,l,c.parentSettings,!0);this.getLocalTRS(u,f),e.premultiply(u),Tn.release(u),a=h,o=l.parentId}}static getWorldMatrix(e,t,i,s){const r=t.getComponent("Animation3D");if(!r)throw new Error(`Object "${t.name}" [ ${t.id} ] does not have an Animation3D component!`);const a=new Q;return this._accumulateTRS(a,e,t,i,s),r.origin&&(r.origin.x!==0||r.origin.y!==0||r.origin.z!==0)&&(kr.makeTranslation(r.origin.x,r.origin.y,r.origin.z),a.multiply(kr)),a}static getColorsAt(e,t,i){const s=t.tracks.Color;if(!s){const f=P.rgbaToRaw(i.background);return{color:f,shade:f}}const{prev:r,next:a,t:o}=le.interpolateTrack(s,e);if(o===0)return{color:this._resolveColor(r.data[0],i),shade:this._resolveColor(r.data[1],i)};if(o===1)return{color:this._resolveColor(a.data[0],i),shade:this._resolveColor(a.data[1],i)};const h=this._resolveColor(r.data[0],i),l=this._resolveColor(a.data[0],i),c=this._resolveColor(r.data[1],i),u=this._resolveColor(a.data[1],i);return{color:le.lerpArrays(h,l,o),shade:le.lerpArrays(c,u,o)}}static _resolveColor(e,t){const i=t.objects[e];return i?P.rgbaToRaw(i):[0,0,0,1]}}const Cr={},Hl=(n,e,t,i,s,r)=>{if(e<t.spawnTime||e>t.spawnTime+t.lifetime)return;le.interpolateTracks(e,t,t.parentId?t.parentSettings:void 0,!1,Cr);const a=t.tracks.Move!==void 0,o=t.tracks.Rotation!==void 0,h=t.tracks.Scale!==void 0;if((a||o||h)&&t.tracks.Color&&t.mesh){const l=zr.getWorldMatrix(e,i,s,Cr),{color:c,shade:u}=zr.getColorsAt(e,t,r);n.queueMesh(t.mesh,l,c,u)}},Wl=[{id:Lt.TYPE,callback:Hl},{id:mt.TYPE,callback:Bl}];function Xl(){ke.init();for(const n of Wl){const{id:e,callback:t}=n;ke.register(e,t)}}const ql=[Lt,mt];function Yl(){fn.init();for(const n of ql)fn.register(n.TYPE,n)}class Zi{static handlers;static init(){this.handlers=new Map,console.info("Export Registry initialized")}static register(e,t){this.handlers.has(e)&&(console.warn(`[ExportRegistry] Component exporter for type "${e}" was already registered, the previous entry will be overwritten!`),this.handlers.delete(e)),this.handlers.set(e,t),console.info(`[ExportRegistry] Registered component exporter "${e}" -> ${t.name}`)}static runHandler(e,t,i){e.update();const s=e.type(),r=this.handlers.get(s);if(r)try{return r(e,t,i)}catch(a){return console.error(`[ExportRegistry] Error exporting component ${s} in object "${t.name}" [${t.id}]:
${a}`),console.error(a.stack),console.error(`Offending object:
`,t),[]}else return console.error(`[ExportRegistry] No handler was registered to export component "${s}"!`),[]}}class hn{static toVgdLevel(e){const t={events:[[],[],[],[],[],[],[],[],[]],objects:[],themes:[]};return e.objects.forEach(i=>{t.objects.push(...this.toVgdLevelObject(i,e.objects))}),e.themes.forEach(i=>{t.themes.push(this.toVgdTheme(i))}),t}static toVgdLevelObject(e,t){const i=[];return e.components.forEach(s=>{const r=Zi.runHandler(s,e,t??new Map);for(const a of r)i.push(a)}),i}static toVgdTheme(e){return{name:e.name,id:e.id,pla:["E57373","64B5F6","81C784","FFB74D"],obj:e.objects.map(i=>P.rgbaToHex(i)),fx:e.effects.map(i=>P.rgbaToHex(i)),bg:e.parallax.map(i=>P.rgbaToHex(i)),base_bg:P.rgbaToHex(e.background),base_gui:P.rgbaToHex(e.gui),base_gui_accent:P.rgbaToHex(e.guiAccent)}}static toVgdKeyframeTrack(e,t,i){const s=[];for(const r of t)s.push(this.toVgdKeyframe(e,r,i));return s}static toVgdKeyframe(e,t,i){const s={ev:[]};switch(e){case"Color":{s.ev=[t.data[0]],t.data[1]!==100&&s.ev.push(t.data[1]);break}case"Rotation":{s.ev=[t.data[0]],t.data[1]&&s.ev.push(t.data[1]);break}default:{s.ev=[t.data[0],t.data[1]];break}}return t.time&&t.time-i>0&&(s.t=t.time-i),t.randomize&&t.randomize!=="None"&&(s.r=Object.keys(cs).indexOf(t.randomize)),t.easing&&t.easing!=="Linear"&&(s.ct=t.easing),t.random&&(s.er=[t.random[0],t.random[1]]),t.themeId&&(s.evs=[t.themeId]),s}}const Zl=(n,e)=>{const t={id:e.id,n:e.name,ak_t:3,ak_o:n.lifetime,st:n.spawnTime,e:[{k:[{ev:[0,0]}]},{k:[{ev:[1,1]}]},{k:[{ev:[0,0]}]},{k:[{ev:[0,0]}]}]};if(n.tracks.Move&&(t.e[0].k=hn.toVgdKeyframeTrack("Move",n.tracks.Move,n.spawnTime)),n.tracks.Scale&&(t.e[1].k=hn.toVgdKeyframeTrack("Scale",n.tracks.Scale,n.spawnTime)),n.tracks.Rotation&&(t.e[2].k=hn.toVgdKeyframeTrack("Rotation",n.tracks.Rotation,n.spawnTime)),n.tracks.Color&&(t.e[3].k=hn.toVgdKeyframeTrack("Color",n.tracks.Color,n.spawnTime)),n.parentId&&(t.p_id=n.parentId),n.origin&&n.origin.x!==0&&n.origin.y!==0&&(t.o=structuredClone(n.origin)),n.zOffset&&n.zOffset!==-30&&(t.d=Math.max(Math.min(0-Math.floor(n.zOffset),60),0)),n.parentSettings){const i=[n.parentSettings.Move?.enabled?"1":"0",n.parentSettings.Scale?.enabled?"1":"0",n.parentSettings.Rotation?.enabled?"1":"0"],s=[n.parentSettings.Move?.offset??0,n.parentSettings.Scale?.offset??0,n.parentSettings.Rotation?.offset??0];i.join("")!=="101"&&(t.p_t=i.join("")),s.every(r=>r==0)||(t.p_o=s)}if(n.mesh){t.ot=5;const{s:i,so:s}=ml(n.mesh);i>0&&(t.s=i),s>0&&(t.so=s)}else t.ot=6;return[t]},Gl=[{id:mt.TYPE,callback:Zl}];function Kl(){Zi.init();for(const n of Gl){const{id:e,callback:t}=n;Zi.register(e,t)}}const Ql=()=>({name:"Cube",vertices:[new M(-1,-1,-1),new M(1,-1,-1),new M(1,1,-1),new M(-1,1,-1),new M(-1,-1,1),new M(1,-1,1),new M(1,1,1),new M(-1,1,1)],faces:[[4,7,6,5],[1,2,3,0],[7,3,2,6],[4,5,1,0],[5,6,2,1],[0,3,7,4]]}),Jl=()=>({name:"Dodecahedron",vertices:[new M(.57735,.57735,-.57735),new M(.57735,-.57735,-.57735),new M(.57735,.57735,.57735),new M(.57735,-.57735,.57735),new M(-.57735,.57735,-.57735),new M(-.57735,-.57735,-.57735),new M(-.57735,.57735,.57735),new M(-.57735,-.57735,.57735),new M(.356822,0,-.934172),new M(-.356822,0,-.934172),new M(.356822,0,.934172),new M(-.356822,0,.934172),new M(.934172,.356822,0),new M(.934172,-.356822,0),new M(-.934172,.356822,0),new M(-.934172,-.356822,0),new M(0,.934172,-.356822),new M(0,.934172,.356822),new M(0,-.934172,-.356822),new M(0,-.934172,.356822)],faces:[[0,8,9,4,16],[0,12,13,1,8],[0,16,17,2,12],[8,1,18,5,9],[12,2,10,3,13],[16,4,14,6,17],[9,5,15,14,4],[6,11,10,2,17],[3,19,18,1,13],[7,15,5,18,19],[7,11,6,14,15],[7,19,3,10,11]]}),ec=(n=1,e=0)=>{const t=(1+Math.sqrt(5))/2,i=[new M(-1,t,0).normalize(),new M(1,t,0).normalize(),new M(-1,-t,0).normalize(),new M(1,-t,0).normalize(),new M(0,-1,t).normalize(),new M(0,1,t).normalize(),new M(0,-1,-t).normalize(),new M(0,1,-t).normalize(),new M(t,0,-1).normalize(),new M(t,0,1).normalize(),new M(-t,0,-1).normalize(),new M(-t,0,1).normalize()];let s=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];const r=new Map,a=(o,h)=>{const l=Math.min(o,h),c=Math.max(o,h),u=`${l}-${c}`;if(r.has(u))return r.get(u);const f=i[o],d=i[h],m=f.clone().add(d).multiply(new M(.5)).normalize();i.push(m);const x=i.length-1;return r.set(u,x),x};for(let o=0;o<e;o++){const h=[];for(const l of s){const c=l[0],u=l[1],f=l[2],d=a(c,u),m=a(u,f),x=a(f,c);h.push([c,d,x]),h.push([u,m,d]),h.push([f,x,m]),h.push([d,m,x])}s=h}if(n!==1)for(const o of i)o.multiply(new M(n));return{name:"Icosahedron",vertices:i,faces:s}},Sr={Cube:Ql,Dodecahedron:Jl,Icosahedron:ec};function tc(){ft.init();for(const n in Sr){const t=Sr[n];ft.registerMesh(t())}for(let n=0;n<qe.length;n++)for(let e=0;e<qe[n].length;e++){const t=structuredClone(qe[n][e]),i={name:t.name,faces:t.faces,vertices:[]};t.vertices.forEach(s=>{i.vertices.push(new M().fromArray(s))}),ft.registerMesh(i,!0)}}function nc(){const n=performance.now();tc(),Yl(),Kl(),Xl();const e=performance.now();console.info(`Finished initialization in ${e-n}ms`)}var ic=ie('<span class="text-white/50 text-sm"> </span>'),sc=ie('<div class="w-8 h-8"></div>'),rc=ie('<div class="flex flex-col gap-4"><div class="w-full flex flex-col gap-2 mb-4"><div class="w-full flex gap-4"><!></div> <!></div> <div class="flex gap-4"><!> <!></div> <div class="flex gap-4"><!></div></div> <div class="flex flex-col gap-4"><div class="flex gap-4"><!> <!> <!> <!></div> <div class="flex gap-4"><!> <!> <!></div> <div class="flex gap-2 justify-center"><!></div></div>',1),ac=ie(`<main class="max-w-screen max-h-screen flex flex-col gap-2"><section class="relative w-full bg-zinc-900/50 font-mono z-50 pointer-events-none"><!></section> <div class="flex grow"><section class="flex flex-col justify-between basis-1/3 p-4 gap-4"><!></section> <section class="flex w-full flex-1 min-h-0"><div class="w-full border-2 border-zinc-900 bg-black overflow-hidden" style="aspect-ratio:16/9;"><canvas class="w-full h-full block"></canvas></div></section></div> <section class="flex w-full gap-4"><button aria-label="Play / Pause" class="
        flex justify-center p-1 w-9 h-9
        bg-zinc-700 rounded-md font-bold
        hover:bg-amber-700 active:bg-amber-600
        active:scale-95
        transition-all duration-150

        bg-contain bg-no-repeat bg-origin-content 
      "></button> <svg class="w-full h-9 bg-zinc-900"><!></svg></section></main>`);function mc(n,e){pt(e,!0);let t=de(180),i=500,s=de(null),r=null,a=0,o=0,h=0,l=0,c=0,u=de(0),f=de(Ts({opaque:0,transparent:0})),d=de(null),m=de(Ts([])),x=un(()=>Jt.stats),g=de(0),p=de(!1),y=de(!0),b=0;ja(()=>{nc(),Y(s,r?new wn(null,r):new wn,!0),requestAnimationFrame(z)}),La(()=>{w(s)&&!w(s).isHeadless&&(w(s).renderer.dispose(),Y(s,null))});function v(){if(w(p)){const j=performance.now();Y(g,w(g)+(j-b)/1e3),b=j}else b=performance.now()}function z(){if(!w(s))return;v(),requestAnimationFrame(z);const j=performance.now();w(s).update(w(g)),h+=performance.now()-j,a++,Y(y,w(s).cameraType=="perspective"),Y(d,w(s)._theme,!0);const ee=performance.now();w(s).render(),l+=performance.now()-ee,o++,b-c>i&&w(p)&&C(ee,w(g))}function C(j,ee){const pe=j-c,Se=Math.round(a*1e3/pe),Me=Math.round(o*1e3/pe),Ln=o>0?h/o:0,Un=a>0?l/a:0;Y(u,ee,!0),Y(f,{opaque:0,transparent:0},!0),ke.opaqueBatches.forEach(Qe=>{w(f).opaque+=Qe.size}),ke.transparentBatches.forEach(Qe=>{w(f).transparent+=Qe.size});const Wt=Math.floor(w(g)*1e3/i),Ke={ups:Se,fps:Me,cpuMs:Ln,renderMs:Un,activeObjs:w(f)};w(m)[Wt]?w(m)[Wt]=Ke:w(m).push(Ke),a=0,o=0,h=0,l=0,c=j}function k(j){if(!w(s)){alert("The editor has not loaded yet!");return}try{console.info("Loading level...");const ee=JSON.parse(j),pe=Jt.levelFromVgd(ee);w(s).level=pe,Y(t,Math.min(w(s).getEndTime(),300),!0),console.info(`Done! (${Jt.stats.conversionTime}ms)`),Y(x,Jt.stats),Y(m,[],!0),Y(p,!0)}catch(ee){alert(`There was an error parsing this level! Please report this!

Error: ${ee}

Stack: ${ee??"N/A"}`)}}function R(j){j.code=="Space"&&Y(p,!w(p))}var S=ac();ln("keydown",Pi,R);var A=O(S),D=O(A);zo(D,{get snapshots(){return w(m)},interval:i,get duration(){return w(t)}}),I(A);var F=L(A,2),B=O(F),q=O(B);{var se=j=>{var ee=rc(),pe=Oi(ee),Se=O(pe),Me=O(Se),Ln=O(Me);So(Ln,{onUpload:k}),I(Me);var Un=L(Me,2);{var Wt=U=>{var Je=ic(),Bn=O(Je);I(Je),ce(()=>Ve(Bn,`Parsed ${w(x).objects??""} objects in ${w(x).conversionTime??""}ms`)),K(U,Je)};Be(Un,U=>{w(x)&&U(Wt)})}I(Se);var Ke=L(Se,2),Qe=O(Ke);Kn(Qe,{label:"Perspective",get isChecked(){return w(y)},onClick:()=>w(s).setCameraType("perspective")});var Ea=L(Qe,2);Kn(Ea,{label:"Freecam",isChecked:!0,onClick:()=>w(s).toggleFreecam()}),I(Ke);var fs=L(Ke,2),Ra=O(fs);{let U=un(()=>!w(y));Kn(Ra,{label:"Orthographic",get isChecked(){return w(U)},onClick:()=>w(s).setCameraType("orthographic")})}I(fs),I(pe);var ds=L(pe,2),$n=O(ds),ms=O($n);Ue(ms,{value:0,shiftStep:.1,step:1,ctrlStep:10,onChange:U=>w(s).freecamPos.x=U,label:"Camera X"});var ps=L(ms,2);Ue(ps,{value:0,shiftStep:.1,step:1,ctrlStep:10,onChange:U=>w(s).freecamPos.y=U,label:"Camera Y"});var gs=L(ps,2);Ue(gs,{value:100,shiftStep:.1,step:1,ctrlStep:10,onChange:U=>w(s).freecamPos.z=U,label:"Camera Z"});var Ia=L(gs,2);Ue(Ia,{value:45,shiftStep:.1,step:1,ctrlStep:10,onChange:U=>w(s).freecamFov=U,label:"FoV"}),I($n);var Vn=L($n,2),xs=O(Vn);Ue(xs,{value:0,shiftStep:.1,step:1,ctrlStep:10,onChange:U=>w(s).freecamTarget.x=U,label:"Target X"});var bs=L(xs,2);Ue(bs,{value:0,shiftStep:.1,step:1,ctrlStep:10,onChange:U=>w(s).freecamTarget.y=U,label:"Target Y"});var Fa=L(bs,2);Ue(Fa,{value:0,shiftStep:.1,step:1,ctrlStep:10,onChange:U=>w(s).freecamTarget.z=U,label:"Target Z"}),I(Vn);var ys=L(Vn,2),Oa=O(ys);{var Pa=U=>{var Je=Na(),Bn=Oi(Je);cn(Bn,17,()=>w(d).objects,Pr,(Da,Hn)=>{var vs=sc();ce(()=>Ni(vs,`background-color: rgb(${w(Hn).r??""}, ${w(Hn).g??""}, ${w(Hn).b??""});`)),K(Da,vs)}),K(U,Je)};Be(Oa,U=>{w(d)!==null&&U(Pa)})}I(ys),I(ds),K(j,ee)};Be(q,j=>{w(s)&&j(se)})}I(B);var re=L(B,2),ae=O(re),ue=O(ae);Ji(ue,j=>r=j,()=>r),I(ae),I(re),I(F);var oe=L(F,2),be=O(oe);be.__click=()=>Y(p,!w(p));var ye=L(be,2),_t=O(ye);Fo(_t,{get duration(){return w(t)},timeToPx:j=>(console.log(j),j),pxToTime:j=>(console.log(j),j),get timestamp(){return w(g)},set timestamp(j){Y(g,j,!0)}}),I(ye),I(oe),I(S),ce(()=>Ni(be,`background-image: url(${uo??""}/icons/${w(p)?"pause.png":"play.png"});`)),K(n,S),gt()}Ut(["click"]);export{mc as component};
