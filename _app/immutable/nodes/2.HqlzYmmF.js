import{a as K,f as se,d as Qs,c as Ua}from"../chunks/qiDBJ8aT.js";import{o as $a,a as Ba}from"../chunks/CJlhnFNh.js";import{e as qn,n as Ha,aR as Rr,h as me,w as Yn,V as Va,o as Wa,C as w,t as Xa,H as qa,v as wi,x as Zn,i as Gt,af as Ya,aJ as Za,ar as Ti,c as rt,aS as Te,f as Ps,aT as Ga,s as Ka,Q as Qa,aU as Ja,aH as Js,aV as eo,aW as to,aN as no,ad as ki,aX as so,r as Ir,p as Fr,aY as Gn,q as io,aZ as ro,a_ as ao,aG as oo,d as ho,aD as lo,a$ as Or,k as ei,z as Pr,aO as co,b0 as uo,y as fo,a5 as gt,a7 as ce,a8 as xt,a9 as F,ab as j,aa as I,as as mo,F as X,aQ as Ft,aP as he,a6 as Ds,b1 as Ns,D as zi}from"../chunks/wsYffcW8.js";import{s as $e,d as Ht,e as dn}from"../chunks/DfZZmcBE.js";import{p as Z,b as ti,i as Be}from"../chunks/D6COVnyx.js";import{s as q,r as Dr}from"../chunks/BpG0UDt9.js";import{b as po}from"../chunks/BgFnKSJB.js";function Nr(n,e){return e}function go(n,e,t){for(var s=[],i=e.length,r,a=e.length,o=0;o<i;o++){let f=e[o];Fr(f,()=>{if(r){if(r.pending.delete(f),r.done.add(f),r.pending.size===0){var u=n.outrogroups;Ls(Js(r.done)),u.delete(r),u.size===0&&(n.outrogroups=null)}}else a-=1},!1)}if(a===0){var h=s.length===0&&t!==null;if(h){var l=t,c=l.parentNode;oo(c),c.append(l),n.items.clear()}Ls(e,!h)}else r={pending:new Set(e),done:new Set},(n.outrogroups??=new Set).add(r)}function Ls(n,e=!0){for(var t=0;t<n.length;t++)ho(n[t],e)}var Ci;function mn(n,e,t,s,i,r=null){var a=n,o=new Map,h=(e&Rr)!==0;if(h){var l=n;a=me?Yn(Va(l)):l.appendChild(qn())}me&&Wa();var c=null,f=Qa(()=>{var p=t();return Ja(p)?p:p==null?[]:Js(p)}),u,d=!0;function m(){g.fallback=c,xo(g,u,a,e,s),c!==null&&(u.length===0?(c.f&Te)===0?Ir(c):(c.f^=Te,At(c,null,a)):Fr(c,()=>{c=null}))}var x=Ha(()=>{u=w(f);var p=u.length;let y=!1;if(me){var b=Xa(a)===qa;b!==(p===0)&&(a=wi(),Yn(a),Zn(!1),y=!0)}for(var v=new Set,z=rt,C=Ka(),T=0;T<p;T+=1){me&&Gt.nodeType===Ya&&Gt.data===Za&&(a=Gt,y=!0,Zn(!1));var R=u[T],S=s(R,T),A=d?null:o.get(S);A?(A.v&&Ti(A.v,R),A.i&&Ti(A.i,T),C&&z.unskip_effect(A.e)):(A=bo(o,d?a:Ci??=qn(),R,S,T,i,e,t),d||(A.e.f|=Te),o.set(S,A)),v.add(S)}if(p===0&&r&&!c&&(d?c=Ps(()=>r(a)):(c=Ps(()=>r(Ci??=qn())),c.f|=Te)),p>v.size&&Ga(),me&&p>0&&Yn(wi()),!d)if(C){for(const[O,P]of o)v.has(O)||z.skip_effect(P.e);z.oncommit(m),z.ondiscard(()=>{})}else m();y&&Zn(!0),w(f)}),g={effect:x,items:o,outrogroups:null,fallback:c};d=!1,me&&(a=Gt)}function wt(n){for(;n!==null&&(n.f&ro)===0;)n=n.next;return n}function xo(n,e,t,s,i){var r=(s&ao)!==0,a=e.length,o=n.items,h=wt(n.effect.first),l,c=null,f,u=[],d=[],m,x,g,p;if(r)for(p=0;p<a;p+=1)m=e[p],x=i(m,p),g=o.get(x).e,(g.f&Te)===0&&(g.nodes?.a?.measure(),(f??=new Set).add(g));for(p=0;p<a;p+=1){if(m=e[p],x=i(m,p),g=o.get(x).e,n.outrogroups!==null)for(const A of n.outrogroups)A.pending.delete(g),A.done.delete(g);if((g.f&Te)!==0)if(g.f^=Te,g===h)At(g,null,t);else{var y=c?c.next:h;g===n.effect.last&&(n.effect.last=g.prev),g.prev&&(g.prev.next=g.next),g.next&&(g.next.prev=g.prev),Se(n,c,g),Se(n,g,y),At(g,y,t),c=g,u=[],d=[],h=wt(c.next);continue}if((g.f&Gn)!==0&&(Ir(g),r&&(g.nodes?.a?.unfix(),(f??=new Set).delete(g))),g!==h){if(l!==void 0&&l.has(g)){if(u.length<d.length){var b=d[0],v;c=b.prev;var z=u[0],C=u[u.length-1];for(v=0;v<u.length;v+=1)At(u[v],b,t);for(v=0;v<d.length;v+=1)l.delete(d[v]);Se(n,z.prev,C.next),Se(n,c,z),Se(n,C,b),h=b,c=C,p-=1,u=[],d=[]}else l.delete(g),At(g,h,t),Se(n,g.prev,g.next),Se(n,g,c===null?n.effect.first:c.next),Se(n,c,g),c=g;continue}for(u=[],d=[];h!==null&&h!==g;)(l??=new Set).add(h),d.push(h),h=wt(h.next);if(h===null)continue}(g.f&Te)===0&&u.push(g),c=g,h=wt(g.next)}if(n.outrogroups!==null){for(const A of n.outrogroups)A.pending.size===0&&(Ls(Js(A.done)),n.outrogroups?.delete(A));n.outrogroups.size===0&&(n.outrogroups=null)}if(h!==null||l!==void 0){var T=[];if(l!==void 0)for(g of l)(g.f&Gn)===0&&T.push(g);for(;h!==null;)(h.f&Gn)===0&&h!==n.fallback&&T.push(h),h=wt(h.next);var R=T.length;if(R>0){var S=(s&Rr)!==0&&a===0?t:null;if(r){for(p=0;p<R;p+=1)T[p].nodes?.a?.measure();for(p=0;p<R;p+=1)T[p].nodes?.a?.fix()}go(n,T,S)}}r&&io(()=>{if(f!==void 0)for(g of f)g.nodes?.a?.apply()})}function bo(n,e,t,s,i,r,a,o){var h=(a&eo)!==0?(a&to)===0?no(t,!1,!1):ki(t):null,l=(a&so)!==0?ki(i):null;return{v:h,i:l,e:Ps(()=>(r(e,h??t,l??i,o),()=>{n.delete(s)}))}}function At(n,e,t){if(n.nodes)for(var s=n.nodes.start,i=n.nodes.end,r=e&&(e.f&Te)===0?e.nodes.start:t;s!==null;){var a=lo(s);if(r.before(s),s===i)return;s=a}}function Se(n,e,t){e===null?n.effect.first=t:e.next=t,t===null?n.effect.last=e:t.prev=e}function yo(n,e,t){var s=n==null?"":""+n;return s===""?null:s}function vo(n,e){return n==null?null:String(n)}function Ot(n,e,t,s,i,r){var a=n.__className;if(me||a!==t||a===void 0){var o=yo(t);(!me||o!==n.getAttribute("class"))&&(o==null?n.removeAttribute("class"):n.className=o),n.__className=t}return r}function js(n,e,t,s){var i=n.__style;if(me||i!==e){var r=vo(e);(!me||r!==n.getAttribute("style"))&&(r==null?n.removeAttribute("style"):n.style.cssText=r),n.__style=e}return s}function _o(n,e,t=e){var s=new WeakSet;Or(n,"input",async i=>{var r=i?n.defaultValue:n.value;if(r=Kn(n)?Qn(r):r,t(r),rt!==null&&s.add(rt),await co(),r!==(r=e())){var a=n.selectionStart,o=n.selectionEnd,h=n.value.length;if(n.value=r??"",o!==null){var l=n.value.length;a===o&&o===h&&l>h?(n.selectionStart=l,n.selectionEnd=l):(n.selectionStart=a,n.selectionEnd=Math.min(o,l))}}}),(me&&n.defaultValue!==n.value||ei(e)==null&&n.value)&&(t(Kn(n)?Qn(n.value):n.value),rt!==null&&s.add(rt)),Pr(()=>{var i=e();if(n===document.activeElement){var r=uo??rt;if(s.has(r))return}Kn(n)&&i===Qn(n.value)||n.type==="date"&&!i&&!n.value||i!==n.value&&(n.value=i??"")})}function Mo(n,e,t=e){Or(n,"change",s=>{var i=s?n.defaultChecked:n.checked;t(i)}),(me&&n.defaultChecked!==n.checked||ei(e)==null)&&t(n.checked),Pr(()=>{var s=e();n.checked=!!s})}function Kn(n){var e=n.type;return e==="number"||e==="range"}function Qn(n){return n===""?null:+n}class ni{#e=new WeakMap;#t;#n;static entries=new WeakMap;constructor(e){this.#n=e}observe(e,t){var s=this.#e.get(e)||new Set;return s.add(t),this.#e.set(e,s),this.#s().observe(e,this.#n),()=>{var i=this.#e.get(e);i.delete(t),i.size===0&&(this.#e.delete(e),this.#t.unobserve(e))}}#s(){return this.#t??(this.#t=new ResizeObserver(e=>{for(var t of e){ni.entries.set(t.target,t);for(var s of this.#e.get(t.target)||[])s(t)}}))}}var wo=new ni({box:"border-box"});function Si(n,e,t){var s=wo.observe(n,()=>t(n[e]));fo(()=>(ei(()=>t(n[e])),s))}var To=se('<div class="flex items-center gap-2 text-xs"><div class="w-2.5 h-2.5 rounded-full shadow-[0_0_8px]"></div> <div class="flex flex-col leading-none"><span class="text-zinc-400 font-medium uppercase tracking-wider text-[10px]"> </span> <span class="text-zinc-100 font-mono font-bold mt-0.5"> <span class="text-zinc-500 text-[10px] lowercase"> </span></span></div></div>'),ko=se('<div class="text-zinc-500 text-xs italic">Waiting for data...</div>'),zo=Qs('<line x1="0" x2="100%" stroke="white" stroke-dasharray="2 4" stroke-width="1"></line>'),Co=Qs('<path fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" vector-effect="non-scaling-stroke" class="opacity-90 drop-shadow-md transition-all duration-300 ease-linear"></path>'),So=se('<div class="flex flex-col h-full w-full gap-3 p-4 bg-zinc-900/80  font-mono"><div class="flex flex-wrap gap-x-5 gap-y-2 shrink-0"></div> <div class="relative grow w-full min-h-12 max-h-12 bg-zinc-950/50 rounded border border-zinc-800/50 overflow-hidden"><svg class="absolute inset-0 pointer-events-none w-full h-full opacity-20"><!><line x1="0" y1="99%" x2="100%" y2="99%" stroke="white" stroke-width="1"></line></svg> <svg class="absolute inset-0 overflow-visible opacity-75" preserveAspectRatio="none"></svg></div></div>');function Ao(n,e){gt(e,!0);let t=Z(e,"smooth",3,!0),s=Z(e,"snapshots",19,()=>[]),i=he(0),r=he(0);const a=[{key:"ups",label:"UPS",color:"#3b82f6",getValue:p=>Number(p.ups)},{key:"fps",label:"FPS",color:"#22c55e",getValue:p=>Number(p.fps)},{key:"cpuMs",label:"CPU",color:"#ef4444",unit:"ms",getValue:p=>Number(p.cpuMs)},{key:"renderMs",label:"Render",color:"#eab308",unit:"ms",getValue:p=>Number(p.renderMs)},{key:"activeObjs",label:"Objs",color:"#a855f7",getValue:p=>p.activeObjs.opaque+p.activeObjs.transparent}];function o(p){let y=0;for(let b=0;b<p.length;b++)p[b]>y&&(y=p[b]);return y||1}function h(p){if(p.length===0)return"";if(p.length===1)return`M ${p[0].x} ${p[0].y}`;let y=`M ${p[0].x} ${p[0].y}`;for(let b=0;b<p.length-1;b++){const v=p[b===0?0:b-1],z=p[b],C=p[b+1],T=p[b+2]||C,R=z.x+(C.x-v.x)/6,S=z.y+(C.y-v.y)/6,A=C.x-(T.x-z.x)/6,O=C.y-(T.y-z.y)/6;y+=` C ${R} ${S}, ${A} ${O}, ${C.x} ${C.y}`}return y}const l=Ft(()=>{if(!s().length)return[];const p=Math.ceil(e.duration*1e3/e.interval);return s().length>p?s().slice(-p):s()}),c=Ft(()=>w(l).length<2||w(i)===0||w(r)===0?[]:a.map(p=>{const y=w(l).map(p.getValue),b=y[y.length-1]??0,v=o(y),z=y.map((T,R)=>({x:R/(y.length-1)*w(i),y:w(r)-T/v*w(r)})),C=t()?h(z):`M ${z.map(T=>`${T.x},${T.y}`).join(" L ")}`;return{...p,d:C,current:b,max:v}}));var f=So(),u=F(f);mn(u,21,()=>a,p=>p.key,(p,y)=>{const b=Ft(()=>e.currentSnapshot?w(y).getValue(e.currentSnapshot):0);var v=To(),z=F(v),C=j(z,2),T=F(C),R=F(T,!0);I(T);var S=j(T,2),A=F(S),O=j(A),P=F(O,!0);I(O),I(S),I(C),I(v),ce($=>{js(z,`background-color: ${w(y).color??""}; box-shadow: 0 0 8px ${w(y).color??""}44`),$e(R,w(y).label),$e(A,`${$??""} `),$e(P,w(y).unit??"")},[()=>w(b).toFixed(1)]),K(p,v)},p=>{var y=ko();K(p,y)}),I(u);var d=j(u,2),m=F(d),x=F(m);mn(x,16,()=>[.25,.5,.75],Nr,(p,y)=>{var b=zo();ce(()=>{q(b,"y1",`${y*100}%`),q(b,"y2",`${y*100}%`)}),K(p,b)}),mo(),I(m);var g=j(m,2);mn(g,21,()=>w(c),p=>p.key,(p,y)=>{var b=Co();ce(()=>{q(b,"d",w(y).d),q(b,"stroke",w(y).color)}),K(p,b)}),I(g),I(d),I(f),ce(()=>{q(g,"width",w(i)),q(g,"height",w(r)),q(g,"viewBox",`0 0 ${w(i)??""} ${w(r)??""}`)}),Si(d,"clientWidth",p=>X(i,p)),Si(d,"clientHeight",p=>X(r,p)),K(n,f),xt()}var Eo=se(`<button class="
    flex grow justify-center p-1 px-2
    bg-zinc-700 rounded-md font-bold
    hover:bg-amber-700 active:bg-amber-600
    active:scale-95
    transition-all duration-150
  "> </button> <input type="file" accept=".vgd" style="display: none;"/>`,1);function Ro(n,e){gt(e,!0);let t=Z(e,"label",3,"Upload VGD"),s;async function i(l){const c=l.target,f=c.files?.[0];if(f)try{const u=await f.text();e.onUpload(u),c.value=""}catch(u){throw new Error(`Error reading .vgd file: ${u}`)}}var r=Eo(),a=Ds(r);a.__click=()=>s.click();var o=F(a,!0);I(a);var h=j(a,2);h.__change=i,ti(h,l=>s=l,()=>s),ce(()=>$e(o,t())),K(n,r),xt()}Ht(["click","change"]);var Io=se('<label class="block text-zinc-200 mb-1"> </label>'),Fo=se('<span class="flex justify-between items-center"><!></span>'),Oo=se('<div><!> <input type="number"/></div>');function Ue(n,e){gt(e,!0);let t=Z(e,"value",15),s=Z(e,"scrollable",3,!0),i=Z(e,"label",3,void 0),r=Z(e,"disabled",3,!1),a=Z(e,"min",19,()=>-2e16),o=Z(e,"max",3,2e16),h=Z(e,"step",3,1),l=Z(e,"shiftStep",3,.1),c=Z(e,"ctrlStep",3,.01),f=Z(e,"placeholder",3,"0.00"),u=Z(e,"mini",3,!1);const d=`number-input-${Math.random().toString(36).substring(2,9)}`,m=[h(),l(),c()].sort((S,A)=>S-A)[0];let x=he(!1);function g(S){if(!s()||r())return;S.preventDefault();const A=Number(t())||0;let O;S.deltaY<0?O=A+(S.ctrlKey?c():w(x)?l():h()):O=A-(S.ctrlKey?c():w(x)?l():h());const P=Math.max(a(),Math.min(o(),O));t(y(P,m)),e.onChange&&e.onChange(t()??0)}function p(){t(t()===0?0:y(t(),m)),e.onChange&&e.onChange(t()??0)}function y(S,A){if(S)return Math.round(S/A)*A}function b(S){S.key==="Shift"&&X(x,!0)}function v(S){S.key==="Shift"&&X(x,!1)}var z=Oo();dn("keydown",Ns,b),dn("keyup",Ns,v);var C=F(z);{var T=S=>{var A=Fo(),O=F(A);{var P=$=>{var V=Io(),ie=F(V,!0);I(V),ce(()=>{q(V,"for",d),$e(ie,i())}),K($,V)};Be(O,$=>{i()&&$(P)})}I(A),K(S,A)};Be(C,S=>{(i()||e.tooltip)&&S(T)})}var R=j(C,2);Dr(R),R.__change=p,I(z),ce(()=>{Ot(z,1,`flex flex-col gap-1 text-left ${u()?"w-full":"min-w-8"}`),q(R,"id",d),R.disabled=r(),q(R,"placeholder",f()),q(R,"min",a()),q(R,"max",o()),q(R,"step",h()),Ot(R,1,`w-full rounded-lg bg-zinc-700 px-2 py-1 text-zinc-100 
           focus:outline-none focus:ring-2 focus:ring-amber-600 
           disabled:cursor-not-allowed disabled:opacity-50
           [appearance:textfield] [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none
           ${u()?"text-center":""}
    `)}),dn("wheel",R,g),_o(R,t),K(n,z),xt()}Ht(["change"]);var Po=Qs('<g data-draggable="true" data-disable-drag="true"><rect height="100%" width="100%" fill="transparent" role="button" tabindex="-7" style="cursor:ew-resize;clip-path: polygon(100% 0, 100% 100%, 0% 100%, 0% 0%, 0 0);"></rect><rect y="0" height="100%" fill="oklch(66.6% 0.179 58.318)" role="button" tabindex="-7" style="cursor:ew-resize;clip-path: polygon(100% 0, 100% 100%, 0% 100%, 0% 0%, 0 0);"></rect></g>');function Do(n,e){gt(e,!0);let t=Z(e,"timestamp",15,0),s=Z(e,"duration",3,1/0),i=Z(e,"width",3,10),r,a=!1;function o(d){a=!0,window.addEventListener("mousemove",h),window.addEventListener("mouseup",l)}function h(d){if(a&&r){const m=r.getClientRects().item(0);if(!m?.width)return;t(d.offsetX/m.width*s())}}function l(){a=!1,window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",l)}var c=Po(),f=F(c);q(f,"y",0),f.__mousedown=o;var u=j(f);u.__mousedown=o,I(c),ti(c,d=>r=d,()=>r),ce(()=>{q(u,"x",`${t()/s()*100}%`),q(u,"width",i())}),K(n,c),xt()}Ht(["mousedown"]);var No=se("<label> </label>"),Lo=se('<span class="flex justify-between items-center select-none gap-2"><!></span>'),jo=se('<div class="flex gap-4 text-left w-full items-center"><input type="checkbox" class="hidden"/> <button><span></span></button> <!></div>');function Jn(n,e){gt(e,!0);let t=Z(e,"isChecked",15);const s=`number-input-${Math.random().toString(36).substring(2,9)}`;function i(){e.disabled||(t(!t()),e.onClick&&e.onClick())}var r=jo(),a=F(r);Dr(a);var o=j(a,2);o.__click=i;var h=F(o);I(o);var l=j(o,2);{var c=f=>{var u=Lo(),d=F(u);{var m=x=>{var g=No(),p=F(g,!0);I(g),ce(()=>{q(g,"for",s),Ot(g,1,`
            block text-zinc-200
            ${e.disabled?"cursor-not-allowed opacity-50":"cursor-pointer"}
          `),$e(p,e.label)}),K(x,g)};Be(d,x=>{e.label&&x(m)})}I(u),K(f,u)};Be(l,f=>{(e.label||e.tooltip)&&f(c)})}I(r),ce(()=>{q(a,"id",s),a.disabled=e.disabled,q(o,"aria-label",s),Ot(o,1,`
      relative border-2 w-6 h-6 rounded-md transition-colors duration-150 
      ${e.disabled?"cursor-not-allowed":"cursor-pointer"}
      ${t()?"border-amber-600":"border-zinc-700"}
    `),Ot(h,1,`absolute transition-all duration-50 bg-amber-600 rounded-sm top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 ${t()?"w-4 h-4":"w-0 h-0"}`)}),Mo(a,t),K(n,r),xt()}Ht(["click"]);var Et=(n=>(n[n.LastKeyframe=1]="LastKeyframe",n[n.LastKeyframeOffset=2]="LastKeyframeOffset",n[n.FixedTime=3]="FixedTime",n[n.SongTime=4]="SongTime",n))(Et||{}),Lr=(n=>(n[n.None=0]="None",n[n.Linear=1]="Linear",n[n.Toggle=3]="Toggle",n[n.Relative=4]="Relative",n))(Lr||{}),ht=(n=>(n[n.None=0]="None",n[n.Linear=1]="Linear",n[n.Toggle=2]="Toggle",n[n.Relative=3]="Relative",n))(ht||{});const ee=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Uo=Math.PI/180;function si(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(ee[n&255]+ee[n>>8&255]+ee[n>>16&255]+ee[n>>24&255]+"-"+ee[e&255]+ee[e>>8&255]+"-"+ee[e>>16&15|64]+ee[e>>24&255]+"-"+ee[t&63|128]+ee[t>>8&255]+"-"+ee[t>>16&255]+ee[t>>24&255]+ee[s&255]+ee[s>>8&255]+ee[s>>16&255]+ee[s>>24&255]).toLowerCase()}function $o(n){return n*Uo}const jr="182",Ur=300,Ai=1e3,Kt=1001,Ei=1002,Bo=1006,Ho=1008,Vo=1009,Wo=1023,Xo="",Rt=2e3,Ri=2001;function Ii(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function De(...n){const e="THREE."+n.shift();console.warn(e,...n)}function Fi(...n){const e="THREE."+n.shift();console.error(e,...n)}class $r{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(t)===-1&&s[e].push(t)}hasEventListener(e,t){const s=this._listeners;return s===void 0?!1:s[e]!==void 0&&s[e].indexOf(t)!==-1}removeEventListener(e,t){const s=this._listeners;if(s===void 0)return;const i=s[e];if(i!==void 0){const r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const s=t[e.type];if(s!==void 0){e.target=this;const i=s.slice(0);for(let r=0,a=i.length;r<a;r++)i[r].call(this,e);e.target=null}}}const te=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Oi=1234567;const Pt=Math.PI/180,pn=180/Math.PI;function Sn(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(te[n&255]+te[n>>8&255]+te[n>>16&255]+te[n>>24&255]+"-"+te[e&255]+te[e>>8&255]+"-"+te[e>>16&15|64]+te[e>>24&255]+"-"+te[t&63|128]+te[t>>8&255]+"-"+te[t>>16&255]+te[t>>24&255]+te[s&255]+te[s>>8&255]+te[s>>16&255]+te[s>>24&255]).toLowerCase()}function B(n,e,t){return Math.max(e,Math.min(t,n))}function Br(n,e){return(n%e+e)%e}function qo(n,e,t,s,i){return s+(n-e)*(i-s)/(t-e)}function Yo(n,e,t){return n!==e?(t-n)/(e-n):0}function Hr(n,e,t){return(1-t)*n+t*e}function Zo(n,e,t,s){return Hr(n,e,1-Math.exp(-t*s))}function Go(n,e=1){return e-Math.abs(Br(n,e*2)-e)}function Ko(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function Qo(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function Jo(n,e){return n+Math.floor(Math.random()*(e-n+1))}function e0(n,e){return n+Math.random()*(e-n)}function t0(n){return n*(.5-Math.random())}function n0(n){n!==void 0&&(Oi=n);let e=Oi+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function s0(n){return n*Pt}function i0(n){return n*pn}function r0(n){return(n&n-1)===0&&n!==0}function a0(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function o0(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function h0(n,e,t,s,i){const r=Math.cos,a=Math.sin,o=r(t/2),h=a(t/2),l=r((e+s)/2),c=a((e+s)/2),f=r((e-s)/2),u=a((e-s)/2),d=r((s-e)/2),m=a((s-e)/2);switch(i){case"XYX":n.set(o*c,h*f,h*u,o*l);break;case"YZY":n.set(h*u,o*c,h*f,o*l);break;case"ZXZ":n.set(h*f,h*u,o*c,o*l);break;case"XZX":n.set(o*c,h*m,h*d,o*l);break;case"YXY":n.set(h*d,o*c,h*m,o*l);break;case"ZYZ":n.set(h*m,h*d,o*c,o*l);break;default:De("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function l0(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function c0(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const es={DEG2RAD:Pt,RAD2DEG:pn,generateUUID:Sn,clamp:B,euclideanModulo:Br,mapLinear:qo,inverseLerp:Yo,lerp:Hr,damp:Zo,pingpong:Go,smoothstep:Ko,smootherstep:Qo,randInt:Jo,randFloat:e0,randFloatSpread:t0,seededRandom:n0,degToRad:s0,radToDeg:i0,isPowerOfTwo:r0,ceilPowerOfTwo:a0,floorPowerOfTwo:o0,setQuaternionFromProperEuler:h0,normalize:c0,denormalize:l0};class He{constructor(e=0,t=0){He.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,s=this.y,i=e.elements;return this.x=i[0]*t+i[3]*s+i[6],this.y=i[1]*t+i[4]*s+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=B(this.x,e.x,t.x),this.y=B(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=B(this.x,e,t),this.y=B(this.y,e,t),this}clampLength(e,t){const s=this.length();return this.divideScalar(s||1).multiplyScalar(B(s,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const s=this.dot(e)/t;return Math.acos(B(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,s=this.y-e.y;return t*t+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const s=Math.cos(t),i=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*s-a*i+e.x,this.y=r*i+a*s+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class qe{constructor(e=0,t=0,s=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=s,this._w=i}static slerpFlat(e,t,s,i,r,a,o){let h=s[i+0],l=s[i+1],c=s[i+2],f=s[i+3],u=r[a+0],d=r[a+1],m=r[a+2],x=r[a+3];if(o<=0){e[t+0]=h,e[t+1]=l,e[t+2]=c,e[t+3]=f;return}if(o>=1){e[t+0]=u,e[t+1]=d,e[t+2]=m,e[t+3]=x;return}if(f!==x||h!==u||l!==d||c!==m){let g=h*u+l*d+c*m+f*x;g<0&&(u=-u,d=-d,m=-m,x=-x,g=-g);let p=1-o;if(g<.9995){const y=Math.acos(g),b=Math.sin(y);p=Math.sin(p*y)/b,o=Math.sin(o*y)/b,h=h*p+u*o,l=l*p+d*o,c=c*p+m*o,f=f*p+x*o}else{h=h*p+u*o,l=l*p+d*o,c=c*p+m*o,f=f*p+x*o;const y=1/Math.sqrt(h*h+l*l+c*c+f*f);h*=y,l*=y,c*=y,f*=y}}e[t]=h,e[t+1]=l,e[t+2]=c,e[t+3]=f}static multiplyQuaternionsFlat(e,t,s,i,r,a){const o=s[i],h=s[i+1],l=s[i+2],c=s[i+3],f=r[a],u=r[a+1],d=r[a+2],m=r[a+3];return e[t]=o*m+c*f+h*d-l*u,e[t+1]=h*m+c*u+l*f-o*d,e[t+2]=l*m+c*d+o*u-h*f,e[t+3]=c*m-o*f-h*u-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,s,i){return this._x=e,this._y=t,this._z=s,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const s=e._x,i=e._y,r=e._z,a=e._order,o=Math.cos,h=Math.sin,l=o(s/2),c=o(i/2),f=o(r/2),u=h(s/2),d=h(i/2),m=h(r/2);switch(a){case"XYZ":this._x=u*c*f+l*d*m,this._y=l*d*f-u*c*m,this._z=l*c*m+u*d*f,this._w=l*c*f-u*d*m;break;case"YXZ":this._x=u*c*f+l*d*m,this._y=l*d*f-u*c*m,this._z=l*c*m-u*d*f,this._w=l*c*f+u*d*m;break;case"ZXY":this._x=u*c*f-l*d*m,this._y=l*d*f+u*c*m,this._z=l*c*m+u*d*f,this._w=l*c*f-u*d*m;break;case"ZYX":this._x=u*c*f-l*d*m,this._y=l*d*f+u*c*m,this._z=l*c*m-u*d*f,this._w=l*c*f+u*d*m;break;case"YZX":this._x=u*c*f+l*d*m,this._y=l*d*f+u*c*m,this._z=l*c*m-u*d*f,this._w=l*c*f-u*d*m;break;case"XZY":this._x=u*c*f-l*d*m,this._y=l*d*f-u*c*m,this._z=l*c*m+u*d*f,this._w=l*c*f+u*d*m;break;default:De("Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const s=t/2,i=Math.sin(s);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,s=t[0],i=t[4],r=t[8],a=t[1],o=t[5],h=t[9],l=t[2],c=t[6],f=t[10],u=s+o+f;if(u>0){const d=.5/Math.sqrt(u+1);this._w=.25/d,this._x=(c-h)*d,this._y=(r-l)*d,this._z=(a-i)*d}else if(s>o&&s>f){const d=2*Math.sqrt(1+s-o-f);this._w=(c-h)/d,this._x=.25*d,this._y=(i+a)/d,this._z=(r+l)/d}else if(o>f){const d=2*Math.sqrt(1+o-s-f);this._w=(r-l)/d,this._x=(i+a)/d,this._y=.25*d,this._z=(h+c)/d}else{const d=2*Math.sqrt(1+f-s-o);this._w=(a-i)/d,this._x=(r+l)/d,this._y=(h+c)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let s=e.dot(t)+1;return s<1e-8?(s=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=s):(this._x=0,this._y=-e.z,this._z=e.y,this._w=s)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=s),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(B(this.dot(e),-1,1)))}rotateTowards(e,t){const s=this.angleTo(e);if(s===0)return this;const i=Math.min(1,t/s);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const s=e._x,i=e._y,r=e._z,a=e._w,o=t._x,h=t._y,l=t._z,c=t._w;return this._x=s*c+a*o+i*l-r*h,this._y=i*c+a*h+r*o-s*l,this._z=r*c+a*l+s*h-i*o,this._w=a*c-s*o-i*h-r*l,this._onChangeCallback(),this}slerp(e,t){if(t<=0)return this;if(t>=1)return this.copy(e);let s=e._x,i=e._y,r=e._z,a=e._w,o=this.dot(e);o<0&&(s=-s,i=-i,r=-r,a=-a,o=-o);let h=1-t;if(o<.9995){const l=Math.acos(o),c=Math.sin(l);h=Math.sin(h*l)/c,t=Math.sin(t*l)/c,this._x=this._x*h+s*t,this._y=this._y*h+i*t,this._z=this._z*h+r*t,this._w=this._w*h+a*t,this._onChangeCallback()}else this._x=this._x*h+s*t,this._y=this._y*h+i*t,this._z=this._z*h+r*t,this._w=this._w*h+a*t,this.normalize();return this}slerpQuaternions(e,t,s){return this.copy(e).slerp(t,s)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),s=Math.random(),i=Math.sqrt(1-s),r=Math.sqrt(s);return this.set(i*Math.sin(e),i*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class M{constructor(e=0,t=0,s=0){M.prototype.isVector3=!0,this.x=e,this.y=t,this.z=s}set(e,t,s){return s===void 0&&(s=this.z),this.x=e,this.y=t,this.z=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Pi.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Pi.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,s=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*s+r[6]*i,this.y=r[1]*t+r[4]*s+r[7]*i,this.z=r[2]*t+r[5]*s+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,s=this.y,i=this.z,r=e.elements,a=1/(r[3]*t+r[7]*s+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*s+r[8]*i+r[12])*a,this.y=(r[1]*t+r[5]*s+r[9]*i+r[13])*a,this.z=(r[2]*t+r[6]*s+r[10]*i+r[14])*a,this}applyQuaternion(e){const t=this.x,s=this.y,i=this.z,r=e.x,a=e.y,o=e.z,h=e.w,l=2*(a*i-o*s),c=2*(o*t-r*i),f=2*(r*s-a*t);return this.x=t+h*l+a*f-o*c,this.y=s+h*c+o*l-r*f,this.z=i+h*f+r*c-a*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,s=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*s+r[8]*i,this.y=r[1]*t+r[5]*s+r[9]*i,this.z=r[2]*t+r[6]*s+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=B(this.x,e.x,t.x),this.y=B(this.y,e.y,t.y),this.z=B(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=B(this.x,e,t),this.y=B(this.y,e,t),this.z=B(this.z,e,t),this}clampLength(e,t){const s=this.length();return this.divideScalar(s||1).multiplyScalar(B(s,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this.z=e.z+(t.z-e.z)*s,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const s=e.x,i=e.y,r=e.z,a=t.x,o=t.y,h=t.z;return this.x=i*h-r*o,this.y=r*a-s*h,this.z=s*o-i*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const s=e.dot(this)/t;return this.copy(e).multiplyScalar(s)}projectOnPlane(e){return ts.copy(this).projectOnVector(e),this.sub(ts)}reflect(e){return this.sub(ts.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const s=this.dot(e)/t;return Math.acos(B(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,s=this.y-e.y,i=this.z-e.z;return t*t+s*s+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,s){const i=Math.sin(t)*e;return this.x=i*Math.sin(s),this.y=Math.cos(t)*e,this.z=i*Math.cos(s),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,s){return this.x=e*Math.sin(t),this.y=s,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),s=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=s,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,s=Math.sqrt(1-t*t);return this.x=s*Math.cos(e),this.y=t,this.z=s*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const ts=new M,Pi=new qe;class Vt{constructor(e,t,s,i,r,a,o,h,l){Vt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,s,i,r,a,o,h,l)}set(e,t,s,i,r,a,o,h,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=o,c[3]=t,c[4]=r,c[5]=h,c[6]=s,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,s=e.elements;return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],this}extractBasis(e,t,s){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const s=e.elements,i=t.elements,r=this.elements,a=s[0],o=s[3],h=s[6],l=s[1],c=s[4],f=s[7],u=s[2],d=s[5],m=s[8],x=i[0],g=i[3],p=i[6],y=i[1],b=i[4],v=i[7],z=i[2],C=i[5],T=i[8];return r[0]=a*x+o*y+h*z,r[3]=a*g+o*b+h*C,r[6]=a*p+o*v+h*T,r[1]=l*x+c*y+f*z,r[4]=l*g+c*b+f*C,r[7]=l*p+c*v+f*T,r[2]=u*x+d*y+m*z,r[5]=u*g+d*b+m*C,r[8]=u*p+d*v+m*T,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],s=e[1],i=e[2],r=e[3],a=e[4],o=e[5],h=e[6],l=e[7],c=e[8];return t*a*c-t*o*l-s*r*c+s*o*h+i*r*l-i*a*h}invert(){const e=this.elements,t=e[0],s=e[1],i=e[2],r=e[3],a=e[4],o=e[5],h=e[6],l=e[7],c=e[8],f=c*a-o*l,u=o*h-c*r,d=l*r-a*h,m=t*f+s*u+i*d;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const x=1/m;return e[0]=f*x,e[1]=(i*l-c*s)*x,e[2]=(o*s-i*a)*x,e[3]=u*x,e[4]=(c*t-i*h)*x,e[5]=(i*r-o*t)*x,e[6]=d*x,e[7]=(s*h-l*t)*x,e[8]=(a*t-s*r)*x,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,s,i,r,a,o){const h=Math.cos(r),l=Math.sin(r);return this.set(s*h,s*l,-s*(h*a+l*o)+a+e,-i*l,i*h,-i*(-l*a+h*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(ns.makeScale(e,t)),this}rotate(e){return this.premultiply(ns.makeRotation(-e)),this}translate(e,t){return this.premultiply(ns.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),s=Math.sin(e);return this.set(t,-s,0,s,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,s=e.elements;for(let i=0;i<9;i++)if(t[i]!==s[i])return!1;return!0}fromArray(e,t=0){for(let s=0;s<9;s++)this.elements[s]=e[s+t];return this}toArray(e=[],t=0){const s=this.elements;return e[t]=s[0],e[t+1]=s[1],e[t+2]=s[2],e[t+3]=s[3],e[t+4]=s[4],e[t+5]=s[5],e[t+6]=s[6],e[t+7]=s[7],e[t+8]=s[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const ns=new Vt;function ss(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}let Je;class u0{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let s;if(e instanceof HTMLCanvasElement)s=e;else{Je===void 0&&(Je=Ii("canvas")),Je.width=e.width,Je.height=e.height;const i=Je.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),s=Je}return s.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Ii("canvas");t.width=e.width,t.height=e.height;const s=t.getContext("2d");s.drawImage(e,0,0,e.width,e.height);const i=s.getImageData(0,0,e.width,e.height),r=i.data;for(let a=0;a<r.length;a++)r[a]=ss(r[a]/255)*255;return s.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let s=0;s<t.length;s++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[s]=Math.floor(ss(t[s]/255)*255):t[s]=ss(t[s]);return{data:t,width:e.width,height:e.height}}else return De("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let f0=0;class d0{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:f0++}),this.uuid=Sn(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):typeof VideoFrame<"u"&&t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const s={uuid:this.uuid,url:""},i=this.data;if(i!==null){let r;if(Array.isArray(i)){r=[];for(let a=0,o=i.length;a<o;a++)i[a].isDataTexture?r.push(is(i[a].image)):r.push(is(i[a]))}else r=is(i);s.url=r}return t||(e.images[this.uuid]=s),s}}function is(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?u0.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(De("Texture: Unable to serialize Texture."),{})}let m0=0;const rs=new M;class Ve extends $r{constructor(e=Ve.DEFAULT_IMAGE,t=Ve.DEFAULT_MAPPING,s=Kt,i=Kt,r=Bo,a=Ho,o=Wo,h=Vo,l=Ve.DEFAULT_ANISOTROPY,c=Xo){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:m0++}),this.uuid=Sn(),this.name="",this.source=new d0(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=s,this.wrapT=i,this.magFilter=r,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=h,this.offset=new He(0,0),this.repeat=new He(1,1),this.center=new He(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Vt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(rs).x}get height(){return this.source.getSize(rs).y}get depth(){return this.source.getSize(rs).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const s=e[t];if(s===void 0){De(`Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){De(`Texture.setValues(): property '${t}' does not exist.`);continue}i&&s&&i.isVector2&&s.isVector2||i&&s&&i.isVector3&&s.isVector3||i&&s&&i.isMatrix3&&s.isMatrix3?i.copy(s):this[t]=s}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const s={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),t||(e.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Ur)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ai:e.x=e.x-Math.floor(e.x);break;case Kt:e.x=e.x<0?0:1;break;case Ei:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Ai:e.y=e.y-Math.floor(e.y);break;case Kt:e.y=e.y<0?0:1;break;case Ei:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Ve.DEFAULT_IMAGE=null;Ve.DEFAULT_MAPPING=Ur;Ve.DEFAULT_ANISOTROPY=1;class Q{constructor(e,t,s,i,r,a,o,h,l,c,f,u,d,m,x,g){Q.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,s,i,r,a,o,h,l,c,f,u,d,m,x,g)}set(e,t,s,i,r,a,o,h,l,c,f,u,d,m,x,g){const p=this.elements;return p[0]=e,p[4]=t,p[8]=s,p[12]=i,p[1]=r,p[5]=a,p[9]=o,p[13]=h,p[2]=l,p[6]=c,p[10]=f,p[14]=u,p[3]=d,p[7]=m,p[11]=x,p[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Q().fromArray(this.elements)}copy(e){const t=this.elements,s=e.elements;return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],t[9]=s[9],t[10]=s[10],t[11]=s[11],t[12]=s[12],t[13]=s[13],t[14]=s[14],t[15]=s[15],this}copyPosition(e){const t=this.elements,s=e.elements;return t[12]=s[12],t[13]=s[13],t[14]=s[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,s){return this.determinant()===0?(e.set(1,0,0),t.set(0,1,0),s.set(0,0,1),this):(e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this)}makeBasis(e,t,s){return this.set(e.x,t.x,s.x,0,e.y,t.y,s.y,0,e.z,t.z,s.z,0,0,0,0,1),this}extractRotation(e){if(e.determinant()===0)return this.identity();const t=this.elements,s=e.elements,i=1/et.setFromMatrixColumn(e,0).length(),r=1/et.setFromMatrixColumn(e,1).length(),a=1/et.setFromMatrixColumn(e,2).length();return t[0]=s[0]*i,t[1]=s[1]*i,t[2]=s[2]*i,t[3]=0,t[4]=s[4]*r,t[5]=s[5]*r,t[6]=s[6]*r,t[7]=0,t[8]=s[8]*a,t[9]=s[9]*a,t[10]=s[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,s=e.x,i=e.y,r=e.z,a=Math.cos(s),o=Math.sin(s),h=Math.cos(i),l=Math.sin(i),c=Math.cos(r),f=Math.sin(r);if(e.order==="XYZ"){const u=a*c,d=a*f,m=o*c,x=o*f;t[0]=h*c,t[4]=-h*f,t[8]=l,t[1]=d+m*l,t[5]=u-x*l,t[9]=-o*h,t[2]=x-u*l,t[6]=m+d*l,t[10]=a*h}else if(e.order==="YXZ"){const u=h*c,d=h*f,m=l*c,x=l*f;t[0]=u+x*o,t[4]=m*o-d,t[8]=a*l,t[1]=a*f,t[5]=a*c,t[9]=-o,t[2]=d*o-m,t[6]=x+u*o,t[10]=a*h}else if(e.order==="ZXY"){const u=h*c,d=h*f,m=l*c,x=l*f;t[0]=u-x*o,t[4]=-a*f,t[8]=m+d*o,t[1]=d+m*o,t[5]=a*c,t[9]=x-u*o,t[2]=-a*l,t[6]=o,t[10]=a*h}else if(e.order==="ZYX"){const u=a*c,d=a*f,m=o*c,x=o*f;t[0]=h*c,t[4]=m*l-d,t[8]=u*l+x,t[1]=h*f,t[5]=x*l+u,t[9]=d*l-m,t[2]=-l,t[6]=o*h,t[10]=a*h}else if(e.order==="YZX"){const u=a*h,d=a*l,m=o*h,x=o*l;t[0]=h*c,t[4]=x-u*f,t[8]=m*f+d,t[1]=f,t[5]=a*c,t[9]=-o*c,t[2]=-l*c,t[6]=d*f+m,t[10]=u-x*f}else if(e.order==="XZY"){const u=a*h,d=a*l,m=o*h,x=o*l;t[0]=h*c,t[4]=-f,t[8]=l*c,t[1]=u*f+x,t[5]=a*c,t[9]=d*f-m,t[2]=m*f-d,t[6]=o*c,t[10]=x*f+u}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(p0,e,g0)}lookAt(e,t,s){const i=this.elements;return oe.subVectors(e,t),oe.lengthSq()===0&&(oe.z=1),oe.normalize(),Ae.crossVectors(s,oe),Ae.lengthSq()===0&&(Math.abs(s.z)===1?oe.x+=1e-4:oe.z+=1e-4,oe.normalize(),Ae.crossVectors(s,oe)),Ae.normalize(),Qt.crossVectors(oe,Ae),i[0]=Ae.x,i[4]=Qt.x,i[8]=oe.x,i[1]=Ae.y,i[5]=Qt.y,i[9]=oe.y,i[2]=Ae.z,i[6]=Qt.z,i[10]=oe.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const s=e.elements,i=t.elements,r=this.elements,a=s[0],o=s[4],h=s[8],l=s[12],c=s[1],f=s[5],u=s[9],d=s[13],m=s[2],x=s[6],g=s[10],p=s[14],y=s[3],b=s[7],v=s[11],z=s[15],C=i[0],T=i[4],R=i[8],S=i[12],A=i[1],O=i[5],P=i[9],$=i[13],V=i[2],ie=i[6],ue=i[10],re=i[14],ae=i[3],fe=i[7],_e=i[11],pe=i[15];return r[0]=a*C+o*A+h*V+l*ae,r[4]=a*T+o*O+h*ie+l*fe,r[8]=a*R+o*P+h*ue+l*_e,r[12]=a*S+o*$+h*re+l*pe,r[1]=c*C+f*A+u*V+d*ae,r[5]=c*T+f*O+u*ie+d*fe,r[9]=c*R+f*P+u*ue+d*_e,r[13]=c*S+f*$+u*re+d*pe,r[2]=m*C+x*A+g*V+p*ae,r[6]=m*T+x*O+g*ie+p*fe,r[10]=m*R+x*P+g*ue+p*_e,r[14]=m*S+x*$+g*re+p*pe,r[3]=y*C+b*A+v*V+z*ae,r[7]=y*T+b*O+v*ie+z*fe,r[11]=y*R+b*P+v*ue+z*_e,r[15]=y*S+b*$+v*re+z*pe,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],s=e[4],i=e[8],r=e[12],a=e[1],o=e[5],h=e[9],l=e[13],c=e[2],f=e[6],u=e[10],d=e[14],m=e[3],x=e[7],g=e[11],p=e[15],y=h*d-l*u,b=o*d-l*f,v=o*u-h*f,z=a*d-l*c,C=a*u-h*c,T=a*f-o*c;return t*(x*y-g*b+p*v)-s*(m*y-g*z+p*C)+i*(m*b-x*z+p*T)-r*(m*v-x*C+g*T)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,s){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=s),this}invert(){const e=this.elements,t=e[0],s=e[1],i=e[2],r=e[3],a=e[4],o=e[5],h=e[6],l=e[7],c=e[8],f=e[9],u=e[10],d=e[11],m=e[12],x=e[13],g=e[14],p=e[15],y=f*g*l-x*u*l+x*h*d-o*g*d-f*h*p+o*u*p,b=m*u*l-c*g*l-m*h*d+a*g*d+c*h*p-a*u*p,v=c*x*l-m*f*l+m*o*d-a*x*d-c*o*p+a*f*p,z=m*f*h-c*x*h-m*o*u+a*x*u+c*o*g-a*f*g,C=t*y+s*b+i*v+r*z;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/C;return e[0]=y*T,e[1]=(x*u*r-f*g*r-x*i*d+s*g*d+f*i*p-s*u*p)*T,e[2]=(o*g*r-x*h*r+x*i*l-s*g*l-o*i*p+s*h*p)*T,e[3]=(f*h*r-o*u*r-f*i*l+s*u*l+o*i*d-s*h*d)*T,e[4]=b*T,e[5]=(c*g*r-m*u*r+m*i*d-t*g*d-c*i*p+t*u*p)*T,e[6]=(m*h*r-a*g*r-m*i*l+t*g*l+a*i*p-t*h*p)*T,e[7]=(a*u*r-c*h*r+c*i*l-t*u*l-a*i*d+t*h*d)*T,e[8]=v*T,e[9]=(m*f*r-c*x*r-m*s*d+t*x*d+c*s*p-t*f*p)*T,e[10]=(a*x*r-m*o*r+m*s*l-t*x*l-a*s*p+t*o*p)*T,e[11]=(c*o*r-a*f*r-c*s*l+t*f*l+a*s*d-t*o*d)*T,e[12]=z*T,e[13]=(c*x*i-m*f*i+m*s*u-t*x*u-c*s*g+t*f*g)*T,e[14]=(m*o*i-a*x*i-m*s*h+t*x*h+a*s*g-t*o*g)*T,e[15]=(a*f*i-c*o*i+c*s*h-t*f*h-a*s*u+t*o*u)*T,this}scale(e){const t=this.elements,s=e.x,i=e.y,r=e.z;return t[0]*=s,t[4]*=i,t[8]*=r,t[1]*=s,t[5]*=i,t[9]*=r,t[2]*=s,t[6]*=i,t[10]*=r,t[3]*=s,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,s,i))}makeTranslation(e,t,s){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,s,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),s=Math.sin(e);return this.set(1,0,0,0,0,t,-s,0,0,s,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),s=Math.sin(e);return this.set(t,0,s,0,0,1,0,0,-s,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),s=Math.sin(e);return this.set(t,-s,0,0,s,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const s=Math.cos(t),i=Math.sin(t),r=1-s,a=e.x,o=e.y,h=e.z,l=r*a,c=r*o;return this.set(l*a+s,l*o-i*h,l*h+i*o,0,l*o+i*h,c*o+s,c*h-i*a,0,l*h-i*o,c*h+i*a,r*h*h+s,0,0,0,0,1),this}makeScale(e,t,s){return this.set(e,0,0,0,0,t,0,0,0,0,s,0,0,0,0,1),this}makeShear(e,t,s,i,r,a){return this.set(1,s,r,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,s){const i=this.elements,r=t._x,a=t._y,o=t._z,h=t._w,l=r+r,c=a+a,f=o+o,u=r*l,d=r*c,m=r*f,x=a*c,g=a*f,p=o*f,y=h*l,b=h*c,v=h*f,z=s.x,C=s.y,T=s.z;return i[0]=(1-(x+p))*z,i[1]=(d+v)*z,i[2]=(m-b)*z,i[3]=0,i[4]=(d-v)*C,i[5]=(1-(u+p))*C,i[6]=(g+y)*C,i[7]=0,i[8]=(m+b)*T,i[9]=(g-y)*T,i[10]=(1-(u+x))*T,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,s){const i=this.elements;if(e.x=i[12],e.y=i[13],e.z=i[14],this.determinant()===0)return s.set(1,1,1),t.identity(),this;let r=et.set(i[0],i[1],i[2]).length();const a=et.set(i[4],i[5],i[6]).length(),o=et.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),xe.copy(this);const l=1/r,c=1/a,f=1/o;return xe.elements[0]*=l,xe.elements[1]*=l,xe.elements[2]*=l,xe.elements[4]*=c,xe.elements[5]*=c,xe.elements[6]*=c,xe.elements[8]*=f,xe.elements[9]*=f,xe.elements[10]*=f,t.setFromRotationMatrix(xe),s.x=r,s.y=a,s.z=o,this}makePerspective(e,t,s,i,r,a,o=Rt,h=!1){const l=this.elements,c=2*r/(t-e),f=2*r/(s-i),u=(t+e)/(t-e),d=(s+i)/(s-i);let m,x;if(h)m=r/(a-r),x=a*r/(a-r);else if(o===Rt)m=-(a+r)/(a-r),x=-2*a*r/(a-r);else if(o===Ri)m=-a/(a-r),x=-a*r/(a-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return l[0]=c,l[4]=0,l[8]=u,l[12]=0,l[1]=0,l[5]=f,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=m,l[14]=x,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,s,i,r,a,o=Rt,h=!1){const l=this.elements,c=2/(t-e),f=2/(s-i),u=-(t+e)/(t-e),d=-(s+i)/(s-i);let m,x;if(h)m=1/(a-r),x=a/(a-r);else if(o===Rt)m=-2/(a-r),x=-(a+r)/(a-r);else if(o===Ri)m=-1/(a-r),x=-r/(a-r);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return l[0]=c,l[4]=0,l[8]=0,l[12]=u,l[1]=0,l[5]=f,l[9]=0,l[13]=d,l[2]=0,l[6]=0,l[10]=m,l[14]=x,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,s=e.elements;for(let i=0;i<16;i++)if(t[i]!==s[i])return!1;return!0}fromArray(e,t=0){for(let s=0;s<16;s++)this.elements[s]=e[s+t];return this}toArray(e=[],t=0){const s=this.elements;return e[t]=s[0],e[t+1]=s[1],e[t+2]=s[2],e[t+3]=s[3],e[t+4]=s[4],e[t+5]=s[5],e[t+6]=s[6],e[t+7]=s[7],e[t+8]=s[8],e[t+9]=s[9],e[t+10]=s[10],e[t+11]=s[11],e[t+12]=s[12],e[t+13]=s[13],e[t+14]=s[14],e[t+15]=s[15],e}}const et=new M,xe=new Q,p0=new M(0,0,0),g0=new M(1,1,1),Ae=new M,Qt=new M,oe=new M,Di=new Q,Ni=new qe;class bt{constructor(e=0,t=0,s=0,i=bt.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=s,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,s,i=this._order){return this._x=e,this._y=t,this._z=s,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,s=!0){const i=e.elements,r=i[0],a=i[4],o=i[8],h=i[1],l=i[5],c=i[9],f=i[2],u=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(B(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-B(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(h,l)):(this._y=Math.atan2(-f,r),this._z=0);break;case"ZXY":this._x=Math.asin(B(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-f,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(h,r));break;case"ZYX":this._y=Math.asin(-B(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(h,r)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(B(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-f,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-B(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:De("Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,s===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,s){return Di.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Di,t,s)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Ni.setFromEuler(this),this.setFromQuaternion(Ni,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}bt.DEFAULT_ORDER="XYZ";class x0{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let b0=0;const Li=new M,tt=new qe,we=new Q,Jt=new M,Tt=new M,y0=new M,v0=new qe,ji=new M(1,0,0),Ui=new M(0,1,0),$i=new M(0,0,1),Bi={type:"added"},_0={type:"removed"},nt={type:"childadded",child:null},as={type:"childremoved",child:null};class Oe extends $r{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:b0++}),this.uuid=Sn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Oe.DEFAULT_UP.clone();const e=new M,t=new bt,s=new qe,i=new M(1,1,1);function r(){s.setFromEuler(t,!1)}function a(){t.setFromQuaternion(s,void 0,!1)}t._onChange(r),s._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Q},normalMatrix:{value:new Vt}}),this.matrix=new Q,this.matrixWorld=new Q,this.matrixAutoUpdate=Oe.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Oe.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new x0,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return tt.setFromAxisAngle(e,t),this.quaternion.multiply(tt),this}rotateOnWorldAxis(e,t){return tt.setFromAxisAngle(e,t),this.quaternion.premultiply(tt),this}rotateX(e){return this.rotateOnAxis(ji,e)}rotateY(e){return this.rotateOnAxis(Ui,e)}rotateZ(e){return this.rotateOnAxis($i,e)}translateOnAxis(e,t){return Li.copy(e).applyQuaternion(this.quaternion),this.position.add(Li.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(ji,e)}translateY(e){return this.translateOnAxis(Ui,e)}translateZ(e){return this.translateOnAxis($i,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(we.copy(this.matrixWorld).invert())}lookAt(e,t,s){e.isVector3?Jt.copy(e):Jt.set(e,t,s);const i=this.parent;this.updateWorldMatrix(!0,!1),Tt.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?we.lookAt(Tt,Jt,this.up):we.lookAt(Jt,Tt,this.up),this.quaternion.setFromRotationMatrix(we),i&&(we.extractRotation(i.matrixWorld),tt.setFromRotationMatrix(we),this.quaternion.premultiply(tt.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(Fi("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Bi),nt.child=e,this.dispatchEvent(nt),nt.child=null):Fi("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(_0),as.child=e,this.dispatchEvent(as),as.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),we.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),we.multiply(e.parent.matrixWorld)),e.applyMatrix4(we),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Bi),nt.child=e,this.dispatchEvent(nt),nt.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let s=0,i=this.children.length;s<i;s++){const a=this.children[s].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,s=[]){this[e]===t&&s.push(this);const i=this.children;for(let r=0,a=i.length;r<a;r++)i[r].getObjectsByProperty(e,t,s);return s}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Tt,e,y0),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Tt,v0,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let s=0,i=t.length;s<i;s++)t[s].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let s=0,i=t.length;s<i;s++)t[s].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let s=0,i=t.length;s<i;s++)t[s].updateMatrixWorld(e)}updateWorldMatrix(e,t){const s=this.parent;if(e===!0&&s!==null&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const i=this.children;for(let r=0,a=i.length;r<a;r++)i[r].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",s={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),i.instanceInfo=this._instanceInfo.map(o=>({...o})),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(e),i.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(i.boundingBox=this.boundingBox.toJSON()));function r(o,h){return o[h.uuid]===void 0&&(o[h.uuid]=h.toJSON(e)),h.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const h=o.shapes;if(Array.isArray(h))for(let l=0,c=h.length;l<c;l++){const f=h[l];r(e.shapes,f)}else r(e.shapes,h)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let h=0,l=this.material.length;h<l;h++)o.push(r(e.materials,this.material[h]));i.material=o}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let o=0;o<this.children.length;o++)i.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let o=0;o<this.animations.length;o++){const h=this.animations[o];i.animations.push(r(e.animations,h))}}if(t){const o=a(e.geometries),h=a(e.materials),l=a(e.textures),c=a(e.images),f=a(e.shapes),u=a(e.skeletons),d=a(e.animations),m=a(e.nodes);o.length>0&&(s.geometries=o),h.length>0&&(s.materials=h),l.length>0&&(s.textures=l),c.length>0&&(s.images=c),f.length>0&&(s.shapes=f),u.length>0&&(s.skeletons=u),d.length>0&&(s.animations=d),m.length>0&&(s.nodes=m)}return s.object=i,s;function a(o){const h=[];for(const l in o){const c=o[l];delete c.metadata,h.push(c)}return h}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let s=0;s<e.children.length;s++){const i=e.children[s];this.add(i.clone())}return this}}Oe.DEFAULT_UP=new M(0,1,0);Oe.DEFAULT_MATRIX_AUTO_UPDATE=!0;Oe.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;class Vr extends Oe{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Q,this.projectionMatrix=new Q,this.projectionMatrixInverse=new Q,this.coordinateSystem=Rt,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Ee=new M,Hi=new He,Vi=new He;class M0 extends Vr{constructor(e=50,t=1,s=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=s,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=pn*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Pt*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return pn*2*Math.atan(Math.tan(Pt*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,s){Ee.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Ee.x,Ee.y).multiplyScalar(-e/Ee.z),Ee.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),s.set(Ee.x,Ee.y).multiplyScalar(-e/Ee.z)}getViewSize(e,t){return this.getViewBounds(e,Hi,Vi),t.subVectors(Vi,Hi)}setViewOffset(e,t,s,i,r,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=s,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Pt*.5*this.fov)/this.zoom,s=2*t,i=this.aspect*s,r=-.5*i;const a=this.view;if(this.view!==null&&this.view.enabled){const h=a.fullWidth,l=a.fullHeight;r+=a.offsetX*i/h,t-=a.offsetY*s/l,i*=a.width/h,s*=a.height/l}const o=this.filmOffset;o!==0&&(r+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-s,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}class w0 extends Vr{constructor(e=-1,t=1,s=1,i=-1,r=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=s,this.bottom=i,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,s,i,r,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=s,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),s=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=s-e,a=s+e,o=i+t,h=i-t;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=l*this.view.offsetX,a=r+l*this.view.width,o-=c*this.view.offsetY,h=o-c*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,h,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:jr}}));typeof window<"u"&&(window.__THREE__?De("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=jr);const Wr=[{name:"SquareFilled",vertices:[[-.5,.5,0],[-.5,-.5,0],[.5,-.5,0],[.5,.5,0]],faces:[[0,1,2],[3,2,0]]},{name:"SquareOutline",vertices:[[-.5,.5,0],[.5,.5,0],[-.5,.375,0],[.5,.375,0],[-.5,-.375,0],[.5,-.375,0],[-.5,-.5,0],[.5,-.5,0],[-.375,.375,0],[-.375,-.375,0],[.375,.375,0],[.375,-.375,0]],faces:[[0,1,2],[3,2,1],[4,5,6],[7,6,5],[2,8,4],[9,4,8],[10,3,11],[5,11,3]]},{name:"SquareOutlineThin",vertices:[[-.5,.5,0],[.5,.5,0],[-.5,.45,0],[.5,.45,0],[-.5,-.45,0],[.5,-.45,0],[-.5,-.5,0],[.5,-.5,0],[-.45,.45,0],[-.45,-.45,0],[.45,.45,0],[.45,-.45,0]],faces:[[0,1,2],[3,2,1],[4,5,6],[7,6,5],[2,8,4],[9,4,8],[10,3,11],[5,11,3]]}],Xr=[{name:"TriangleFilled",vertices:[[352086e-22,.575,0],[-.497965,-.2875,0],[.497965,-.2875,0]],faces:[[0,1,2]]},{name:"TriangleOutline",vertices:[[352086e-22,.575,0],[-.497965,-.2875,0],[213889e-22,.349307,0],[-.302509,-.174654,0],[.302509,-.174654,0],[.497965,-.2875,0]],faces:[[0,1,2],[2,1,3],[3,1,4],[4,1,5],[5,4,2],[2,0,5]]},{name:"TriangleRightFilled",vertices:[[-.5,.5,0],[-.5,-.5,0],[.5,-.5,0]],faces:[[0,1,2]]},{name:"TriangleRightOutline",vertices:[[-.393333,.236667,0],[-.5,.5,0],[-.393333,-.393333,0],[-.5,-.5,0],[.236667,-.393333,0],[.5,-.5,0]],faces:[[0,1,2],[2,1,3],[3,2,4],[4,3,5],[5,4,0],[0,5,1]]},{name:"TriangleOffset",vertices:[[352086e-22,.8625,0],[-.497965,0,0],[.497965,0,0]],faces:[[0,1,2]]},{name:"TriangleOffsetOutline",vertices:[[352086e-22,.7875,0],[-.497965,-.075,0],[213889e-22,.561807,0],[-.302509,.037846,0],[.302509,.037846,0],[.497965,-.075,0]],faces:[[0,1,2],[2,1,3],[3,1,4],[4,1,5],[5,4,2],[2,0,5]]}],qr=[{name:"Point",vertices:[[0,0,0]],faces:[[0,0,0]]}],Yr=[{name:"CircleFilled",vertices:[[0,0,0],[.5,0,0],[.490393,.0975452,0],[.46194,.191342,0],[.415735,.277785,0],[.353553,.353553,0],[.277785,.415735,0],[.191342,.46194,0],[.0975452,.490393,0],[306162e-22,.5,0],[-.0975452,.490393,0],[-.191342,.46194,0],[-.277785,.415735,0],[-.353553,.353553,0],[-.415735,.277785,0],[-.46194,.191342,0],[-.490393,.0975452,0],[-.5,612323e-22,0],[-.490393,-.0975452,0],[-.46194,-.191342,0],[-.415735,-.277785,0],[-.353553,-.353553,0],[-.277785,-.415735,0],[-.191342,-.46194,0],[-.0975452,-.490393,0],[-918485e-22,-.5,0],[.0975452,-.490393,0],[.191342,-.46194,0],[.277785,-.415735,0],[.353553,-.353553,0],[.415735,-.277785,0],[.46194,-.191342,0],[.490393,-.0975452,0],[.5,-122465e-21,0]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,6],[0,6,7],[0,7,8],[0,8,9],[0,9,10],[0,10,11],[0,11,12],[0,12,13],[0,13,14],[0,14,15],[0,15,16],[0,16,17],[0,17,18],[0,18,19],[0,19,20],[0,20,21],[0,21,22],[0,22,23],[0,23,24],[0,24,25],[0,25,26],[0,26,27],[0,27,28],[0,28,29],[0,29,30],[0,30,31],[0,31,32],[0,32,33]]},{name:"CircleOutline",vertices:[[.375,0,0],[.5,0,0],[.490393,.0975452,0],[.367794,.0731589,0],[.46194,.191342,0],[.346455,.143506,0],[.415735,.277785,0],[.311801,.208339,0],[.353553,.353553,0],[.265165,.265165,0],[.277785,.415735,0],[.208339,.311801,0],[.191342,.46194,0],[.143506,.346455,0],[.0975452,.490393,0],[.0731589,.367794,0],[306162e-22,.5,0],[229621e-22,.375,0],[-.0975452,.490393,0],[-.0731589,.367794,0],[-.191342,.46194,0],[-.143506,.346455,0],[-.277785,.415735,0],[-.208339,.311801,0],[-.353553,.353553,0],[-.265165,.265165,0],[-.415735,.277785,0],[-.311801,.208339,0],[-.46194,.191342,0],[-.346455,.143506,0],[-.490393,.0975452,0],[-.367794,.0731589,0],[-.5,612323e-22,0],[-.375,459243e-22,0],[-.490393,-.0975452,0],[-.367794,-.0731589,0],[-.46194,-.191342,0],[-.346455,-.143506,0],[-.415735,-.277785,0],[-.311801,-.208339,0],[-.353553,-.353553,0],[-.265165,-.265165,0],[-.277785,-.415735,0],[-.208339,-.311801,0],[-.191342,-.46194,0],[-.143506,-.346455,0],[-.0975452,-.490393,0],[-.0731589,-.367794,0],[-918485e-22,-.5,0],[-688864e-22,-.375,0],[.0975452,-.490393,0],[.0731589,-.367794,0],[.191342,-.46194,0],[.143506,-.346455,0],[.277785,-.415735,0],[.208339,-.311801,0],[.353553,-.353553,0],[.265165,-.265165,0],[.415735,-.277785,0],[.311801,-.208339,0],[.46194,-.191342,0],[.346455,-.143506,0],[.490393,-.0975452,0],[.367794,-.0731589,0],[.5,-122465e-21,0],[.375,-918485e-22,0]],faces:[[0,1,2],[0,3,2],[3,2,4],[3,5,4],[5,4,6],[5,7,6],[7,6,8],[7,9,8],[9,8,10],[9,11,10],[11,10,12],[11,13,12],[13,12,14],[13,15,14],[15,14,16],[15,17,16],[17,16,18],[17,19,18],[19,18,20],[19,21,20],[21,20,22],[21,23,22],[23,22,24],[23,25,24],[25,24,26],[25,27,26],[27,26,28],[27,29,28],[29,28,30],[29,31,30],[31,30,32],[31,33,32],[33,32,34],[33,35,34],[35,34,36],[35,37,36],[37,36,38],[37,39,38],[39,38,40],[39,41,40],[41,40,42],[41,43,42],[43,42,44],[43,45,44],[45,44,46],[45,47,46],[47,46,48],[47,49,48],[49,48,50],[49,51,50],[51,50,52],[51,53,52],[53,52,54],[53,55,54],[55,54,56],[55,57,56],[57,56,58],[57,59,58],[59,58,60],[59,61,60],[61,60,62],[61,63,62],[63,62,64],[63,65,64]]},{name:"CircleHalf",vertices:[[0,0,0],[306162e-22,-.5,0],[.0975452,-.490393,0],[.191342,-.46194,0],[.277785,-.415735,0],[.353553,-.353553,0],[.415735,-.277785,0],[.46194,-.191342,0],[.490393,-.0975452,0],[.5,0,0],[.490393,.0975452,0],[.46194,.191342,0],[.415735,.277785,0],[.353553,.353553,0],[.277785,.415735,0],[.191342,.46194,0],[.0975452,.490393,0],[306162e-22,.5,0]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,6],[0,6,7],[0,7,8],[0,8,9],[0,9,10],[0,10,11],[0,11,12],[0,12,13],[0,13,14],[0,14,15],[0,15,16],[0,16,17]]},{name:"CircleHalfOutline",vertices:[[229621e-22,-.375,0],[306162e-22,-.5,0],[.0975452,-.490393,0],[.0731589,-.367794,0],[.191342,-.46194,0],[.143506,-.346455,0],[.277785,-.415735,0],[.208339,-.311801,0],[.353553,-.353553,0],[.265165,-.265165,0],[.415735,-.277785,0],[.311801,-.208339,0],[.46194,-.191342,0],[.346455,-.143506,0],[.490393,-.0975452,0],[.367794,-.0731589,0],[.5,0,0],[.375,0,0],[.490393,.0975452,0],[.367794,.0731589,0],[.46194,.191342,0],[.346455,.143506,0],[.415735,.277785,0],[.311801,.208339,0],[.353553,.353553,0],[.265165,.265165,0],[.277785,.415735,0],[.208339,.311801,0],[.191342,.46194,0],[.143506,.346455,0],[.0975452,.490393,0],[.0731589,.367794,0],[306162e-22,.5,0],[229621e-22,.375,0]],faces:[[0,1,2],[0,3,2],[3,2,4],[3,5,4],[5,4,6],[5,7,6],[7,6,8],[7,9,8],[9,8,10],[9,11,10],[11,10,12],[11,13,12],[13,12,14],[13,15,14],[15,14,16],[15,17,16],[17,16,18],[17,19,18],[19,18,20],[19,21,20],[21,20,22],[21,23,22],[23,22,24],[23,25,24],[25,24,26],[25,27,26],[27,26,28],[27,29,28],[29,28,30],[29,31,30],[31,30,32],[31,33,32]]},{name:"CircleOutlineThin",vertices:[[.45,0,0],[.5,0,0],[.490393,.0975452,0],[.441353,.0877906,0],[.46194,.191342,0],[.415746,.172208,0],[.415735,.277785,0],[.374161,.250007,0],[.353553,.353553,0],[.318198,.318198,0],[.277785,.415735,0],[.250007,.374161,0],[.191342,.46194,0],[.172208,.415746,0],[.0975452,.490393,0],[.0877906,.441353,0],[306162e-22,.5,0],[275546e-22,.45,0],[-.0975452,.490393,0],[-.0877906,.441353,0],[-.191342,.46194,0],[-.172208,.415746,0],[-.277785,.415735,0],[-.250007,.374161,0],[-.353553,.353553,0],[-.318198,.318198,0],[-.415735,.277785,0],[-.374161,.250007,0],[-.46194,.191342,0],[-.415746,.172208,0],[-.490393,.0975452,0],[-.441353,.0877906,0],[-.5,612323e-22,0],[-.45,551091e-22,0],[-.490393,-.0975452,0],[-.441353,-.0877906,0],[-.46194,-.191342,0],[-.415746,-.172208,0],[-.415735,-.277785,0],[-.374161,-.250007,0],[-.353553,-.353553,0],[-.318198,-.318198,0],[-.277785,-.415735,0],[-.250007,-.374161,0],[-.191342,-.46194,0],[-.172208,-.415746,0],[-.0975452,-.490393,0],[-.0877906,-.441353,0],[-918485e-22,-.5,0],[-826637e-22,-.45,0],[.0975452,-.490393,0],[.0877906,-.441353,0],[.191342,-.46194,0],[.172208,-.415746,0],[.277785,-.415735,0],[.250007,-.374161,0],[.353553,-.353553,0],[.318198,-.318198,0],[.415735,-.277785,0],[.374161,-.250007,0],[.46194,-.191342,0],[.415746,-.172208,0],[.490393,-.0975452,0],[.441353,-.0877906,0],[.5,-122465e-21,0],[.45,-110218e-21,0]],faces:[[0,1,2],[0,3,2],[3,2,4],[3,5,4],[5,4,6],[5,7,6],[7,6,8],[7,9,8],[9,8,10],[9,11,10],[11,10,12],[11,13,12],[13,12,14],[13,15,14],[15,14,16],[15,17,16],[17,16,18],[17,19,18],[19,18,20],[19,21,20],[21,20,22],[21,23,22],[23,22,24],[23,25,24],[25,24,26],[25,27,26],[27,26,28],[27,29,28],[29,28,30],[29,31,30],[31,30,32],[31,33,32],[33,32,34],[33,35,34],[35,34,36],[35,37,36],[37,36,38],[37,39,38],[39,38,40],[39,41,40],[41,40,42],[41,43,42],[43,42,44],[43,45,44],[45,44,46],[45,47,46],[47,46,48],[47,49,48],[49,48,50],[49,51,50],[51,50,52],[51,53,52],[53,52,54],[53,55,54],[55,54,56],[55,57,56],[57,56,58],[57,59,58],[59,58,60],[59,61,60],[61,60,62],[61,63,62],[63,62,64],[63,65,64]]},{name:"CircleQuarter",vertices:[[0,0,0],[.5,0,0],[.490393,.0975452,0],[.46194,.191342,0],[.415735,.277785,0],[.353553,.353553,0],[.277785,.415735,0],[.191342,.46194,0],[.0975452,.490393,0],[306162e-22,.5,0]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,6],[0,6,7],[0,7,8],[0,8,9]]},{name:"CircleQuarterOutline",vertices:[[.375,0,0],[.5,0,0],[.490393,.0975452,0],[.367794,.0731589,0],[.46194,.191342,0],[.346455,.143506,0],[.415735,.277785,0],[.311801,.208339,0],[.353553,.353553,0],[.265165,.265165,0],[.277785,.415735,0],[.208339,.311801,0],[.191342,.46194,0],[.143506,.346455,0],[.0975452,.490393,0],[.0731589,.367794,0],[306162e-22,.5,0],[229621e-22,.375,0]],faces:[[0,1,2],[0,3,2],[3,2,4],[3,5,4],[5,4,6],[5,7,6],[7,6,8],[7,9,8],[9,8,10],[9,11,10],[11,10,12],[11,13,12],[13,12,14],[13,15,14],[15,14,16],[15,17,16]]},{name:"CircleHalfQuarter",vertices:[[0,0,0],[.353553,.353553,0],[.277785,.415735,0],[.191342,.46194,0],[.0975452,.490393,0],[306162e-22,.5,0]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5]]},{name:"CircleHalfQuarterOutline",vertices:[[.265165,.265165,0],[.353553,.353553,0],[.277785,.415735,0],[.208339,.311801,0],[.191342,.46194,0],[.143506,.346455,0],[.0975452,.490393,0],[.0731589,.367794,0],[306162e-22,.5,0],[229621e-22,.375,0]],faces:[[0,1,2],[0,3,2],[3,2,4],[3,5,4],[5,4,6],[5,7,6],[7,6,8],[7,9,8]]}],Zr=[{name:"Arrow",vertices:[[.114711,.0941153,0],[-.385289,.0941153,0],[-.385289,-.0941153,0],[.114711,-.0941153,0],[.0131641,.403351,0],[.495352,0,0],[-.0995,.272262,0],[-.0995,-.272262,0],[.0131641,-.403351,0]],faces:[[0,1,2],[2,3,0],[4,5,6],[6,5,0],[0,5,3],[3,5,7],[7,5,8]]},{name:"ArrowHead",vertices:[[.0131641,.403352,0],[.495352,24e-8,0],[-.0995,.272262,0],[.218477,24e-8,0],[-.0995,-.272262,0],[.0131641,-.403351,0]],faces:[[0,1,2],[2,1,3],[3,1,4],[4,1,5]]}],Gr=[{name:"HexagonFilled",vertices:[[0,0,0],[306162e-22,.5,0],[-.433013,.25,0],[-.433013,-.25,0],[-918485e-22,-.5,0],[.433013,-.25,0],[.433013,.25,0],[153081e-21,.5,0]],faces:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,6],[0,6,7]]},{name:"HexagonOutline",vertices:[[213889e-22,.349307,0],[306162e-22,.5,0],[-.433013,.25,0],[-.302509,.174654,0],[-.433013,-.25,0],[-.302509,-.174654,0],[-918485e-22,-.5,0],[-641667e-22,-.349307,0],[.433013,-.25,0],[.302509,-.174654,0],[.433013,.25,0],[.302509,.174654,0],[153081e-21,.5,0],[106944e-21,.349307,0]],faces:[[0,1,2],[0,3,2],[3,2,4],[3,5,4],[5,4,6],[5,7,6],[7,6,8],[7,9,8],[9,8,10],[9,11,10],[11,10,12],[11,13,12]]},{name:"HexagonOutlineThin",vertices:[[278607e-22,.455,0],[306162e-22,.5,0],[-.433013,.25,0],[-.394042,.2275,0],[-.433013,-.25,0],[-.394042,-.2275,0],[-918485e-22,-.5,0],[-835821e-22,-.455,0],[.433013,-.25,0],[.394042,-.2275,0],[.433013,.25,0],[.394042,.2275,0],[153081e-21,.5,0],[139304e-21,.455,0]],faces:[[0,1,2],[0,3,2],[3,2,4],[3,5,4],[5,4,6],[5,7,6],[7,6,8],[7,9,8],[9,8,10],[9,11,10],[11,10,12],[11,13,12]]},{name:"HexagonHalf",vertices:[[0,.5,0],[0,-.5,0],[.433013,.25,0],[.433013,-.25,0]],faces:[[0,1,2],[2,1,3]]},{name:"HexagonHalfOutline",vertices:[[0,.5,0],[0,.35,0],[.433013,.25,0],[.303109,.175,0],[.433013,-.25,0],[.303109,-.175,0],[0,-.5,0],[0,-.35,0]],faces:[[0,1,2],[2,1,3],[3,2,4],[4,3,5],[5,4,6],[6,5,7]]},{name:"HexagonHalfOutlineThin",vertices:[[0,.5,0],[0,.45,0],[.433013,.25,0],[.394042,.2275,0],[.433013,-.25,0],[.394042,-.2275,0],[0,-.5,0],[0,-.45,0]],faces:[[0,1,2],[2,1,3],[3,2,4],[4,3,5],[5,4,6],[6,5,7]]}];[...Wr.map(n=>n.name),...Yr.map(n=>n.name),...Xr.map(n=>n.name),...Zr.map(n=>n.name),...qr.map(n=>n.name),...Gr.map(n=>n.name)];const We=[Wr,Yr,Xr,Zr,qr,Gr];function T0(n,e){return We[n||0][e||0].name}function k0(n){let e=0,t=0;for(e=0;e<100&&We[e]!==void 0;e++)for(t=0;t<100&&We[e][t]!==void 0;t++)if(We[e][t].name===n)return{s:e,so:t};return{s:e,so:t}}class gn{static components=new Map;static init(){this.components=new Map,console.info("Component Registry initialized")}static register(e,t){this.components.has(e)&&(console.warn(`[ComponentRegistry] Component with name "${e}" was already registered, the previous entry will be overwritten!`),this.components.delete(e)),this.components.set(e,t),console.info(`[ComponentRegistry] Registered component "${e}" -> ${t.name}`)}static get(e){return this.components.get(e)}static create(e){const t=this.components.get(e.type);if(!t)throw new Error(`[ComponentRegistry] Component type "${e.type}" is not registered.`);return t.from(e)}}class ve{id;name;components;constructor(e){this.id=si(),this.name="New Object",this.components=[],e&&this.assign(e)}static from(e){return new ve(e)}serialize(){const e=[];return this.components.forEach(t=>{e.push(t.serialize())}),{id:this.id,name:this.name,components:e}}assign(e){return e.id&&(this.id=e.id),e.name&&(this.name=e.name),e.components&&e.components.forEach(t=>{this.components.push(gn.create(t))}),this}_setDirty(){this.components.forEach(e=>e._isDirty=!0)}addComponent(e){const t=gn.create({type:e});return this.components.push(t),t}deleteComponent(e){return this.components.forEach((t,s)=>{t.type()===e&&this.components.splice(s,1)}),this}getComponent(e){for(const t of this.components)if(t.type()===e)return t;throw new Error(`[Animatable] Animatable "${this.name}" [ ${this.id} ] does not possess the component "${e}"`)}}const Kr=(n,e)=>{if(typeof n=="number"){if(e===3)return{mode:"rgb",r:(n>>8&15|n>>4&240)/255,g:(n>>4&15|n&240)/255,b:(n&15|n<<4&240)/255};if(e===4)return{mode:"rgb",r:(n>>12&15|n>>8&240)/255,g:(n>>8&15|n>>4&240)/255,b:(n>>4&15|n&240)/255,alpha:(n&15|n<<4&240)/255};if(e===6)return{mode:"rgb",r:(n>>16&255)/255,g:(n>>8&255)/255,b:(n&255)/255};if(e===8)return{mode:"rgb",r:(n>>24&255)/255,g:(n>>16&255)/255,b:(n>>8&255)/255,alpha:(n&255)/255}}},z0={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},C0=n=>Kr(z0[n.toLowerCase()],6),S0=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,A0=n=>{let e;return(e=n.match(S0))?Kr(parseInt(e[1],16),e[1].length):void 0},Pe="([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)",Dt=`${Pe}%`,ii=`(?:${Pe}%|${Pe})`,E0=`(?:${Pe}(deg|grad|rad|turn)|${Pe})`,mt="\\s*,\\s*",R0=new RegExp(`^rgba?\\(\\s*${Pe}${mt}${Pe}${mt}${Pe}\\s*(?:,\\s*${ii}\\s*)?\\)$`),I0=new RegExp(`^rgba?\\(\\s*${Dt}${mt}${Dt}${mt}${Dt}\\s*(?:,\\s*${ii}\\s*)?\\)$`),F0=n=>{let e={mode:"rgb"},t;if(t=n.match(R0))t[1]!==void 0&&(e.r=t[1]/255),t[2]!==void 0&&(e.g=t[2]/255),t[3]!==void 0&&(e.b=t[3]/255);else if(t=n.match(I0))t[1]!==void 0&&(e.r=t[1]/100),t[2]!==void 0&&(e.g=t[2]/100),t[3]!==void 0&&(e.b=t[3]/100);else return;return t[4]!==void 0?e.alpha=Math.max(0,Math.min(1,t[4]/100)):t[5]!==void 0&&(e.alpha=Math.max(0,Math.min(1,+t[5]))),e},O0=(n,e)=>n===void 0?void 0:typeof n!="object"?na(n):n.mode!==void 0?n:e?{...n,mode:e}:void 0,be=(n="rgb")=>e=>(e=O0(e,n))!==void 0?e.mode===n?e:ye[e.mode][n]?ye[e.mode][n](e):n==="rgb"?ye[e.mode].rgb(e):ye.rgb[n](ye[e.mode].rgb(e)):void 0,ye={},Qr={},xn=[],Jr={},P0=n=>n,N=n=>(ye[n.mode]={...ye[n.mode],...n.toMode},Object.keys(n.fromMode||{}).forEach(e=>{ye[e]||(ye[e]={}),ye[e][n.mode]=n.fromMode[e]}),n.ranges||(n.ranges={}),n.difference||(n.difference={}),n.channels.forEach(e=>{if(n.ranges[e]===void 0&&(n.ranges[e]=[0,1]),!n.interpolate[e])throw new Error(`Missing interpolator for: ${e}`);typeof n.interpolate[e]=="function"&&(n.interpolate[e]={use:n.interpolate[e]}),n.interpolate[e].fixup||(n.interpolate[e].fixup=P0)}),Qr[n.mode]=n,(n.parse||[]).forEach(e=>{D0(e,n.mode)}),be(n.mode)),ea=n=>Qr[n],D0=(n,e)=>{if(typeof n=="string"){if(!e)throw new Error("'mode' required when 'parser' is a string");Jr[n]=e}else typeof n=="function"&&xn.indexOf(n)<0&&xn.push(n)},Us=/[^\x00-\x7F]|[a-zA-Z_]/,N0=/[^\x00-\x7F]|[-\w]/,_={Function:"function",Ident:"ident",Number:"number",Percentage:"percentage",ParenClose:")",None:"none",Hue:"hue",Alpha:"alpha"};let E=0;function en(n){let e=n[E],t=n[E+1];return e==="-"||e==="+"?/\d/.test(t)||t==="."&&/\d/.test(n[E+2]):e==="."?/\d/.test(t):/\d/.test(e)}function $s(n){if(E>=n.length)return!1;let e=n[E];if(Us.test(e))return!0;if(e==="-"){if(n.length-E<2)return!1;let t=n[E+1];return!!(t==="-"||Us.test(t))}return!1}const L0={deg:1,rad:180/Math.PI,grad:9/10,turn:360};function kt(n){let e="";if((n[E]==="-"||n[E]==="+")&&(e+=n[E++]),e+=tn(n),n[E]==="."&&/\d/.test(n[E+1])&&(e+=n[E++]+tn(n)),(n[E]==="e"||n[E]==="E")&&((n[E+1]==="-"||n[E+1]==="+")&&/\d/.test(n[E+2])?e+=n[E++]+n[E++]+tn(n):/\d/.test(n[E+1])&&(e+=n[E++]+tn(n))),$s(n)){let t=bn(n);return t==="deg"||t==="rad"||t==="turn"||t==="grad"?{type:_.Hue,value:e*L0[t]}:void 0}return n[E]==="%"?(E++,{type:_.Percentage,value:+e}):{type:_.Number,value:+e}}function tn(n){let e="";for(;/\d/.test(n[E]);)e+=n[E++];return e}function bn(n){let e="";for(;E<n.length&&N0.test(n[E]);)e+=n[E++];return e}function j0(n){let e=bn(n);return n[E]==="("?(E++,{type:_.Function,value:e}):e==="none"?{type:_.None,value:void 0}:{type:_.Ident,value:e}}function U0(n=""){let e=n.trim(),t=[],s;for(E=0;E<e.length;){if(s=e[E++],s===`
`||s==="	"||s===" "){for(;E<e.length&&(e[E]===`
`||e[E]==="	"||e[E]===" ");)E++;continue}if(s===",")return;if(s===")"){t.push({type:_.ParenClose});continue}if(s==="+"){if(E--,en(e)){t.push(kt(e));continue}return}if(s==="-"){if(E--,en(e)){t.push(kt(e));continue}if($s(e)){t.push({type:_.Ident,value:bn(e)});continue}return}if(s==="."){if(E--,en(e)){t.push(kt(e));continue}return}if(s==="/"){for(;E<e.length&&(e[E]===`
`||e[E]==="	"||e[E]===" ");)E++;let i;if(en(e)&&(i=kt(e),i.type!==_.Hue)){t.push({type:_.Alpha,value:i});continue}if($s(e)&&bn(e)==="none"){t.push({type:_.Alpha,value:{type:_.None,value:void 0}});continue}return}if(/\d/.test(s)){E--,t.push(kt(e));continue}if(Us.test(s)){E--,t.push(j0(e));continue}return}return t}function $0(n){n._i=0;let e=n[n._i++];if(!e||e.type!==_.Function||e.value!=="color"||(e=n[n._i++],e.type!==_.Ident))return;const t=Jr[e.value];if(!t)return;const s={mode:t},i=ta(n,!1);if(!i)return;const r=ea(t).channels;for(let a=0,o,h;a<r.length;a++)o=i[a],h=r[a],o.type!==_.None&&(s[h]=o.type===_.Number?o.value:o.value/100,h==="alpha"&&(s[h]=Math.max(0,Math.min(1,s[h]))));return s}function ta(n,e){const t=[];let s;for(;n._i<n.length;){if(s=n[n._i++],s.type===_.None||s.type===_.Number||s.type===_.Alpha||s.type===_.Percentage||e&&s.type===_.Hue){t.push(s);continue}if(s.type===_.ParenClose){if(n._i<n.length)return;continue}return}if(!(t.length<3||t.length>4)){if(t.length===4){if(t[3].type!==_.Alpha)return;t[3]=t[3].value}return t.length===3&&t.push({type:_.None,value:void 0}),t.every(i=>i.type!==_.Alpha)?t:void 0}}function B0(n,e){n._i=0;let t=n[n._i++];if(!t||t.type!==_.Function)return;let s=ta(n,e);if(s)return s.unshift(t.value),s}const na=n=>{if(typeof n!="string")return;const e=U0(n),t=e?B0(e,!0):void 0;let s,i=0,r=xn.length;for(;i<r;)if((s=xn[i++](n,t))!==void 0)return s;return e?$0(e):void 0};function H0(n,e){if(!e||e[0]!=="rgb"&&e[0]!=="rgba")return;const t={mode:"rgb"},[,s,i,r,a]=e;if(!(s.type===_.Hue||i.type===_.Hue||r.type===_.Hue))return s.type!==_.None&&(t.r=s.type===_.Number?s.value/255:s.value/100),i.type!==_.None&&(t.g=i.type===_.Number?i.value/255:i.value/100),r.type!==_.None&&(t.b=r.type===_.Number?r.value/255:r.value/100),a.type!==_.None&&(t.alpha=Math.min(1,Math.max(0,a.type===_.Number?a.value:a.value/100))),t}const V0=n=>n==="transparent"?{mode:"rgb",r:0,g:0,b:0,alpha:0}:void 0,W0=(n,e,t)=>n+t*(e-n),X0=n=>{let e=[];for(let t=0;t<n.length-1;t++){let s=n[t],i=n[t+1];s===void 0&&i===void 0?e.push(void 0):s!==void 0&&i!==void 0?e.push([s,i]):e.push(s!==void 0?[s,s]:[i,i])}return e},q0=n=>e=>{let t=X0(e);return s=>{let i=s*t.length,r=s>=1?t.length-1:Math.max(Math.floor(i),0),a=t[r];return a===void 0?void 0:n(a[0],a[1],i-r)}},k=q0(W0),Y=n=>{let e=!1,t=n.map(s=>s!==void 0?(e=!0,s):1);return e?t:n},yt={mode:"rgb",channels:["r","g","b","alpha"],parse:[H0,A0,F0,C0,V0,"srgb"],serialize:"srgb",interpolate:{r:k,g:k,b:k,alpha:{use:k,fixup:Y}},gamut:!0,white:{r:1,g:1,b:1},black:{r:0,g:0,b:0}},os=(n=0)=>Math.pow(Math.abs(n),563/256)*Math.sign(n),Wi=n=>{let e=os(n.r),t=os(n.g),s=os(n.b),i={mode:"xyz65",x:.5766690429101305*e+.1855582379065463*t+.1882286462349947*s,y:.297344975250536*e+.6273635662554661*t+.0752914584939979*s,z:.0270313613864123*e+.0706888525358272*t+.9913375368376386*s};return n.alpha!==void 0&&(i.alpha=n.alpha),i},hs=n=>Math.pow(Math.abs(n),256/563)*Math.sign(n),Xi=({x:n,y:e,z:t,alpha:s})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let i={mode:"a98",r:hs(n*2.0415879038107465-e*.5650069742788597-.3447313507783297*t),g:hs(n*-.9692436362808798+e*1.8759675015077206+.0415550574071756*t),b:hs(n*.0134442806320312-e*.1183623922310184+1.0151749943912058*t)};return s!==void 0&&(i.alpha=s),i},ls=(n=0)=>{const e=Math.abs(n);return e<=.04045?n/12.92:(Math.sign(n)||1)*Math.pow((e+.055)/1.055,2.4)},vt=({r:n,g:e,b:t,alpha:s})=>{let i={mode:"lrgb",r:ls(n),g:ls(e),b:ls(t)};return s!==void 0&&(i.alpha=s),i},Ye=n=>{let{r:e,g:t,b:s,alpha:i}=vt(n),r={mode:"xyz65",x:.4123907992659593*e+.357584339383878*t+.1804807884018343*s,y:.2126390058715102*e+.715168678767756*t+.0721923153607337*s,z:.0193308187155918*e+.119194779794626*t+.9505321522496607*s};return i!==void 0&&(r.alpha=i),r},cs=(n=0)=>{const e=Math.abs(n);return e>.0031308?(Math.sign(n)||1)*(1.055*Math.pow(e,1/2.4)-.055):n*12.92},_t=({r:n,g:e,b:t,alpha:s},i="rgb")=>{let r={mode:i,r:cs(n),g:cs(e),b:cs(t)};return s!==void 0&&(r.alpha=s),r},Ze=({x:n,y:e,z:t,alpha:s})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let i=_t({r:n*3.2409699419045226-e*1.537383177570094-.4986107602930034*t,g:n*-.9692436362808796+e*1.8759675015077204+.0415550574071756*t,b:n*.0556300796969936-e*.2039769588889765+1.0569715142428784*t});return s!==void 0&&(i.alpha=s),i},Y0={...yt,mode:"a98",parse:["a98-rgb"],serialize:"a98-rgb",fromMode:{rgb:n=>Xi(Ye(n)),xyz65:Xi},toMode:{rgb:n=>Ze(Wi(n)),xyz65:Wi}},J=n=>(n=n%360)<0?n+360:n,Z0=(n,e)=>n.map((t,s,i)=>{if(t===void 0)return t;let r=J(t);return s===0||n[s-1]===void 0?r:e(r-J(i[s-1]))}).reduce((t,s)=>!t.length||s===void 0||t[t.length-1]===void 0?(t.push(s),t):(t.push(s+t[t.length-1]),t),[]),ze=n=>Z0(n,e=>Math.abs(e)<=180?e:e-360*Math.sign(e)),G=[-.14861,1.78277,-.29227,-.90649,1.97294,0],G0=Math.PI/180,K0=180/Math.PI;let qi=G[3]*G[4],Yi=G[1]*G[4],Zi=G[1]*G[2]-G[0]*G[3];const Q0=({r:n,g:e,b:t,alpha:s})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let i=(Zi*t+n*qi-e*Yi)/(Zi+qi-Yi),r=t-i,a=(G[4]*(e-i)-G[2]*r)/G[3],o={mode:"cubehelix",l:i,s:i===0||i===1?void 0:Math.sqrt(r*r+a*a)/(G[4]*i*(1-i))};return o.s&&(o.h=Math.atan2(a,r)*K0-120),s!==void 0&&(o.alpha=s),o},J0=({h:n,s:e,l:t,alpha:s})=>{let i={mode:"rgb"};n=(n===void 0?0:n+120)*G0,t===void 0&&(t=0);let r=e===void 0?0:e*t*(1-t),a=Math.cos(n),o=Math.sin(n);return i.r=t+r*(G[0]*a+G[1]*o),i.g=t+r*(G[2]*a+G[3]*o),i.b=t+r*(G[4]*a+G[5]*o),s!==void 0&&(i.alpha=s),i},An=(n,e)=>{if(n.h===void 0||e.h===void 0||!n.s||!e.s)return 0;let t=J(n.h),s=J(e.h),i=Math.sin((s-t+360)/2*Math.PI/180);return 2*Math.sqrt(n.s*e.s)*i},eh=(n,e)=>{if(n.h===void 0||e.h===void 0)return 0;let t=J(n.h),s=J(e.h);return Math.abs(s-t)>180?t-(s-360*Math.sign(s-t)):s-t},En=(n,e)=>{if(n.h===void 0||e.h===void 0||!n.c||!e.c)return 0;let t=J(n.h),s=J(e.h),i=Math.sin((s-t+360)/2*Math.PI/180);return 2*Math.sqrt(n.c*e.c)*i},Ce=n=>{let e=n.reduce((s,i)=>{if(i!==void 0){let r=i*Math.PI/180;s.sin+=Math.sin(r),s.cos+=Math.cos(r)}return s},{sin:0,cos:0}),t=Math.atan2(e.sin,e.cos)*180/Math.PI;return t<0?360+t:t},th={mode:"cubehelix",channels:["h","s","l","alpha"],parse:["--cubehelix"],serialize:"--cubehelix",ranges:{h:[0,360],s:[0,4.614],l:[0,1]},fromMode:{rgb:Q0},toMode:{rgb:J0},interpolate:{h:{use:k,fixup:ze},s:k,l:k,alpha:{use:k,fixup:Y}},difference:{h:An},average:{h:Ce}},Ne=({l:n,a:e,b:t,alpha:s},i="lch")=>{e===void 0&&(e=0),t===void 0&&(t=0);let r=Math.sqrt(e*e+t*t),a={mode:i,l:n,c:r};return r&&(a.h=J(Math.atan2(t,e)*180/Math.PI)),s!==void 0&&(a.alpha=s),a},Le=({l:n,c:e,h:t,alpha:s},i="lab")=>{t===void 0&&(t=0);let r={mode:i,l:n,a:e?e*Math.cos(t/180*Math.PI):0,b:e?e*Math.sin(t/180*Math.PI):0};return s!==void 0&&(r.alpha=s),r},sa=Math.pow(29,3)/Math.pow(3,3),ia=Math.pow(6,3)/Math.pow(29,3),W={X:.3457/.3585,Y:1,Z:(1-.3457-.3585)/.3585},ct={X:.3127/.329,Y:1,Z:(1-.3127-.329)/.329};let us=n=>Math.pow(n,3)>ia?Math.pow(n,3):(116*n-16)/sa;const ra=({l:n,a:e,b:t,alpha:s})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let i=(n+16)/116,r=e/500+i,a=i-t/200,o={mode:"xyz65",x:us(r)*ct.X,y:us(i)*ct.Y,z:us(a)*ct.Z};return s!==void 0&&(o.alpha=s),o},Rn=n=>Ze(ra(n)),fs=n=>n>ia?Math.cbrt(n):(sa*n+16)/116,aa=({x:n,y:e,z:t,alpha:s})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let i=fs(n/ct.X),r=fs(e/ct.Y),a=fs(t/ct.Z),o={mode:"lab65",l:116*r-16,a:500*(i-r),b:200*(r-a)};return s!==void 0&&(o.alpha=s),o},In=n=>{let e=aa(Ye(n));return n.r===n.b&&n.b===n.g&&(e.a=e.b=0),e},yn=1,oa=1,Nt=26/180*Math.PI,vn=Math.cos(Nt),_n=Math.sin(Nt),ha=100/Math.log(139/100),Bs=({l:n,c:e,h:t,alpha:s})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let i={mode:"lab65",l:(Math.exp(n*yn/ha)-1)/.0039},r=(Math.exp(.0435*e*oa*yn)-1)/.075,a=r*Math.cos(t/180*Math.PI-Nt),o=r*Math.sin(t/180*Math.PI-Nt);return i.a=a*vn-o/.83*_n,i.b=a*_n+o/.83*vn,s!==void 0&&(i.alpha=s),i},Hs=({l:n,a:e,b:t,alpha:s})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let i=e*vn+t*_n,r=.83*(t*vn-e*_n),a=Math.sqrt(i*i+r*r),o={mode:"dlch",l:ha/yn*Math.log(1+.0039*n),c:Math.log(1+.075*a)/(.0435*oa*yn)};return o.c&&(o.h=J((Math.atan2(r,i)+Nt)/Math.PI*180)),s!==void 0&&(o.alpha=s),o},Gi=n=>Bs(Ne(n,"dlch")),Ki=n=>Le(Hs(n),"dlab"),nh={mode:"dlab",parse:["--din99o-lab"],serialize:"--din99o-lab",toMode:{lab65:Gi,rgb:n=>Rn(Gi(n))},fromMode:{lab65:Ki,rgb:n=>Ki(In(n))},channels:["l","a","b","alpha"],ranges:{l:[0,100],a:[-40.09,45.501],b:[-40.469,44.344]},interpolate:{l:k,a:k,b:k,alpha:{use:k,fixup:Y}}},sh={mode:"dlch",parse:["--din99o-lch"],serialize:"--din99o-lch",toMode:{lab65:Bs,dlab:n=>Le(n,"dlab"),rgb:n=>Rn(Bs(n))},fromMode:{lab65:Hs,dlab:n=>Ne(n,"dlch"),rgb:n=>Hs(In(n))},channels:["l","c","h","alpha"],ranges:{l:[0,100],c:[0,51.484],h:[0,360]},interpolate:{l:k,c:k,h:{use:k,fixup:ze},alpha:{use:k,fixup:Y}},difference:{h:En},average:{h:Ce}};function ih({h:n,s:e,i:t,alpha:s}){n=J(n!==void 0?n:0),e===void 0&&(e=0),t===void 0&&(t=0);let i=Math.abs(n/60%2-1),r;switch(Math.floor(n/60)){case 0:r={r:t*(1+e*(3/(2-i)-1)),g:t*(1+e*(3*(1-i)/(2-i)-1)),b:t*(1-e)};break;case 1:r={r:t*(1+e*(3*(1-i)/(2-i)-1)),g:t*(1+e*(3/(2-i)-1)),b:t*(1-e)};break;case 2:r={r:t*(1-e),g:t*(1+e*(3/(2-i)-1)),b:t*(1+e*(3*(1-i)/(2-i)-1))};break;case 3:r={r:t*(1-e),g:t*(1+e*(3*(1-i)/(2-i)-1)),b:t*(1+e*(3/(2-i)-1))};break;case 4:r={r:t*(1+e*(3*(1-i)/(2-i)-1)),g:t*(1-e),b:t*(1+e*(3/(2-i)-1))};break;case 5:r={r:t*(1+e*(3/(2-i)-1)),g:t*(1-e),b:t*(1+e*(3*(1-i)/(2-i)-1))};break;default:r={r:t*(1-e),g:t*(1-e),b:t*(1-e)}}return r.mode="rgb",s!==void 0&&(r.alpha=s),r}function rh({r:n,g:e,b:t,alpha:s}){n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let i=Math.max(n,e,t),r=Math.min(n,e,t),a={mode:"hsi",s:n+e+t===0?0:1-3*r/(n+e+t),i:(n+e+t)/3};return i-r!==0&&(a.h=(i===n?(e-t)/(i-r)+(e<t)*6:i===e?(t-n)/(i-r)+2:(n-e)/(i-r)+4)*60),s!==void 0&&(a.alpha=s),a}const ah={mode:"hsi",toMode:{rgb:ih},parse:["--hsi"],serialize:"--hsi",fromMode:{rgb:rh},channels:["h","s","i","alpha"],ranges:{h:[0,360]},gamut:"rgb",interpolate:{h:{use:k,fixup:ze},s:k,i:k,alpha:{use:k,fixup:Y}},difference:{h:An},average:{h:Ce}};function oh({h:n,s:e,l:t,alpha:s}){n=J(n!==void 0?n:0),e===void 0&&(e=0),t===void 0&&(t=0);let i=t+e*(t<.5?t:1-t),r=i-(i-t)*2*Math.abs(n/60%2-1),a;switch(Math.floor(n/60)){case 0:a={r:i,g:r,b:2*t-i};break;case 1:a={r,g:i,b:2*t-i};break;case 2:a={r:2*t-i,g:i,b:r};break;case 3:a={r:2*t-i,g:r,b:i};break;case 4:a={r,g:2*t-i,b:i};break;case 5:a={r:i,g:2*t-i,b:r};break;default:a={r:2*t-i,g:2*t-i,b:2*t-i}}return a.mode="rgb",s!==void 0&&(a.alpha=s),a}function hh({r:n,g:e,b:t,alpha:s}){n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let i=Math.max(n,e,t),r=Math.min(n,e,t),a={mode:"hsl",s:i===r?0:(i-r)/(1-Math.abs(i+r-1)),l:.5*(i+r)};return i-r!==0&&(a.h=(i===n?(e-t)/(i-r)+(e<t)*6:i===e?(t-n)/(i-r)+2:(n-e)/(i-r)+4)*60),s!==void 0&&(a.alpha=s),a}const lh=(n,e)=>{switch(e){case"deg":return+n;case"rad":return n/Math.PI*180;case"grad":return n/10*9;case"turn":return n*360}},ch=new RegExp(`^hsla?\\(\\s*${E0}${mt}${Dt}${mt}${Dt}\\s*(?:,\\s*${ii}\\s*)?\\)$`),uh=n=>{let e=n.match(ch);if(!e)return;let t={mode:"hsl"};return e[3]!==void 0?t.h=+e[3]:e[1]!==void 0&&e[2]!==void 0&&(t.h=lh(e[1],e[2])),e[4]!==void 0&&(t.s=Math.min(Math.max(0,e[4]/100),1)),e[5]!==void 0&&(t.l=Math.min(Math.max(0,e[5]/100),1)),e[6]!==void 0?t.alpha=Math.max(0,Math.min(1,e[6]/100)):e[7]!==void 0&&(t.alpha=Math.max(0,Math.min(1,+e[7]))),t};function fh(n,e){if(!e||e[0]!=="hsl"&&e[0]!=="hsla")return;const t={mode:"hsl"},[,s,i,r,a]=e;if(s.type!==_.None){if(s.type===_.Percentage)return;t.h=s.value}if(i.type!==_.None){if(i.type===_.Hue)return;t.s=i.value/100}if(r.type!==_.None){if(r.type===_.Hue)return;t.l=r.value/100}return a.type!==_.None&&(t.alpha=Math.min(1,Math.max(0,a.type===_.Number?a.value:a.value/100))),t}const la={mode:"hsl",toMode:{rgb:oh},fromMode:{rgb:hh},channels:["h","s","l","alpha"],ranges:{h:[0,360]},gamut:"rgb",parse:[fh,uh],serialize:n=>`hsl(${n.h!==void 0?n.h:"none"} ${n.s!==void 0?n.s*100+"%":"none"} ${n.l!==void 0?n.l*100+"%":"none"}${n.alpha<1?` / ${n.alpha}`:""})`,interpolate:{h:{use:k,fixup:ze},s:k,l:k,alpha:{use:k,fixup:Y}},difference:{h:An},average:{h:Ce}};function ca({h:n,s:e,v:t,alpha:s}){n=J(n!==void 0?n:0),e===void 0&&(e=0),t===void 0&&(t=0);let i=Math.abs(n/60%2-1),r;switch(Math.floor(n/60)){case 0:r={r:t,g:t*(1-e*i),b:t*(1-e)};break;case 1:r={r:t*(1-e*i),g:t,b:t*(1-e)};break;case 2:r={r:t*(1-e),g:t,b:t*(1-e*i)};break;case 3:r={r:t*(1-e),g:t*(1-e*i),b:t};break;case 4:r={r:t*(1-e*i),g:t*(1-e),b:t};break;case 5:r={r:t,g:t*(1-e),b:t*(1-e*i)};break;default:r={r:t*(1-e),g:t*(1-e),b:t*(1-e)}}return r.mode="rgb",s!==void 0&&(r.alpha=s),r}function ua({r:n,g:e,b:t,alpha:s}){n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let i=Math.max(n,e,t),r=Math.min(n,e,t),a={mode:"hsv",s:i===0?0:1-r/i,v:i};return i-r!==0&&(a.h=(i===n?(e-t)/(i-r)+(e<t)*6:i===e?(t-n)/(i-r)+2:(n-e)/(i-r)+4)*60),s!==void 0&&(a.alpha=s),a}const fa={mode:"hsv",toMode:{rgb:ca},parse:["--hsv"],serialize:"--hsv",fromMode:{rgb:ua},channels:["h","s","v","alpha"],ranges:{h:[0,360]},gamut:"rgb",interpolate:{h:{use:k,fixup:ze},s:k,v:k,alpha:{use:k,fixup:Y}},difference:{h:An},average:{h:Ce}};function dh({h:n,w:e,b:t,alpha:s}){if(e===void 0&&(e=0),t===void 0&&(t=0),e+t>1){let i=e+t;e/=i,t/=i}return ca({h:n,s:t===1?1:1-e/(1-t),v:1-t,alpha:s})}function mh(n){let e=ua(n);if(e===void 0)return;let t=e.s!==void 0?e.s:0,s=e.v!==void 0?e.v:0,i={mode:"hwb",w:(1-t)*s,b:1-s};return e.h!==void 0&&(i.h=e.h),e.alpha!==void 0&&(i.alpha=e.alpha),i}function ph(n,e){if(!e||e[0]!=="hwb")return;const t={mode:"hwb"},[,s,i,r,a]=e;if(s.type!==_.None){if(s.type===_.Percentage)return;t.h=s.value}if(i.type!==_.None){if(i.type===_.Hue)return;t.w=i.value/100}if(r.type!==_.None){if(r.type===_.Hue)return;t.b=r.value/100}return a.type!==_.None&&(t.alpha=Math.min(1,Math.max(0,a.type===_.Number?a.value:a.value/100))),t}const gh={mode:"hwb",toMode:{rgb:dh},fromMode:{rgb:mh},channels:["h","w","b","alpha"],ranges:{h:[0,360]},gamut:"rgb",parse:[ph],serialize:n=>`hwb(${n.h!==void 0?n.h:"none"} ${n.w!==void 0?n.w*100+"%":"none"} ${n.b!==void 0?n.b*100+"%":"none"}${n.alpha<1?` / ${n.alpha}`:""})`,interpolate:{h:{use:k,fixup:ze},w:k,b:k,alpha:{use:k,fixup:Y}},difference:{h:eh},average:{h:Ce}},da=203,Fn=.1593017578125,ma=78.84375,On=.8359375,Pn=18.8515625,Dn=18.6875;function ds(n){if(n<0)return 0;const e=Math.pow(n,1/ma);return 1e4*Math.pow(Math.max(0,e-On)/(Pn-Dn*e),1/Fn)}function ms(n){if(n<0)return 0;const e=Math.pow(n/1e4,Fn);return Math.pow((On+Pn*e)/(1+Dn*e),ma)}const ps=n=>Math.max(n/da,0),Qi=({i:n,t:e,p:t,alpha:s})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);const i=ds(n+.008609037037932761*e+.11102962500302593*t),r=ds(n-.00860903703793275*e-.11102962500302599*t),a=ds(n+.5600313357106791*e-.32062717498731885*t),o={mode:"xyz65",x:ps(2.070152218389422*i-1.3263473389671556*r+.2066510476294051*a),y:ps(.3647385209748074*i+.680566024947227*r-.0453045459220346*a),z:ps(-.049747207535812*i-.0492609666966138*r+1.1880659249923042*a)};return s!==void 0&&(o.alpha=s),o},gs=(n=0)=>Math.max(n*da,0),Ji=({x:n,y:e,z:t,alpha:s})=>{const i=gs(n),r=gs(e),a=gs(t),o=ms(.3592832590121217*i+.6976051147779502*r-.0358915932320289*a),h=ms(-.1920808463704995*i+1.1004767970374323*r+.0753748658519118*a),l=ms(.0070797844607477*i+.0748396662186366*r+.8433265453898765*a),c=.5*o+.5*h,f=1.61376953125*o-3.323486328125*h+1.709716796875*l,u=4.378173828125*o-4.24560546875*h-.132568359375*l,d={mode:"itp",i:c,t:f,p:u};return s!==void 0&&(d.alpha=s),d},xh={mode:"itp",channels:["i","t","p","alpha"],parse:["--ictcp"],serialize:"--ictcp",toMode:{xyz65:Qi,rgb:n=>Ze(Qi(n))},fromMode:{xyz65:Ji,rgb:n=>Ji(Ye(n))},ranges:{i:[0,.581],t:[-.369,.272],p:[-.164,.331]},interpolate:{i:k,t:k,p:k,alpha:{use:k,fixup:Y}}},bh=134.03437499999998,yh=16295499532821565e-27,xs=n=>{if(n<0)return 0;let e=Math.pow(n/1e4,Fn);return Math.pow((On+Pn*e)/(1+Dn*e),bh)},bs=(n=0)=>Math.max(n*203,0),pa=({x:n,y:e,z:t,alpha:s})=>{n=bs(n),e=bs(e),t=bs(t);let i=1.15*n-.15*t,r=.66*e+.34*n,a=xs(.41478972*i+.579999*r+.014648*t),o=xs(-.20151*i+1.120649*r+.0531008*t),h=xs(-.0166008*i+.2648*r+.6684799*t),l=(a+o)/2,c={mode:"jab",j:.44*l/(1-.56*l)-yh,a:3.524*a-4.066708*o+.542708*h,b:.199076*a+1.096799*o-1.295875*h};return s!==void 0&&(c.alpha=s),c},vh=134.03437499999998,er=16295499532821565e-27,ys=n=>{if(n<0)return 0;let e=Math.pow(n,1/vh);return 1e4*Math.pow((On-e)/(Dn*e-Pn),1/Fn)},vs=n=>n/203,ga=({j:n,a:e,b:t,alpha:s})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let i=(n+er)/(.44+.56*(n+er)),r=ys(i+.13860504*e+.058047316*t),a=ys(i-.13860504*e-.058047316*t),o=ys(i-.096019242*e-.8118919*t),h={mode:"xyz65",x:vs(1.661373024652174*r-.914523081304348*a+.23136208173913045*o),y:vs(-.3250758611844533*r+1.571847026732543*a-.21825383453227928*o),z:vs(-.090982811*r-.31272829*a+1.5227666*o)};return s!==void 0&&(h.alpha=s),h},xa=n=>{let e=pa(Ye(n));return n.r===n.b&&n.b===n.g&&(e.a=e.b=0),e},ba=n=>Ze(ga(n)),_h={mode:"jab",channels:["j","a","b","alpha"],parse:["--jzazbz"],serialize:"--jzazbz",fromMode:{rgb:xa,xyz65:pa},toMode:{rgb:ba,xyz65:ga},ranges:{j:[0,.222],a:[-.109,.129],b:[-.185,.134]},interpolate:{j:k,a:k,b:k,alpha:{use:k,fixup:Y}}},tr=({j:n,a:e,b:t,alpha:s})=>{e===void 0&&(e=0),t===void 0&&(t=0);let i=Math.sqrt(e*e+t*t),r={mode:"jch",j:n,c:i};return i&&(r.h=J(Math.atan2(t,e)*180/Math.PI)),s!==void 0&&(r.alpha=s),r},nr=({j:n,c:e,h:t,alpha:s})=>{t===void 0&&(t=0);let i={mode:"jab",j:n,a:e?e*Math.cos(t/180*Math.PI):0,b:e?e*Math.sin(t/180*Math.PI):0};return s!==void 0&&(i.alpha=s),i},Mh={mode:"jch",parse:["--jzczhz"],serialize:"--jzczhz",toMode:{jab:nr,rgb:n=>ba(nr(n))},fromMode:{rgb:n=>tr(xa(n)),jab:tr},channels:["j","c","h","alpha"],ranges:{j:[0,.221],c:[0,.19],h:[0,360]},interpolate:{h:{use:k,fixup:ze},c:k,j:k,alpha:{use:k,fixup:Y}},difference:{h:En},average:{h:Ce}},Nn=Math.pow(29,3)/Math.pow(3,3),ri=Math.pow(6,3)/Math.pow(29,3);let _s=n=>Math.pow(n,3)>ri?Math.pow(n,3):(116*n-16)/Nn;const ai=({l:n,a:e,b:t,alpha:s})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let i=(n+16)/116,r=e/500+i,a=i-t/200,o={mode:"xyz50",x:_s(r)*W.X,y:_s(i)*W.Y,z:_s(a)*W.Z};return s!==void 0&&(o.alpha=s),o},Wt=({x:n,y:e,z:t,alpha:s})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let i=_t({r:n*3.1341359569958707-e*1.6173863321612538-.4906619460083532*t,g:n*-.978795502912089+e*1.916254567259524+.03344273116131949*t,b:n*.07195537988411677-e*.2289768264158322+1.405386058324125*t});return s!==void 0&&(i.alpha=s),i},ya=n=>Wt(ai(n)),Xt=n=>{let{r:e,g:t,b:s,alpha:i}=vt(n),r={mode:"xyz50",x:.436065742824811*e+.3851514688337912*t+.14307845442264197*s,y:.22249319175623702*e+.7168870538238823*t+.06061979053616537*s,z:.013923904500943465*e+.09708128566574634*t+.7140993584005155*s};return i!==void 0&&(r.alpha=i),r},Ms=n=>n>ri?Math.cbrt(n):(Nn*n+16)/116,oi=({x:n,y:e,z:t,alpha:s})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let i=Ms(n/W.X),r=Ms(e/W.Y),a=Ms(t/W.Z),o={mode:"lab",l:116*r-16,a:500*(i-r),b:200*(r-a)};return s!==void 0&&(o.alpha=s),o},va=n=>{let e=oi(Xt(n));return n.r===n.b&&n.b===n.g&&(e.a=e.b=0),e};function wh(n,e){if(!e||e[0]!=="lab")return;const t={mode:"lab"},[,s,i,r,a]=e;if(!(s.type===_.Hue||i.type===_.Hue||r.type===_.Hue))return s.type!==_.None&&(t.l=Math.min(Math.max(0,s.value),100)),i.type!==_.None&&(t.a=i.type===_.Number?i.value:i.value*125/100),r.type!==_.None&&(t.b=r.type===_.Number?r.value:r.value*125/100),a.type!==_.None&&(t.alpha=Math.min(1,Math.max(0,a.type===_.Number?a.value:a.value/100))),t}const hi={mode:"lab",toMode:{xyz50:ai,rgb:ya},fromMode:{xyz50:oi,rgb:va},channels:["l","a","b","alpha"],ranges:{l:[0,100],a:[-125,125],b:[-125,125]},parse:[wh],serialize:n=>`lab(${n.l!==void 0?n.l:"none"} ${n.a!==void 0?n.a:"none"} ${n.b!==void 0?n.b:"none"}${n.alpha<1?` / ${n.alpha}`:""})`,interpolate:{l:k,a:k,b:k,alpha:{use:k,fixup:Y}}},Th={...hi,mode:"lab65",parse:["--lab-d65"],serialize:"--lab-d65",toMode:{xyz65:ra,rgb:Rn},fromMode:{xyz65:aa,rgb:In},ranges:{l:[0,100],a:[-125,125],b:[-125,125]}};function kh(n,e){if(!e||e[0]!=="lch")return;const t={mode:"lch"},[,s,i,r,a]=e;if(s.type!==_.None){if(s.type===_.Hue)return;t.l=Math.min(Math.max(0,s.value),100)}if(i.type!==_.None&&(t.c=Math.max(0,i.type===_.Number?i.value:i.value*150/100)),r.type!==_.None){if(r.type===_.Percentage)return;t.h=r.value}return a.type!==_.None&&(t.alpha=Math.min(1,Math.max(0,a.type===_.Number?a.value:a.value/100))),t}const li={mode:"lch",toMode:{lab:Le,rgb:n=>ya(Le(n))},fromMode:{rgb:n=>Ne(va(n)),lab:Ne},channels:["l","c","h","alpha"],ranges:{l:[0,100],c:[0,150],h:[0,360]},parse:[kh],serialize:n=>`lch(${n.l!==void 0?n.l:"none"} ${n.c!==void 0?n.c:"none"} ${n.h!==void 0?n.h:"none"}${n.alpha<1?` / ${n.alpha}`:""})`,interpolate:{h:{use:k,fixup:ze},c:k,l:k,alpha:{use:k,fixup:Y}},difference:{h:En},average:{h:Ce}},zh={...li,mode:"lch65",parse:["--lch-d65"],serialize:"--lch-d65",toMode:{lab65:n=>Le(n,"lab65"),rgb:n=>Rn(Le(n,"lab65"))},fromMode:{rgb:n=>Ne(In(n),"lch65"),lab65:n=>Ne(n,"lch65")},ranges:{l:[0,100],c:[0,150],h:[0,360]}},_a=({l:n,u:e,v:t,alpha:s})=>{e===void 0&&(e=0),t===void 0&&(t=0);let i=Math.sqrt(e*e+t*t),r={mode:"lchuv",l:n,c:i};return i&&(r.h=J(Math.atan2(t,e)*180/Math.PI)),s!==void 0&&(r.alpha=s),r},Ma=({l:n,c:e,h:t,alpha:s})=>{t===void 0&&(t=0);let i={mode:"luv",l:n,u:e?e*Math.cos(t/180*Math.PI):0,v:e?e*Math.sin(t/180*Math.PI):0};return s!==void 0&&(i.alpha=s),i},wa=(n,e,t)=>4*n/(n+15*e+3*t),Ta=(n,e,t)=>9*e/(n+15*e+3*t),Ch=wa(W.X,W.Y,W.Z),Sh=Ta(W.X,W.Y,W.Z),Ah=n=>n<=ri?Nn*n:116*Math.cbrt(n)-16,Vs=({x:n,y:e,z:t,alpha:s})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let i=Ah(e/W.Y),r=wa(n,e,t),a=Ta(n,e,t);!isFinite(r)||!isFinite(a)?i=r=a=0:(r=13*i*(r-Ch),a=13*i*(a-Sh));let o={mode:"luv",l:i,u:r,v:a};return s!==void 0&&(o.alpha=s),o},Eh=(n,e,t)=>4*n/(n+15*e+3*t),Rh=(n,e,t)=>9*e/(n+15*e+3*t),Ih=Eh(W.X,W.Y,W.Z),Fh=Rh(W.X,W.Y,W.Z),Ws=({l:n,u:e,v:t,alpha:s})=>{if(n===void 0&&(n=0),n===0)return{mode:"xyz50",x:0,y:0,z:0};e===void 0&&(e=0),t===void 0&&(t=0);let i=e/(13*n)+Ih,r=t/(13*n)+Fh,a=W.Y*(n<=8?n/Nn:Math.pow((n+16)/116,3)),o=a*(9*i)/(4*r),h=a*(12-3*i-20*r)/(4*r),l={mode:"xyz50",x:o,y:a,z:h};return s!==void 0&&(l.alpha=s),l},Oh=n=>_a(Vs(Xt(n))),Ph=n=>Wt(Ws(Ma(n))),Dh={mode:"lchuv",toMode:{luv:Ma,rgb:Ph},fromMode:{rgb:Oh,luv:_a},channels:["l","c","h","alpha"],parse:["--lchuv"],serialize:"--lchuv",ranges:{l:[0,100],c:[0,176.956],h:[0,360]},interpolate:{h:{use:k,fixup:ze},c:k,l:k,alpha:{use:k,fixup:Y}},difference:{h:En},average:{h:Ce}},Nh={...yt,mode:"lrgb",toMode:{rgb:_t},fromMode:{rgb:vt},parse:["srgb-linear"],serialize:"srgb-linear"},Lh={mode:"luv",toMode:{xyz50:Ws,rgb:n=>Wt(Ws(n))},fromMode:{xyz50:Vs,rgb:n=>Vs(Xt(n))},channels:["l","u","v","alpha"],parse:["--luv"],serialize:"--luv",ranges:{l:[0,100],u:[-84.936,175.042],v:[-125.882,87.243]},interpolate:{l:k,u:k,v:k,alpha:{use:k,fixup:Y}}},ka=({r:n,g:e,b:t,alpha:s})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let i=Math.cbrt(.412221469470763*n+.5363325372617348*e+.0514459932675022*t),r=Math.cbrt(.2119034958178252*n+.6806995506452344*e+.1073969535369406*t),a=Math.cbrt(.0883024591900564*n+.2817188391361215*e+.6299787016738222*t),o={mode:"oklab",l:.210454268309314*i+.7936177747023054*r-.0040720430116193*a,a:1.9779985324311684*i-2.42859224204858*r+.450593709617411*a,b:.0259040424655478*i+.7827717124575296*r-.8086757549230774*a};return s!==void 0&&(o.alpha=s),o},Ln=n=>{let e=ka(vt(n));return n.r===n.b&&n.b===n.g&&(e.a=e.b=0),e},qt=({l:n,a:e,b:t,alpha:s})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let i=Math.pow(n+.3963377773761749*e+.2158037573099136*t,3),r=Math.pow(n-.1055613458156586*e-.0638541728258133*t,3),a=Math.pow(n-.0894841775298119*e-1.2914855480194092*t,3),o={mode:"lrgb",r:4.076741636075957*i-3.3077115392580616*r+.2309699031821044*a,g:-1.2684379732850317*i+2.6097573492876887*r-.3413193760026573*a,b:-.0041960761386756*i-.7034186179359362*r+1.7076146940746117*a};return s!==void 0&&(o.alpha=s),o},jn=n=>_t(qt(n));function Xs(n){const s=1.170873786407767;return .5*(s*n-.206+Math.sqrt((s*n-.206)*(s*n-.206)+4*.03*s*n))}function Mn(n){return(n*n+.206*n)/(1.170873786407767*(n+.03))}function jh(n,e){let t,s,i,r,a,o,h,l;-1.88170328*n-.80936493*e>1?(t=1.19086277,s=1.76576728,i=.59662641,r=.75515197,a=.56771245,o=4.0767416621,h=-3.3077115913,l=.2309699292):1.81444104*n-1.19445276*e>1?(t=.73956515,s=-.45954404,i=.08285427,r=.1254107,a=.14503204,o=-1.2684380046,h=2.6097574011,l=-.3413193965):(t=1.35733652,s=-.00915799,i=-1.1513021,r=-.50559606,a=.00692167,o=-.0041960863,h=-.7034186147,l=1.707614701);let c=t+s*n+i*e+r*n*n+a*n*e,f=.3963377774*n+.2158037573*e,u=-.1055613458*n-.0638541728*e,d=-.0894841775*n-1.291485548*e;{let m=1+c*f,x=1+c*u,g=1+c*d,p=m*m*m,y=x*x*x,b=g*g*g,v=3*f*m*m,z=3*u*x*x,C=3*d*g*g,T=6*f*f*m,R=6*u*u*x,S=6*d*d*g,A=o*p+h*y+l*b,O=o*v+h*z+l*C,P=o*T+h*R+l*S;c=c-A*O/(O*O-.5*A*P)}return c}function ci(n,e){let t=jh(n,e),s=qt({l:1,a:t*n,b:t*e}),i=Math.cbrt(1/Math.max(s.r,s.g,s.b)),r=i*t;return[i,r]}function Uh(n,e,t,s,i,r=null){r||(r=ci(n,e));let a;if((t-i)*r[1]-(r[0]-i)*s<=0)a=r[1]*i/(s*r[0]+r[1]*(i-t));else{a=r[1]*(i-1)/(s*(r[0]-1)+r[1]*(i-t));{let o=t-i,h=s,l=.3963377774*n+.2158037573*e,c=-.1055613458*n-.0638541728*e,f=-.0894841775*n-1.291485548*e,u=o+h*l,d=o+h*c,m=o+h*f;{let x=i*(1-a)+a*t,g=a*s,p=x+g*l,y=x+g*c,b=x+g*f,v=p*p*p,z=y*y*y,C=b*b*b,T=3*u*p*p,R=3*d*y*y,S=3*m*b*b,A=6*u*u*p,O=6*d*d*y,P=6*m*m*b,$=4.0767416621*v-3.3077115913*z+.2309699292*C-1,V=4.0767416621*T-3.3077115913*R+.2309699292*S,ie=4.0767416621*A-3.3077115913*O+.2309699292*P,ue=V/(V*V-.5*$*ie),re=-$*ue,ae=-1.2684380046*v+2.6097574011*z-.3413193965*C-1,fe=-1.2684380046*T+2.6097574011*R-.3413193965*S,_e=-1.2684380046*A+2.6097574011*O-.3413193965*P,pe=fe/(fe*fe-.5*ae*_e),Ge=-ae*pe,Yt=-.0041960863*v-.7034186147*z+1.707614701*C-1,L=-.0041960863*T-.7034186147*R+1.707614701*S,ne=-.0041960863*A-.7034186147*O+1.707614701*P,ge=L/(L*L-.5*Yt*ne),Me=-Yt*ge;re=ue>=0?re:1e6,Ge=pe>=0?Ge:1e6,Me=ge>=0?Me:1e6,a+=Math.min(re,Math.min(Ge,Me))}}}return a}function ui(n,e,t=null){t||(t=ci(n,e));let s=t[0],i=t[1];return[i/s,i/(1-s)]}function za(n,e,t){let s=ci(e,t),i=Uh(e,t,n,1,n,s),r=ui(e,t,s),a=.11516993+1/(7.4477897+4.1590124*t+e*(-2.19557347+1.75198401*t+e*(-2.13704948-10.02301043*t+e*(-4.24894561+5.38770819*t+4.69891013*e)))),o=.11239642+1/(1.6132032-.68124379*t+e*(.40370612+.90148123*t+e*(-.27087943+.6122399*t+e*(.00299215-.45399568*t-.14661872*e)))),h=i/Math.min(n*r[0],(1-n)*r[1]),l=n*a,c=(1-n)*o,f=.9*h*Math.sqrt(Math.sqrt(1/(1/(l*l*l*l)+1/(c*c*c*c))));return l=n*.4,c=(1-n)*.8,[Math.sqrt(1/(1/(l*l)+1/(c*c))),f,i]}function sr(n){const e=n.l!==void 0?n.l:0,t=n.a!==void 0?n.a:0,s=n.b!==void 0?n.b:0,i={mode:"okhsl",l:Xs(e)};n.alpha!==void 0&&(i.alpha=n.alpha);let r=Math.sqrt(t*t+s*s);if(!r)return i.s=0,i;let[a,o,h]=za(e,t/r,s/r),l;if(r<o){let c=0,f=.8*a,u=1-f/o;l=(r-c)/(f+u*(r-c))*.8}else{let c=o,f=.2*o*o*1.25*1.25/a,u=1-f/(h-o);l=.8+.2*((r-c)/(f+u*(r-c)))}return l&&(i.s=l,i.h=J(Math.atan2(s,t)*180/Math.PI)),i}function ir(n){let e=n.h!==void 0?n.h:0,t=n.s!==void 0?n.s:0,s=n.l!==void 0?n.l:0;const i={mode:"oklab",l:Mn(s)};if(n.alpha!==void 0&&(i.alpha=n.alpha),!t||s===1)return i.a=i.b=0,i;let r=Math.cos(e/180*Math.PI),a=Math.sin(e/180*Math.PI),[o,h,l]=za(i.l,r,a),c,f,u,d;t<.8?(c=1.25*t,f=0,u=.8*o,d=1-u/h):(c=5*(t-.8),f=h,u=.2*h*h*1.25*1.25/o,d=1-u/(l-h));let m=f+c*u/(1-d*c);return i.a=m*r,i.b=m*a,i}const $h={...la,mode:"okhsl",channels:["h","s","l","alpha"],parse:["--okhsl"],serialize:"--okhsl",fromMode:{oklab:sr,rgb:n=>sr(Ln(n))},toMode:{oklab:ir,rgb:n=>jn(ir(n))}};function rr(n){let e=n.l!==void 0?n.l:0,t=n.a!==void 0?n.a:0,s=n.b!==void 0?n.b:0,i=Math.sqrt(t*t+s*s),r=i?t/i:1,a=i?s/i:1,[o,h]=ui(r,a),l=.5,c=1-l/o,f=h/(i+e*h),u=f*e,d=f*i,m=Mn(u),x=d*m/u,g=qt({l:m,a:r*x,b:a*x}),p=Math.cbrt(1/Math.max(g.r,g.g,g.b,0));e=e/p,i=i/p*Xs(e)/e,e=Xs(e);const y={mode:"okhsv",s:i?(l+h)*d/(h*l+h*c*d):0,v:e?e/u:0};return y.s&&(y.h=J(Math.atan2(s,t)*180/Math.PI)),n.alpha!==void 0&&(y.alpha=n.alpha),y}function ar(n){const e={mode:"oklab"};n.alpha!==void 0&&(e.alpha=n.alpha);const t=n.h!==void 0?n.h:0,s=n.s!==void 0?n.s:0,i=n.v!==void 0?n.v:0,r=Math.cos(t/180*Math.PI),a=Math.sin(t/180*Math.PI),[o,h]=ui(r,a),l=.5,c=1-l/o,f=1-s*l/(l+h-h*c*s),u=s*h*l/(l+h-h*c*s),d=Mn(f),m=u*d/f,x=qt({l:d,a:r*m,b:a*m}),g=Math.cbrt(1/Math.max(x.r,x.g,x.b,0)),p=Mn(i*f),y=u*p/f;return e.l=p*g,e.a=y*r*g,e.b=y*a*g,e}const Bh={...fa,mode:"okhsv",channels:["h","s","v","alpha"],parse:["--okhsv"],serialize:"--okhsv",fromMode:{oklab:rr,rgb:n=>rr(Ln(n))},toMode:{oklab:ar,rgb:n=>jn(ar(n))}};function Hh(n,e){if(!e||e[0]!=="oklab")return;const t={mode:"oklab"},[,s,i,r,a]=e;if(!(s.type===_.Hue||i.type===_.Hue||r.type===_.Hue))return s.type!==_.None&&(t.l=Math.min(Math.max(0,s.type===_.Number?s.value:s.value/100),1)),i.type!==_.None&&(t.a=i.type===_.Number?i.value:i.value*.4/100),r.type!==_.None&&(t.b=r.type===_.Number?r.value:r.value*.4/100),a.type!==_.None&&(t.alpha=Math.min(1,Math.max(0,a.type===_.Number?a.value:a.value/100))),t}const Vh={...hi,mode:"oklab",toMode:{lrgb:qt,rgb:jn},fromMode:{lrgb:ka,rgb:Ln},ranges:{l:[0,1],a:[-.4,.4],b:[-.4,.4]},parse:[Hh],serialize:n=>`oklab(${n.l!==void 0?n.l:"none"} ${n.a!==void 0?n.a:"none"} ${n.b!==void 0?n.b:"none"}${n.alpha<1?` / ${n.alpha}`:""})`};function Wh(n,e){if(!e||e[0]!=="oklch")return;const t={mode:"oklch"},[,s,i,r,a]=e;if(s.type!==_.None){if(s.type===_.Hue)return;t.l=Math.min(Math.max(0,s.type===_.Number?s.value:s.value/100),1)}if(i.type!==_.None&&(t.c=Math.max(0,i.type===_.Number?i.value:i.value*.4/100)),r.type!==_.None){if(r.type===_.Percentage)return;t.h=r.value}return a.type!==_.None&&(t.alpha=Math.min(1,Math.max(0,a.type===_.Number?a.value:a.value/100))),t}const Xh={...li,mode:"oklch",toMode:{oklab:n=>Le(n,"oklab"),rgb:n=>jn(Le(n,"oklab"))},fromMode:{rgb:n=>Ne(Ln(n),"oklch"),oklab:n=>Ne(n,"oklch")},parse:[Wh],serialize:n=>`oklch(${n.l!==void 0?n.l:"none"} ${n.c!==void 0?n.c:"none"} ${n.h!==void 0?n.h:"none"}${n.alpha<1?` / ${n.alpha}`:""})`,ranges:{l:[0,1],c:[0,.4],h:[0,360]}},or=n=>{let{r:e,g:t,b:s,alpha:i}=vt(n),r={mode:"xyz65",x:.486570948648216*e+.265667693169093*t+.1982172852343625*s,y:.2289745640697487*e+.6917385218365062*t+.079286914093745*s,z:0*e+.0451133818589026*t+1.043944368900976*s};return i!==void 0&&(r.alpha=i),r},hr=({x:n,y:e,z:t,alpha:s})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let i=_t({r:n*2.4934969119414263-e*.9313836179191242-.402710784450717*t,g:n*-.8294889695615749+e*1.7626640603183465+.0236246858419436*t,b:n*.0358458302437845-e*.0761723892680418+.9568845240076871*t},"p3");return s!==void 0&&(i.alpha=s),i},qh={...yt,mode:"p3",parse:["display-p3"],serialize:"display-p3",fromMode:{rgb:n=>hr(Ye(n)),xyz65:hr},toMode:{rgb:n=>Ze(or(n)),xyz65:or}},ws=n=>{let e=Math.abs(n);return e>=1/512?Math.sign(n)*Math.pow(e,1/1.8):16*n},lr=({x:n,y:e,z:t,alpha:s})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let i={mode:"prophoto",r:ws(n*1.3457868816471585-e*.2555720873797946-.0511018649755453*t),g:ws(n*-.5446307051249019+e*1.5082477428451466+.0205274474364214*t),b:ws(n*0+e*0+1.2119675456389452*t)};return s!==void 0&&(i.alpha=s),i},Ts=(n=0)=>{let e=Math.abs(n);return e>=16/512?Math.sign(n)*Math.pow(e,1.8):n/16},cr=n=>{let e=Ts(n.r),t=Ts(n.g),s=Ts(n.b),i={mode:"xyz50",x:.7977666449006423*e+.1351812974005331*t+.0313477341283922*s,y:.2880748288194013*e+.7118352342418731*t+899369387256e-16*s,z:0*e+0*t+.8251046025104602*s};return n.alpha!==void 0&&(i.alpha=n.alpha),i},Yh={...yt,mode:"prophoto",parse:["prophoto-rgb"],serialize:"prophoto-rgb",fromMode:{xyz50:lr,rgb:n=>lr(Xt(n))},toMode:{xyz50:cr,rgb:n=>Wt(cr(n))}},ur=1.09929682680944,Zh=.018053968510807,ks=n=>{const e=Math.abs(n);return e>Zh?(Math.sign(n)||1)*(ur*Math.pow(e,.45)-(ur-1)):4.5*n},fr=({x:n,y:e,z:t,alpha:s})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);let i={mode:"rec2020",r:ks(n*1.7166511879712683-e*.3556707837763925-.2533662813736599*t),g:ks(n*-.6666843518324893+e*1.6164812366349395+.0157685458139111*t),b:ks(n*.0176398574453108-e*.0427706132578085+.9421031212354739*t)};return s!==void 0&&(i.alpha=s),i},dr=1.09929682680944,Gh=.018053968510807,zs=(n=0)=>{let e=Math.abs(n);return e<Gh*4.5?n/4.5:(Math.sign(n)||1)*Math.pow((e+dr-1)/dr,1/.45)},mr=n=>{let e=zs(n.r),t=zs(n.g),s=zs(n.b),i={mode:"xyz65",x:.6369580483012911*e+.1446169035862083*t+.1688809751641721*s,y:.262700212011267*e+.6779980715188708*t+.059301716469862*s,z:0*e+.0280726930490874*t+1.0609850577107909*s};return n.alpha!==void 0&&(i.alpha=n.alpha),i},Kh={...yt,mode:"rec2020",fromMode:{xyz65:fr,rgb:n=>fr(Ye(n))},toMode:{xyz65:mr,rgb:n=>Ze(mr(n))},parse:["rec2020"],serialize:"rec2020"},Xe=.0037930732552754493,Ca=Math.cbrt(Xe),Cs=n=>Math.cbrt(n)-Ca,Qh=n=>{const{r:e,g:t,b:s,alpha:i}=vt(n),r=Cs(.3*e+.622*t+.078*s+Xe),a=Cs(.23*e+.692*t+.078*s+Xe),o=Cs(.2434226892454782*e+.2047674442449682*t+.5518098665095535*s+Xe),h={mode:"xyb",x:(r-a)/2,y:(r+a)/2,b:o-(r+a)/2};return i!==void 0&&(h.alpha=i),h},Ss=n=>Math.pow(n+Ca,3),Jh=({x:n,y:e,b:t,alpha:s})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);const i=Ss(n+e)-Xe,r=Ss(e-n)-Xe,a=Ss(t+e)-Xe,o=_t({r:11.031566904639861*i-9.866943908131562*r-.16462299650829934*a,g:-3.2541473810744237*i+4.418770377582723*r-.16462299650829934*a,b:-3.6588512867136815*i+2.7129230459360922*r+1.9459282407775895*a});return s!==void 0&&(o.alpha=s),o},el={mode:"xyb",channels:["x","y","b","alpha"],parse:["--xyb"],serialize:"--xyb",toMode:{rgb:Jh},fromMode:{rgb:Qh},ranges:{x:[-.0154,.0281],y:[0,.8453],b:[-.2778,.388]},interpolate:{x:k,y:k,b:k,alpha:{use:k,fixup:Y}}},tl={mode:"xyz50",parse:["xyz-d50"],serialize:"xyz-d50",toMode:{rgb:Wt,lab:oi},fromMode:{rgb:Xt,lab:ai},channels:["x","y","z","alpha"],ranges:{x:[0,.964],y:[0,.999],z:[0,.825]},interpolate:{x:k,y:k,z:k,alpha:{use:k,fixup:Y}}},nl=n=>{let{x:e,y:t,z:s,alpha:i}=n;e===void 0&&(e=0),t===void 0&&(t=0),s===void 0&&(s=0);let r={mode:"xyz50",x:1.0479298208405488*e+.0229467933410191*t-.0501922295431356*s,y:.0296278156881593*e+.990434484573249*t-.0170738250293851*s,z:-.0092430581525912*e+.0150551448965779*t+.7518742899580008*s};return i!==void 0&&(r.alpha=i),r},sl=n=>{let{x:e,y:t,z:s,alpha:i}=n;e===void 0&&(e=0),t===void 0&&(t=0),s===void 0&&(s=0);let r={mode:"xyz65",x:.9554734527042182*e-.0230985368742614*t+.0632593086610217*s,y:-.0283697069632081*e+1.0099954580058226*t+.021041398966943*s,z:.0123140016883199*e-.0205076964334779*t+1.3303659366080753*s};return i!==void 0&&(r.alpha=i),r},il={mode:"xyz65",toMode:{rgb:Ze,xyz50:nl},fromMode:{rgb:Ye,xyz50:sl},ranges:{x:[0,.95],y:[0,1],z:[0,1.088]},channels:["x","y","z","alpha"],parse:["xyz","xyz-d65"],serialize:"xyz-d65",interpolate:{x:k,y:k,z:k,alpha:{use:k,fixup:Y}}},rl=({r:n,g:e,b:t,alpha:s})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);const i={mode:"yiq",y:.29889531*n+.58662247*e+.11448223*t,i:.59597799*n-.2741761*e-.32180189*t,q:.21147017*n-.52261711*e+.31114694*t};return s!==void 0&&(i.alpha=s),i},al=({y:n,i:e,q:t,alpha:s})=>{n===void 0&&(n=0),e===void 0&&(e=0),t===void 0&&(t=0);const i={mode:"rgb",r:n+.95608445*e+.6208885*t,g:n-.27137664*e-.6486059*t,b:n-1.10561724*e+1.70250126*t};return s!==void 0&&(i.alpha=s),i},ol={mode:"yiq",toMode:{rgb:al},fromMode:{rgb:rl},channels:["y","i","q","alpha"],parse:["--yiq"],serialize:"--yiq",ranges:{i:[-.595,.595],q:[-.522,.522]},interpolate:{y:k,i:k,q:k,alpha:{use:k,fixup:Y}}},hl=(n,e)=>Math.round(n*(e=Math.pow(10,e)))/e,ll=(n=4)=>e=>typeof e=="number"?hl(e,n):e;let cl=ll(2);const Sa=n=>Math.max(0,Math.min(1,n||0)),ut=n=>Math.round(Sa(n)*255),Aa=be("rgb"),ul=n=>{if(n===void 0)return;let e=ut(n.r),t=ut(n.g),s=ut(n.b);return"#"+(1<<24|e<<16|t<<8|s).toString(16).slice(1)},fl=n=>{if(n===void 0)return;let e=ut(n.r),t=ut(n.g),s=ut(n.b);return n.alpha===void 0||n.alpha===1?`rgb(${e}, ${t}, ${s})`:`rgba(${e}, ${t}, ${s}, ${cl(Sa(n.alpha))})`},dl=n=>ul(Aa(n)),zt=n=>fl(Aa(n)),ml=n=>n!==void 0&&(n.r===void 0||n.r>=0&&n.r<=1)&&(n.g===void 0||n.g>=0&&n.g<=1)&&(n.b===void 0||n.b>=0&&n.b<=1);function nn(n="rgb"){const{gamut:e}=ea(n);if(!e)return s=>!0;const t=be(typeof e=="string"?e:n);return s=>ml(t(s))}N(Y0);N(th);N(nh);N(sh);N(ah);N(la);N(fa);N(gh);N(xh);N(_h);N(Mh);N(hi);N(Th);N(li);N(zh);N(Dh);N(Nh);N(Lh);N($h);N(Bh);N(Vh);const Ct=N(Xh);N(qh);N(Yh);N(Kh);N(yt);N(el);N(tl);N(il);N(ol);const pl={r:299,g:587,b:114},gl=200;class D{static hslFix(e){let t=e.h||0;t>180?t=t-180:t=t+180;let s=e.s;return s=Math.abs(s),{h:t,s,l:e.l}}static averageLuminance(e){const{r:t,g:s,b:i}=e,{r,g:a,b:o}=pl;return(t*r+s*a+i*o)/1e3}static averageOrangeness(e){const{h:t}=this.rgbaToHsl(e),s=((t||0)-gl+180)%360-180,i=s<-180?s+360:s;return 1-Math.abs(i)/90}static findMaxChroma(e,t){if(t===void 0||e<=0||e>=100)return 0;const s=nn("rgb");let i=0,r=.4;const a=.001;for(;r-i>a;){const o=(i+r)/2;s({mode:"oklch",l:e/100,h:t,c:o})?i=o:r=o}return i*100}static findMinLightness(e,t){if(e<=0||t===void 0)return 0;const s=nn("rgb");let i=0,r=1;const a=.001;for(;r-i>a;){const o=(i+r)/2;s({mode:"oklch",l:o,c:e/100,h:t})?r=o:i=o}return r*100}static findMaxLightness(e,t){if(e<=0||t===void 0)return 100;const s=nn("rgb");let i=0,r=1;const a=.001;for(;r-i>a;){const o=(i+r)/2;s({mode:"oklch",l:o,c:e/100,h:t})?i=o:r=o}return i*100}static rgbGradientStops(){return{r:[{color:"rgba(0,0,0,1)",pos:0},{color:"rgba(255,0,0,1)",pos:100}],g:[{color:"rgba(0,0,0,1)",pos:0},{color:"rgba(0,255,0,1)",pos:100}],b:[{color:"rgba(0,0,0,1)",pos:0},{color:"rgba(0,0,255,1)",pos:100}]}}static hslGradientStops(e,t=20){return{h:[...Array(t).keys()].map(s=>({color:`rgba(${Object.values(this.hslToRgba({h:s*(360/10),s:e.s,l:e.l})).join(",")})`,pos:s*10})),s:[{color:`rgba(${Object.values(this.hslToRgba({h:e.h,s:0,l:e.l})).join(",")})`,pos:0},{color:`rgba(${Object.values(this.hslToRgba({h:e.h,s:1,l:e.l})).join(",")})`,pos:100}],l:[{color:`rgba(${Object.values(this.hslToRgba({h:e.h,s:e.s,l:0})).join(",")})`,pos:0},{color:`rgba(${Object.values(this.hslToRgba({h:e.h,s:e.s,l:255})).join(",")})`,pos:100}]}}static oklchGradientStops(e,t=!1,s=50){const i=e.h??0,r=e.l,a=e.c,o={l:[],c:[],h:[]},h=nn("rgb"),l=be("rgb"),c=u=>{if(!t){const p=[];for(let y=0;y<s;y++){const b=y/(s-1),v=u(b),z=l({mode:"oklch",...v});p.push({color:zt(z),pos:b*100})}return p}const d=Array.from({length:s},(p,y)=>{const b=y/(s-1),v=u(b);return{oklch:v,inGamut:h(Ct({mode:"oklch",...v})),pos:b*100}}),m=[],x=d[0];m.push({color:x.inGamut?zt(Ct({mode:"oklch",...x.oklch})):"rgba(0,0,0,1)",pos:x.pos});for(let p=1;p<d.length;p++){const y=d[p],b=d[p-1];if(y.inGamut!==b.inGamut){const v=(y.pos+b.pos)/2;y.inGamut?(m.push({color:"rgba(0,0,0,1)",pos:v}),m.push({color:zt(Ct({mode:"oklch",...y.oklch})),pos:v})):(m.push({color:zt(Ct({mode:"oklch",...b.oklch})),pos:v}),m.push({color:"rgba(0,0,0,1)",pos:v}))}else y.inGamut&&m.push({color:zt(Ct({mode:"oklch",...y.oklch})),pos:y.pos})}const g=d[s-1];return g.inGamut||m.push({color:"rgba(0,0,0,1)",pos:g.pos}),m};o.l=c(u=>({l:u,c:a/100,h:i}));const f=.4;return o.c=c(u=>({l:r/100,c:u*f,h:i})),o.h=c(u=>({l:r/100,c:a/100,h:u*360})),o}static rgbaToRaw(e){return[e.r/255,e.g/255,e.b/255,e.a??1]}static rawToRgba(e){return{r:e[0]*255,g:e[1]*255,b:e[2]*255,a:e[3]}}static hexToRaw(e){return this.rgbaToRaw(this.hexToRgba(e)??{r:0,g:0,b:0})}static hexToRgba(e){const t=na(e);if(!t)return;const s=be("rgb"),{r:i,g:r,b:a}=s(t);return{r:i*255,g:r*255,b:a*255}}static rgbaToHex(e){const{r:t,g:s,b:i}=e;return dl({mode:"rgb",r:t/255,g:s/255,b:i/255})}static oklchToRgba(e){const t=be("rgb"),{r:s,g:i,b:r}=t({mode:"oklch",...e});return{r:s,g:i,b:r}}static rgbaToOklch(e){const t=be("oklch"),{l:s,c:i,h:r}=t({mode:"rgb",...e});return{l:s,c:i,h:r}}static hslToRgba(e){const t=be("rgb"),{r:s,g:i,b:r}=t({mode:"hsl",...e});return{r:s,g:i,b:r}}static rgbaToHsl(e){const t=be("hsl"),{h:s,s:i,l:r}=this.hslFix(t({mode:"rgb",...e}));return{h:s,s:i,l:r}}static hslToOklch(e){const t=be("oklch"),{l:s,c:i,h:r}=t({mode:"hsl",...e});return{l:s,c:i,h:r}}static oklchToHsl(e){const t=be("hsl"),{h:s,s:i,l:r}=this.hslFix(t({mode:"oklch",...e}));return{h:s,s:i,l:r}}}class ft{id;displayName;events;themes;_objects;_idToIndex;_freeIndices;constructor(e){this.id=si(),this.displayName="My Cool 3D",this.events=new ve,this.themes=new Map,this._objects=[],this._idToIndex=new Map,this._freeIndices=[],e&&this.assign(e)}get rawObjects(){return this._objects}static from(e){return new ft(e)}assign(e){if(e.metadata&&(e.metadata.id&&(this.id=e.metadata.id),e.metadata.displayName&&(this.displayName=e.metadata.displayName),e.events&&(this.events=ve.from(e.events)),e.themes)){this.themes.clear();for(const t of e.themes)this.themes.set(t.id,t)}if(e.objects)for(const t of e.objects){const s=ve.from(t);this.addObject(s)}return this}serialize(){const e=new Array(this._idToIndex.size);let t=0;const s=this._objects.length;for(let a=0;a<s;a++){const o=this._objects[a];o!==null&&(e[t++]=o.serialize())}const i=new Array(this.themes.size);let r=0;for(const a of this.themes.values())i[r++]=a;return{objects:e,events:this.events.serialize(),themes:i,metadata:{id:this.id,displayName:this.displayName}}}addObject(e){if(this._idToIndex.has(e.id))return console.warn(`[Level] Object ID [${e.id}] already exists. Skipping.`),this._idToIndex.get(e.id);let t;return this._freeIndices.length>0?(t=this._freeIndices.pop(),this._objects[t]=e):(t=this._objects.length,this._objects.push(e)),this._idToIndex.set(e.id,t),t}getObject(e){const t=this._idToIndex.get(e);if(t!==void 0)return this._objects[t]}deleteObject(e,t=!1){const s=this._idToIndex.get(e);return s===void 0?!1:(this._objects[s]=null,this._freeIndices.push(s),this._idToIndex.delete(e),t&&this.rawObjects.forEach(i=>{i&&i.components.forEach(r=>{r.parentId===e&&(r._isDirty=!0)})}),!0)}}class sn{static stats;static resetStats(){this.stats={conversionTime:0,themes:0,objects:0,prefabs:0,prefabInstances:0,keyframes:{}}}static levelFromVgd(e){this.resetStats();const t=performance.now(),s=new ft;if(s.events=this.eventsFromVgd(e.events),e.objects&&e.objects.forEach(r=>{s.addObject(this.animatableFromVgd(r)),this.stats.objects++}),(e.prefabObjects||e.prefab_objects)&&e.prefabs&&e.prefabs.length>0){const r=e.prefabObjects??e.prefab_objects;r&&r.length>0&&r.forEach(a=>{const o=e.prefabs.filter(h=>h.id===a.pid)[0];o&&(this.prefabInstanceFromVgd(a,o).forEach(h=>{s.addObject(h),this.stats.objects++}),this.stats.prefabInstances++)})}e.prefabs&&(this.stats.prefabs=e.prefabs.length),e.themes&&e.themes.forEach(r=>{s.themes.set(r.id,this.themeFromVgd(r))});const i=performance.now();return this.stats.conversionTime=i-t,s}static prefabInstanceFromVgd(e,t){const s=[],i={},r=new ve;r.id=e.id,r.name="Prefab Root";const a=r.addComponent("Animation2D");if(a.spawnTime=e.t,e.e){const o=e.e[0]?.ev??[0,0],h=e.e[1]?.ev??[1,1],l=e.e[2]?.ev??[0,0];a.addKeyframe("Move",{data:[o[0]??0,o[1]??0]}),a.addKeyframe("Scale",{data:[h[0]??0,h[1]??0]}),a.addKeyframe("Rotation",{data:[l[0]??0,l[1]??0]})}return s.push(r),t.objs.forEach(o=>{i[o.id.toString()]=si()}),t.objs.forEach(o=>{const h=structuredClone(o),l=o.id.toString();h.id=i[l],!h.p_id||!i[h.p_id]?(h.p_id=r.id,h.p_t="111"):h.p_id=i[h.p_id],s.push(this.animatableFromVgd(h,e.t))}),s}static animatableFromVgd(e,t=0){const s=new ve;s.addComponent("Animation2D");const i=s.getComponent("Animation2D"),r=(e.st??0)+t;i.zOffset=0-(e.d??20),i.spawnTime=r,i.setParenting("Move",!0).setParenting("Scale",!1).setParenting("Rotation",!0);const a=this.keyframeTrackFromVgd(e.e[0].k,"Move",r),o=this.keyframeTrackFromVgd(e.e[1].k,"Scale",r),h=this.keyframeTrackFromVgd(e.e[2].k,"Rotation",r),l=this.keyframeTrackFromVgd(e.e[3].k,"Color",r);if(i.createTrack("Move",a),i.createTrack("Scale",o),i.createTrack("Rotation",h),i.createTrack("Color",l),e.ak_t)switch(e.ak_t){case Et.LastKeyframe:{let c=0;[a,o,h,l].forEach(f=>{f.forEach(u=>{u.time>c&&(c=u.time)})}),i.lifetime=c-i.spawnTime;break}case Et.LastKeyframeOffset:{let c=0;[a,o,h,l].forEach(f=>{f.forEach(u=>{u.time>c&&(c=u.time)})}),i.lifetime=c-i.spawnTime+(e.ak_o||0);break}case Et.FixedTime:{i.lifetime=e.ak_o||0;break}case Et.SongTime:{i.lifetime=(e.ak_o||0)-i.spawnTime;break}}if(e.id&&(s.id=e.id),e.n&&(s.name=e.n),e.o&&(i.origin={x:e.o.x,y:e.o.y}),e.p_id&&(i.parentId=e.p_id),e.p_t){const c=e.p_t.split("");i.setParenting("Move",c[0]=="1"),i.setParenting("Scale",c[1]=="1"),i.setParenting("Rotation",c[2]=="1")}if(e.p_o&&(i.setParentOffset("Move",e.p_o[0]),i.setParentOffset("Scale",e.p_o[1]),i.setParentOffset("Rotation",e.p_o[2])),e.s&&e.s>5&&(e.s=0),e.so&&e.so>[2,8,5,1,0,5][e.s??0]&&(e.so=0),e.ot!=6&&e.ot!=3){const c=T0(e.s,e.so);i.mesh=c}else i.mesh=void 0;return s}static keyframeTrackFromVgd(e,t,s=0){const i=[];if(t=="Rotation"){let r=0;e.forEach(a=>{a.ev[1]==1&&(r=0),r+=a.ev[0],a.ev[0]=r,i.push(this.keyframeFromVgd(a,t,s))})}else e.forEach(r=>{i.push(this.keyframeFromVgd(r,t,s))});return i}static keyframeFromVgd(e,t,s=0){const i={time:0,data:[]};if(i.time=(e.t??0)+s,e.ct&&(i.easing=e.ct),e.r&&(i.randomize=e.r>1?e.r-1:e.r,console.log(e.r,i.randomize)),e.ev)switch(t){case"Color":{i.data=[e.ev[0],(e.ev[1]==null?100:e.ev[1])/100];break}case"Rotation":{i.data=[e.ev[0]];break}default:i.data=e.ev}if(e.er){switch(t){case"Color":{i.random=[e.er[0],e.er[1]??0];break}case"Rotation":{i.random=[e.er[0]];break}default:i.random=e.er}i.randomizeInterval=e.er[2]}return this.stats.keyframes[t]?this.stats.keyframes[t]++:this.stats.keyframes[t]=1,i}static themeFromVgd(e){const t={id:e.id,name:e.name,objects:e.obj.map(s=>D.hexToRgba(s)||{r:0,g:0,b:0}),effects:e.fx.map(s=>D.hexToRgba(s)||{r:0,g:0,b:0}),parallax:e.bg.map(s=>D.hexToRgba(s)||{r:0,g:0,b:0}),background:D.hexToRgba(e.base_bg),gui:D.hexToRgba(e.base_gui),guiAccent:D.hexToRgba(e.base_gui_accent)};return this.stats.themes++,t}static eventsFromVgd(e){const t=new ve,s=t.addComponent("Animation3D").addKeyframe("AmbientLight",{data:[40]}).addKeyframe("CameraFOV",{data:[45]}).addKeyframe("CameraMove",{data:[0,0,100]}).addKeyframe("CameraTarget",{data:[0,0,0]}).addKeyframe("LightSourceLuminosity",{data:[100]}).addKeyframe("LightSourceMove",{data:[100,100,0]});for(const i of e[0])s.addKeyframe("CameraMove",{data:[...i.ev,100],time:i.t??0,easing:i.ct}),s.addKeyframe("CameraTarget",{data:[...i.ev,100],time:i.t??0,easing:i.ct}),this.stats.keyframes.CameraMove?this.stats.keyframes.CameraMove++:this.stats.keyframes.CameraMove=1;for(const i of e[1]){const r=this.toPaZoom(i.ev[0]??30);s.addKeyframe("CameraFOV",{data:[r],time:i.t??0,easing:i.ct}),this.stats.keyframes.CameraFOV?this.stats.keyframes.CameraFOV++:this.stats.keyframes.CameraFOV=1}for(const i of e[4])s.addKeyframe("Theme",{themeId:i.evs[0],time:i.t??0,easing:i.ct}),this.stats.keyframes.Theme?this.stats.keyframes.Theme++:this.stats.keyframes.Theme=1;return t}static toPaZoom(e){return-.0028*Math.pow(e,2)+1.2*e+-.1}}const at=24,ot=4096;class xl{_buffers;_writeIndex=0;_readIndex=1;constructor(){this._buffers=[this._createBuffer(),this._createBuffer()]}_createBuffer(){return{data:new Float32Array(ot*at),indices:new Uint32Array(ot),positions:new Float32Array(ot*3),depths:new Float32Array(ot),count:0}}reset(){this._buffers[this._writeIndex].count=0}commit(){const e=this._writeIndex;this._writeIndex=this._readIndex,this._readIndex=e}getReadBuffer(){return this._buffers[this._readIndex]}add(e,t,s){const i=this._buffers[this._writeIndex];if(i.count>=ot)return;const r=i.count;let a=r*at;const o=i.data;o[a++]=t[0],o[a++]=t[1],o[a++]=t[2],o[a++]=t[3];const h=s||t;o[a++]=h[0],o[a++]=h[1],o[a++]=h[2],o[a++]=h[3];const l=e.elements;for(let u=0;u<16;u++)o[a++]=l[u];const c=i.positions,f=r*3;c[f]=l[12],c[f+1]=l[13],c[f+2]=l[14],i.indices[r]=r,i.count++}sort(e,t=!0){const s=this._buffers[this._readIndex];if(s.count<2)return;const i=s.count,r=s.indices,a=s.positions,o=s.depths,h=e.x,l=e.y,c=e.z;for(let u=0;u<i;u++){const d=a[u*3],m=a[u*3+1],x=a[u*3+2];o[u]=(d-h)**2+(m-l)**2+(x-c)**2}const f=r.subarray(0,i);t?f.sort((u,d)=>o[d]-o[u]):f.sort((u,d)=>o[u]-o[d])}getSortedData(e){const t=this._buffers[this._readIndex],s=t.count;if(s===0)return e;const i=t.indices,r=t.data;for(let a=0;a<s;a++){const h=i[a]*at,l=a*at;e.set(r.subarray(h,h+at),l)}return e}get size(){return this._buffers[this._readIndex].count}get data(){return this._buffers[this._readIndex].data}}class ke{static isError;static handlers;static opaqueBatches=new Map;static transparentBatches=new Map;static init(){this.isError=!1,this.handlers=new Map,this.opaqueBatches.clear(),this.transparentBatches.clear(),console.info("Runtime Service initialized")}static register(e,t){this.handlers.has(e)&&(console.warn(`[RuntimeService] Component handler for type "${e}" was already registered, the previous entry will be overwritten!`),this.handlers.delete(e)),this.handlers.set(e,t),console.info(`[RuntimeService] Registered component handler "${e}" -> ${t.name}`)}static clean(){this.opaqueBatches.forEach(e=>e.reset()),this.transparentBatches.forEach(e=>e.reset())}static commit(){this.opaqueBatches.forEach(e=>e.commit()),this.transparentBatches.forEach(e=>e.commit())}static update(e,t,s,i){this.isError||!t||t.components.forEach(r=>{this.runHandler(r,e,t,s,i)})}static runHandler(e,t,s,i,r){e.update();const a=e.type(),o=this.handlers.get(a);o?o(this,t,e,s,i,r):console.error(`No handler was registered to handle component "${a}"!`)}static queueMesh(e,t,s,i){const a=s[3]<.99?this.transparentBatches:this.opaqueBatches;let o=a.get(e);o||(o=new xl,a.set(e,o)),o.add(t,s,i)}}const Ea=Math.PI,st=Ea/2,rn=1/2.75,an=2/2.75,Re=1.5/2.75,on=2.5/2.75,Ie=2.25/2.75,Fe=2.625/2.75,bl=n=>pr[n||"Linear"]||pr.Linear,pr={Linear:n=>n,Instant:()=>0,InSine:n=>n===1?1:-Math.cos(st*n)+1,OutSine:n=>Math.sin(st*n),InOutSine:n=>-Math.cos(Ea*n)/2+.5,InElastic:n=>Math.sin(13*st*n)*Math.pow(2,10*(n-1)),OutElastic:n=>n===1?1:Math.sin(-13*st*(n+1))*Math.pow(2,-10*n)+1,InOutElastic:n=>n<.5?.5*Math.sin(13*st*(2*n))*Math.pow(2,10*(2*n-1)):.5*(Math.sin(-13*st*(2*n-1+1))*Math.pow(2,-10*(2*n-1))+2),InBack:n=>n*n*(2.70158*n-1.70158),OutBack:n=>1- --n*n*(-2.70158*n-1.70158),InOutBack:n=>{const t=2.5949095;return n*=2,n<1?.5*(n*n*((t+1)*n-t)):(n-=2,.5*(n*n*((t+1)*n+t)+2))},InBounce:n=>(n=1-n,n<rn?1-7.5625*n*n:n<an?1-(7.5625*(n-Re)*(n-Re)+.75):n<on?1-(7.5625*(n-Ie)*(n-Ie)+.9375):1-(7.5625*(n-Fe)*(n-Fe)+.984375)),OutBounce:n=>n<rn?7.5625*n*n:n<an?7.5625*(n-Re)*(n-Re)+.75:n<on?7.5625*(n-Ie)*(n-Ie)+.9375:7.5625*(n-Fe)*(n-Fe)+.984375,InOutBounce:n=>n<.5?(n=1-n*2,n<rn?(1-7.5625*n*n)/2:n<an?(1-(7.5625*(n-Re)*(n-Re)+.75))/2:n<on?(1-(7.5625*(n-Ie)*(n-Ie)+.9375))/2:(1-(7.5625*(n-Fe)*(n-Fe)+.984375))/2):(n=n*2-1,n<rn?7.5625*n*n/2+.5:n<an?(7.5625*(n-Re)*(n-Re)+.75)/2+.5:n<on?(7.5625*(n-Ie)*(n-Ie)+.9375)/2+.5:(7.5625*(n-Fe)*(n-Fe)+.984375)/2+.5),InQuad:n=>n*n,OutQuad:n=>-n*(n-2),InOutQuad:n=>n<=.5?n*n*2:1- --n*n*2,InCirc:n=>-(Math.sqrt(1-n*n)-1),OutCirc:n=>Math.sqrt(1-(n-1)*(n-1)),InOutCirc:n=>n<=.5?(Math.sqrt(1-n*n*4)-1)/-2:(Math.sqrt(1-(n*2-2)*(n*2-2))+1)/2,InExpo:n=>Math.pow(2,10*(n-1)),OutExpo:n=>n===1?1:-Math.pow(2,-10*n)+1,InOutExpo:n=>n===1?1:n<.5?Math.pow(2,10*(n*2-1))/2:(-Math.pow(2,-10*(n*2-1))+2)/2},As=new Map,de=[],yl=[],vl=[],it={prev:null,next:null,t:0};class le{static interpolateTracks(e,t,s,i,r=!0){for(const a in t.tracks){const o=a,h=t.tracks[o];if(!h)continue;let l=!0,c=0;if(i){const g=i[o];g&&(l=g.enabled,c=g.offset)}this.interpolateTrack(h,e-c);const{prev:f,next:u,t:d}=it;let m=f.data,x=u.data;if(f.randomize&&(m=this.getRandom(f,yl)),u.randomize&&(x=this.getRandom(u,vl)),l||r){let g=s[o];g||(g=new Array(m.length).fill(0),s[o]=g),this.lerpArrays(m,x,d,g)}}return s}static interpolateTheme(e,t,s){this.interpolateTrack(s,e);const{prev:i,next:r,t:a}=it,o=t.get(i.themeId??""),h=t.get(r.themeId??"");if(!o&&!h)throw new Error("Missing themes for interpolation");if(!o)return h;if(!h)return o;const l=this.getCachedTheme(o),c=this.getCachedTheme(h);this.lerpArrays(l.background,c.background,a,de);const f=D.rawToRgba(de);this.lerpArrays(l.gui,c.gui,a,de);const u=D.rawToRgba(de);this.lerpArrays(l.guiAccent,c.guiAccent,a,de);const d=D.rawToRgba(de),m=l.effects.map((p,y)=>(this.lerpArrays(p,c.effects[y],a,de),D.rawToRgba(de))),x=l.parallax.map((p,y)=>(this.lerpArrays(p,c.parallax[y],a,de),D.rawToRgba(de))),g=l.objects.map((p,y)=>(this.lerpArrays(p,c.objects[y],a,de),D.rawToRgba(de)));return{id:o.id,name:o.name,background:f,gui:u,guiAccent:d,effects:m,parallax:x,objects:g}}static lerpArrays(e,t,s,i){const r=e.length,a=i||new Array(r);a.length!==r&&(a.length=r);for(let o=0;o<r;o++)a[o]=e[o]+(t[o]-e[o])*s;return a}static getRandom(e,t,s){if(!e.random||!e.randomize||e.randomize===ht.None)return e.data;const i=761,r=e.data,a=e.random,o=r.length,h=t||new Array(o);h.length!==o&&(h.length=o);const l=s??e.randomSeed;switch(e.randomize){case ht.Linear:{for(let c=0;c<o;c++){const f=l+c*i;let d=this.seededRandom(f)*(a[c]-r[c])+r[c];if(e.randomizeInterval!==void 0){const m=e.randomizeInterval;d=m===0?d:Math.round(d/m)*m}t[c]=d}break}case ht.Toggle:{const c=l+i,f=this.seededRandom(c)>=.5?r:a;for(let u=0;u<o;u++)h[u]=f[u];break}case ht.Relative:{const c=l+i,u=this.seededRandom(c)*(a[1]-a[0])*a[0];for(let d=0;d<o;d++)t[d]=r[d]*u;break}}return h}static interpolateTrack(e,t){const{prev:s,next:i}=e.keyframesAt(t),r=i.time-s.time,a=r===0?1:(t-s.time)/r,o=a<0?0:a>1?1:a;return it.prev=s,it.next=i,it.t=bl(i.easing)(o),it}static seededRandom(e){let t=e+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)*23283064365386963e-26}static seededRandomBetween(e,t,s){return this.seededRandom(s)*(t-e)+e}static getCachedTheme(e){if(!As.has(e.id)){const t=D.rgbaToRaw(e.background),s=D.rgbaToRaw(e.gui),i=D.rgbaToRaw(e.guiAccent),r=e.effects.map(h=>D.rgbaToRaw(h)),a=e.parallax.map(h=>D.rgbaToRaw(h)),o=e.objects.map(h=>D.rgbaToRaw(h));As.set(e.id,{background:t,gui:s,guiAccent:i,effects:r,parallax:a,objects:o})}return As.get(e.id)}}class gr{constructor(e,t,s){if(this.gl=e,this.vertexCount=t.length/3,this.vao=e.createVertexArray(),this.vboPos=e.createBuffer(),this.vboNor=e.createBuffer(),this.vboInst=e.createBuffer(),!this.vao)throw new Error("Failed to create VertexAtrributeArray!");this.gl.bindVertexArray(this.vao),this.bindAttribute(this.vboPos,t,0,3),this.bindAttribute(this.vboNor,s,1,3),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboInst);const i=96;e.enableVertexAttribArray(2),e.vertexAttribPointer(2,4,e.FLOAT,!1,i,0),e.vertexAttribDivisor(2,1),e.enableVertexAttribArray(3),e.vertexAttribPointer(3,4,e.FLOAT,!1,i,16),e.vertexAttribDivisor(3,1);for(let r=0;r<4;r++){const a=4+r;e.enableVertexAttribArray(a),e.vertexAttribPointer(a,4,e.FLOAT,!1,i,32+r*16),e.vertexAttribDivisor(a,1)}this.gl.bindVertexArray(null)}vao;vboPos;vboNor;vboInst;vertexCount=0;instanceCount=0;bindAttribute(e,t,s,i){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e),this.gl.bufferData(this.gl.ARRAY_BUFFER,t,this.gl.STATIC_DRAW),this.gl.enableVertexAttribArray(s),this.gl.vertexAttribPointer(s,i,this.gl.FLOAT,!1,0,0)}bind(){this.vao&&this.gl.bindVertexArray(this.vao)}unbind(){this.gl.bindVertexArray(null)}draw(){this.instanceCount!==0&&(this.gl.bindVertexArray(this.vao),this.gl.drawArraysInstanced(this.gl.TRIANGLES,0,this.vertexCount,this.instanceCount),this.gl.bindVertexArray(null))}uploadInstanceData(e,t){this.instanceCount=t,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vboInst);const s=t*24,i=e.subarray(0,s);this.gl.bufferData(this.gl.ARRAY_BUFFER,i,this.gl.DYNAMIC_DRAW)}dispose(){this.vboPos&&this.gl.deleteBuffer(this.vboPos),this.vboNor&&this.gl.deleteBuffer(this.vboNor),this.vboInst&&this.gl.deleteBuffer(this.vboInst),this.vao&&this.gl.deleteVertexArray(this.vao),this.vboPos=null,this.vboNor=null,this.vboInst=null,this.vao=null}}class wn{constructor(e,t,s){this.gl=e,this.width=t,this.height=s,this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,s,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.fbo=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.fbo),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0);const i=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,i),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t,s),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,i),e.bindFramebuffer(e.FRAMEBUFFER,null)}fbo;texture;width;height;bind(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbo),this.gl.viewport(0,0,this.width,this.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}unbind(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}}class Ra{constructor(e){this.gl=e;const t=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);this.vao=e.createVertexArray();const s=e.createBuffer();e.bindVertexArray(this.vao),e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0),e.bindVertexArray(null)}vao;draw(){this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}}class _l{passes=[];quad;readBuffer;writeBuffer;constructor(e,t,s){this.quad=new Ra(e),this.readBuffer=new wn(e,t,s),this.writeBuffer=new wn(e,t,s)}addPass(e){this.passes.push(e)}resize(){}render(e,t){let s=t;for(let i=0;i<this.passes.length;i++){const r=this.passes[i];if(!r.enabled)continue;const a=i===this.passes.length-1;a?(e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height)):this.writeBuffer.bind(),e.clear(e.COLOR_BUFFER_BIT),r.shader.use(),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,s),r.shader.setUniform("uTexture","1i",0),r.onApply&&r.onApply(r.shader),this.quad.draw(),a||(s=this.writeBuffer.texture,this.swapBuffers())}this.passes.length===0&&(e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height))}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}}class Tn{constructor(e,t,s){this.gl=e;const i=this.compile(e.VERTEX_SHADER,t),r=this.compile(e.FRAGMENT_SHADER,s);if(this.program=e.createProgram(),e.attachShader(this.program,i),e.attachShader(this.program,r),e.linkProgram(this.program),!e.getProgramParameter(this.program,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(this.program)||"Link Error")}program;uniforms=new Map;compile(e,t){const s=this.gl.createShader(e);if(this.gl.shaderSource(s,t),this.gl.compileShader(s),!this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS))throw new Error(this.gl.getShaderInfoLog(s)||"Compile Error");return s}use(){this.gl.useProgram(this.program)}setUniform(e,t,s){if(!this.uniforms.has(e)){const r=this.gl.getUniformLocation(this.program,e);r&&this.uniforms.set(e,r)}const i=this.uniforms.get(e);i&&(t==="1f"&&this.gl.uniform1f(i,s),t==="2fv"&&this.gl.uniform2fv(i,s),t==="3fv"&&this.gl.uniform3fv(i,s),t==="4fv"&&this.gl.uniform4fv(i,s),t==="1i"&&this.gl.uniform1i(i,s))}}const qs=`#version 300 es
layout(location=0) in vec2 aPos;

out vec2 vUv;

void main() {
  vUv = aPos * 0.5 + 0.5;
  gl_Position = vec4(aPos, 0.0, 1.0);
}`,Ml=`#version 300 es
precision mediump float;
in vec2 vUv;
uniform sampler2D uTexture;
uniform vec2 uTexelSize;
uniform float uThreshold;
uniform bool uIsFirstPass;

out vec4 FragColor;

void main() {
  vec4 d = uTexelSize.xyxy * vec4(-1.0, -1.0, 1.0, 1.0);

  vec4 s1 = texture(uTexture, vUv + d.xy);
  vec4 s2 = texture(uTexture, vUv + d.zy);
  vec4 s3 = texture(uTexture, vUv + d.xw);
  vec4 s4 = texture(uTexture, vUv + d.zw);

  vec4 color = (s1 + s2 + s3 + s4) * 0.25;

  if (uIsFirstPass) {
    float brightness = dot(color.rgb, vec3(0.2126, 0.7152, 0.0722));

    if(brightness < uThreshold) {
      color = vec4(0.0);
    }
  }

  FragColor = color;
}`,wl=`#version 300 es
precision mediump float;

in vec2 vUv;

uniform sampler2D uTexture;
uniform float uIntensity;
uniform vec2 uTexelSize;

out vec4 FragColor;

void main() {
  float x = uTexelSize.x;
  float y = uTexelSize.y;

  vec4 d = uTexelSize.xyxy * vec4(1.0, 1.0, -1.0, 0.0);

  vec4 s1 = texture(uTexture, vUv - d.xy);
  vec4 s2 = texture(uTexture, vUv - d.wy);
  vec4 s3 = texture(uTexture, vUv - d.zy);

  vec4 s4 = texture(uTexture, vUv - d.xw);
  vec4 s5 = texture(uTexture, vUv);
  vec4 s6 = texture(uTexture, vUv + d.xw);

  vec4 s7 = texture(uTexture, vUv + d.zy);
  vec4 s8 = texture(uTexture, vUv + d.wy);
  vec4 s9 = texture(uTexture, vUv + d.xy);

  vec4 result = (
    s1 + s3 + s7 + s9 + 
    2.0 * (s2 + s4 + s6 + s8) + 
    4.0 * s5
  ) / 16.0;

  FragColor = result * uIntensity;
}`;class Tl{constructor(e,t,s,i=5){this.gl=e,this.quad=new Ra(e),this.shaderDown=new Tn(e,qs,Ml),this.shaderUp=new Tn(e,qs,wl);let r=t,a=s;for(let o=0;o<i&&(r=Math.floor(r/2),a=Math.floor(a/2),!(r<1||a<1));o++)this.mips.push(new wn(e,r,a))}mips=[];shaderDown;shaderUp;quad;render(e){const t=this.gl;this.quad.draw(),this.shaderDown.use(),t.activeTexture(t.TEXTURE0);let s=e;for(let i=0;i<this.mips.length;i++){const r=this.mips[i],a=i===0;r.bind(),t.viewport(0,0,r.width,r.height),t.clear(t.COLOR_BUFFER_BIT),t.bindTexture(t.TEXTURE_2D,s),this.shaderDown.setUniform("uTexture","1i",0),this.shaderDown.setUniform("uTexelSize","2fv",[1/r.width,1/r.height]),this.shaderDown.setUniform("uIsFirstPass","1i",a?1:0),a&&this.shaderDown.setUniform("uThreshold","1f",1),t.drawArrays(t.TRIANGLES,0,6),s=r.texture}this.shaderUp.use(),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE);for(let i=this.mips.length-1;i>0;i--){const r=this.mips[i],a=this.mips[i-1];a.bind(),t.viewport(0,0,a.width,a.height),t.bindTexture(t.TEXTURE_2D,r.texture),this.shaderUp.setUniform("uTexture","1i",0),this.shaderUp.setUniform("uTexelSize","2fv",[1/r.width,1/r.height]),this.shaderUp.setUniform("uIntensity","1f",1),t.drawArrays(t.TRIANGLES,0,6)}return t.disable(t.BLEND),this.mips[0].texture}}const kl=`#version 300 es
layout(location=0) in vec3 a_position;
layout(location=1) in vec3 a_normal;
layout(location=2) in vec4 a_color;
layout(location=3) in vec4 a_shade;
layout(location=4) in mat4 a_modelMatrix; 

uniform mat4 u_viewMatrix;
uniform mat4 u_projectionMatrix;

out vec3 v_worldPosition;
out vec3 v_normal;
out vec4 v_color;
out vec4 v_shade;

void main() {
  vec4 worldPos = a_modelMatrix * vec4(a_position, 1.0);
  gl_Position = u_projectionMatrix * u_viewMatrix * worldPos;

  v_worldPosition = worldPos.xyz;
  v_normal = mat3(a_modelMatrix) * a_normal; 
  
  v_color = a_color;
  v_shade = a_shade;
}`,zl=`#version 300 es
precision highp float;

#define MAX_LIGHTS 10

in vec3 v_worldPosition;
in vec3 v_normal;
in vec4 v_color;
in vec4 v_shade;

struct Light {
  vec3 pos;
  float lum;
};

uniform Light u_lights[MAX_LIGHTS];
uniform vec3 u_ambientLight;
uniform int u_numLights;

out vec4 FragColor;

void main() {
  vec3 normal = normalize(v_normal);

  float diffuseIntensity = 0.0;
  
  for (int i = 0; i < u_numLights; i++) {
    vec3 lightDir = normalize(u_lights[i].pos - v_worldPosition);
    float diffuseFactor = max(dot(normal, lightDir), 0.0);
    diffuseIntensity += u_lights[i].lum * diffuseFactor;
  }

  float ambientIntensity = length(u_ambientLight);
  float lightingFactor = ambientIntensity + diffuseIntensity;
  lightingFactor = clamp(lightingFactor, 0.0, 1.0);

  vec3 finalColor = mix(v_shade.rgb, v_color.rgb, lightingFactor);

  FragColor = vec4(finalColor, v_color.a);
}`,Cl=`#version 300 es
precision mediump float;

in vec2 vUv;

uniform sampler2D uTexture;
uniform float uThreshold;

out vec4 FragColor;

void main() { 
  vec4 color = texture(uTexture, vUv);
  FragColor = color;
}`,Sl=new Float32Array(ot*at);class Al{gl;canvas;meshCache=new Map;quadGeometry;sceneShader;sceneTarget;ppStack;bloom;uniformLocs={};renderQueue=[];renderQueueCount=0;constructor(e,t){this.canvas=e;const s=this.canvas.getContext("webgl2",t);if(!s)throw new Error("WebGL2 not supported");this.gl=s,this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.disable(this.gl.CULL_FACE)}init(){this.quadGeometry=new gr(this.gl,new Float32Array([-1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0]),new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1])),this.sceneShader=new Tn(this.gl,kl,zl),this.cacheSceneUniforms(),this.sceneTarget=new wn(this.gl,this.canvas.width,this.canvas.height),this.ppStack=new _l(this.gl,this.canvas.width,this.canvas.height),this.bloom=new Tl(this.gl,this.canvas.width,this.canvas.height,6);const e={shader:new Tn(this.gl,qs,Cl),enabled:!0,onApply:t=>{t.setUniform("uThreshold","1f",.8)}};this.ppStack.addPass(e)}registerMesh(e,t,s){this.meshCache.has(e)&&this.unregisterMesh(e),this.meshCache.set(e,new gr(this.gl,t,s))}unregisterMesh(e){this.meshCache.get(e)?.dispose(),this.meshCache.delete(e)}dispose(){this.meshCache.forEach(e=>e.dispose()),this.meshCache.clear(),this.quadGeometry.dispose(),this.gl.getExtension("WEBGL_lose_context")?.loseContext()}render(e,t,s,i){this.sceneTarget.bind(),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clearColor(i[0],i[1],i[2],1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.sceneShader.use(),this.uploadGlobalUniforms(e,s,i),this.renderBatches(ke.opaqueBatches,t,!1),this.gl.depthMask(!1),this.renderBatches(ke.transparentBatches,t,!0),this.gl.depthMask(!0),this.sceneTarget.unbind(),this.ppStack.render(this.gl,this.sceneTarget.texture)}renderBatches(e,t,s){e.forEach((i,r)=>{const a=i.size;if(a===0)return;const o=this.meshCache.get(r);if(!o)return;let h;s?(i.sort(t,!0),h=i.getSortedData(Sl)):h=i.data,o.bind(),o.uploadInstanceData(h,a),o.draw(),o.unbind()})}cacheSceneUniforms(){this.sceneShader.use();const e=["u_projectionMatrix","u_viewMatrix","u_modelMatrix","u_ambientLight","u_numLights","u_objectColor","u_shadeColor"];for(let t=0;t<10;t++)e.push(`u_lights[${t}].pos`),e.push(`u_lights[${t}].lum`);e.forEach(t=>{this.uniformLocs[t]=this.gl.getUniformLocation(this.sceneShader.program,t)})}uploadGlobalUniforms(e,t,s){const i=this.uniformLocs.u_ambientLight;i&&this.gl.uniform3fv(i,s);const r=this.uniformLocs.u_projectionMatrix,a=this.uniformLocs.u_viewMatrix;r&&this.gl.uniformMatrix4fv(r,!1,e.projection.elements),a&&this.gl.uniformMatrix4fv(a,!1,e.view.elements);const o=this.uniformLocs.u_numLights;o&&this.gl.uniform1i(o,t.length);for(let h=0;h<t.length;h++){const l=t[h],c=this.uniformLocs[`u_lights[${h}].pos`],f=this.uniformLocs[`u_lights[${h}].lum`];c&&this.gl.uniform3f(c,l.pos.x,l.pos.y,l.pos.z),f&&this.gl.uniform1f(f,l.luminosity)}}}function El(n,e,t=2){const s=n.length;let i=Rl(n,0,s,t,!0);const r=[];if(!i||i.next===i.prev)return r;let a,o,h;if(n.length>80*t){a=n[0],o=n[1];let l=a,c=o;for(let f=t;f<s;f+=t){const u=n[f],d=n[f+1];u<a&&(a=u),d<o&&(o=d),u>l&&(l=u),d>c&&(c=d)}h=Math.max(l-a,c-o),h=h!==0?32767/h:0}return jt(i,r,t,a,o,h,0),r}function Rl(n,e,t,s,i){let r;if(i===Hl(n,e,t,s)>0)for(let a=e;a<t;a+=s)r=xr(a/s|0,n[a],n[a+1],r);else for(let a=t-s;a>=e;a-=s)r=xr(a/s|0,n[a],n[a+1],r);return r&&Un(r,r.next)&&(Ut(r),r=r.next),r}function Lt(n,e){if(!n)return n;e||(e=n);let t=n,s;do if(s=!1,!t.steiner&&(Un(t,t.next)||H(t.prev,t,t.next)===0)){if(Ut(t),t=e=t.prev,t===t.next)break;s=!0}else t=t.next;while(s||t!==e);return e}function jt(n,e,t,s,i,r,a){if(!n)return;!a&&r&&Dl(n,s,i,r);let o=n;for(;n.prev!==n.next;){const h=n.prev,l=n.next;if(r?Fl(n,s,i,r):Il(n)){e.push(h.i,n.i,l.i),Ut(n),n=l.next,o=l.next;continue}if(n=l,n===o){a?a===1?(n=Ol(Lt(n),e),jt(n,e,t,s,i,r,2)):a===2&&Pl(n,e,t,s,i,r):jt(Lt(n),e,t,s,i,r,1);break}}}function Il(n){const e=n.prev,t=n,s=n.next;if(H(e,t,s)>=0)return!1;const i=e.x,r=t.x,a=s.x,o=e.y,h=t.y,l=s.y,c=Math.min(i,r,a),f=Math.min(o,h,l),u=Math.max(i,r,a),d=Math.max(o,h,l);let m=s.next;for(;m!==e;){if(m.x>=c&&m.x<=u&&m.y>=f&&m.y<=d&&It(i,o,r,h,a,l,m.x,m.y)&&H(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function Fl(n,e,t,s){const i=n.prev,r=n,a=n.next;if(H(i,r,a)>=0)return!1;const o=i.x,h=r.x,l=a.x,c=i.y,f=r.y,u=a.y,d=Math.min(o,h,l),m=Math.min(c,f,u),x=Math.max(o,h,l),g=Math.max(c,f,u),p=Ys(d,m,e,t,s),y=Ys(x,g,e,t,s);let b=n.prevZ,v=n.nextZ;for(;b&&b.z>=p&&v&&v.z<=y;){if(b.x>=d&&b.x<=x&&b.y>=m&&b.y<=g&&b!==i&&b!==a&&It(o,c,h,f,l,u,b.x,b.y)&&H(b.prev,b,b.next)>=0||(b=b.prevZ,v.x>=d&&v.x<=x&&v.y>=m&&v.y<=g&&v!==i&&v!==a&&It(o,c,h,f,l,u,v.x,v.y)&&H(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;b&&b.z>=p;){if(b.x>=d&&b.x<=x&&b.y>=m&&b.y<=g&&b!==i&&b!==a&&It(o,c,h,f,l,u,b.x,b.y)&&H(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;v&&v.z<=y;){if(v.x>=d&&v.x<=x&&v.y>=m&&v.y<=g&&v!==i&&v!==a&&It(o,c,h,f,l,u,v.x,v.y)&&H(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function Ol(n,e){let t=n;do{const s=t.prev,i=t.next.next;!Un(s,i)&&Ia(s,t,t.next,i)&&kn(s,i)&&kn(i,s)&&(e.push(s.i,t.i,i.i),Ut(t),Ut(t.next),t=n=i),t=t.next}while(t!==n);return Lt(t)}function Pl(n,e,t,s,i,r){let a=n;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&jl(a,o)){let h=Bl(a,o);a=Lt(a,a.next),h=Lt(h,h.next),jt(a,e,t,s,i,r,0),jt(h,e,t,s,i,r,0);return}o=o.next}a=a.next}while(a!==n)}function Dl(n,e,t,s){let i=n;do i.z===0&&(i.z=Ys(i.x,i.y,e,t,s)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==n);i.prevZ.nextZ=null,i.prevZ=null,Nl(i)}function Nl(n){let e,t=1;do{let s=n,i;n=null;let r=null;for(e=0;s;){e++;let a=s,o=0;for(let l=0;l<t&&(o++,a=a.nextZ,!!a);l++);let h=t;for(;o>0||h>0&&a;)o!==0&&(h===0||!a||s.z<=a.z)?(i=s,s=s.nextZ,o--):(i=a,a=a.nextZ,h--),r?r.nextZ=i:n=i,i.prevZ=r,r=i;s=a}r.nextZ=null,t*=2}while(e>1);return n}function Ys(n,e,t,s,i){return n=(n-t)*i|0,e=(e-s)*i|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function Ll(n,e,t,s,i,r,a,o){return(i-a)*(e-o)>=(n-a)*(r-o)&&(n-a)*(s-o)>=(t-a)*(e-o)&&(t-a)*(r-o)>=(i-a)*(s-o)}function It(n,e,t,s,i,r,a,o){return!(n===a&&e===o)&&Ll(n,e,t,s,i,r,a,o)}function jl(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!Ul(n,e)&&(kn(n,e)&&kn(e,n)&&$l(n,e)&&(H(n.prev,n,e.prev)||H(n,e.prev,e))||Un(n,e)&&H(n.prev,n,n.next)>0&&H(e.prev,e,e.next)>0)}function H(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function Un(n,e){return n.x===e.x&&n.y===e.y}function Ia(n,e,t,s){const i=ln(H(n,e,t)),r=ln(H(n,e,s)),a=ln(H(t,s,n)),o=ln(H(t,s,e));return!!(i!==r&&a!==o||i===0&&hn(n,t,e)||r===0&&hn(n,s,e)||a===0&&hn(t,n,s)||o===0&&hn(t,e,s))}function hn(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function ln(n){return n>0?1:n<0?-1:0}function Ul(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&Ia(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function kn(n,e){return H(n.prev,n,n.next)<0?H(n,e,n.next)>=0&&H(n,n.prev,e)>=0:H(n,e,n.prev)<0||H(n,n.next,e)<0}function $l(n,e){let t=n,s=!1;const i=(n.x+e.x)/2,r=(n.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&i<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(s=!s),t=t.next;while(t!==n);return s}function Bl(n,e){const t=Zs(n.i,n.x,n.y),s=Zs(e.i,e.x,e.y),i=n.next,r=e.prev;return n.next=e,e.prev=n,t.next=i,i.prev=t,s.next=t,t.prev=s,r.next=s,s.prev=r,s}function xr(n,e,t,s){const i=Zs(n,e,t);return s?(i.next=s.next,i.prev=s,s.next.prev=i,s.next=i):(i.prev=i,i.next=i),i}function Ut(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Zs(n,e,t){return{i:n,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Hl(n,e,t,s){let i=0;for(let r=e,a=t-s;r<t;r+=s)i+=(n[a]-n[r])*(n[r+1]+n[a+1]),a=r;return i}class Es{static prepareMesh(e,t=!1){const{vertices:s,faces:i}=e,r=this.getGeometricCenter(e),a=new Gs(e);let o;if(t){let h=[];i.forEach(l=>h=[...h,...l]),o=new Uint16Array(h)}else o=this.triangulateMesh(s,i),o=this.fixIndexWindingOrder(o,s,r);return a._indices=new Uint16Array(o),a._flatMesh=this.flatMapMesh(a.vertices,a._indices),a._flatNormals=this.flatMapNormals(a.vertices,a._indices),a}static getGeometricCenter(e){if(e.vertices.length===0)return new M(0,0,0);const t=new M(0,0,0);for(const s of e.vertices)t.add(s);return t.divideScalar(e.vertices.length)}static triangulateMesh(e,t){if(e.length===0)return new Uint16Array;const s=[];for(const i of t){const r=i.length;if(r<3)continue;if(r===3){s.push(...i);continue}const a=i.map(b=>e[b]),o=a[0],h=a[1],l=a[2],c=new M().subVectors(h,o),f=new M().subVectors(l,o),u=new M().crossVectors(c,f),d=Math.abs(u.x),m=Math.abs(u.y),x=Math.abs(u.z);let g;switch(!0){case(d>m&&d>x):{g=a.flatMap(b=>[b.y,b.z]);break}case m>x:{g=a.flatMap(b=>[b.x,b.z]);break}default:{g=a.flatMap(b=>[b.x,b.y]);break}}const y=El(g).map(b=>i[b]);s.push(...y)}return new Uint16Array(s)}static fixIndexWindingOrder(e,t,s){if(!e||e.length===0)return console.error("Geometry winding failed; mesh has no indices."),new Uint16Array;const i=new Map;for(let v=0;v<=e.length;v+=3){const z=e[v],C=e[v+1],T=e[v+2],R=[[z,C],[C,T],[T,z]].map(S=>S.sort((A,O)=>A-O).join("-"));for(const S of R)i.has(S)||i.set(S,[]),i.get(S).push(v)}const r=e.length/3,a=new Array(r).fill(!1),o=[];let h=-1,l=0;for(let v=0;v<e.length;v+=3){const z=t[e[v]],C=t[e[v+1]],T=t[e[v+2]],S=z.clone().add(C).add(T).divideScalar(3).lengthSq();S>h&&(h=S,l=v)}const c=e[l],f=e[l+1],u=e[l+2],d=t[c],m=t[f],x=t[u],g=new M().subVectors(m,d),p=new M().subVectors(x,d),y=new M().crossVectors(g,p),b=new M().subVectors(d,s);for(y.dot(b)<0&&(e[l+1]=u,e[l+2]=f),o.push(l),a[l/3]=!0;o.length>0;){const v=o.shift(),z=e[v],C=e[v+1],T=e[v+2],R=[[z,C],[C,T],[T,z]];for(const S of R){const A=[...S].sort((P,$)=>P-$).join("-"),O=i.get(A)||[];for(const P of O){if(P===v)continue;const $=P/3;if(!a[$]){a[$]=!0;const V=e[P],ie=e[P+1],ue=e[P+2],re=[[V,ie],[ie,ue],[ue,V]];for(const ae of re)if(ae[0]===S[0]&&ae[1]===S[1]){const fe=e[P+1];e[P+1]=e[P+2],e[P+2]=fe;break}o.push(P)}}}}return e}static flatMapMesh(e,t){if(!t||t.length===0)return console.error("Geometry unindexing failed; mesh has no indices."),new Float32Array;const s=new Float32Array(t.length*3);for(let i=0;i<t.length;i++){const r=t[i],a=e[r],o=i*3;s[o+0]=a.x,s[o+1]=a.y,s[o+2]=a.z}return s}static flatMapNormals(e,t){if(!t||t.length===0)return console.error("Normal calculation failed; mesh has no indices."),new Float32Array;const s=new Float32Array(t.length*3);for(let i=0;i<t.length;i+=3){const r=t[i],a=t[i+1],o=t[i+2],h=e[r],l=e[a],c=e[o],f=new M().subVectors(l,h),u=new M().subVectors(c,h),d=new M().crossVectors(f,u).normalize(),m=i*3,x=(i+1)*3,g=(i+2)*3;s[m]=d.x,s[m+1]=d.y,s[m+2]=d.z,s[x]=d.x,s[x+1]=d.y,s[x+2]=d.z,s[g]=d.x,s[g+1]=d.y,s[g+2]=d.z}return s}}const Rs={name:"Empty",vertices:[],faces:[]};class Gs{name;vertices;faces;_isDirty;_indices;_flatMesh;_flatNormals;_material;constructor(e){this._isDirty=!0,this._indices=new Uint16Array,this._flatMesh=new Float32Array,this._flatNormals=new Float32Array,this._material={color:[1,1,1],shade:[0,0,0]},e?(this.name=e.name,this.vertices=structuredClone(e.vertices),this.faces=structuredClone(e.faces)):(this.name=Rs.name,this.vertices=structuredClone(Rs.vertices),this.faces=structuredClone(Rs.faces))}static from(e,t=!1){const s=Es.prepareMesh(e,t);return s._flatMesh||(s._flatMesh=new Float32Array(0)),s._flatNormals||(s._flatNormals=new Float32Array(0)),s}applyMatrix4(e){const t=[];for(const s of this.vertices)s.applyMatrix4(e);return this._flatMesh=Es.flatMapMesh(t,this._indices),this._flatNormals=Es.flatMapNormals(t,this._indices),this}}class dt{static meshData;static meshes;static init(){this.meshData=new Map,this.meshes=new Map,console.info("MeshRegistry initialized")}static registerMesh(e,t=!1){this.meshData.has(e.name)&&(console.warn(`Mesh with name "${e.name}" was already registered! The previous entry will be overwritten!`),this.meshData.delete(e.name),this.meshes.delete(e.name)),this.meshData.set(e.name,structuredClone(e));const s=Gs.from(e,t);this.meshes.set(s.name,s)}static new(e){const t=this.meshData.get(e);if(!t)throw new Error(`Mesh with name "${e}" was not registered.`);return Gs.from(t)}static getFlatMesh(e){const t=this.meshes.get(e);if(!t)throw new Error(`Mesh with name "${e}" was not registered.`);return t._flatMesh}static getFlatNormals(e){const t=this.meshes.get(e);if(!t)throw new Error(`Mesh with name "${e}" was not registered.`);return t._flatNormals}}const St=new M(0,0,100),cn=new M(0,0,-100),Vl=new M(0,1,0),un={id:"DEFAULT_THEME",name:"New Theme",objects:[{r:25,g:25,b:25},{r:50,g:50,b:50},{r:75,g:75,b:75},{r:100,g:100,b:100},{r:125,g:125,b:125},{r:150,g:150,b:150},{r:175,g:175,b:175},{r:200,g:200,b:200},{r:225,g:225,b:225}],effects:[{r:25,g:25,b:25},{r:50,g:50,b:50},{r:75,g:75,b:75},{r:100,g:100,b:100},{r:125,g:125,b:125},{r:150,g:150,b:150},{r:175,g:175,b:175},{r:200,g:200,b:200},{r:225,g:225,b:225}],parallax:[{r:25,g:25,b:25},{r:50,g:50,b:50},{r:75,g:75,b:75},{r:100,g:100,b:100},{r:125,g:125,b:125},{r:150,g:150,b:150},{r:175,g:175,b:175},{r:200,g:200,b:200},{r:225,g:225,b:225}],background:{r:25,g:25,b:25},gui:{r:200,g:200,b:200},guiAccent:{r:200,g:200,b:200}};class zn{isHeadless;level;renderer;freecamEnabled=!0;freecamPos=new M(0,0,100);freecamTarget=new M(0,0,0);freecamFov=45;_viewMatrix=new Q;_events;_theme;cameraType;perspectiveCamera;orthographicCamera;_activeCamera;constructor(e,t,s){if(e?this.assign(e):(this.level=new ft,this.level.themes.set(un.id,un),this.newEffectsObject()),t){this.isHeadless=!1;const i=t.getBoundingClientRect(),r=i.width/i.height;this.perspectiveCamera=new M0(45,r,.1,1e4);const a=100,o={left:a*r/-2,right:a*r/2,top:a/2,bottom:a/-2,near:.1,far:1e4};this.orthographicCamera=new w0(...Object.values(o)),this.orthographicCamera.zoom=1,this.cameraType="perspective",this._activeCamera=this.perspectiveCamera,this.updateCameraMatrix();const h=Math.min(window.devicePixelRatio||1,2);t.width=i.width*h,t.height=i.height*h,this.renderer=new Al(t,s),this.renderer.init(),console.info("[Editor] Registering meshes to vbuffer...");let l=0;dt.meshes.forEach((c,f)=>{const u=f,d=dt.getFlatMesh(u),m=dt.getFlatNormals(u);this.renderer.registerMesh(u,d,m),l++}),console.info(`[Editor] Registered ${l} meshes to vbuffer.`),this._theme=structuredClone(un)}else this.isHeadless=!0,console.warn("[Editor] Editor is running in headless mode, no attempt to render will be made.")}static from(e){return new zn(e)}assign(e){return e.level&&(this.level=ft.from(e.level)),this}serialize(){return{level:this.level.serialize()}}update(e){const t=this.level.events.getComponent("Animation3D");this._events=le.interpolateTracks(e,t,this._events??{}),this.freecamEnabled?(St.copy(this.freecamPos),cn.copy(this.freecamTarget),this.perspectiveCamera.fov=this.freecamFov,this.perspectiveCamera.updateProjectionMatrix(),this.orthographicCamera.zoom=this.fovToOrtho(this.freecamFov,100),this.orthographicCamera.updateProjectionMatrix()):(this._events.CameraMove&&St.fromArray(this._events.CameraMove),this._events.CameraTarget&&cn.fromArray(this._events.CameraTarget),this._events.CameraFOV&&(this.perspectiveCamera.fov=this._events.CameraFOV[0],this.perspectiveCamera.updateProjectionMatrix(),this.orthographicCamera.zoom=this.fovToOrtho(this._events.CameraFOV[0],100),this.orthographicCamera.updateProjectionMatrix())),this.updateCameraMatrix();let s=un;t.tracks.Theme&&(s=le.interpolateTheme(e,this.level.themes,t.tracks.Theme),this._theme=s),ke.clean(),this.level.rawObjects.forEach(i=>{ke.update(e,i,this.level,s)}),ke.commit()}render(){if(this.isHeadless||!this.renderer)return;const e=[{pos:new M(20,20,20),luminosity:1}],t=D.rgbaToRaw(this._theme.background),s=new M().copy(St),i={projection:this._activeCamera.projectionMatrix,view:this._viewMatrix};this.renderer.render(i,s,e,t)}resize(e,t){if(this.isHeadless)return;const s=e/t;this.perspectiveCamera.aspect=s,this.perspectiveCamera.updateProjectionMatrix();const r=(this.orthographicCamera.top-this.orthographicCamera.bottom)*s;this.orthographicCamera.left=-r/2,this.orthographicCamera.right=r/2,this.orthographicCamera.updateProjectionMatrix()}load(e){return this.level=ft.from(e),this}getEndTime(){let e=0;return this.level.rawObjects.forEach(t=>{t&&t.components.forEach(s=>{const i=s.lifetime+s.spawnTime;i>e&&(e=i)})}),e}newObject(e){const t=ve.from(e??{});return t.addComponent("Animation3D").addKeyframe("Move",{data:[0,0,0]}).addKeyframe("Scale",{data:[1,1,1]}).addKeyframe("Rotation",{data:[0,0,0]}).addKeyframe("Color",{data:[0,8]}).setParenting("Move",!0).setParenting("Scale",!1).setParenting("Rotation",!0),this.level.addObject(t),t}newEffectsObject(e){const t=ve.from(e??{});return t.addComponent("Animation3D").addKeyframe("AmbientLight",{data:[40]}).addKeyframe("CameraFOV",{data:[45]}).addKeyframe("CameraMove",{data:[0,0,100]}).addKeyframe("CameraTarget",{data:[0,0,0]}).addKeyframe("LightSourceLuminosity",{data:[100]}).addKeyframe("LightSourceMove",{data:[100,100,0]}).addKeyframe("Theme",{themeId:this.level.themes.entries().toArray()[0][1].id}),this.level.events=t,t}updateCameraMatrix(){this._viewMatrix.lookAt(St,cn,Vl),this._activeCamera.position.copy(St),this._activeCamera.lookAt(cn),this._viewMatrix.copy(this._activeCamera.matrixWorldInverse)}setCameraType(e){this.cameraType!==e&&(this.cameraType=e,e==="perspective"?this._activeCamera=this.perspectiveCamera:this._activeCamera=this.orthographicCamera,this._activeCamera.updateProjectionMatrix())}toggleFreecam(){this.freecamEnabled=!this.freecamEnabled,this.updateCameraMatrix()}fovToOrtho(e,t){const s=e/2*(Math.PI/180),i=2*t*Math.tan(s),a=(this.orthographicCamera.top-this.orthographicCamera.bottom)/i;return Math.max(.001,a)}}const Wl={time:0,easing:"Linear",data:[]};class lt{time;easing;data;random;themeId;randomize;randomizeInterval;randomSeed;constructor(e){this.refreshSeed(),e?this.assign(e):this.assign(structuredClone(Wl))}static from(e){return new lt(e)}serialize(){return{time:this.time,easing:this.easing,data:structuredClone(this.data),random:this.random,themeId:this.themeId,randomize:this.randomize,randomizeInterval:this.randomizeInterval}}assign(e){return this.data=structuredClone(e.data)??this.data??[],this.time=e.time??0,this.easing=e.easing??"Linear",this.random=e.random,this.themeId=e.themeId,this.randomize=e.randomize,this.randomizeInterval=e.randomizeInterval,this}refreshSeed(){this.randomSeed=Math.floor(Math.random()*999999)}setTime(e){return this.time=e,this}setEasing(e){return this.easing=e,this}setData(e){return this.data=e,this}setThemeId(e){return this.themeId=e,this}}class fi extends Array{randomSeed;isDirty;constructor(e){super(),this.refreshRandomSeed(),this.isDirty=!0,e&&e.forEach((t,s)=>this[s]=lt.from(t))}static from(e){return new fi(e)}serialize(){const e=[];for(const t of this)e.push(t.serialize());return e}refreshRandomSeed(){this.randomSeed=Math.floor(Math.random()*999999);for(const e of this)e.refreshSeed()}sortByTime(){return this.sort((e,t)=>e.time-t.time),this.isDirty=!1,this}addKeyframe(e){return this.push(lt.from(e)),this.isDirty=!0,this}deleteKeyframe(e){return this[e]&&this.splice(e,1),this.isDirty=!0,this}keyframesAt(e){if(this.length===0)return{prev:new lt,next:new lt};if(this.length===1)return{prev:this[0],next:this[0]};this.isDirty&&this.sortByTime();const t=this[0].time,s=this[this.length-1].time;if(e>=s){const l=this[this.length-1];return{prev:l,next:l}}if(e<t)return{prev:this[0],next:this[1]};let i=0,r=this.length-1,a=0;for(;i<=r;){const l=Math.floor(i+(r-i)/2);(this[l].time||0)<=e?(a=l,i=l+1):r=l-1}const o=this[a],h=this[a+1]||o;return{prev:o,next:h}}}class di{_isDirty=!0;static type(){return"Component"}type(){return di.type()}init(){}update(){}serialize(){return{}}}class $t extends di{static TYPE="Animation";_parentIndex;parentId;tracks;spawnTime;lifetime;mesh;parentSettings;randomSeed;constructor(e){super(),this.init(),e&&this.assign(e)}static from(e){return new $t(e)}static type(){return this.TYPE}type(){return $t.type()}init(){this._isDirty=!0,this.tracks={},this.spawnTime=0,this.lifetime=30,this.parentSettings={},this.refreshRandomSeed()}update(){}serialize(){const e={};for(const t in this.tracks){const s=t;e[s]=this.tracks[s]?.serialize()}return{type:this.type(),parentId:this.parentId,mesh:this.mesh,tracks:e,spawnTime:this.spawnTime,lifetime:this.lifetime,parentSettings:structuredClone(this.parentSettings)}}assign(e){if(e.parentId&&(this.parentId=e.parentId),e.mesh&&(this.mesh=e.mesh),e.tracks!==void 0)for(const t in e.tracks){const s=t;this.createTrack(s,e.tracks[s])}return e.spawnTime!==void 0&&(this.spawnTime=e.spawnTime),e.lifetime!==void 0&&(this.lifetime=e.lifetime),e.parentSettings&&(this.parentSettings=structuredClone(e.parentSettings)),this}createTrack(e,t){return this.tracks[e]=fi.from(t??[]),this}deleteTrack(e){return delete this.tracks[e],this}addKeyframe(e,t){return this.tracks[e]||this.createTrack(e),this.tracks[e]&&t&&this.tracks[e].addKeyframe(t),this}setMesh(e){return this.mesh=e,this}setParent(e,t){return this.parentId=e,this._parentIndex=t,this}setParenting(e,t){return this.parentSettings[e]?this.parentSettings[e].enabled=t:this.parentSettings[e]={enabled:t,offset:0},this}setParentOffset(e,t){return this.parentSettings[e]?this.parentSettings[e].offset=t:this.parentSettings[e]={enabled:!0,offset:t},this}refreshRandomSeed(){this.randomSeed=Math.random()*9999999}}class pt extends $t{static TYPE="Animation2D";mesh;zOffset;origin;constructor(e){super(),this.init(),e&&this.assign(e)}static from(e){return new pt(e)}static type(){return this.TYPE}type(){return pt.type()}init(){this._isDirty=!0,this.tracks={},this.spawnTime=1,this.lifetime=5,this.zOffset=0,this.origin={x:0,y:0},this.parentSettings={}}update(){}serialize(){const e={};for(const t in this.tracks){const s=t;e[s]=this.tracks[s]?.serialize()}return{type:this.type(),parentId:this.parentId,zOffset:this.zOffset,mesh:this.mesh,tracks:e,spawnTime:this.spawnTime,lifetime:this.lifetime,origin:structuredClone(this.origin),parentSettings:structuredClone(this.parentSettings)}}assign(e){if(e.parentId&&(this.parentId=e.parentId),e.mesh&&(this.mesh=e.mesh),e.tracks!==void 0)for(const t in e.tracks){const s=t;this.createTrack(s,e.tracks[s])}return e.zOffset!==void 0&&(this.zOffset=e.zOffset),e.spawnTime!==void 0&&(this.spawnTime=e.spawnTime),e.lifetime!==void 0&&(this.lifetime=e.lifetime),e.origin&&(this.origin=structuredClone(e.origin)),e.parentSettings&&(this.parentSettings=structuredClone(e.parentSettings)),this}}class Bt extends $t{static TYPE="Animation3D";origin;constructor(e){super(),this.init(),e&&this.assign(e)}static from(e){return new Bt(e)}static type(){return this.TYPE}type(){return Bt.type()}init(){this._isDirty=!0,this.tracks={},this.spawnTime=0,this.lifetime=30,this.mesh="Cube",this.origin={x:0,y:0,z:0},this.parentSettings={}}update(){}serialize(){const e={};for(const t in this.tracks){const s=t;e[s]=this.tracks[s]?.serialize()}return{type:this.type(),parentId:this.parentId,mesh:this.mesh,tracks:e,spawnTime:this.spawnTime,lifetime:this.lifetime,origin:structuredClone(this.origin),parentSettings:structuredClone(this.parentSettings)}}assign(e){if(e.parentId&&(this.parentId=e.parentId),e.mesh&&(this.mesh=e.mesh),e.tracks!==void 0)for(const t in e.tracks){const s=t;this.createTrack(s,e.tracks[s])}return e.spawnTime&&(this.spawnTime=e.spawnTime),e.lifetime&&(this.lifetime=e.lifetime),e.origin&&(this.origin=structuredClone(e.origin)),e.parentSettings&&(this.parentSettings=structuredClone(e.parentSettings)),this}}class Cn{static _pool=[];static _count=0;static get(){return this._count>0?(this._count--,this._pool[this._count]):new Q}static release(e){e.identity(),this._pool[this._count]=e,this._count++}static logStatus(){console.log(`Matrix4Pool: ${this._count} available`)}}const br=new M,yr=new M,vr=new bt,Is=new qe,_r=new Q;class Mr{static getLocalTRS(e,t){e.identity();const s=t.Move?t.Move[0]:0,i=t.Move?t.Move[1]:0,r=t.Scale?t.Scale[0]:1,a=t.Scale?t.Scale[1]:1,o=t.Rotation?t.Rotation[0]:0;return br.set(s,i,0),yr.set(r,a,1),o!==0?(vr.set(0,0,$o(o)),Is.setFromEuler(vr)):Is.set(0,0,0,1),e.compose(br,Is,yr),e}static _accumulateTRS(e,t,s,i,r){this.getLocalTRS(e,r);let a=s,o=a.getComponent("Animation2D")?.parentId;for(;o;){const h=i.getObject(o);if(!h)break;const l={},c=h.getComponent("Animation2D"),f=a.getComponent("Animation2D"),u=Cn.get(),d=le.interpolateTracks(t,c,l,f.parentSettings,!1);this.getLocalTRS(u,d),e.premultiply(u),Cn.release(u),a=h,o=c.parentId}}static getWorldMatrix(e,t,s,i){const r=t.getComponent("Animation2D");if(!r)throw new Error(`Object "${t.name}" [ ${t.id} ] does not have an Animation2D component!`);const a=new Q;return this._accumulateTRS(a,e,t,s,i),r.origin&&(r.origin.x!==0||r.origin.y!==0)&&(_r.makeTranslation(r.origin.x,r.origin.y,0),a.multiply(_r)),r.zOffset&&(a.elements[14]+=(r.zOffset+le.seededRandom(r.randomSeed))*2),a}static getColorAt(e,t,s,i){const r=t.tracks.Color;if(!r)return D.rgbaToRaw(s.background);const{prev:a,next:o,t:h}=le.interpolateTrack(r,e);if(h===0){const f=D.rgbaToRaw(s.objects[a.data[0]]);return f[3]=a.data[1],f}if(h===1){const f=D.rgbaToRaw(s.objects[o.data[0]]);return f[3]=a.data[1],f}const l=D.rgbaToRaw(s.objects[a.data[0]]);l[3]=a.data[1];const c=D.rgbaToRaw(s.objects[o.data[0]]);return c[3]=o.data[1],i?(i=le.lerpArrays(l,c,h,i),i):le.lerpArrays(l,c,h)}}const wr={};let Fs=[1,1,1,1];const Xl=(n,e,t,s,i,r)=>{if(e<t.spawnTime||e>t.spawnTime+t.lifetime)return;le.interpolateTracks(e,t,wr,t.parentId?t.parentSettings:void 0,!0);const a=t.tracks.Move!==void 0,o=t.tracks.Rotation!==void 0,h=t.tracks.Scale!==void 0;if((a||o||h)&&t.tracks.Color&&t.mesh){const l=Mr.getWorldMatrix(e,s,i,wr);Fs=Mr.getColorAt(e,t,r),n.queueMesh(t.mesh,l,Fs,Fs)}},Tr=new M,kr=new M,zr=new bt,Os=new qe,Cr=new Q;class Sr{static getLocalTRS(e,t){e.identity();const s=t.Move?t.Move[0]:0,i=t.Move?t.Move[1]:0,r=t.Move?t.Move[2]:0,a=t.Scale?t.Scale[0]:1,o=t.Scale?t.Scale[1]:1,h=t.Scale?t.Scale[2]:1;return Tr.set(s,i,r),kr.set(a,o,h),t.Rotation?(zr.set(es.degToRad(t.Rotation[0]),es.degToRad(t.Rotation[1]),es.degToRad(t.Rotation[2])),Os.setFromEuler(zr)):Os.set(0,0,0,1),e.compose(Tr,Os,kr),e}static _accumulateTRS(e,t,s,i,r){this.getLocalTRS(e,r);let a=s,o=a.getComponent("Animation3D")?.parentId;for(;o;){const h=i.getObject(o);if(!h)break;const l={},c=h.getComponent("Animation3D"),f=a.getComponent("Animation3D"),u=Cn.get(),d=le.interpolateTracks(t,c,l,f.parentSettings,!0);this.getLocalTRS(u,d),e.premultiply(u),Cn.release(u),a=h,o=c.parentId}}static getWorldMatrix(e,t,s,i){const r=t.getComponent("Animation3D");if(!r)throw new Error(`Object "${t.name}" [ ${t.id} ] does not have an Animation3D component!`);const a=new Q;return this._accumulateTRS(a,e,t,s,i),r.origin&&(r.origin.x!==0||r.origin.y!==0||r.origin.z!==0)&&(Cr.makeTranslation(r.origin.x,r.origin.y,r.origin.z),a.multiply(Cr)),a}static getColorsAt(e,t,s){const i=t.tracks.Color;if(!i){const u=D.rgbaToRaw(s.background);return{color:u,shade:u}}const{prev:r,next:a,t:o}=le.interpolateTrack(i,e);if(o===0)return{color:this._resolveColor(r.data[0],s),shade:this._resolveColor(r.data[1],s)};if(o===1)return{color:this._resolveColor(a.data[0],s),shade:this._resolveColor(a.data[1],s)};const h=this._resolveColor(r.data[0],s),l=this._resolveColor(a.data[0],s),c=this._resolveColor(r.data[1],s),f=this._resolveColor(a.data[1],s);return{color:le.lerpArrays(h,l,o),shade:le.lerpArrays(c,f,o)}}static _resolveColor(e,t){const s=t.objects[e];return s?D.rgbaToRaw(s):[0,0,0,1]}}const Ar={},ql=(n,e,t,s,i,r)=>{if(e<t.spawnTime||e>t.spawnTime+t.lifetime)return;le.interpolateTracks(e,t,Ar,t.parentId?t.parentSettings:void 0,!1);const a=t.tracks.Move!==void 0,o=t.tracks.Rotation!==void 0,h=t.tracks.Scale!==void 0;if((a||o||h)&&t.tracks.Color&&t.mesh){const l=Sr.getWorldMatrix(e,s,i,Ar),{color:c,shade:f}=Sr.getColorsAt(e,t,r);n.queueMesh(t.mesh,l,c,f)}},Yl=[{id:Bt.TYPE,callback:ql},{id:pt.TYPE,callback:Xl}];function Zl(){ke.init();for(const n of Yl){const{id:e,callback:t}=n;ke.register(e,t)}}const Gl=[Bt,pt];function Kl(){gn.init();for(const n of Gl)gn.register(n.TYPE,n)}class Ks{static handlers;static init(){this.handlers=new Map,console.info("Export Registry initialized")}static register(e,t){this.handlers.has(e)&&(console.warn(`[ExportRegistry] Component exporter for type "${e}" was already registered, the previous entry will be overwritten!`),this.handlers.delete(e)),this.handlers.set(e,t),console.info(`[ExportRegistry] Registered component exporter "${e}" -> ${t.name}`)}static runHandler(e,t,s){e.update();const i=e.type(),r=this.handlers.get(i);if(r)try{return r(e,t,s)}catch(a){return console.error(`[ExportRegistry] Error exporting component ${i} in object "${t.name}" [${t.id}]:
${a}`),console.error(a.stack),console.error(`Offending object:
`,t),[]}else return console.error(`[ExportRegistry] No handler was registered to export component "${i}"!`),[]}}class fn{static toVgdLevel(e){const t={events:[[],[],[],[],[],[],[],[],[]],objects:[],themes:[]};return e._objects.forEach(s=>{s&&t.objects.push(...this.toVgdLevelObject(s,e._objects))}),e.themes.forEach(s=>{t.themes.push(this.toVgdTheme(s))}),t}static toVgdLevelObject(e,t){const s=[];return e.components.forEach(i=>{const r=Ks.runHandler(i,e,t??[]);for(const a of r)s.push(a)}),s}static toVgdTheme(e){return{name:e.name,id:e.id,pla:["E57373","64B5F6","81C784","FFB74D"],obj:e.objects.map(s=>D.rgbaToHex(s)),fx:e.effects.map(s=>D.rgbaToHex(s)),bg:e.parallax.map(s=>D.rgbaToHex(s)),base_bg:D.rgbaToHex(e.background),base_gui:D.rgbaToHex(e.gui),base_gui_accent:D.rgbaToHex(e.guiAccent)}}static toVgdKeyframeTrack(e,t,s){const i=[];for(const r of t)i.push(this.toVgdKeyframe(e,r,s));return i}static toVgdKeyframe(e,t,s){const i={ev:[]};switch(e){case"Color":{i.ev=[t.data[0]],t.data[1]!==100&&i.ev.push(t.data[1]);break}case"Rotation":{i.ev=[t.data[0]],t.data[1]&&i.ev.push(t.data[1]);break}default:{i.ev=[t.data[0],t.data[1]];break}}return t.time&&t.time-s>0&&(i.t=t.time-s),t.randomize&&t.randomize!==ht.None&&(i.r=Object.values(Lr).indexOf(t.randomize)),t.easing&&t.easing!=="Linear"&&(i.ct=t.easing),t.themeId&&(i.evs=[t.themeId]),t.random&&(i.er=[t.random[0],t.random[1]],t.randomizeInterval!==void 0&&(i.er[2]=t.randomizeInterval)),i}}const Ql=(n,e)=>{const t={id:e.id,n:e.name,ak_t:3,ak_o:n.lifetime,st:n.spawnTime,e:[{k:[{ev:[0,0]}]},{k:[{ev:[1,1]}]},{k:[{ev:[0,0]}]},{k:[{ev:[0,0]}]}]};if(n.tracks.Move&&(t.e[0].k=fn.toVgdKeyframeTrack("Move",n.tracks.Move,n.spawnTime)),n.tracks.Scale&&(t.e[1].k=fn.toVgdKeyframeTrack("Scale",n.tracks.Scale,n.spawnTime)),n.tracks.Rotation&&(t.e[2].k=fn.toVgdKeyframeTrack("Rotation",n.tracks.Rotation,n.spawnTime)),n.tracks.Color&&(t.e[3].k=fn.toVgdKeyframeTrack("Color",n.tracks.Color,n.spawnTime)),n.parentId&&(t.p_id=n.parentId),n.origin&&n.origin.x!==0&&n.origin.y!==0&&(t.o=structuredClone(n.origin)),n.zOffset&&n.zOffset!==-30&&(t.d=Math.max(Math.min(0-Math.floor(n.zOffset),60),0)),n.parentSettings){const s=[n.parentSettings.Move?.enabled?"1":"0",n.parentSettings.Scale?.enabled?"1":"0",n.parentSettings.Rotation?.enabled?"1":"0"],i=[n.parentSettings.Move?.offset??0,n.parentSettings.Scale?.offset??0,n.parentSettings.Rotation?.offset??0];s.join("")!=="101"&&(t.p_t=s.join("")),i.every(r=>r==0)||(t.p_o=i)}if(n.mesh){t.ot=5;const{s,so:i}=k0(n.mesh);s>0&&(t.s=s),i>0&&(t.so=i)}else t.ot=6;return[t]},Jl=[{id:pt.TYPE,callback:Ql}];function ec(){Ks.init();for(const n of Jl){const{id:e,callback:t}=n;Ks.register(e,t)}}const tc=()=>({name:"Cube",vertices:[new M(-1,-1,-1),new M(1,-1,-1),new M(1,1,-1),new M(-1,1,-1),new M(-1,-1,1),new M(1,-1,1),new M(1,1,1),new M(-1,1,1)],faces:[[4,7,6,5],[1,2,3,0],[7,3,2,6],[4,5,1,0],[5,6,2,1],[0,3,7,4]]}),nc=()=>({name:"Dodecahedron",vertices:[new M(.57735,.57735,-.57735),new M(.57735,-.57735,-.57735),new M(.57735,.57735,.57735),new M(.57735,-.57735,.57735),new M(-.57735,.57735,-.57735),new M(-.57735,-.57735,-.57735),new M(-.57735,.57735,.57735),new M(-.57735,-.57735,.57735),new M(.356822,0,-.934172),new M(-.356822,0,-.934172),new M(.356822,0,.934172),new M(-.356822,0,.934172),new M(.934172,.356822,0),new M(.934172,-.356822,0),new M(-.934172,.356822,0),new M(-.934172,-.356822,0),new M(0,.934172,-.356822),new M(0,.934172,.356822),new M(0,-.934172,-.356822),new M(0,-.934172,.356822)],faces:[[0,8,9,4,16],[0,12,13,1,8],[0,16,17,2,12],[8,1,18,5,9],[12,2,10,3,13],[16,4,14,6,17],[9,5,15,14,4],[6,11,10,2,17],[3,19,18,1,13],[7,15,5,18,19],[7,11,6,14,15],[7,19,3,10,11]]}),sc=(n=1,e=0)=>{const t=(1+Math.sqrt(5))/2,s=[new M(-1,t,0).normalize(),new M(1,t,0).normalize(),new M(-1,-t,0).normalize(),new M(1,-t,0).normalize(),new M(0,-1,t).normalize(),new M(0,1,t).normalize(),new M(0,-1,-t).normalize(),new M(0,1,-t).normalize(),new M(t,0,-1).normalize(),new M(t,0,1).normalize(),new M(-t,0,-1).normalize(),new M(-t,0,1).normalize()];let i=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];const r=new Map,a=(o,h)=>{const l=Math.min(o,h),c=Math.max(o,h),f=`${l}-${c}`;if(r.has(f))return r.get(f);const u=s[o],d=s[h],m=u.clone().add(d).multiply(new M(.5)).normalize();s.push(m);const x=s.length-1;return r.set(f,x),x};for(let o=0;o<e;o++){const h=[];for(const l of i){const c=l[0],f=l[1],u=l[2],d=a(c,f),m=a(f,u),x=a(u,c);h.push([c,d,x]),h.push([f,m,d]),h.push([u,x,m]),h.push([d,m,x])}i=h}if(n!==1)for(const o of s)o.multiply(new M(n));return{name:"Icosahedron",vertices:s,faces:i}},Er={Cube:tc,Dodecahedron:nc,Icosahedron:sc};function ic(){dt.init();for(const n in Er){const t=Er[n];dt.registerMesh(t())}for(let n=0;n<We.length;n++)for(let e=0;e<We[n].length;e++){const t=structuredClone(We[n][e]),s={name:t.name,faces:t.faces,vertices:[]};t.vertices.forEach(i=>{s.vertices.push(new M().fromArray(i))}),dt.registerMesh(s,!0)}}function rc(){const n=performance.now();ic(),Kl(),ec(),Zl();const e=performance.now();console.info(`Finished initialization in ${e-n}ms`)}var ac=se('<span class="text-white/50 text-sm"> </span>'),oc=se('<div class="w-8 h-8"></div>'),hc=se('<div class="flex flex-col gap-4"><div class="w-full flex flex-col gap-2 mb-4"><div class="w-full flex gap-4"><!></div> <!></div> <div class="flex gap-4"><!> <!></div> <div class="flex gap-4"><!></div></div> <div class="flex flex-col gap-4"><div class="flex gap-4"><!> <!> <!> <!></div> <div class="flex gap-4"><!> <!> <!></div> <div class="flex gap-2 justify-center"><!></div></div>',1),lc=se(`<main class="max-w-screen max-h-screen flex flex-col gap-2"><section class="relative w-full bg-zinc-900/50 font-mono z-50 pointer-events-none"><!></section> <div class="flex grow"><section class="flex flex-col justify-between basis-1/3 p-4 gap-4"><!></section> <section class="flex w-full flex-1 min-h-0"><div class="w-full border-2 border-zinc-900 bg-black overflow-hidden" style="aspect-ratio:16/9;"><canvas class="w-full h-full block"></canvas></div></section></div> <section class="flex w-full gap-4"><button aria-label="Play / Pause" class="
        flex justify-center p-1 w-9 h-9
        bg-zinc-700 rounded-md font-bold
        hover:bg-amber-700 active:bg-amber-600
        active:scale-95
        transition-all duration-150

        bg-contain bg-no-repeat bg-origin-content 
      "></button> <svg class="w-full h-9 bg-zinc-900"><!></svg></section></main>`);function xc(n,e){gt(e,!0);let t=he(180),s=500,i=he(null),r=null,a=0,o=0,h=0,l=0,c=0,f=he(0),u=he(zi({opaque:0,transparent:0})),d=he(null),m=he(zi([])),x=he(void 0),g=Ft(()=>sn.stats),p=he(0),y=he(!1),b=he(!0),v=0;$a(()=>{rc(),X(i,r?new zn(null,r):new zn,!0),requestAnimationFrame(C)}),Ba(()=>{w(i)&&!w(i).isHeadless&&(w(i).renderer.dispose(),X(i,null))});function z(){if(w(y)){const L=performance.now();X(p,w(p)+(L-v)/1e3),v=L}else v=performance.now()}function C(){if(!w(i))return;z(),requestAnimationFrame(C);const L=performance.now();w(i).update(w(p)),h+=performance.now()-L,a++,X(b,w(i).cameraType=="perspective"),X(d,w(i)._theme,!0);const ne=performance.now();w(i).render(),l+=performance.now()-ne,o++,v-c>s&&w(y)&&T(ne,w(p))}function T(L,ne){const ge=L-c,Me=Math.round(a*1e3/ge),Mt=Math.round(o*1e3/ge),$n=o>0?h/o:0,Bn=a>0?l/a:0;X(f,ne,!0),X(u,{opaque:0,transparent:0},!0),ke.opaqueBatches.forEach(Ke=>{w(u).opaque+=Ke.size}),ke.transparentBatches.forEach(Ke=>{w(u).transparent+=Ke.size});const Zt=Math.floor(w(p)*1e3/s),je={ups:Me,fps:Mt,cpuMs:$n,renderMs:Bn,activeObjs:w(u)};X(x,je,!0),w(m)[Zt]?w(m)[Zt]=je:w(m).push(je),a=0,o=0,h=0,l=0,c=L}function R(L){if(!w(i)){alert("The editor has not loaded yet!");return}try{console.info("Loading level...");const ne=JSON.parse(L),ge=sn.levelFromVgd(ne);w(i).level=ge,X(t,Math.min(w(i).getEndTime(),300),!0),console.info(`Done! (${sn.stats.conversionTime}ms)`),X(g,sn.stats),X(m,[],!0),X(y,!0)}catch(ne){console.error(ne),alert(`There was an error parsing this level! Please report this!

Error: ${ne}`)}}function S(L){L.code=="Space"&&X(y,!w(y))}var A=lc();dn("keydown",Ns,S);var O=F(A),P=F(O);Ao(P,{get snapshots(){return w(m)},interval:s,get duration(){return w(t)},get currentSnapshot(){return w(x)}}),I(O);var $=j(O,2),V=F($),ie=F(V);{var ue=L=>{var ne=hc(),ge=Ds(ne),Me=F(ge),Mt=F(Me),$n=F(Mt);Ro($n,{onUpload:R}),I(Mt);var Bn=j(Mt,2);{var Zt=U=>{var Qe=ac(),Wn=F(Qe);I(Qe),ce(()=>$e(Wn,`Parsed ${w(g).objects??""} objects in ${w(g).conversionTime??""}ms`)),K(U,Qe)};Be(Bn,U=>{w(g)&&U(Zt)})}I(Me);var je=j(Me,2),Ke=F(je);Jn(Ke,{label:"Perspective",get isChecked(){return w(b)},onClick:()=>w(i).setCameraType("perspective")});var Fa=j(Ke,2);Jn(Fa,{label:"Freecam",isChecked:!0,onClick:()=>w(i).toggleFreecam()}),I(je);var mi=j(je,2),Oa=F(mi);{let U=Ft(()=>!w(b));Jn(Oa,{label:"Orthographic",get isChecked(){return w(U)},onClick:()=>w(i).setCameraType("orthographic")})}I(mi),I(ge);var pi=j(ge,2),Hn=F(pi),gi=F(Hn);Ue(gi,{value:0,shiftStep:.1,step:1,ctrlStep:10,onChange:U=>w(i).freecamPos.x=U,label:"Camera X"});var xi=j(gi,2);Ue(xi,{value:0,shiftStep:.1,step:1,ctrlStep:10,onChange:U=>w(i).freecamPos.y=U,label:"Camera Y"});var bi=j(xi,2);Ue(bi,{value:100,shiftStep:.1,step:1,ctrlStep:10,onChange:U=>w(i).freecamPos.z=U,label:"Camera Z"});var Pa=j(bi,2);Ue(Pa,{value:45,shiftStep:.1,step:1,ctrlStep:10,onChange:U=>w(i).freecamFov=U,label:"FoV"}),I(Hn);var Vn=j(Hn,2),yi=F(Vn);Ue(yi,{value:0,shiftStep:.1,step:1,ctrlStep:10,onChange:U=>w(i).freecamTarget.x=U,label:"Target X"});var vi=j(yi,2);Ue(vi,{value:0,shiftStep:.1,step:1,ctrlStep:10,onChange:U=>w(i).freecamTarget.y=U,label:"Target Y"});var Da=j(vi,2);Ue(Da,{value:0,shiftStep:.1,step:1,ctrlStep:10,onChange:U=>w(i).freecamTarget.z=U,label:"Target Z"}),I(Vn);var _i=j(Vn,2),Na=F(_i);{var La=U=>{var Qe=Ua(),Wn=Ds(Qe);mn(Wn,17,()=>w(d).objects,Nr,(ja,Xn)=>{var Mi=oc();ce(()=>js(Mi,`background-color: rgb(${w(Xn).r??""}, ${w(Xn).g??""}, ${w(Xn).b??""});`)),K(ja,Mi)}),K(U,Qe)};Be(Na,U=>{w(d)!==null&&U(La)})}I(_i),I(pi),K(L,ne)};Be(ie,L=>{w(i)&&L(ue)})}I(V);var re=j(V,2),ae=F(re),fe=F(ae);ti(fe,L=>r=L,()=>r),I(ae),I(re),I($);var _e=j($,2),pe=F(_e);pe.__click=()=>X(y,!w(y));var Ge=j(pe,2),Yt=F(Ge);Do(Yt,{get duration(){return w(t)},timeToPx:L=>(console.log(L),L),pxToTime:L=>(console.log(L),L),get timestamp(){return w(p)},set timestamp(L){X(p,L,!0)}}),I(Ge),I(_e),I(A),ce(()=>js(pe,`background-image: url(${po??""}/icons/${w(y)?"pause.png":"play.png"});`)),K(n,A),xt()}Ht(["click"]);export{xc as component};
